<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>项目技术 | wen chao</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_3129839_xft6cqs5gc.css">
    <meta name="description" content="架构进阶之路...">
    <meta name="keywords" content="全栈博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,js,ES6,TypeScript,vue">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.877370ef.css" as="style"><link rel="preload" href="/assets/js/app.af2629f3.js" as="script"><link rel="preload" href="/assets/js/2.c7acc05c.js" as="script"><link rel="preload" href="/assets/js/256.5a2b4630.js" as="script"><link rel="prefetch" href="/assets/js/10.003809e3.js"><link rel="prefetch" href="/assets/js/100.05e6d7b0.js"><link rel="prefetch" href="/assets/js/101.aedcfb99.js"><link rel="prefetch" href="/assets/js/102.0f45ef0b.js"><link rel="prefetch" href="/assets/js/103.f6349067.js"><link rel="prefetch" href="/assets/js/104.159e4fea.js"><link rel="prefetch" href="/assets/js/105.cf376772.js"><link rel="prefetch" href="/assets/js/106.4a24f110.js"><link rel="prefetch" href="/assets/js/107.9130a4fc.js"><link rel="prefetch" href="/assets/js/108.557f1de3.js"><link rel="prefetch" href="/assets/js/109.0eae2c98.js"><link rel="prefetch" href="/assets/js/11.46d1f704.js"><link rel="prefetch" href="/assets/js/110.be00b9ae.js"><link rel="prefetch" href="/assets/js/111.454bc20b.js"><link rel="prefetch" href="/assets/js/112.c987bc96.js"><link rel="prefetch" href="/assets/js/113.f07c8b3c.js"><link rel="prefetch" href="/assets/js/114.ab099d7d.js"><link rel="prefetch" href="/assets/js/115.a5bda3c7.js"><link rel="prefetch" href="/assets/js/116.eb280ad8.js"><link rel="prefetch" href="/assets/js/117.1863722f.js"><link rel="prefetch" href="/assets/js/118.3f192a2d.js"><link rel="prefetch" href="/assets/js/119.66b89deb.js"><link rel="prefetch" href="/assets/js/12.03486813.js"><link rel="prefetch" href="/assets/js/120.69b1d465.js"><link rel="prefetch" href="/assets/js/121.113b1b5a.js"><link rel="prefetch" href="/assets/js/122.917086b7.js"><link rel="prefetch" href="/assets/js/123.ef1b72cd.js"><link rel="prefetch" href="/assets/js/124.a52fd442.js"><link rel="prefetch" href="/assets/js/125.65cf0d15.js"><link rel="prefetch" href="/assets/js/126.9257bcef.js"><link rel="prefetch" href="/assets/js/127.c080527e.js"><link rel="prefetch" href="/assets/js/128.90389431.js"><link rel="prefetch" href="/assets/js/129.582bff3e.js"><link rel="prefetch" href="/assets/js/13.ba8e34d1.js"><link rel="prefetch" href="/assets/js/130.fb170212.js"><link rel="prefetch" href="/assets/js/131.ed138ac9.js"><link rel="prefetch" href="/assets/js/132.4223d6f9.js"><link rel="prefetch" href="/assets/js/133.012411be.js"><link rel="prefetch" href="/assets/js/134.ed98c78a.js"><link rel="prefetch" href="/assets/js/135.2b6eb13f.js"><link rel="prefetch" href="/assets/js/136.65149943.js"><link rel="prefetch" href="/assets/js/137.341d7363.js"><link rel="prefetch" href="/assets/js/138.e9834544.js"><link rel="prefetch" href="/assets/js/139.ff517435.js"><link rel="prefetch" href="/assets/js/14.71b2ed4a.js"><link rel="prefetch" href="/assets/js/140.bf2b9d2d.js"><link rel="prefetch" href="/assets/js/141.ef8d876a.js"><link rel="prefetch" href="/assets/js/142.c28e6ef9.js"><link rel="prefetch" href="/assets/js/143.d0b43d89.js"><link rel="prefetch" href="/assets/js/144.9545dbb1.js"><link rel="prefetch" href="/assets/js/145.c5c5aca2.js"><link rel="prefetch" href="/assets/js/146.c6989cd8.js"><link rel="prefetch" href="/assets/js/147.fe16ad8a.js"><link rel="prefetch" href="/assets/js/148.102ea00d.js"><link rel="prefetch" href="/assets/js/149.2e62b9d1.js"><link rel="prefetch" href="/assets/js/15.1736a531.js"><link rel="prefetch" href="/assets/js/150.daf684ac.js"><link rel="prefetch" href="/assets/js/151.988a3ba9.js"><link rel="prefetch" href="/assets/js/152.4742bb74.js"><link rel="prefetch" href="/assets/js/153.02bcce99.js"><link rel="prefetch" href="/assets/js/154.ebde7923.js"><link rel="prefetch" href="/assets/js/155.c906862e.js"><link rel="prefetch" href="/assets/js/156.3b3d94d4.js"><link rel="prefetch" href="/assets/js/157.81d8c740.js"><link rel="prefetch" href="/assets/js/158.40095645.js"><link rel="prefetch" href="/assets/js/159.2abc32c5.js"><link rel="prefetch" href="/assets/js/16.fb9d3b9b.js"><link rel="prefetch" href="/assets/js/160.dfa13df3.js"><link rel="prefetch" href="/assets/js/161.5697eb79.js"><link rel="prefetch" href="/assets/js/162.fef5ab87.js"><link rel="prefetch" href="/assets/js/163.8b3dff03.js"><link rel="prefetch" href="/assets/js/164.826228d2.js"><link rel="prefetch" href="/assets/js/165.e0099d56.js"><link rel="prefetch" href="/assets/js/166.8294f6c0.js"><link rel="prefetch" href="/assets/js/167.d07b77dd.js"><link rel="prefetch" href="/assets/js/168.c23c0d7b.js"><link rel="prefetch" href="/assets/js/169.c7f7599b.js"><link rel="prefetch" href="/assets/js/17.e42188aa.js"><link rel="prefetch" href="/assets/js/170.b11ea482.js"><link rel="prefetch" href="/assets/js/171.73278046.js"><link rel="prefetch" href="/assets/js/172.040cd7fc.js"><link rel="prefetch" href="/assets/js/173.e0199ce5.js"><link rel="prefetch" href="/assets/js/174.3010733d.js"><link rel="prefetch" href="/assets/js/175.05c196ea.js"><link rel="prefetch" href="/assets/js/176.c490fc2b.js"><link rel="prefetch" href="/assets/js/177.7bcb888a.js"><link rel="prefetch" href="/assets/js/178.34093cd3.js"><link rel="prefetch" href="/assets/js/179.b2413571.js"><link rel="prefetch" href="/assets/js/18.383f6a09.js"><link rel="prefetch" href="/assets/js/180.9648ec05.js"><link rel="prefetch" href="/assets/js/181.342f0059.js"><link rel="prefetch" href="/assets/js/182.35eac70e.js"><link rel="prefetch" href="/assets/js/183.f4a83742.js"><link rel="prefetch" href="/assets/js/184.d82b8a96.js"><link rel="prefetch" href="/assets/js/185.9f5f32ef.js"><link rel="prefetch" href="/assets/js/186.600a4950.js"><link rel="prefetch" href="/assets/js/187.df953d4f.js"><link rel="prefetch" href="/assets/js/188.2491fa83.js"><link rel="prefetch" href="/assets/js/189.32d3c1a4.js"><link rel="prefetch" href="/assets/js/19.cb72d9a9.js"><link rel="prefetch" href="/assets/js/190.39ac92fc.js"><link rel="prefetch" href="/assets/js/191.3125fa77.js"><link rel="prefetch" href="/assets/js/192.7655632a.js"><link rel="prefetch" href="/assets/js/193.7f55a678.js"><link rel="prefetch" href="/assets/js/194.b9c56642.js"><link rel="prefetch" href="/assets/js/195.189fe681.js"><link rel="prefetch" href="/assets/js/196.71658166.js"><link rel="prefetch" href="/assets/js/197.af445c6a.js"><link rel="prefetch" href="/assets/js/198.1de2afd9.js"><link rel="prefetch" href="/assets/js/199.2c218726.js"><link rel="prefetch" href="/assets/js/20.0e9f2f72.js"><link rel="prefetch" href="/assets/js/200.26590f9f.js"><link rel="prefetch" href="/assets/js/201.36d7a8ea.js"><link rel="prefetch" href="/assets/js/202.6c36d934.js"><link rel="prefetch" href="/assets/js/203.d4ae9b00.js"><link rel="prefetch" href="/assets/js/204.c3b2f994.js"><link rel="prefetch" href="/assets/js/205.f480166b.js"><link rel="prefetch" href="/assets/js/206.90dc53ae.js"><link rel="prefetch" href="/assets/js/207.f959801b.js"><link rel="prefetch" href="/assets/js/208.5da4dac0.js"><link rel="prefetch" href="/assets/js/209.217e41a9.js"><link rel="prefetch" href="/assets/js/21.7a7c5c4f.js"><link rel="prefetch" href="/assets/js/210.fb1d985a.js"><link rel="prefetch" href="/assets/js/211.5a3d515c.js"><link rel="prefetch" href="/assets/js/212.bb654f9b.js"><link rel="prefetch" href="/assets/js/213.b8f5ac66.js"><link rel="prefetch" href="/assets/js/214.cfb1547f.js"><link rel="prefetch" href="/assets/js/215.a1de2fe7.js"><link rel="prefetch" href="/assets/js/216.d76003a4.js"><link rel="prefetch" href="/assets/js/217.ad201174.js"><link rel="prefetch" href="/assets/js/218.5adcad1a.js"><link rel="prefetch" href="/assets/js/219.9f3b9b01.js"><link rel="prefetch" href="/assets/js/22.b9540503.js"><link rel="prefetch" href="/assets/js/220.af64e5ad.js"><link rel="prefetch" href="/assets/js/221.379beb37.js"><link rel="prefetch" href="/assets/js/222.85aa5cd0.js"><link rel="prefetch" href="/assets/js/223.13475fe5.js"><link rel="prefetch" href="/assets/js/224.d06abfcb.js"><link rel="prefetch" href="/assets/js/225.1f738876.js"><link rel="prefetch" href="/assets/js/226.a09031a1.js"><link rel="prefetch" href="/assets/js/227.f6018b9a.js"><link rel="prefetch" href="/assets/js/228.ae3296e4.js"><link rel="prefetch" href="/assets/js/229.d9bcea85.js"><link rel="prefetch" href="/assets/js/23.6b5fd8ae.js"><link rel="prefetch" href="/assets/js/230.68a89532.js"><link rel="prefetch" href="/assets/js/231.b31aa02f.js"><link rel="prefetch" href="/assets/js/232.cc07d501.js"><link rel="prefetch" href="/assets/js/233.76443c50.js"><link rel="prefetch" href="/assets/js/234.5efbcd6a.js"><link rel="prefetch" href="/assets/js/235.dfcf36cf.js"><link rel="prefetch" href="/assets/js/236.4bb99856.js"><link rel="prefetch" href="/assets/js/237.79a22c20.js"><link rel="prefetch" href="/assets/js/238.1b592be7.js"><link rel="prefetch" href="/assets/js/239.a4c119aa.js"><link rel="prefetch" href="/assets/js/24.63372db7.js"><link rel="prefetch" href="/assets/js/240.22d7d47a.js"><link rel="prefetch" href="/assets/js/241.36336698.js"><link rel="prefetch" href="/assets/js/242.b7db4d20.js"><link rel="prefetch" href="/assets/js/243.f156bf47.js"><link rel="prefetch" href="/assets/js/244.14f3046b.js"><link rel="prefetch" href="/assets/js/245.984447ea.js"><link rel="prefetch" href="/assets/js/246.cd55bf13.js"><link rel="prefetch" href="/assets/js/247.d2a77b3d.js"><link rel="prefetch" href="/assets/js/248.c23e38fd.js"><link rel="prefetch" href="/assets/js/249.a0b42d1f.js"><link rel="prefetch" href="/assets/js/25.d3f99e2a.js"><link rel="prefetch" href="/assets/js/250.870b2e9a.js"><link rel="prefetch" href="/assets/js/251.ee8edd7f.js"><link rel="prefetch" href="/assets/js/252.15e2c05e.js"><link rel="prefetch" href="/assets/js/253.18d0fc46.js"><link rel="prefetch" href="/assets/js/254.39ecf5f7.js"><link rel="prefetch" href="/assets/js/255.d42ae6e7.js"><link rel="prefetch" href="/assets/js/257.df147154.js"><link rel="prefetch" href="/assets/js/258.f42bcf46.js"><link rel="prefetch" href="/assets/js/259.022f92f9.js"><link rel="prefetch" href="/assets/js/26.c6b54266.js"><link rel="prefetch" href="/assets/js/260.abb07bf2.js"><link rel="prefetch" href="/assets/js/261.74b1bebb.js"><link rel="prefetch" href="/assets/js/262.680edf56.js"><link rel="prefetch" href="/assets/js/263.0cdbe35a.js"><link rel="prefetch" href="/assets/js/264.ea699edd.js"><link rel="prefetch" href="/assets/js/265.cf168b25.js"><link rel="prefetch" href="/assets/js/266.18f03883.js"><link rel="prefetch" href="/assets/js/267.007dcd30.js"><link rel="prefetch" href="/assets/js/268.41de028b.js"><link rel="prefetch" href="/assets/js/269.e206560c.js"><link rel="prefetch" href="/assets/js/27.120b6069.js"><link rel="prefetch" href="/assets/js/270.164398a3.js"><link rel="prefetch" href="/assets/js/271.7d100757.js"><link rel="prefetch" href="/assets/js/272.0b83e5d3.js"><link rel="prefetch" href="/assets/js/273.f317bcb6.js"><link rel="prefetch" href="/assets/js/274.2947d9f0.js"><link rel="prefetch" href="/assets/js/275.e99b65f2.js"><link rel="prefetch" href="/assets/js/276.ea03cf89.js"><link rel="prefetch" href="/assets/js/277.93476fbc.js"><link rel="prefetch" href="/assets/js/278.db0ff8eb.js"><link rel="prefetch" href="/assets/js/279.b36007aa.js"><link rel="prefetch" href="/assets/js/28.91595b48.js"><link rel="prefetch" href="/assets/js/280.14723ae7.js"><link rel="prefetch" href="/assets/js/281.f27b79de.js"><link rel="prefetch" href="/assets/js/282.718708d7.js"><link rel="prefetch" href="/assets/js/283.f91a771c.js"><link rel="prefetch" href="/assets/js/284.25b1d4f7.js"><link rel="prefetch" href="/assets/js/285.a641722b.js"><link rel="prefetch" href="/assets/js/286.9d2d85fb.js"><link rel="prefetch" href="/assets/js/287.a8a0d7a2.js"><link rel="prefetch" href="/assets/js/288.ee27e2fe.js"><link rel="prefetch" href="/assets/js/289.e4300193.js"><link rel="prefetch" href="/assets/js/29.a5ef89d9.js"><link rel="prefetch" href="/assets/js/290.ba445f12.js"><link rel="prefetch" href="/assets/js/291.7a767d85.js"><link rel="prefetch" href="/assets/js/292.aa96cc76.js"><link rel="prefetch" href="/assets/js/293.e18d36c6.js"><link rel="prefetch" href="/assets/js/294.7113dff7.js"><link rel="prefetch" href="/assets/js/295.abae5e0e.js"><link rel="prefetch" href="/assets/js/296.010241c4.js"><link rel="prefetch" href="/assets/js/297.4bbe88fd.js"><link rel="prefetch" href="/assets/js/298.9f291f83.js"><link rel="prefetch" href="/assets/js/299.bf9e031a.js"><link rel="prefetch" href="/assets/js/3.1403d3ee.js"><link rel="prefetch" href="/assets/js/30.3bb57e98.js"><link rel="prefetch" href="/assets/js/300.fc58f3c4.js"><link rel="prefetch" href="/assets/js/301.69cd291f.js"><link rel="prefetch" href="/assets/js/302.c34ca8e9.js"><link rel="prefetch" href="/assets/js/303.25655f40.js"><link rel="prefetch" href="/assets/js/304.97a8e358.js"><link rel="prefetch" href="/assets/js/305.1c5e713f.js"><link rel="prefetch" href="/assets/js/306.b53f2ea6.js"><link rel="prefetch" href="/assets/js/307.e4a9a150.js"><link rel="prefetch" href="/assets/js/308.92931c17.js"><link rel="prefetch" href="/assets/js/309.6e452bde.js"><link rel="prefetch" href="/assets/js/31.f1ddaeee.js"><link rel="prefetch" href="/assets/js/310.6abc9668.js"><link rel="prefetch" href="/assets/js/311.1bd77809.js"><link rel="prefetch" href="/assets/js/312.78b7405d.js"><link rel="prefetch" href="/assets/js/313.3b23ded5.js"><link rel="prefetch" href="/assets/js/314.ae150cf1.js"><link rel="prefetch" href="/assets/js/315.d375ed9c.js"><link rel="prefetch" href="/assets/js/316.c8a05987.js"><link rel="prefetch" href="/assets/js/317.febd6c4f.js"><link rel="prefetch" href="/assets/js/318.34fe4d11.js"><link rel="prefetch" href="/assets/js/319.5b558d88.js"><link rel="prefetch" href="/assets/js/32.8019bc57.js"><link rel="prefetch" href="/assets/js/320.af89e963.js"><link rel="prefetch" href="/assets/js/321.f646b641.js"><link rel="prefetch" href="/assets/js/322.897f28f1.js"><link rel="prefetch" href="/assets/js/323.38229c39.js"><link rel="prefetch" href="/assets/js/324.7baf2418.js"><link rel="prefetch" href="/assets/js/325.e0225366.js"><link rel="prefetch" href="/assets/js/326.e30b69cd.js"><link rel="prefetch" href="/assets/js/327.6774c791.js"><link rel="prefetch" href="/assets/js/328.58239b5d.js"><link rel="prefetch" href="/assets/js/329.570eb01e.js"><link rel="prefetch" href="/assets/js/33.2009be2a.js"><link rel="prefetch" href="/assets/js/330.6c29d590.js"><link rel="prefetch" href="/assets/js/331.bbe673f1.js"><link rel="prefetch" href="/assets/js/332.6d2bbedd.js"><link rel="prefetch" href="/assets/js/333.7e60b6bd.js"><link rel="prefetch" href="/assets/js/334.9f9ea9bb.js"><link rel="prefetch" href="/assets/js/335.0f60cf92.js"><link rel="prefetch" href="/assets/js/336.3981edeb.js"><link rel="prefetch" href="/assets/js/337.0ca91dae.js"><link rel="prefetch" href="/assets/js/338.09e14c30.js"><link rel="prefetch" href="/assets/js/339.31147ffa.js"><link rel="prefetch" href="/assets/js/34.f4ffaa4e.js"><link rel="prefetch" href="/assets/js/340.b216b6b7.js"><link rel="prefetch" href="/assets/js/341.7af949b2.js"><link rel="prefetch" href="/assets/js/342.03e80905.js"><link rel="prefetch" href="/assets/js/343.147ff16c.js"><link rel="prefetch" href="/assets/js/344.c95f6de9.js"><link rel="prefetch" href="/assets/js/345.7cc8cfaa.js"><link rel="prefetch" href="/assets/js/346.d5ff42a4.js"><link rel="prefetch" href="/assets/js/347.f1f1478f.js"><link rel="prefetch" href="/assets/js/348.32ea340f.js"><link rel="prefetch" href="/assets/js/349.4d743984.js"><link rel="prefetch" href="/assets/js/35.6f997bc2.js"><link rel="prefetch" href="/assets/js/350.c218cb98.js"><link rel="prefetch" href="/assets/js/351.a6f08d8b.js"><link rel="prefetch" href="/assets/js/352.46538632.js"><link rel="prefetch" href="/assets/js/353.6702d9ff.js"><link rel="prefetch" href="/assets/js/354.10264327.js"><link rel="prefetch" href="/assets/js/355.bc66e304.js"><link rel="prefetch" href="/assets/js/356.36d9208c.js"><link rel="prefetch" href="/assets/js/357.708af07a.js"><link rel="prefetch" href="/assets/js/358.61ab6834.js"><link rel="prefetch" href="/assets/js/359.bb4ad887.js"><link rel="prefetch" href="/assets/js/36.5172c464.js"><link rel="prefetch" href="/assets/js/360.9ae57e7b.js"><link rel="prefetch" href="/assets/js/37.72aa4947.js"><link rel="prefetch" href="/assets/js/38.77129de5.js"><link rel="prefetch" href="/assets/js/39.01d84c7e.js"><link rel="prefetch" href="/assets/js/4.5517c98c.js"><link rel="prefetch" href="/assets/js/40.b2fb57bd.js"><link rel="prefetch" href="/assets/js/41.fa63fb49.js"><link rel="prefetch" href="/assets/js/42.c68fd691.js"><link rel="prefetch" href="/assets/js/43.071af6f3.js"><link rel="prefetch" href="/assets/js/44.99321348.js"><link rel="prefetch" href="/assets/js/45.4c105e24.js"><link rel="prefetch" href="/assets/js/46.91a5aa2c.js"><link rel="prefetch" href="/assets/js/47.18bd4930.js"><link rel="prefetch" href="/assets/js/48.deef5f67.js"><link rel="prefetch" href="/assets/js/49.12c80dd9.js"><link rel="prefetch" href="/assets/js/5.6b7a7b35.js"><link rel="prefetch" href="/assets/js/50.259ff32b.js"><link rel="prefetch" href="/assets/js/51.ee83db82.js"><link rel="prefetch" href="/assets/js/52.1cf54e16.js"><link rel="prefetch" href="/assets/js/53.821dd297.js"><link rel="prefetch" href="/assets/js/54.bf29c9d1.js"><link rel="prefetch" href="/assets/js/55.25e00784.js"><link rel="prefetch" href="/assets/js/56.b1112045.js"><link rel="prefetch" href="/assets/js/57.5923ed3a.js"><link rel="prefetch" href="/assets/js/58.ee7fa86f.js"><link rel="prefetch" href="/assets/js/59.7b9800f0.js"><link rel="prefetch" href="/assets/js/6.207c7bac.js"><link rel="prefetch" href="/assets/js/60.ca146265.js"><link rel="prefetch" href="/assets/js/61.77a27075.js"><link rel="prefetch" href="/assets/js/62.2839e098.js"><link rel="prefetch" href="/assets/js/63.6c8cdea8.js"><link rel="prefetch" href="/assets/js/64.1a5f538c.js"><link rel="prefetch" href="/assets/js/65.a3708a3e.js"><link rel="prefetch" href="/assets/js/66.63a1d86b.js"><link rel="prefetch" href="/assets/js/67.5563ad9d.js"><link rel="prefetch" href="/assets/js/68.182b4324.js"><link rel="prefetch" href="/assets/js/69.b695215c.js"><link rel="prefetch" href="/assets/js/7.00b0f0bb.js"><link rel="prefetch" href="/assets/js/70.819c0991.js"><link rel="prefetch" href="/assets/js/71.534cf941.js"><link rel="prefetch" href="/assets/js/72.b3c641ef.js"><link rel="prefetch" href="/assets/js/73.e613a0d5.js"><link rel="prefetch" href="/assets/js/74.d7fc07e0.js"><link rel="prefetch" href="/assets/js/75.d50101e4.js"><link rel="prefetch" href="/assets/js/76.18e7ac7b.js"><link rel="prefetch" href="/assets/js/77.bb898521.js"><link rel="prefetch" href="/assets/js/78.a08d2106.js"><link rel="prefetch" href="/assets/js/79.0f362a00.js"><link rel="prefetch" href="/assets/js/8.197a9ad8.js"><link rel="prefetch" href="/assets/js/80.8b74cf4c.js"><link rel="prefetch" href="/assets/js/81.3e8c87af.js"><link rel="prefetch" href="/assets/js/82.83cb55b7.js"><link rel="prefetch" href="/assets/js/83.7355f968.js"><link rel="prefetch" href="/assets/js/84.51061851.js"><link rel="prefetch" href="/assets/js/85.b5df8911.js"><link rel="prefetch" href="/assets/js/86.baf2296e.js"><link rel="prefetch" href="/assets/js/87.2e9ae95d.js"><link rel="prefetch" href="/assets/js/88.57a8401a.js"><link rel="prefetch" href="/assets/js/89.a0d99eba.js"><link rel="prefetch" href="/assets/js/9.53a0556a.js"><link rel="prefetch" href="/assets/js/90.6121d367.js"><link rel="prefetch" href="/assets/js/91.56f285e2.js"><link rel="prefetch" href="/assets/js/92.7d7c0428.js"><link rel="prefetch" href="/assets/js/93.17841bd6.js"><link rel="prefetch" href="/assets/js/94.832fcc1c.js"><link rel="prefetch" href="/assets/js/95.e9c523bc.js"><link rel="prefetch" href="/assets/js/96.d8aae52a.js"><link rel="prefetch" href="/assets/js/97.bd436fab.js"><link rel="prefetch" href="/assets/js/98.78f6e4f3.js"><link rel="prefetch" href="/assets/js/99.a405fc1f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.877370ef.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="wen chao" class="logo"> <span class="site-name can-hide">wen chao</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Algorithm" class="dropdown-title"><a href="/Algorithm/" class="link-title">Algorithm</a> <span class="title" style="display:none;">Algorithm</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/d8e764/" class="nav-link">Theory</a></li><li class="dropdown-item"><!----> <a href="/pages/81a4bd/" class="nav-link">LeetCode</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Spring" class="dropdown-title"><a href="/Spring/" class="link-title">Spring</a> <span class="title" style="display:none;">Spring</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/373439/" class="nav-link">Spring</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Technology" class="dropdown-title"><a href="/Technology/" class="link-title">Technology</a> <span class="title" style="display:none;">Technology</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/3b6841/" class="nav-link">DB</a></li><li class="dropdown-item"><!----> <a href="/pages/d7857e/" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/pages/b89362/" class="nav-link">Redis</a></li><li class="dropdown-item"><!----> <a href="/pages/ec8b81/" class="nav-link">MongoDB</a></li><li class="dropdown-item"><!----> <a href="/pages/4e3ff1/" class="nav-link">Zookeeper</a></li><li class="dropdown-item"><!----> <a href="/pages/a75fef/" class="nav-link">MQ</a></li><li class="dropdown-item"><!----> <a href="/pages/b194d7/" class="nav-link">Dubbo</a></li><li class="dropdown-item"><!----> <a href="/pages/371f2f/" class="nav-link">ElasticSearch</a></li><li class="dropdown-item"><!----> <a href="/pages/027aa3/" class="nav-link">Workflow</a></li><li class="dropdown-item"><!----> <a href="/pages/73ab4b/" class="nav-link">OAuth2</a></li><li class="dropdown-item"><!----> <a href="/pages/d7a38a/" class="nav-link">JPA</a></li><li class="dropdown-item"><!----> <a href="/pages/eb5dc1/" class="nav-link">Liquibase</a></li><li class="dropdown-item"><!----> <a href="/pages/e54277/" class="nav-link">Lombok</a></li><li class="dropdown-item"><!----> <a href="/pages/62e4f6/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/pages/13c836/" class="nav-link">Nginx</a></li><li class="dropdown-item"><!----> <a href="/pages/b50b3d/" class="nav-link">Mini Program</a></li><li class="dropdown-item"><!----> <a href="/pages/09d3b8/" class="nav-link">JVM</a></li><li class="dropdown-item"><!----> <a href="/pages/a526c7/" class="nav-link">Log</a></li><li class="dropdown-item"><!----> <a href="/pages/59cf4f/" class="nav-link">JDK</a></li><li class="dropdown-item"><!----> <a href="/pages/d50dab/" class="nav-link">Thymeleaf</a></li><li class="dropdown-item"><!----> <a href="/pages/97abaa/" class="nav-link">Maven</a></li><li class="dropdown-item"><!----> <a href="/pages/7879f1/" class="nav-link">Mybatis</a></li><li class="dropdown-item"><!----> <a href="/pages/745b7c/" class="nav-link">Network</a></li><li class="dropdown-item"><!----> <a href="/pages/274dac/" class="nav-link">Raspberrypi</a></li><li class="dropdown-item"><!----> <a href="/pages/87c097/" class="nav-link">Node</a></li><li class="dropdown-item"><!----> <a href="/pages/927664/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/pages/2c3f19/" class="nav-link">Vue</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Other" class="dropdown-title"><a href="/Other/" class="link-title">Other</a> <span class="title" style="display:none;">Other</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/fea344/" class="nav-link">Book</a></li><li class="dropdown-item"><!----> <a href="/pages/d62f72/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/pages/f3d338/" class="nav-link">问题</a></li><li class="dropdown-item"><!----> <a href="/pages/ff202b/" class="nav-link">友链</a></li><li class="dropdown-item"><!----> <a href="/pages/2b746e/" class="nav-link">证券</a></li></ul></div></div><div class="nav-item"><a href="/About/" class="nav-link">About</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Index" class="dropdown-title"><a href="/archives/" class="link-title">Index</a> <span class="title" style="display:none;">Index</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/touxiang-lanse.png"> <div class="blogger-info"><h3>wen chao</h3> <span>持之以恒做正确有价值的事!</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Algorithm" class="dropdown-title"><a href="/Algorithm/" class="link-title">Algorithm</a> <span class="title" style="display:none;">Algorithm</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/d8e764/" class="nav-link">Theory</a></li><li class="dropdown-item"><!----> <a href="/pages/81a4bd/" class="nav-link">LeetCode</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Spring" class="dropdown-title"><a href="/Spring/" class="link-title">Spring</a> <span class="title" style="display:none;">Spring</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/373439/" class="nav-link">Spring</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Technology" class="dropdown-title"><a href="/Technology/" class="link-title">Technology</a> <span class="title" style="display:none;">Technology</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/3b6841/" class="nav-link">DB</a></li><li class="dropdown-item"><!----> <a href="/pages/d7857e/" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/pages/b89362/" class="nav-link">Redis</a></li><li class="dropdown-item"><!----> <a href="/pages/ec8b81/" class="nav-link">MongoDB</a></li><li class="dropdown-item"><!----> <a href="/pages/4e3ff1/" class="nav-link">Zookeeper</a></li><li class="dropdown-item"><!----> <a href="/pages/a75fef/" class="nav-link">MQ</a></li><li class="dropdown-item"><!----> <a href="/pages/b194d7/" class="nav-link">Dubbo</a></li><li class="dropdown-item"><!----> <a href="/pages/371f2f/" class="nav-link">ElasticSearch</a></li><li class="dropdown-item"><!----> <a href="/pages/027aa3/" class="nav-link">Workflow</a></li><li class="dropdown-item"><!----> <a href="/pages/73ab4b/" class="nav-link">OAuth2</a></li><li class="dropdown-item"><!----> <a href="/pages/d7a38a/" class="nav-link">JPA</a></li><li class="dropdown-item"><!----> <a href="/pages/eb5dc1/" class="nav-link">Liquibase</a></li><li class="dropdown-item"><!----> <a href="/pages/e54277/" class="nav-link">Lombok</a></li><li class="dropdown-item"><!----> <a href="/pages/62e4f6/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/pages/13c836/" class="nav-link">Nginx</a></li><li class="dropdown-item"><!----> <a href="/pages/b50b3d/" class="nav-link">Mini Program</a></li><li class="dropdown-item"><!----> <a href="/pages/09d3b8/" class="nav-link">JVM</a></li><li class="dropdown-item"><!----> <a href="/pages/a526c7/" class="nav-link">Log</a></li><li class="dropdown-item"><!----> <a href="/pages/59cf4f/" class="nav-link">JDK</a></li><li class="dropdown-item"><!----> <a href="/pages/d50dab/" class="nav-link">Thymeleaf</a></li><li class="dropdown-item"><!----> <a href="/pages/97abaa/" class="nav-link">Maven</a></li><li class="dropdown-item"><!----> <a href="/pages/7879f1/" class="nav-link">Mybatis</a></li><li class="dropdown-item"><!----> <a href="/pages/745b7c/" class="nav-link">Network</a></li><li class="dropdown-item"><!----> <a href="/pages/274dac/" class="nav-link">Raspberrypi</a></li><li class="dropdown-item"><!----> <a href="/pages/87c097/" class="nav-link">Node</a></li><li class="dropdown-item"><!----> <a href="/pages/927664/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/pages/2c3f19/" class="nav-link">Vue</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Other" class="dropdown-title"><a href="/Other/" class="link-title">Other</a> <span class="title" style="display:none;">Other</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/fea344/" class="nav-link">Book</a></li><li class="dropdown-item"><!----> <a href="/pages/d62f72/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/pages/f3d338/" class="nav-link">问题</a></li><li class="dropdown-item"><!----> <a href="/pages/ff202b/" class="nav-link">友链</a></li><li class="dropdown-item"><!----> <a href="/pages/2b746e/" class="nav-link">证券</a></li></ul></div></div><div class="nav-item"><a href="/About/" class="nav-link">About</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Index" class="dropdown-title"><a href="/archives/" class="link-title">Index</a> <span class="title" style="display:none;">Index</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Book</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>性能调优专题</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>并发编程专题</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>源码框架专题</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>微服务专题</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>项目实战专题</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/6f8d3f/" class="sidebar-link">项目搭建</a></li><li><a href="/pages/3f9765/" aria-current="page" class="active sidebar-link">项目技术</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/3f9765/#电商项目总结" class="sidebar-link">电商项目总结</a></li><li class="sidebar-sub-header level2"><a href="/pages/3f9765/#项目简介" class="sidebar-link">项目简介</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/3f9765/#电商模式-b2b、b2c、c2b、c2c、o2o" class="sidebar-link">电商模式 B2B、B2C、C2B、C2C、O2O</a></li><li class="sidebar-sub-header level3"><a href="/pages/3f9765/#商城架构图" class="sidebar-link">商城架构图</a></li><li class="sidebar-sub-header level4"><a href="/pages/3f9765/#前后端分离-基础版" class="sidebar-link">前后端分离 基础版</a></li><li class="sidebar-sub-header level4"><a href="/pages/3f9765/#微服务三高架构版" class="sidebar-link">微服务三高架构版</a></li><li class="sidebar-sub-header level4"><a href="/pages/3f9765/#前置知识" class="sidebar-link">前置知识</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/3f9765/#服务端高并发分布式架构演进之路" class="sidebar-link">服务端高并发分布式架构演进之路</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/3f9765/#概述" class="sidebar-link">概述</a></li><li class="sidebar-sub-header level3"><a href="/pages/3f9765/#架构的演进" class="sidebar-link">架构的演进：</a></li><li class="sidebar-sub-header level4"><a href="/pages/3f9765/#单机架构-原始" class="sidebar-link">单机架构（原始）</a></li><li class="sidebar-sub-header level4"><a href="/pages/3f9765/#第一次演进-tomcat与数据库分开部署" class="sidebar-link">第一次演进：Tomcat与数据库分开部署</a></li><li class="sidebar-sub-header level4"><a href="/pages/3f9765/#第二次演进-引入本地缓存和分部署缓存" class="sidebar-link">第二次演进：引入本地缓存和分部署缓存</a></li><li class="sidebar-sub-header level4"><a href="/pages/3f9765/#第三次演进-引入反向代理和负载均衡" class="sidebar-link">第三次演进：引入反向代理和负载均衡</a></li><li class="sidebar-sub-header level4"><a href="/pages/3f9765/#第四次演进-数据库读写分离" class="sidebar-link">第四次演进：数据库读写分离</a></li><li class="sidebar-sub-header level4"><a href="/pages/3f9765/#第五次演进-数据库按业务分库" class="sidebar-link">第五次演进：数据库按业务分库</a></li><li class="sidebar-sub-header level4"><a href="/pages/3f9765/#第六次演进-把大表拆分为小表-分表" class="sidebar-link">第六次演进：把大表拆分为小表（分表）</a></li><li class="sidebar-sub-header level4"><a href="/pages/3f9765/#第七次演进-使用lvs或f5来使多个nginx负载均衡" class="sidebar-link">第七次演进：使用LVS或F5来使多个Nginx负载均衡</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/3f9765/#项目结构-技术-搭建" class="sidebar-link">项目结构，技术，搭建</a></li><li class="sidebar-sub-header level2"><a href="/pages/3f9765/#开发阶段" class="sidebar-link">开发阶段</a></li><li class="sidebar-sub-header level2"><a href="/pages/3f9765/#mall-web后台管理的前端部署" class="sidebar-link">mall_web后台管理的前端部署</a></li><li class="sidebar-sub-header level2"><a href="/pages/3f9765/#vscode开发工具安装使用-vue" class="sidebar-link">VSCode开发工具安装使用（VUE）</a></li><li class="sidebar-sub-header level2"><a href="/pages/3f9765/#mall整合springsecurity和jwt实现认证和授权" class="sidebar-link">mall整合SpringSecurity和JWT实现认证和授权</a></li><li class="sidebar-sub-header level2"><a href="/pages/3f9765/#es6快速入门" class="sidebar-link">ES6快速入门</a></li></ul></li><li><a href="/pages/165d97/" class="sidebar-link">商品详细页多级缓存实战1</a></li><li><a href="/pages/248afc/" class="sidebar-link">商品详细页多级缓存实战2</a></li><li><a href="/pages/cde965/" class="sidebar-link">商品详细页多级缓存实战3</a></li><li><a href="/pages/684f32/" class="sidebar-link">电商项目微服务架构拆分</a></li><li><a href="/pages/528503/" class="sidebar-link">电商项目微服务网关整合授权中心实现单点登录</a></li><li><a href="/pages/f4e7c3/" class="sidebar-link">ES电商项目笔记</a></li><li><a href="/pages/a076e7/" class="sidebar-link">秒杀系统-订单交易全链路优化实战</a></li><li><a href="/pages/17d7cb/" class="sidebar-link">秒杀系统-订单交易全链路优化实战2</a></li><li><a href="/pages/1cc02e/" class="sidebar-link">canal安装与使用和原理详解</a></li><li><a href="/pages/7c3ae9/" class="sidebar-link">秒杀链路兜底方案之限流和降级实战</a></li><li><a href="/pages/b3e1d7/" class="sidebar-link">Sharding分库分表实战</a></li><li><a href="/pages/21df2c/" class="sidebar-link">项目实战总结与项目管理分享</a></li><li><a href="/pages/98944c/" class="sidebar-link">中台建设和DDD</a></li><li><a href="/pages/b36dd7/" class="sidebar-link">Docker详解与部署微服务实战</a></li><li><a href="/pages/75ec88/" class="sidebar-link">Docker-Compose编排电商微服务项目实战</a></li><li><a href="/pages/e77282/" class="sidebar-link">自动化性能监控系统Prometheus-Grafana实战</a></li><li><a href="/pages/fd685e/" class="sidebar-link">Kubernetes快速实战与核心原理剖析</a></li><li><a href="/pages/cdff9c/" class="sidebar-link">Kubernetes电商微服务部署实战</a></li><li><a href="/pages/33fd02/" class="sidebar-link">电商项目性能优化实战</a></li><li><a href="/pages/c5f7e6/" class="sidebar-link">推荐系统-机器学习</a></li><li><a href="/pages/98b787/" class="sidebar-link">企业级IM系统后端架构实战</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>设计模式专题</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>面试</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>问题</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>友链</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>证券</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/Other/#Other" data-v-06225672>Other</a></li><li data-v-06225672><a href="/Other/#Book" data-v-06225672>Book</a></li><li data-v-06225672><a href="/Other/#项目实战专题" data-v-06225672>项目实战专题</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://gitee.com/nylg" target="_blank" title="作者" class="beLink" data-v-06225672>wenchao</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2021-09-23</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">项目技术<!----></h1>  <div class="theme-vdoing-content content__default"><h2 id="电商项目总结"><a href="#电商项目总结" class="header-anchor">#</a> 电商项目总结</h2> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/springboot/%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%E6%80%BB%E7%BB%93.png" alt="电商项目实战总结"></p> <h2 id="项目简介"><a href="#项目简介" class="header-anchor">#</a> 项目简介</h2> <h3 id="电商模式-b2b、b2c、c2b、c2c、o2o"><a href="#电商模式-b2b、b2c、c2b、c2c、o2o" class="header-anchor">#</a> 电商模式 B2B、B2C、C2B、C2C、O2O</h3> <p><strong>B2B 模式</strong>：Business to Business, 是指商家与商家建立的商业关系， 如：阿里巴巴</p> <p>**B2C 模式 **：Business to Consumer ， 商家直接把商品卖给用户（个人），既“商对客”模式，也就是场所的商业零售，直接面向消费者销售产品和服务。如：京东</p> <p><strong>C2B 模式</strong>：Consumer to Business ， 消费者对企业，现有消费者需求产生而后有企业生产</p> <p><strong>C2C 模式</strong>：Consumer to Consumer ,客户销售给客户， 如：咸鱼、淘宝</p> <p><strong>O2O 模式</strong>：Online To Offline,  线上销售、线下服务。如：饿了么，淘淘票</p> <h3 id="商城架构图"><a href="#商城架构图" class="header-anchor">#</a> 商城架构图</h3> <h4 id="前后端分离-基础版"><a href="#前后端分离-基础版" class="header-anchor">#</a> <strong>前后端分离 基础版</strong></h4> <ul><li><p>微服务形成之前的架构形态</p></li> <li><p>前后端分离 ，基于vue的后台管理系统</p></li></ul> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/baota/30.png" alt=""></p> <h4 id="微服务三高架构版"><a href="#微服务三高架构版" class="header-anchor">#</a> 微服务三高架构版</h4> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/baota/31.png" alt=""></p> <h4 id="前置知识"><a href="#前置知识" class="header-anchor">#</a> 前置知识</h4> <ul><li>熟悉springboot及常用第三方框架整合</li> <li>熟悉SSM 框架使用</li> <li>熟悉Mysql数据库</li> <li>熟悉maven、 redis</li> <li>了解html、css、js</li> <li>熟练使用idea</li></ul> <h2 id="服务端高并发分布式架构演进之路"><a href="#服务端高并发分布式架构演进之路" class="header-anchor">#</a> 服务端高并发分布式架构演进之路</h2> <h3 id="概述"><a href="#概述" class="header-anchor">#</a> 概述</h3> <p>本文以淘宝作为例子，介绍从一百个并发到千万级并发情况下服务端的架构的演进过程，同时列举出每个演进阶段会遇到的相关技术，让大家对架构的演进有一个整体的认知，文章最后汇总了一些架构设计的原则。</p> <h3 id="架构的演进"><a href="#架构的演进" class="header-anchor">#</a> 架构的演进：</h3> <h4 id="单机架构-原始"><a href="#单机架构-原始" class="header-anchor">#</a> 单机架构（原始）</h4> <p>以淘宝为例子，在网站最初的时候，应用数量与用户数量都比较少，可以把Tomcat和数据库部署在同一个台服务器上。浏览器往www.taobao.com发起请求时，首先经果DNS服务器（域名系统）把域名转换成实际IP地址10.102.4.1，浏览器转而访问该IP对应的Tomcat。</p> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/baota/40.png" alt=""></p> <p>但是随着用户数量的增长，Tomcat和数据库之间竞争资源，单机性能不足以支撑业务。</p> <h4 id="第一次演进-tomcat与数据库分开部署"><a href="#第一次演进-tomcat与数据库分开部署" class="header-anchor">#</a> 第一次演进：Tomcat与数据库分开部署</h4> <p>Tomcat和数据库分别独占服务器资源，显著地提高两者各自的性能。</p> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/baota/41.png" alt=""></p> <p>但是随着用户数量的增长，并发读写数据库成为了性能的瓶颈。</p> <h4 id="第二次演进-引入本地缓存和分部署缓存"><a href="#第二次演进-引入本地缓存和分部署缓存" class="header-anchor">#</a> 第二次演进：引入本地缓存和分部署缓存</h4> <p>在Tomcat同服务器或同JVM中增加本地缓存，并在外部增加分布式缓存，缓存热门商品信息或热门商品的HTML页面等。通过缓存能把绝大多数请求在读写数据库前拦截掉，大大降低数据库压力。其中涉及的技术包括：使用<strong>Memcached</strong>作为本地缓存，使用Redis作为分布式缓存，还会涉及到缓存一致性、缓存穿透/击穿、缓存雪崩、热点数据集中失效等问题。</p> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/baota/42.png" alt=""></p> <p>缓存虽然抗住了大部分的访问请求，但是随着用户数量的增长，并发的压力还是主要落在单机的Tomcat上，响应逐渐变慢。</p> <h4 id="第三次演进-引入反向代理和负载均衡"><a href="#第三次演进-引入反向代理和负载均衡" class="header-anchor">#</a> 第三次演进：引入反向代理和负载均衡</h4> <p>在多台服务器上分别部署Tomcat，使用反向代理软件（Nginx）把请求均匀分发到每个Tomcat中。此处假设Tomcat最多支持100个并发，Nginx最多支持50000个并发，那么理论上Nginx把请求分发到500个Tomcat上，就能抗住50000个并发。其中涉及的技术包括：Nginx、HAProxy，两者都是工作在网络第七层（最高层、应用层）的反向代理软件，主要支持HTTP协议，还会涉及Session共享，文件上传、下载的问题。</p> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/baota/43.png" alt=""></p> <p>虽然反向代理使应用服务器可以支持的并发量大大增加，但是并发量的增加也意味着更多请求穿透到数据库，单机的数据库最终会称为性能瓶颈。</p> <h4 id="第四次演进-数据库读写分离"><a href="#第四次演进-数据库读写分离" class="header-anchor">#</a> 第四次演进：数据库读写分离</h4> <p>把数据库划分为读库和写库，读库可以有多个，通过同步机制把写库的数据同步到读库，对于需要查询最新写入数据的场景，可以在缓存中多写一份，通过缓存获得最新数据。其中涉及的技术包括：<strong>Mycat</strong>，它是数据库中间件，可通过它来组织数据库的读写分离和分库分表，客户端通过它来访问下层数据库，还会涉及数据同步，数据一致性的问题。</p> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/baota/44.png" alt=""></p> <p>但是随着业务逐渐变多，不同业务之间的访问量差距较大，不同业务直接竞争数据库资源，相互影响性能。</p> <h4 id="第五次演进-数据库按业务分库"><a href="#第五次演进-数据库按业务分库" class="header-anchor">#</a> 第五次演进：数据库按业务分库</h4> <p>把不同业务的数据保存到不同的数据库中，使业务之间的资源竞争降低。对于访问量大的业务，可以部署更多的服务器来支撑。虽然这样做会同时导致跨业务的表无法直接做关联分析，需要通过其他途径来解决，有兴趣的可以去搜索相关的解决方案。</p> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/baota/45.png" alt=""></p> <p>但是随着用户数量的增长，单机的写库会逐渐达到性能瓶颈。</p> <h4 id="第六次演进-把大表拆分为小表-分表"><a href="#第六次演进-把大表拆分为小表-分表" class="header-anchor">#</a> 第六次演进：把大表拆分为小表（分表）</h4> <p>比如针对评论数据，可以按照商品的ID进行Hash，路由到对应的表中存储；针对支付记录，可以按照支付的小时创建表，每个小时表继续拆分为小表，使用用户ID或记录编号来路由数据。只要实时操作的表数据量足够小，请求能够足够均匀地分发到多台服务器上的小表，那数据库就能通过水平扩展的方式来提升性能。其中前面提到的Mycat也支持在大表拆分为小表的情况下进行访问控制。</p> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/baota/46.png" alt=""></p> <p>这种做法显著地增加了数据库运维的难度，对DBA的要求较高。当数据库设计到这种结构时，已经可以称为分布式数据库，但是这只是一个逻辑的数据库整体，数据库里不同的组成部分是由不同的组件单独来实现的，<strong>比如分库分表的管理和请求分发由Mycat实现，SQL的解析由单机的数据库实现，读写分离可能由网关和消息队列来实现，查询结果的汇总可能由数据库接口层来实现等，这种架构其实是MPP（大规模并行处理）架构的一类实现</strong>。</p> <p><strong>目前开源和商用都已经有不少MPP数据库，开源中比较流行的有Greenplum、TiDB、Postgresql XC、HAWQ等，商用的如南大通用的GBase、睿帆科技的雪球DB、华为的LibraA等，不同的MPP数据库的侧重点也不一样，比如TiDB侧重于分布式OLTP场景，Greenplum侧重于分布式OLAP场景，这些MPP数据库基本都提供了类似Postgresql、Oracle、MySQL那样的SQL标准支持能力，能把一个查询解析为分布式的执行计划分发到每台机器上并行执行，最终由数据库本身汇总数据进行返回，也提供了注入权限管理、分库分表、事务、数据副本等能力，并且大多能够支持100个节点以上的集群，大大降低了数据库运维的成本，并且使数据库也能够水平扩展。</strong></p> <p>虽然数据库和Tomcat都能够水平扩展，可以支撑的并发量大幅提升，但是随着用户量的增长，最终单机的Nginx会成为性能上的瓶颈。</p> <h4 id="第七次演进-使用lvs或f5来使多个nginx负载均衡"><a href="#第七次演进-使用lvs或f5来使多个nginx负载均衡" class="header-anchor">#</a> 第七次演进：使用LVS或F5来使多个Nginx负载均衡</h4> <p>由于性能瓶颈在Nginx，因此无法通过两层的Nginx来实现多个Nginx的负载均衡。<strong>LVS和F5是工作在网络第四层的负载均衡解决方案，其中LVS是软件，运行在操作系统内核态，可对TCP请求或更高层级的网络协议进行转发，因此支持的协议更丰富，并且性能也远高于Nginx，可假设单机的LVS可支持几十万个并发的请求转发；F5是一种负载均衡硬件，与LVS提供的能力类似，性能比LVS更高，但价格昂贵</strong>。由于LVS是单机版的软件，若LVS所在服务器宕机则会导致整个后端系统都无法访问，因此需要有备用节点。可使用<strong>keepalived</strong>软件模拟出虚拟IP，然后把虚拟IP绑定到多台LVS服务器上，浏览器访问虚拟IP时，会被路由器重定向到真实的LVS服务器，当主LVS服务器宕机时，keepalived软件会自动更新路由器中的路由表，把虚拟IP重定向到另外一台正常的LVS服务器，从而达到LVS服务器高可用的效果。</p> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/baota/47.png" alt=""></p> <p>此处需要注意的是，上图中从Nginx层到Tomcat层这样画并不代表全部Nginx都转发请求到全部的Tomcat，在实际使用时，可能会是几个Nginx下面接一部分的Tomcat，这些Nginx之间通过keepalived实现高可用，其他的Nginx接另外的Tomcat，这样可接入的Tomcat数量就能成倍的增加。</p> <p>由于LVS也是单机的，随着并发数量增长到几十万时，LVS服务器最终会达到性能瓶颈，此时用户数量达到千万甚至上亿级别，用户分布在不同的地区，与服务器机房距离不同，导致了访问的延迟会明显不同。</p> <p><strong>3.9、第八次演进：通过DNS轮询实现机房之间的负载均衡</strong></p> <p>在DNS服务器中可配置一个域名对应多个IP地址，每个IP地址对应到不同的机房里的虚拟IP。当用户访问www.taobao.com时，DNS服务器会使用轮询策略或其他策略，来选择某个IP供用户访问。此方式能实现机房间的负载均衡，至此，系统可做到机房级别的水平扩展，千万级到亿级的并发量都可通过增加机房来解决，系统入口处的请求并发量不再是问题。</p> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/baota/48.png" alt=""></p> <p>但是随着数据的丰富程度和业务的发展，检索、分析等需求越来越丰富，单单依靠数据库无法解决如此丰富的需求。</p> <p><strong>3.10、第九次演进：引入NoSQL数据库和搜索引擎等技术</strong></p> <p>当数据库中的数据多到一定规模的时候，数据库就不适用于复杂查询了，往往只能满足普通查询的场景。对于统计报表的场景，在数据量大时不一定能跑出结果，而且在跑复杂查询时会导致其他查询变慢，对于全文检索、可变数据结构等场景，数据库天生不适用。因此需要针对特定的场景，引入合适的解决方案。如对于海量文件的存储，可以通过分布式文件系统HDFS解决，对于KEY-VALUE类型的数据，可以通过HBase和Redis等方案解决，对于全文检索场景，可以通过搜索引擎比如ElasticSearch解决，对于多维分析场景，可以通过Kylin或Druid等方案解决。当然，引入更多的组件同时会提高系统的复杂度，不同的组件保存的数据需要同步，需要考虑数据一致性的问题，需要有更多的运维手段来管理这些组件等。</p> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/baota/49.png" alt=""></p> <p>引入更多组件解决了丰富的需求，业务维度能够极大扩充，但是随之而来的是一个应用中包含了太多的业务代码，业务的升级迭代变得困难。</p> <p><strong>3.11、第十次演进：大应用拆分为小应用</strong></p> <p>按照业务板块来划分应用代码，使单个应用的职责更清晰，相互之间可以做到独立升级迭代。这时候应用之间可能会涉及到一些公共配置，可以通过分布式配置中心Zookeeper来解决。</p> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/baota/50.png" alt=""></p> <p>但是不同的应用之间可能存在共用的模块，由应用单独管理会导致相同的代码存在多份，导致公共功能在升级时全部应用代码都要跟着升级。</p> <p><strong>3.12、第十一次演进：复用的功能抽离成微服务</strong></p> <p>如用户管理、订单、支付、鉴权等功能在多个应用中都存在，那么可以把这些功能的代码单独抽取出来形成一个单独的服务来管理，这样的服务就是所谓的微服务，应用和服务之间通过HTTP、TCP或RPC请求等多种方式来访问公共服务，每个单独的服务都可以由单独的团队来管理。此外，可以通过Dubbo、SpringCloud等框架实现服务治理、限流、熔断、降级等功能，提高服务的稳定性和可用性。</p> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/baota/51.png" alt=""></p> <p>但是由于不同服务的接口访问方式不同，应用代码需要适配多种访问方式才能使用服务。此外，应用访问服务，服务之间也可能相互访问，调用链将会变得非常复杂，逻辑变得混乱。</p> <p><strong>3.13、第十二次演进：引入企业服务总线ESB屏蔽服务接口的访问差异</strong></p> <p>通过ESB统一进行访问协议转换，应用统一通过ESB来访问后端服务，服务与服务之间也通过ESB来相互调用，以此降低系统的耦合程度。这种单个应用拆分为多个应用，公共服务单独抽取出来来管理，并使用企业消息总线来解除服务之间耦合问题的架构，就是所谓的SOA（面向服务）架构，这种架构与微服务架构容易混淆，因为表现形式十分相似。个人理解，微服务架构更多是指把系统里的公共服务抽取出来单独运维管理的思想，而SOA架构则是指一种拆分服务并使服务接口访问变得统一的架构思想，SOA架构中包含了微服务的思想。</p> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/baota/52.png" alt=""></p> <p>但是随着业务不断发展，应用和服务都会不断变多，应用和服务的部署变得复杂，同一台服务器上部署多个服务还要解决运行环境冲突的问题。此外，对于如大促这类需要动态扩缩容的场景，需要水平扩展服务的场景，就需要在新增的服务器上准备运行环境，部署服务等，运维将变得十分困难。</p> <p><strong>3.14、第十三次演进：引入容器化技术实现运行环境隔离与动态服务管理</strong></p> <p>目前最流行的容器化技术是Docker，最流行的容器管理服务是Kubernetes(K8S)，应用/服务可以打包为Docker镜像，通过K8S来动态分发和部署镜像。Docker镜像可理解为一个能运行你的应用/服务的最小的操作系统，里面放着应用/服务的运行代码，运行环境根据实际的需要设置好。把整个“操作系统”打包为一个镜像后，就可以分发到需要部署相关服务的机器上，直接启动Docker镜像就可以把服务起起来，使服务的部署和运维变得简单。</p> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/baota/53.png" alt=""></p> <p>在大促的之前，可以在现有的机器集群上划分出服务器来启动Docker镜像，增强服务的性能，大促过后就可以关闭镜像，对机器上的其他服务不造成影响（在之前，服务运行在新增机器上需要修改系统配置来适配服务，这会导致机器上其他服务需要的运行环境被破坏）。</p> <p>但是虽然使用容器化技术后服务动态扩缩问题得以解决，但是机器还是需要公司自身来管理，在非大促的时候，还是需要闲置着大量的机器资源来应对大促，机器自身成本和运维成本都极高，资源利用率低。</p> <p><strong>3.15、第十四次演进：以云平台承载系统</strong></p> <p>系统可部署到公有云上，利用公有云的海量机器资源，解决动态硬件资源的问题，在大促的时间段里，在云平台中临时申请更多的资源，结合Docker和K8S来快速部署服务，在大促结束后释放资源，真正做到按需付费，资源利用率大大提高，同时大大降低了运维成本。</p> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/baota/54.png" alt=""></p> <h2 id="项目结构-技术-搭建"><a href="#项目结构-技术-搭建" class="header-anchor">#</a> 项目结构，技术，搭建</h2> <p><strong>结构介绍：</strong></p> <p><strong>1、后端项目</strong></p> <p><strong>1.1、项目演示</strong></p> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/project/1.png" alt=""></p> <p>专门为前端提供rest接口</p> <p>后台项目演示：<a href="http://localhost:8081/#/index" target="_blank" rel="noopener noreferrer">http://localhost:8081/ <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>1.2、使用技术</strong></p> <table><thead><tr><th>技术</th> <th>说明</th> <th>学习视频</th></tr></thead> <tbody><tr><td>Spring Boot</td> <td>容器+MVC框架</td> <td>https://www.tulingxueyuan.cn/video/XLSP819x0x819xXL100179x</td></tr> <tr><td>Spring Security</td> <td>认证和授权框架</td> <td>https://www.tulingxueyuan.cn/series/XL100195xxxx1</td></tr> <tr><td>MyBatis</td> <td>ORM框架</td> <td>https://www.tulingxueyuan.cn/video/XLSP582x0x582xXL100179x</td></tr> <tr><td>MyBatis-Plus</td> <td>MyBatis增强工具</td> <td>本项目使用</td></tr> <tr><td>MyBatis-Plus Generator</td> <td>数据层代码生成</td> <td>本项目使用</td></tr> <tr><td>Swagger-UI</td> <td>文档生产工具</td> <td>https://www.tulingxueyuan.cn/video/XLSP856x0x856xXL100179x</td></tr> <tr><td>Redis</td> <td>分布式缓存</td> <td>https://www.tulingxueyuan.cn/video/XLSP771x0x771xXL100184x</td></tr> <tr><td>Druid</td> <td>数据库连接池</td> <td>https://www.tulingxueyuan.cn/video/XLSP873x0x873xXL100179x</td></tr> <tr><td>OSS</td> <td>对象存储</td> <td>本项目使用</td></tr> <tr><td>Lombok</td> <td>简化对象封装工具</td> <td>本项目使用</td></tr></tbody></table> <p><strong>1.3、数据库表概览</strong></p> <p>mall项目目前有71张数据表，业务逻辑有一定复杂度，当然我们在开发中不一定会全用到， 这里所有的表是我们整个图灵商城的完整版</p> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/project/2.png" alt=""></p> <p><strong>1.4、数据库表前缀说明</strong></p> <ul><li>cms_*：内容管理模块相关表（暂不关心）</li> <li>oms_*：订单管理模块相关表</li> <li>pms_*：商品模块相关表</li> <li>sms_*：营销模块相关表（暂不关心）</li> <li>ums_*：会员模块相关表</li></ul> <p><strong>1.5、搭建：</strong></p> <ol><li><p>后端开发环境、工具</p></li> <li><ol><li><p>环境：jdk1.8  maven3.6+  、  mysql 、  redis</p></li> <li><p>工具：idea2019（mybatis插件、 lombok插件、translation插件）、 Postman 、Navicat、RedisStudio（github） redisdesktop</p></li> <li><ol><li><p>实在不会提供2份文档给你：</p></li> <li><ol><li><a href="https://note.youdao.com/ynoteshare1/index.html?id=866db703e9c2e464c8bca11617b82be3&amp;type=notebook#/D0756FA5981A4FA09928827514A5D7AE" target="_blank" rel="noopener noreferrer">mall在windows环境下运行.note<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://note.youdao.com/noteshare?id=93716db3b14c6d4aac8057f02dfcabc9&amp;sub=AF4E9B83048F45229B12E980BD52FB37" target="_blank" rel="noopener noreferrer">mall在Linux环境下的部署（基于Docker容器）.note<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ol></li></ol></li></ol></li> <li><p>提供后端脚手架</p></li> <li><ol><li><p>基于SpringBoot+MyBatis-Plus的快速开发脚手架，拥有完整的权限管理功能，可对接Vue前端，开箱即用。</p></li> <li><ol><li>项目结构</li></ol></li></ol></li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>src
├── common -- 用于存放通用代码
|   ├── api -- 通用结果集封装类
|   ├── config -- 通用配置类
|   ├── domain -- 通用封装对象
|   ├── exception -- 全局异常处理相关类
|   └── service -- 通用业务类
├── config -- SpringBoot中的Java配置
├── domain -- 共用封装对象
├── generator -- MyBatis-Plus代码生成器
├── modules -- 存放业务代码的基础包
|   └── ums -- 权限管理模块业务代码
|       ├── controller -- 该模块相关接口
|       ├── dto -- 该模块数据传输封装对象
|       ├── mapper -- 该模块相关Mapper接口
|       ├── model -- 该模块相关实体类
|       └── service -- 该模块相关业务处理类
 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><ol start="3"><li><p>导入提供的脚手架</p></li> <li><p>执行sql脚本：执行sql/tiny.sql</p></li></ol> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/project/3.png" alt=""></p> <p>4.修改本地的数据库 配置信息和 redis配置信息</p> <p>5.运行Main方法</p> <p><strong>6、后台前端项目</strong></p> <p><strong>5.1、项目演示</strong></p> <p>后台项目演示：http://localhost:8090/#/login</p> <p>核心功能：</p> <ul><li><p>商品模块</p></li> <li><ul><li>商品管理</li> <li>商品分类管理</li> <li>商品类型管理</li> <li>品牌管理</li></ul></li> <li><p>订单模块</p></li> <li><ul><li>订单管理</li></ul></li></ul> <p><strong>5.2、使用技术</strong></p> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/project/4.png" alt=""></p> <p>技术选型</p> <table><thead><tr><th>技术</th> <th>说明</th> <th>官网</th></tr></thead> <tbody><tr><td>Vue</td> <td>前端框架</td> <td>https://vuejs.org/</td></tr> <tr><td>Vue-router</td> <td>路由管理器</td> <td>https://router.vuejs.org/</td></tr> <tr><td>Vuex</td> <td>全局状态管理框架</td> <td>https://vuex.vuejs.org/</td></tr> <tr><td>Element</td> <td>前端UI框架</td> <td>https://element.eleme.io/</td></tr> <tr><td>Axios</td> <td>前端HTTP框架</td> <td>https://github.com/axios/axios</td></tr> <tr><td>v-charts</td> <td>基于Echarts的图表框架</td> <td>https://v-charts.js.org/</td></tr> <tr><td>Js-cookie</td> <td>cookie管理工具</td> <td>https://github.com/js-cookie/js-cookie</td></tr> <tr><td>nprogress</td> <td>进度条控件</td> <td>https://github.com/rstacruz/nprogress</td></tr> <tr><td>vue-element-admin</td> <td>项目脚手架参考</td> <td>https://github.com/PanJiaChen/vue-element-admin</td></tr></tbody></table> <p>项目布局</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>src -- 源码目录
├── api -- axios网络请求定义
├── assets -- 静态图片资源文件
├── components -- 通用组件封装
├── icons -- svg矢量图片文件
├── router -- vue-router路由配置
├── store -- vuex的状态管理
├── styles -- 全局css样式
├── utils -- 工具类
└── views -- 前端页面
    ├── home -- 首页
    ├── layout -- 通用页面加载框架
    ├── login -- 登录页
    ├── oms -- 订单模块页面
    ├── pms -- 商品模块页面
    └── sms -- 营销模块页面
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><strong>搭建：</strong></p> <ul><li><p>环境工具：</p></li> <li><ul><li><p>[VSCode 开发工具安装说明(Vue)](文档：VSCode 开发工具安装说明(Vue) 链接：http://note.youdao.com/noteshare?id=170fca3799165165cbfb77cd74d538e8&amp;sub=wcp1610523762595204)</p></li> <li><ul><li>1.安装vscode</li> <li>2.安装vscode插件</li> <li>\3. 解压前端开源项目：mall-admin-web-master-前端.zip</li> <li>4.在VSCode中选择“文件”---&gt;“打开 文件夹” 选择解压后的项目所在目录</li> <li>5.下载node并安装：https://nodejs.org/dist/v12.14.0/node-v12.14.0-x64.msi;</li></ul></li></ul></li> <li><p>检测是否安装成功</p></li></ul> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/project/5.png" alt=""></p> <ul><li>该项目为前后端分离项目，访问本地访问接口需搭建后台环境。(已完成http://localhost:8099/)</li> <li>设置npm的镜像 ,为避免出现下载失败等异常</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>1打开cmd使用命令：

npm config set registry https://registry.npm.taobao.org

2// 配置后可通过下面命令来验证是否成功
　npm config ls
// 此时：metrics-registry = &quot;http://registry.npm.taobao.org/&quot;表示设置成功

3// 
npm config get registry
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ul><li><p>在VsCode终端窗口中运行命令：npm install,下载相关依赖;</p></li> <li><ul><li>如出现报错， 最好用管理员的方式运行npm install</li></ul></li></ul> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/project/6.png" alt=""></p> <ul><li>运行项目之前需要将config/dev.env.js文件中的BASE_API改为http://localhost:你的后端项目的端口/</li></ul> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/project/7.png" alt=""></p> <ul><li>在VsCode终端窗口中运行命令：npm run dev,运行项目;</li></ul> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/project/8.png" alt=""></p> <p>启动成功：</p> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/project/9.png" alt=""></p> <ul><li><p>访问地址：<a href="http://localhost:8090/" target="_blank" rel="noopener noreferrer">http://localhost:8090<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 即可打开后台管理系统页面;</p></li> <li><ul><li><p>登录 admin  123456   如密码错误， 先用test 123456登录进去改密码</p></li> <li><p>如果登陆进去没有权限然后自动登出：请执行/sql/tiny.sql 文件</p></li> <li><p>如出现登录后自动登出</p></li> <li><ul><li>检查你的vue端， 你看下src/utils/request.js 里面有没有这句，如果注释请打开</li></ul></li></ul></li></ul> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/project/10.png" alt=""></p> <p><strong>6、前台前端项目</strong></p> <p><strong>5.1、项目演示</strong></p> <p>http://localhost:8081/</p> <p><strong>5.2、使用技术</strong></p> <p>技术选型</p> <table><thead><tr><th>技术</th> <th>说明</th> <th>官网</th></tr></thead> <tbody><tr><td>Vue</td> <td>前端框架</td> <td>https://vuejs.org/</td></tr> <tr><td>Vue-router</td> <td>路由框架</td> <td>https://router.vuejs.org/</td></tr> <tr><td>Vuex</td> <td>全局状态管理框架</td> <td>https://vuex.vuejs.org/</td></tr> <tr><td>Element</td> <td>前端UI框架</td> <td>https://element.eleme.io/</td></tr> <tr><td>Axios</td> <td>前端HTTP框架</td> <td>https://github.com/axios/axios</td></tr> <tr><td>Js-cookie</td> <td>cookie管理工具</td> <td>https://github.com/js-cookie/js-cookie</td></tr> <tr><td>nprogress</td> <td>进度条控件</td> <td>https://github.com/rstacruz/nprogress</td></tr></tbody></table> <p><strong>搭建：</strong></p> <ol><li>确定完成前端环境的搭建（包括vscode安装、nodejs安装、npm镜像）</li> <li>在VsCode终端窗口中运行命令：npm install,下载相关依赖;</li></ol> <ul><li><ul><li>如出现报错， 最好用管理员的方式运行npm install</li> <li>如果在安装前存在node_modules 请先删除</li> <li>安装成功：</li></ul></li></ul> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/project/11.png" alt=""></p> <ol start="3"><li>前台商城采用的是vue-cli3.x  所以修改后端的请求地址  和 前端的端口： /vue.config.js 文件中</li></ol> <ul><li>8081 是前台商城的端口：</li> <li>8888 是后端的请求地址：</li></ul> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/project/12.png" alt=""></p> <ol start="4"><li>运行npm run serve:</li></ol> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/project/14.png" alt=""></p> <h2 id="开发阶段"><a href="#开发阶段" class="header-anchor">#</a> 开发阶段</h2> <p>http://www.macrozheng.com/</p> <h2 id="mall-web后台管理的前端部署"><a href="#mall-web后台管理的前端部署" class="header-anchor">#</a> mall_web后台管理的前端部署</h2> <p>mall_web下的部署</p> <ul><li>修改prod.env.js文件的配置</li></ul> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/mail1/1.png" alt=""></p> <ul><li>使用命令进行打包</li></ul> <p>npm run build</p> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/mail1/2.png" alt=""></p> <ul><li>打包后的代码位置</li></ul> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/mail1/3.png" alt=""></p> <ul><li>将dist目录打包为dist.tar.gz文件</li></ul> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/mail1/4.png" alt=""></p> <ul><li>Linux上nginx的安装可以参考<a href="https://mp.weixin.qq.com/s/0fVMK107i5bBq8kGQqg8KA" target="_blank" rel="noopener noreferrer">mall在Linux环境下的部署（基于Docker容器）<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>中的nginx部分</li> <li>将dist.tar.gz上传到linux服务器（nginx相关目录）</li></ul> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/mail1/5.png" alt=""></p> <ul><li>使用该命令进行解压操作</li></ul> <p>tar -zxvf dist.tar.gz</p> <ul><li>删除nginx的html文件夹</li></ul> <p>rm -rf html</p> <ul><li>移动dist文件夹到html文件夹</li></ul> <p>mv dist html</p> <ul><li>运行mall-admin服务</li></ul> <p>docker start mall-admin</p> <ul><li>重启nginx</li></ul> <p>docker restart nginx</p> <ul><li>访问首页并登录：<a href="http://192.168.3.101/" target="_blank" rel="noopener noreferrer">http://192.168.3.101<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/mail1/6.png" alt=""></p> <ul><li>发现调用的是Linux服务器地址</li></ul> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/mail1/7.png" alt=""></p> <h2 id="vscode开发工具安装使用-vue"><a href="#vscode开发工具安装使用-vue" class="header-anchor">#</a> VSCode开发工具安装使用（VUE）</h2> <p><strong>1.安装vscode</strong></p> <p>https://code.visualstudio.com/</p> <p><strong>2.安装开发vue所需插件：</strong></p> <p>Vetur —— 语法高亮、智能感知、Emmet等</p> <p>包含格式化功能， Alt+Shift+F （格式化全文），Ctrl+K Ctrl+F（格式化选中代码，两个Ctrl需要同时按着）</p> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/mall4/1.png" alt=""></p> <p>EsLint —— 语法纠错</p> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/mall4/2.png" alt=""></p> <p>Debugger for Chrome —— 映射vscode上的断点到chrome上，方便调试（配置有点麻烦，其实我没用这个）</p> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/mall4/3.png" alt=""></p> <p>Auto Close Tag —— 自动闭合HTML/XML标签</p> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/mall4/4.png" alt=""></p> <p>Auto Rename Tag —— 自动完成另一侧标签的同步修改</p> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/mall4/5.png" alt=""></p> <p>JavaScript(ES6) code snippets —— ES6语法智能提示以及快速输入，除js外还支持.ts，.jsx，.tsx，.html，.vue，省去了配置其支持各种包含js代码文件的时间</p> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/mall4/6.png" alt=""></p> <p>Path Intellisense —— 自动路径补全</p> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/mall4/7.png" alt=""></p> <p>HTML CSS Support —— 让 html 标签上写class 智能提示当前项目所支持的样式</p> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/mall4/8.png" alt=""></p> <p>Beautify——格式化代码，值得注意的是，beautify插件支持自定义格式化代码规则</p> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/mall4/9.png" alt=""></p> <p>Bracket Pair Colorizer——给括号加上不同的颜色，便于区分不同的区块，使用者可以定义不同括号类型和不同颜色</p> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/mall4/10.png" alt=""></p> <p>open in browser——直接右键项目单击启动</p> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/mall4/11.png" alt=""></p> <p>chinese ——中文汉化</p> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/mall4/12.png" alt=""></p> <p>所有的</p> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/mall4/13.png" alt=""></p> <p><strong>3.安装开发nodejs所需环境</strong></p> <ul><li>下载node并安装：https://nodejs.org/dist/v12.14.0/node-v12.14.0-x64.msi;</li> <li>检测是否安装成功</li></ul> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/mall4/14.png" alt=""></p> <p><strong>4.设置npm的镜像</strong></p> <p>设置maven一个道理</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>1打开cmd使用命令：

npm config set registry https://registry.npm.taobao.org

2// 配置后可通过下面命令来验证是否成功
　npm config ls
// 此时：metrics-registry = &quot;http://registry.npm.taobao.org/&quot;表示设置成功

3// 
npm config get registry
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="mall整合springsecurity和jwt实现认证和授权"><a href="#mall整合springsecurity和jwt实现认证和授权" class="header-anchor">#</a> mall整合SpringSecurity和JWT实现认证和授权</h2> <p><strong>介绍</strong></p> <p><strong>SpringSecurity</strong></p> <p>https://vip.tulingxueyuan.cn/detail/p_602e308de4b029faba185b3b/6</p> <p>SpringSecurity是一个强大的可高度定制的认证和授权框架，对于Spring应用来说它是一套Web安全标准。SpringSecurity注重于为Java应用提供认证和授权功能，像所有的Spring项目一样，它对自定义需求具有强大的扩展性。</p> <p><strong>JWT</strong></p> <p>JWT是JSON WEB TOKEN的缩写，它是基于 RFC 7519 标准定义的一种可以安全传输的的JSON对象，由于使用了数字签名，所以是可信任和安全的。</p> <p>JWT的组成</p> <ul><li>JWT token的格式：header.payload.signature</li> <li>header中用于存放签名的生成算法</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>{&quot;alg&quot;: &quot;HS512&quot;}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>payload中用于存放用户名、token的生成时间和过期时间</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>{&quot;sub&quot;:&quot;admin&quot;,&quot;created&quot;:1489079981393,&quot;exp&quot;:1489684781}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>signature为以header和payload生成的签名，一旦header和payload被篡改，验证将失败</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>//secret为加密算法的密钥
String signature = HMACSHA512(base64UrlEncode(header) + &quot;.&quot; +base64UrlEncode(payload),secret)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>JWT实例</p> <p>这是一个JWT的字符串</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhZG1pbiIsImNyZWF0ZWQiOjE1NTY3NzkxMjUzMDksImV4cCI6MTU1NzM4MzkyNX0.d-iki0193X0bBOETf2UN3r3PotNIEAV7mzIxxeI5IxFyzzkOZxS0PGfF_SK6wxCv2K8S0cZjMkv6b5bCqc0VBw
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>可以在该网站上获得解析结果：https://jwt.io/</p> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/mall5/1.png" alt=""></p> <p><strong>JWT实现认证和授权的原理</strong></p> <ul><li>用户调用登录接口，登录成功后获取到JWT的token；</li> <li>之后用户每次调用接口都在http的header中添加一个叫Authorization的头，值为JWT的token；</li> <li>后台程序通过对Authorization头中信息的解码及数字签名校验来获取其中的用户信息，从而实现认证和授权。</li></ul> <p>Hutool</p> <p>Hutool是一个丰富的Java开源工具包,它帮助我们简化每一行代码，减少每一个方法，mall项目采用了此工具包。</p> <p><strong>项目使用表说明</strong></p> <ul><li>ums_admin：后台用户表</li> <li>ums_role：后台用户角色表</li> <li>ums_resource：后台用户权限表</li> <li>ums_admin_role_relation：后台用户和角色关系表，用户与角色是多对多关系</li> <li>ums_role_permission_relation：后台用户角色和权限关系表，角色与权限是多对多关系</li> <li>ums_admin_permission_relation：后台用户和权限关系表(除角色中定义的权限以外的加减权限)，加权限是指用户比角色多出的权限，减权限是指用户比角色少的权限</li></ul> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/mall5/2.png" alt=""></p> <p><strong>ums_admin</strong></p> <p>后台用户表，定义了后台用户的一些基本信息。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>create table ums_admin
(
   id                   bigint not null auto_increment,
   username             varchar(64) comment '用户名',
   password             varchar(64) comment '密码',
   icon                 varchar(500) comment '头像',
   email                varchar(100) comment '邮箱',
   nick_name            varchar(200) comment '昵称',
   note                 varchar(500) comment '备注信息',
   create_time          datetime comment '创建时间',
   login_time           datetime comment '最后登录时间',
   status               int(1) default 1 comment '帐号启用状态：0-&gt;禁用；1-&gt;启用',
   primary key (id)
);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><strong>ums_role</strong></p> <p>后台用户角色表，定义了后台用户角色的一些基本信息，通过给后台用户分配角色来实现菜单和资源的分配。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>create table ums_role
(
   id                   bigint not null auto_increment,
   name                 varchar(100) comment '名称',
   description          varchar(500) comment '描述',
   admin_count          int comment '后台用户数量',
   create_time          datetime comment '创建时间',
   status               int(1) default 1 comment '启用状态：0-&gt;禁用；1-&gt;启用',
   sort                 int default 0,
   primary key (id)
);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>ums_admin_role_relation</strong></p> <p>后台用户和角色关系表，多对多关系表，一个角色可以分配给多个用户。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>create table ums_admin_role_relation
(
   id                   bigint not null auto_increment,
   admin_id             bigint,
   role_id              bigint,
   primary key (id)
);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>ums_menu</strong></p> <p>后台菜单表，用于控制后台用户可以访问的菜单，支持隐藏、排序和更改名称、图标。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>create table ums_menu
(
   id                   bigint not null auto_increment,
   parent_id            bigint comment '父级ID',
   create_time          datetime comment '创建时间',
   title                varchar(100) comment '菜单名称',
   level                int(4) comment '菜单级数',
   sort                 int(4) comment '菜单排序',
   name                 varchar(100) comment '前端名称',
   icon                 varchar(200) comment '前端图标',
   hidden               int(1) comment '前端隐藏',
   primary key (id)
);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><strong>ums_resource</strong></p> <p>后台资源表，用于控制后台用户可以访问的接口，使用了Ant路径的匹配规则，可以使用通配符定义一系列接口的权限。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>create table ums_resource
(
   id                   bigint not null auto_increment,
   category_id          bigint comment '资源分类ID',
   create_time          datetime comment '创建时间',
   name                 varchar(200) comment '资源名称',
   url                  varchar(200) comment '资源URL',
   description          varchar(500) comment '描述',
   primary key (id)
);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>ums_resource_category</strong></p> <p>后台资源分类表，在细粒度进行权限控制时，可能资源会比较多，所以设计了个资源分类的概念，便于给角色分配资源。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>create table ums_resource_category
(
   id                   bigint not null auto_increment,
   create_time          datetime comment '创建时间',
   name                 varchar(200) comment '分类名称',
   sort                 int(4) comment '排序',
   primary key (id)
);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>ums_role_menu_relation</strong></p> <p>后台角色菜单关系表，多对多关系，可以给一个角色分配多个菜单。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>create table ums_role_menu_relation
(
   id                   bigint not null auto_increment,
   role_id              bigint comment '角色ID',
   menu_id              bigint comment '菜单ID',
   primary key (id)
);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>ums_role_resource_relation</strong></p> <p>后台角色资源关系表，多对多关系，可以给一个角色分配多个资源。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>create table ums_role_resource_relation
(
   id                   bigint not null auto_increment,
   role_id              bigint comment '角色ID',
   resource_id          bigint comment '资源ID',
   primary key (id)
);

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>整合SpringSecurity及JWT</strong></p> <p><strong>在pom.xml中添加项目依赖</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;!--SpringSecurity依赖配置--&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;!--Hutool Java工具包--&gt;
&lt;dependency&gt;
    &lt;groupId&gt;cn.hutool&lt;/groupId&gt;
    &lt;artifactId&gt;hutool-all&lt;/artifactId&gt;
    &lt;version&gt;4.5.7&lt;/version&gt;
&lt;/dependency&gt;
&lt;!--JWT(Json Web Token)登录支持--&gt;
&lt;dependency&gt;
    &lt;groupId&gt;io.jsonwebtoken&lt;/groupId&gt;
    &lt;artifactId&gt;jjwt&lt;/artifactId&gt;
    &lt;version&gt;0.9.0&lt;/version&gt;
&lt;/dependency&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p><strong>添加JWT token的工具类</strong></p> <p>用于生成和解析JWT token的工具类</p> <p>相关方法说明：</p> <ul><li>generateToken(UserDetails userDetails) :用于根据登录用户信息生成token</li> <li>getUserNameFromToken(String token)：从token中获取登录用户的信息</li> <li>validateToken(String token, UserDetails userDetails)：判断token是否还有效</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>package com.tulingxueyuan.mall.common.utils;

import io.jsonwebtoken.Claims;
import io.jsonwebtoken.Jwts;
import io.jsonwebtoken.SignatureAlgorithm;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.stereotype.Component;

import java.util.Date;
import java.util.HashMap;
import java.util.Map;

/**
 * JwtToken生成的工具类
 * Created by xushu on 2018/4/26.
 */
@Component
public class JwtTokenUtil {
    private static final Logger LOGGER = LoggerFactory.getLogger(JwtTokenUtil.class);
    private static final String CLAIM_KEY_USERNAME = &quot;sub&quot;;
    private static final String CLAIM_KEY_CREATED = &quot;created&quot;;
    @Value(&quot;${jwt.secret}&quot;)
    private String secret;
    @Value(&quot;${jwt.expiration}&quot;)
    private Long expiration;

    /**
     * 根据负责生成JWT的token
     */
    private String generateToken(Map&lt;String, Object&gt; claims) {
        return Jwts.builder()
                .setClaims(claims)
                .setExpiration(generateExpirationDate())
                .signWith(SignatureAlgorithm.HS512, secret)
                .compact();
    }

    /**
     * 从token中获取JWT中的负载
     */
    private Claims getClaimsFromToken(String token) {
        Claims claims = null;
        try {
            claims = Jwts.parser()
                    .setSigningKey(secret)
                    .parseClaimsJws(token)
                    .getBody();
        } catch (Exception e) {
            LOGGER.info(&quot;JWT格式验证失败:{}&quot;,token);
        }
        return claims;
    }

    /**
     * 生成token的过期时间
     */
    private Date generateExpirationDate() {
        return new Date(System.currentTimeMillis() + expiration * 1000);
    }

    /**
     * 从token中获取登录用户名
     */
    public String getUserNameFromToken(String token) {
        String username;
        try {
            Claims claims = getClaimsFromToken(token);
            username =  claims.getSubject();
        } catch (Exception e) {
            username = null;
        }
        return username;
    }

    /**
     * 验证token是否还有效
     *
     * @param token       客户端传入的token
     * @param userDetails 从数据库中查询出来的用户信息
     */
    public boolean validateToken(String token, UserDetails userDetails) {
        String username = getUserNameFromToken(token);
        return username.equals(userDetails.getUsername()) &amp;&amp; !isTokenExpired(token);
    }

    /**
     * 判断token是否已经失效
     */
    private boolean isTokenExpired(String token) {
        Date expiredDate = getExpiredDateFromToken(token);
        return expiredDate.before(new Date());
    }

    /**
     * 从token中获取过期时间
     */
    private Date getExpiredDateFromToken(String token) {
        Claims claims = getClaimsFromToken(token);
        return claims.getExpiration();
    }

    /**
     * 根据用户信息生成token
     */
    public String generateToken(UserDetails userDetails) {
        Map&lt;String, Object&gt; claims = new HashMap&lt;&gt;();
        claims.put(CLAIM_KEY_USERNAME, userDetails.getUsername());
        claims.put(CLAIM_KEY_CREATED, new Date());
        return generateToken(claims);
    }

    /**
     * 判断token是否可以被刷新
     */
    public boolean canRefresh(String token) {
        return !isTokenExpired(token);
    }

    /**
     * 刷新token
     */
    public String refreshToken(String token) {
        Claims claims = getClaimsFromToken(token);
        claims.put(CLAIM_KEY_CREATED, new Date());
        return generateToken(claims);
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br></div></div><p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/mall5/3.png" alt=""></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>package com.tulingxueyuan.mall.config;

import com.macro.mall.tiny.component.JwtAuthenticationTokenFilter;
import com.macro.mall.tiny.component.RestAuthenticationEntryPoint;
import com.macro.mall.tiny.component.RestfulAccessDeniedHandler;
import com.macro.mall.tiny.dto.AdminUserDetails;
import com.macro.mall.tiny.mbg.model.UmsAdmin;
import com.macro.mall.tiny.mbg.model.UmsPermission;
import com.macro.mall.tiny.service.UmsAdminService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.http.HttpMethod;
import org.springframework.security.authentication.AuthenticationManager;
import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;
import org.springframework.security.config.annotation.method.configuration.EnableGlobalMethodSecurity;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;
import org.springframework.security.config.http.SessionCreationPolicy;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.security.core.userdetails.UsernameNotFoundException;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;

import java.util.List;


/**
 * SpringSecurity的配置
 * Created by xushu 2018/4/26.
 */
@Configuration
@EnableWebSecurity
@EnableGlobalMethodSecurity(prePostEnabled=true)
public class SecurityConfig extends WebSecurityConfigurerAdapter {
    @Autowired
    private UmsAdminService adminService;
    @Autowired
    private RestfulAccessDeniedHandler restfulAccessDeniedHandler;
    @Autowired
    private RestAuthenticationEntryPoint restAuthenticationEntryPoint;

    @Override
    protected void configure(HttpSecurity httpSecurity) throws Exception {
        httpSecurity.csrf()// 由于使用的是JWT，我们这里不需要csrf
                .disable()
                .sessionManagement()// 基于token，所以不需要session
                .sessionCreationPolicy(SessionCreationPolicy.STATELESS)
                .and()
                .authorizeRequests()
                .antMatchers(HttpMethod.GET, // 允许对于网站静态资源的无授权访问
                        &quot;/&quot;,
                        &quot;/*.html&quot;,
                        &quot;/favicon.ico&quot;,
                        &quot;/**/*.html&quot;,
                        &quot;/**/*.css&quot;,
                        &quot;/**/*.js&quot;,
                        &quot;/swagger-resources/**&quot;,
                        &quot;/v2/api-docs/**&quot;
                )
                .permitAll()
                .antMatchers(&quot;/admin/login&quot;, &quot;/admin/register&quot;)// 对登录注册要允许匿名访问
                .permitAll()
                .antMatchers(HttpMethod.OPTIONS)//跨域请求会先进行一次options请求
                .permitAll()
//                .antMatchers(&quot;/**&quot;)//测试时全部运行访问
//                .permitAll()
                .anyRequest()// 除上面外的所有请求全部需要鉴权认证
                .authenticated();
        // 禁用缓存
        httpSecurity.headers().cacheControl();
        // 添加JWT filter
        httpSecurity.addFilterBefore(jwtAuthenticationTokenFilter(), UsernamePasswordAuthenticationFilter.class);
        //添加自定义未授权和未登录结果返回
        httpSecurity.exceptionHandling()
                .accessDeniedHandler(restfulAccessDeniedHandler)
                .authenticationEntryPoint(restAuthenticationEntryPoint);
    }

    @Override
    protected void configure(AuthenticationManagerBuilder auth) throws Exception {
        auth.userDetailsService(userDetailsService())
                .passwordEncoder(passwordEncoder());
    }

    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }

    @Bean
    public UserDetailsService userDetailsService() {
        //获取登录用户信息
        return username -&gt; {
            UmsAdmin admin = adminService.getAdminByUsername(username);
            if (admin != null) {
                List&lt;UmsPermission&gt; permissionList = adminService.getPermissionList(admin.getId());
                return new AdminUserDetails(admin,permissionList);
            }
            throw new UsernameNotFoundException(&quot;用户名或密码错误&quot;);
        };
    }

    @Bean
    public JwtAuthenticationTokenFilter jwtAuthenticationTokenFilter(){
        return new JwtAuthenticationTokenFilter();
    }

    @Bean
    @Override
    public AuthenticationManager authenticationManagerBean() throws Exception {
        return super.authenticationManagerBean();
    }

}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br></div></div><p>相关依赖及方法说明</p> <ul><li>configure(HttpSecurity httpSecurity)：用于配置需要拦截的url路径、jwt过滤器及出异常后的处理器；</li> <li>configure(AuthenticationManagerBuilder auth)：用于配置UserDetailsService及PasswordEncoder；</li> <li>RestfulAccessDeniedHandler：当用户没有访问权限时的处理器，用于返回JSON格式的处理结果；</li> <li>RestAuthenticationEntryPoint：当未登录或token失效时，返回JSON格式的结果；</li> <li>UserDetailsService:SpringSecurity定义的核心接口，用于根据用户名获取用户信息，需要自行实现；</li> <li>UserDetails：SpringSecurity定义用于封装用户信息的类（主要是用户信息和权限），需要自行实现；</li> <li>PasswordEncoder：SpringSecurity定义的用于对密码进行编码及比对的接口，目前使用的是BCryptPasswordEncoder；</li> <li>JwtAuthenticationTokenFilter：在用户名和密码校验前添加的过滤器，如果有jwt的token，会自行根据token信息进行登录。</li></ul> <p><strong>添加RestfulAccessDeniedHandler</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>package com.tulingxueyuan.mall.component;

import cn.hutool.json.JSONUtil;
import com.macro.mall.tiny.common.api.CommonResult;
import org.springframework.security.access.AccessDeniedException;
import org.springframework.security.web.access.AccessDeniedHandler;
import org.springframework.stereotype.Component;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;

/**
 * 当访问接口没有权限时，自定义的返回结果
 * Created by xushu on 2018/4/26.
 */
@Component
public class RestfulAccessDeniedHandler implements AccessDeniedHandler{
    @Override
    public void handle(HttpServletRequest request,
                       HttpServletResponse response,
                       AccessDeniedException e) throws IOException, ServletException {
        response.setCharacterEncoding(&quot;UTF-8&quot;);
        response.setContentType(&quot;application/json&quot;);
        response.getWriter().println(JSONUtil.parse(CommonResult.forbidden(e.getMessage())));
        response.getWriter().flush();
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p><strong>添加RestAuthenticationEntryPoint</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>package com.tulingxueyuan.mall.component;

import cn.hutool.json.JSONUtil;
import com.macro.mall.tiny.common.api.CommonResult;
import org.springframework.security.core.AuthenticationException;
import org.springframework.security.web.AuthenticationEntryPoint;
import org.springframework.stereotype.Component;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;

/**
 * 当未登录或者token失效访问接口时，自定义的返回结果
 * Created by xushu 2018/5/14.
 */
@Component
public class RestAuthenticationEntryPoint implements AuthenticationEntryPoint {
    @Override
    public void commence(HttpServletRequest request, HttpServletResponse response, AuthenticationException authException) throws IOException, ServletException {
        response.setCharacterEncoding(&quot;UTF-8&quot;);
        response.setContentType(&quot;application/json&quot;);
        response.getWriter().println(JSONUtil.parse(CommonResult.unauthorized(authException.getMessage())));
        response.getWriter().flush();
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p><strong>添加AdminUserDetails</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>package com.tulingxueyuan.mall.dto;

import com.macro.mall.tiny.mbg.model.UmsAdmin;
import com.macro.mall.tiny.mbg.model.UmsPermission;
import org.springframework.security.core.GrantedAuthority;
import org.springframework.security.core.authority.SimpleGrantedAuthority;
import org.springframework.security.core.userdetails.UserDetails;

import java.util.Collection;
import java.util.List;
import java.util.stream.Collectors;

/**
 * SpringSecurity需要的用户详情
 * Created by xushu on 2018/4/26.
 */
public class AdminUserDetails implements UserDetails {
    private UmsAdmin umsAdmin;
    private List&lt;UmsPermission&gt; permissionList;
    public AdminUserDetails(UmsAdmin umsAdmin, List&lt;UmsPermission&gt; permissionList) {
        this.umsAdmin = umsAdmin;
        this.permissionList = permissionList;
    }

    @Override
    public Collection&lt;? extends GrantedAuthority&gt; getAuthorities() {
        //返回当前用户的权限
        return permissionList.stream()
                .filter(permission -&gt; permission.getValue()!=null)
                .map(permission -&gt;new SimpleGrantedAuthority(permission.getValue()))
                .collect(Collectors.toList());
    }

    @Override
    public String getPassword() {
        return umsAdmin.getPassword();
    }

    @Override
    public String getUsername() {
        return umsAdmin.getUsername();
    }

    @Override
    public boolean isAccountNonExpired() {
        return true;
    }

    @Override
    public boolean isAccountNonLocked() {
        return true;
    }

    @Override
    public boolean isCredentialsNonExpired() {
        return true;
    }

    @Override
    public boolean isEnabled() {
        return umsAdmin.getStatus().equals(1);
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br></div></div><p><strong>添加JwtAuthenticationTokenFilter</strong></p> <p>在用户名和密码校验前添加的过滤器，如果请求中有jwt的token且有效，会取出token中的用户名，然后调用SpringSecurity的API进行登录操作。</p> <p><strong>由于 security 默认的登录方式不支持这种方式，需要重写过滤器，修改为支持从 header 中获取 token 值，根据 token 设置当前登录对象。</strong></p> <p><strong>思路大概为：App 端登录成功，后端返回 token 值，App 保存在本地后在后面的每次请求中都在 header 中带着 token 进行请求。后端重写过滤器，在过滤器中解析 token 值并将 token 中带的对象放到登录用户中，让 security 认为请求已经是在登录状态下进行。</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>package com.tulingxueyuan.mall.component;

import com.macro.mall.tiny.common.utils.JwtTokenUtil;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;
import org.springframework.security.core.context.SecurityContextHolder;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.security.web.authentication.WebAuthenticationDetailsSource;
import org.springframework.web.filter.OncePerRequestFilter;

import javax.servlet.FilterChain;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;

/**
 * JWT登录授权过滤器
 * Created by xushu on 2018/4/26.
 */
public class JwtAuthenticationTokenFilter extends OncePerRequestFilter {
    private static final Logger LOGGER = LoggerFactory.getLogger(JwtAuthenticationTokenFilter.class);
    @Autowired
    private UserDetailsService userDetailsService;
    @Autowired
    private JwtTokenUtil jwtTokenUtil;
    @Value(&quot;${jwt.tokenHeader}&quot;)
    private String tokenHeader;
    @Value(&quot;${jwt.tokenHead}&quot;)
    private String tokenHead;

    @Override
    protected void doFilterInternal(HttpServletRequest request,
                                    HttpServletResponse response,
                                    FilterChain chain) throws ServletException, IOException {
        String authHeader = request.getHeader(this.tokenHeader);
        if (authHeader != null &amp;&amp; authHeader.startsWith(this.tokenHead)) {
            String authToken = authHeader.substring(this.tokenHead.length());// The part after &quot;Bearer &quot;
            String username = jwtTokenUtil.getUserNameFromToken(authToken);
            LOGGER.info(&quot;checking username:{}&quot;, username);
            if (username != null &amp;&amp; SecurityContextHolder.getContext().getAuthentication() == null) {
                UserDetails userDetails = this.userDetailsService.loadUserByUsername(username);
                if (jwtTokenUtil.validateToken(authToken, userDetails)) {
                    UsernamePasswordAuthenticationToken authentication = new UsernamePasswordAuthenticationToken(userDetails, null, userDetails.getAuthorities());
                    authentication.setDetails(new WebAuthenticationDetailsSource().buildDetails(request));
                    LOGGER.info(&quot;authenticated user:{}&quot;, username);
                    SecurityContextHolder.getContext().setAuthentication(authentication);
                }
            }
        }
        chain.doFilter(request, response);
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div><p><a href="http://www.macrozheng.com/#/architect/mall_arch_05?id=%E7%99%BB%E5%BD%95%E6%B3%A8%E5%86%8C%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0" target="_blank" rel="noopener noreferrer">登录注册功能实现<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="http://www.macrozheng.com/#/architect/mall_arch_05?id=%E6%B7%BB%E5%8A%A0umsadmincontroller%E7%B1%BB" target="_blank" rel="noopener noreferrer">添加UmsAdminController类<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>实现了后台用户登录、注册及获取权限的接口</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>package com.macro.mall.tiny.controller;

import com.macro.mall.tiny.common.api.CommonResult;
import com.macro.mall.tiny.dto.UmsAdminLoginParam;
import com.macro.mall.tiny.mbg.model.UmsAdmin;
import com.macro.mall.tiny.mbg.model.UmsPermission;
import com.macro.mall.tiny.service.UmsAdminService;
import io.swagger.annotations.Api;
import io.swagger.annotations.ApiOperation;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Controller;
import org.springframework.validation.BindingResult;
import org.springframework.web.bind.annotation.*;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

/**
 * 后台用户管理
 * Created by xushu on 2018/4/26.
 */
@Controller
@Api(tags = &quot;UmsAdminController&quot;, description = &quot;后台用户管理&quot;)
@RequestMapping(&quot;/admin&quot;)
public class UmsAdminController {
    @Autowired
    private UmsAdminService adminService;
    @Value(&quot;${jwt.tokenHeader}&quot;)
    private String tokenHeader;
    @Value(&quot;${jwt.tokenHead}&quot;)
    private String tokenHead;

    @ApiOperation(value = &quot;用户注册&quot;)
    @RequestMapping(value = &quot;/register&quot;, method = RequestMethod.POST)
    @ResponseBody
    public CommonResult&lt;UmsAdmin&gt; register(@RequestBody UmsAdmin umsAdminParam, BindingResult result) {
        UmsAdmin umsAdmin = adminService.register(umsAdminParam);
        if (umsAdmin == null) {
            CommonResult.failed();
        }
        return CommonResult.success(umsAdmin);
    }

    @ApiOperation(value = &quot;登录以后返回token&quot;)
    @RequestMapping(value = &quot;/login&quot;, method = RequestMethod.POST)
    @ResponseBody
    public CommonResult login(@RequestBody UmsAdminLoginParam umsAdminLoginParam, BindingResult result) {
        String token = adminService.login(umsAdminLoginParam.getUsername(), umsAdminLoginParam.getPassword());
        if (token == null) {
            return CommonResult.validateFailed(&quot;用户名或密码错误&quot;);
        }
        Map&lt;String, String&gt; tokenMap = new HashMap&lt;&gt;();
        tokenMap.put(&quot;token&quot;, token);
        tokenMap.put(&quot;tokenHead&quot;, tokenHead);
        return CommonResult.success(tokenMap);
    }

    @ApiOperation(&quot;获取用户所有权限（包括+-权限）&quot;)
    @RequestMapping(value = &quot;/permission/{adminId}&quot;, method = RequestMethod.GET)
    @ResponseBody
    public CommonResult&lt;List&lt;UmsPermission&gt;&gt; getPermissionList(@PathVariable Long adminId) {
        List&lt;UmsPermission&gt; permissionList = adminService.getPermissionList(adminId);
        return CommonResult.success(permissionList);
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br></div></div><p><a href="http://www.macrozheng.com/#/architect/mall_arch_05?id=%E6%B7%BB%E5%8A%A0umsadminservice%E6%8E%A5%E5%8F%A3" target="_blank" rel="noopener noreferrer">添加UmsAdminService接口<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>package com.macro.mall.tiny.service;

import com.macro.mall.tiny.mbg.model.UmsAdmin;
import com.macro.mall.tiny.mbg.model.UmsPermission;

import java.util.List;

/**
 * 后台管理员Service
 * Created by xushu on 2018/4/26.
 */
public interface UmsAdminService {
    /**
     * 根据用户名获取后台管理员
     */
    UmsAdmin getAdminByUsername(String username);

    /**
     * 注册功能
     */
    UmsAdmin register(UmsAdmin umsAdminParam);

    /**
     * 登录功能
     * @param username 用户名
     * @param password 密码
     * @return 生成的JWT的token
     */
    String login(String username, String password);

    /**
     * 获取用户所有权限（包括角色权限和+-权限）
     */
    List&lt;UmsPermission&gt; getPermissionList(Long adminId);
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p><a href="http://www.macrozheng.com/#/architect/mall_arch_05?id=%E6%B7%BB%E5%8A%A0umsadminserviceimpl%E7%B1%BB" target="_blank" rel="noopener noreferrer">添加UmsAdminServiceImpl类<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>package com.macro.mall.tiny.service.impl;

import com.macro.mall.tiny.common.utils.JwtTokenUtil;
import com.macro.mall.tiny.dao.UmsAdminRoleRelationDao;
import com.macro.mall.tiny.dto.UmsAdminLoginParam;
import com.macro.mall.tiny.mbg.mapper.UmsAdminMapper;
import com.macro.mall.tiny.mbg.model.UmsAdmin;
import com.macro.mall.tiny.mbg.model.UmsAdminExample;
import com.macro.mall.tiny.mbg.model.UmsPermission;
import com.macro.mall.tiny.service.UmsAdminService;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.BeanUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.security.authentication.AuthenticationManager;
import org.springframework.security.authentication.BadCredentialsException;
import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;
import org.springframework.security.core.AuthenticationException;
import org.springframework.security.core.context.SecurityContextHolder;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.stereotype.Service;

import java.util.Date;
import java.util.List;

/**
 * UmsAdminService实现类
 * Created by xushu on 2018/4/26.
 */
@Service
public class UmsAdminServiceImpl implements UmsAdminService {
    private static final Logger LOGGER = LoggerFactory.getLogger(UmsAdminServiceImpl.class);
    @Autowired
    private UserDetailsService userDetailsService;
    @Autowired
    private JwtTokenUtil jwtTokenUtil;
    @Autowired
    private PasswordEncoder passwordEncoder;
    @Value(&quot;${jwt.tokenHead}&quot;)
    private String tokenHead;
    @Autowired
    private UmsAdminMapper adminMapper;
    @Autowired
    private UmsAdminRoleRelationDao adminRoleRelationDao;

    @Override
    public UmsAdmin getAdminByUsername(String username) {
        UmsAdminExample example = new UmsAdminExample();
        example.createCriteria().andUsernameEqualTo(username);
        List&lt;UmsAdmin&gt; adminList = adminMapper.selectByExample(example);
        if (adminList != null &amp;&amp; adminList.size() &gt; 0) {
            return adminList.get(0);
        }
        return null;
    }

    @Override
    public UmsAdmin register(UmsAdmin umsAdminParam) {
        UmsAdmin umsAdmin = new UmsAdmin();
        BeanUtils.copyProperties(umsAdminParam, umsAdmin);
        umsAdmin.setCreateTime(new Date());
        umsAdmin.setStatus(1);
        //查询是否有相同用户名的用户
        UmsAdminExample example = new UmsAdminExample();
        example.createCriteria().andUsernameEqualTo(umsAdmin.getUsername());
        List&lt;UmsAdmin&gt; umsAdminList = adminMapper.selectByExample(example);
        if (umsAdminList.size() &gt; 0) {
            return null;
        }
        //将密码进行加密操作
        String encodePassword = passwordEncoder.encode(umsAdmin.getPassword());
        umsAdmin.setPassword(encodePassword);
        adminMapper.insert(umsAdmin);
        return umsAdmin;
    }

    @Override
    public String login(String username, String password) {
        String token = null;
        try {
            UserDetails userDetails = userDetailsService.loadUserByUsername(username);
            if (!passwordEncoder.matches(password, userDetails.getPassword())) {
                throw new BadCredentialsException(&quot;密码不正确&quot;);
            }
            UsernamePasswordAuthenticationToken authentication = new UsernamePasswordAuthenticationToken(userDetails, null, userDetails.getAuthorities());
            SecurityContextHolder.getContext().setAuthentication(authentication);
            token = jwtTokenUtil.generateToken(userDetails);
        } catch (AuthenticationException e) {
            LOGGER.warn(&quot;登录异常:{}&quot;, e.getMessage());
        }
        return token;
    }


    @Override
    public List&lt;UmsPermission&gt; getPermissionList(Long adminId) {
        return adminRoleRelationDao.getPermissionList(adminId);
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br></div></div><p><a href="http://www.macrozheng.com/#/architect/mall_arch_05?id=%E4%BF%AE%E6%94%B9swagger%E7%9A%84%E9%85%8D%E7%BD%AE" target="_blank" rel="noopener noreferrer">修改Swagger的配置<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>通过修改配置实现调用接口自带Authorization头，这样就可以访问需要登录的接口了。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>package com.macro.mall.tiny.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import springfox.documentation.builders.ApiInfoBuilder;
import springfox.documentation.builders.PathSelectors;
import springfox.documentation.builders.RequestHandlerSelectors;
import springfox.documentation.service.ApiInfo;
import springfox.documentation.service.ApiKey;
import springfox.documentation.service.AuthorizationScope;
import springfox.documentation.service.SecurityReference;
import springfox.documentation.spi.DocumentationType;
import springfox.documentation.spi.service.contexts.SecurityContext;
import springfox.documentation.spring.web.plugins.Docket;
import springfox.documentation.swagger2.annotations.EnableSwagger2;

import java.util.ArrayList;
import java.util.List;

/**
 * Swagger2API文档的配置
 */
@Configuration
@EnableSwagger2
public class Swagger2Config {
    @Bean
    public Docket createRestApi(){
        return new Docket(DocumentationType.SWAGGER_2)
                .apiInfo(apiInfo())
                .select()
                //为当前包下controller生成API文档
                .apis(RequestHandlerSelectors.basePackage(&quot;com.macro.mall.tiny.controller&quot;))
                .paths(PathSelectors.any())
                .build()
                //添加登录认证
                .securitySchemes(securitySchemes())
                .securityContexts(securityContexts());
    }

    private ApiInfo apiInfo() {
        return new ApiInfoBuilder()
                .title(&quot;SwaggerUI演示&quot;)
                .description(&quot;mall-tiny&quot;)
                .contact(&quot;macro&quot;)
                .version(&quot;1.0&quot;)
                .build();
    }

    private List&lt;ApiKey&gt; securitySchemes() {
        //设置请求头信息
        List&lt;ApiKey&gt; result = new ArrayList&lt;&gt;();
        ApiKey apiKey = new ApiKey(&quot;Authorization&quot;, &quot;Authorization&quot;, &quot;header&quot;);
        result.add(apiKey);
        return result;
    }

    private List&lt;SecurityContext&gt; securityContexts() {
        //设置需要登录认证的路径
        List&lt;SecurityContext&gt; result = new ArrayList&lt;&gt;();
        result.add(getContextByPath(&quot;/brand/.*&quot;));
        return result;
    }

    private SecurityContext getContextByPath(String pathRegex){
        return SecurityContext.builder()
                .securityReferences(defaultAuth())
                .forPaths(PathSelectors.regex(pathRegex))
                .build();
    }

    private List&lt;SecurityReference&gt; defaultAuth() {
        List&lt;SecurityReference&gt; result = new ArrayList&lt;&gt;();
        AuthorizationScope authorizationScope = new AuthorizationScope(&quot;global&quot;, &quot;accessEverything&quot;);
        AuthorizationScope[] authorizationScopes = new AuthorizationScope[1];
        authorizationScopes[0] = authorizationScope;
        result.add(new SecurityReference(&quot;Authorization&quot;, authorizationScopes));
        return result;
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br></div></div><p><a href="http://www.macrozheng.com/#/architect/mall_arch_05?id=%E7%BB%99pmsbrandcontroller%E6%8E%A5%E5%8F%A3%E4%B8%AD%E7%9A%84%E6%96%B9%E6%B3%95%E6%B7%BB%E5%8A%A0%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90" target="_blank" rel="noopener noreferrer">给PmsBrandController接口中的方法添加访问权限<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ul><li>给查询接口添加pms:brand:read权限</li> <li>给修改接口添加pms:brand:update权限</li> <li>给删除接口添加pms:brand:delete权限</li> <li>给添加接口添加pms:brand:create权限</li></ul> <p>例子：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>@PreAuthorize(&quot;hasAuthority('pms:brand:read')&quot;)
public CommonResult&lt;List&lt;PmsBrand&gt;&gt; getBrandList() {
    return CommonResult.success(brandService.listAllBrand());
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><a href="http://www.macrozheng.com/#/architect/mall_arch_05?id=%E8%AE%A4%E8%AF%81%E4%B8%8E%E6%8E%88%E6%9D%83%E6%B5%81%E7%A8%8B%E6%BC%94%E7%A4%BA" target="_blank" rel="noopener noreferrer">认证与授权流程演示<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="http://www.macrozheng.com/#/architect/mall_arch_05?id=%E8%BF%90%E8%A1%8C%E9%A1%B9%E7%9B%AE%EF%BC%8C%E8%AE%BF%E9%97%AEapi" target="_blank" rel="noopener noreferrer">运行项目，访问API<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Swagger api地址：http://localhost:8080/swagger-ui.html</p> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/mall5/4.png" alt=""></p> <p><a href="http://www.macrozheng.com/#/architect/mall_arch_05?id=%E6%9C%AA%E7%99%BB%E5%BD%95%E5%89%8D%E8%AE%BF%E9%97%AE%E6%8E%A5%E5%8F%A3" target="_blank" rel="noopener noreferrer">未登录前访问接口<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/mall5/5.png" alt=""></p> <p><a href="http://www.macrozheng.com/#/architect/mall_arch_05?id=%E7%99%BB%E5%BD%95%E5%90%8E%E8%AE%BF%E9%97%AE%E6%8E%A5%E5%8F%A3" target="_blank" rel="noopener noreferrer">登录后访问接口<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ul><li>进行登录操作：登录帐号test 123456</li></ul> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/mall5/6.png" alt=""></p> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/mall5/10.png" alt=""></p> <ul><li>点击Authorize按钮，在弹框中输入登录接口中获取到的token信息</li></ul> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/mall5/7.png" alt=""></p> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/mall5/8.png" alt=""></p> <ul><li>登录后访问获取权限列表接口，发现已经可以正常访问</li></ul> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/mall5/9.png" alt=""></p> <h2 id="es6快速入门"><a href="#es6快速入门" class="header-anchor">#</a> ES6快速入门</h2> <p><strong>1、ECMAScript 6.0 简介</strong></p> <p><strong>ECMAScript 6.0</strong> (以下简称ES6, ECMAScript是一种由Ecma国际(前身为欧洲计算机制造商协会,英文名称是European Computer Manufacturers Association)通过ECMA-262标准化的脚本程序设计语言)<strong>一种脚本语言的****标准</strong>,已经在2015年6月正式发布了,并且从ECMAScript6开始,开始采用年号来做版本。即ECMAScript 2015,就是ECMAScript6它的目标,是使得JavaScript语言可以用来编写复杂的大型应用程序,成为企业级开发语言。<strong>每年一个新版本。</strong></p> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/mall5/20.png" alt=""></p> <p><strong>关键点：</strong></p> <ul><li>ECMAScript是每年更新的</li> <li>初始的ECMAScript版本是从1按照数字递增的：<strong>ES1</strong>,<strong>ES2</strong>,<strong>ES3</strong>,<strong>ES4</strong>,<strong>ES5</strong></li> <li>新的版本(从2015年开始)根据发布的年份命名：<strong>ES2015</strong>,<strong>ES2016</strong>,<strong>ES2017</strong></li> <li><strong>ECMAScript</strong>是个标准。<strong>Javascript</strong>是这个标准最流行普遍的实现。其他实现包括：SpiderMonkey,V8和ActionScript</li></ul> <p><strong>2、 ES6新特性-let&amp;const</strong></p> <p>我们以后会经常使用let来声明一个变量，还有一个const常量（声明之后不允许改变，一旦声明必须初始化，否则报错）</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;script&gt;
	 const a=3
	  a=4
//Uncaught TypeError: Assignment to constant variable. at let&amp;const.html:36

&lt;/script&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;script&gt;
//var声明的变量往往会越域
			//let声明的变量有严格的局部作用域
			{
				var a=1
				let b=2
			}
			console.log(a)
			console.log(b)
//Uncaught ReferenceError: b is not defined at let&amp;const.html:19
&lt;/script&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;script&gt;
			//var可以声明多次,let只可以声明一次
			var a=1
			var a=3
			let b=2
			let b=4
			console.log(a)
		    console.log(b)
//Uncaught SyntaxError: Identifier 'b' has already been declared		    
&lt;/script&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;script&gt;
		 //var会变量提升
		 //let不会变量提升
		 console.log(a)
		 var a=1
		 console.log(b)
		 let b=2
//let&amp;const.html:33 Uncaught ReferenceError: b is not defined at let&amp;const.html:33		 
&lt;/script&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>3、 ES6新特性-解构&amp;字符串</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;script&gt;
//数组解构
			let arr=[1,2,3];
			
			let d=arr[0];
			let b=arr[1];
			let c=arr[2];
			let [d,b,c]=arr;
			console.log(d,b,c);
&lt;/script&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;script&gt;
//对象解构
			let person={
				name: &quot;jack&quot;,
				age: 21,
				language: ['java','js','css'],
				
			}
       let {name,age,language}=person
       console.log(name,age,language) 
&lt;/script&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;script&gt;
			//字符串扩展
			let str=&quot;hello.vue&quot;;
			console.log(str.startsWith(&quot;hello&quot;))//true
			console.log(str.endsWith(&quot;.vue&quot;))//true
			console.log(str.includes(&quot;e&quot;));//true
			console.log(str.includes(&quot;hello&quot;))//true
&lt;/script&gt;		
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;script&gt;
			//字符串模板
			let ss=`&lt;div&gt;
                   &lt;a&gt;11&lt;/a&gt;
               &lt;/div&gt;`
			console.log(ss)//&lt;div&gt;&lt;a&gt;11&lt;/a&gt;&lt;/div&gt;
   
   
  
&lt;/script&gt;		
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;script&gt;
			let person={
				name: &quot;jack&quot;,
				age: 21,
				language: ['java','js','css'],
				
			}
			
			let {name,age,language}=person
       console.log(name,age,language) 
   
        //字符串插入变量和表达式.变量名写在${},${}中可以放入js表达式
        function fun(){
        return &quot;这是一个函数&quot;
        }
        
        let info=`我是${name},今年${age+10},我想说${fun()}`
        console.log(info)
&lt;/script&gt;		
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p><strong>4、 ES6新特性-函数优化</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;script&gt;
      
        //函数默认值
        //在ES6以前，我们无法给一个函数参数设置默认值，只能采用变通写法：
        function add(a, b) {
            // 判断b是否为空，为空就给默认值1
            b = b || 1;
            return a + b;
        }
        // 传一个参数
        console.log(add(10));


        //现在可以这么写：直接给参数写上默认值，没传就会自动使用默认值
        function add2(a, b = 1) {
            return a + b;
        }
        console.log(add2(20));
        
        //可变长度参数
        function fun(...values){
            console.log(values.length)
        }
        fun(5)
        fun(5,5,6)
        //简单的箭头函数
        function fun(a,b){
            return a+b;
        }
        var sum=(a,b) =&gt; a+b
        console.log(sum(11,11))
        
        
        
        //箭头函数
        const person={
        name: &quot;jack&quot;,
        age: 21,
        language: ['java','js','css'],
        
        }
        function hello (person) {
        console.log(person.name)
        }
        
        let hellos=(obj) =&gt; console.log(obj.name)
        hellos(person)//jack
&lt;/script&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><p><strong>5、 ES6新特性-对象优化</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;script&gt;
          // 对象的内置函数
         const person = {
            name: &quot;jack&quot;,
            age: 21,
            language: ['java', 'js', 'css']
        }

        console.log(Object.keys(person));//[&quot;name&quot;, &quot;age&quot;, &quot;language&quot;]
        console.log(Object.values(person));//[&quot;jack&quot;, 21, Array(3)]
        console.log(Object.entries(person));//[Array(2), Array(2), Array(2)]
        
        // 对象合并
        const target = { a: 1 };
        const source1 = { b: 2 };
        const source2 = { c: 3 };

        //{a:1,b:2,c:3}
        Object.assign(target, source1, source2);

        console.log(target);//{a:1,b:2,c:3}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code> //2）、声明对象简写
        const age = 23
        const name = &quot;&quot;
        const person1 = { age: age, name: name }

        const person2 = { age, name }
        console.log(person2);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>
         //3）、声明对象书写方式
			let person={
				name: &quot;xushu&quot;,
				eat: function(food){
					console.log(&quot;我吃了&quot;+food)
				},
				eat1: food =&gt; console.log(&quot;我吃了&quot;+food),
				eat3(food){
					console.log(&quot;我吃了&quot;+food)
					
				}
			}
			person.eat(&quot;香蕉&quot;)
			person.eat1(&quot;苹果&quot;)
			person.eat3(&quot;肥肠&quot;)
		&lt;/script&gt;
		//对象优化.html:12 我吃了香蕉
//对象优化.html:14 我吃了苹果
///对象优化.html:16 我吃了肥肠
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>	//4）、对象拓展运算符	
  &lt;script&gt;
//拷贝对象
		    let p1={
				name: &quot;zlj&quot;,
				age: 19
			}
			let someone={...p1}
			console.log(someone)
			//{name: &quot;zlj&quot;, age: 19}
&lt;/script&gt;	
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;script&gt;
//对象合并
		    let name={name: &quot;zlj&quot;}
			let age={age: 19}
			
			let someone={...name,...age}
			console.log(someone)
			//{name: &quot;zlj&quot;, age: 19}
&lt;/script&gt;		
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>6、 map，reduce</strong></p> <ul><li><strong>map</strong></li></ul> <p>map()方法：map，映射，即原数组映射成一个新的数组；</p> <p>map方法接受一个新参数，这个参数就是将原数组变成新数组的映射关系。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>//map()：接收一个函数，将原数组中的所有元素用这个函数处理后放入新数组返回。
         let arr = [1, 20, -5, 3];
         
         arr = arr.map((item)=&gt;{
             return item*2
         });
         arr = arr.map(item=&gt; item*2);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li><strong>reduce</strong></li></ul> <p>语法:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>arr.reduce(callback,[initialValue])
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>reduce为数组中的每一个元素依次执行回调函数，不包括数组中被删除或从未被赋值的元素，接受四个参数：初始值(或者上一次回调函数的返回值)，当前元素值，当前索引，调用reduce 的数组。</p> <p>callback ( 执行数组中每个值的函数，包含四个参数)</p> <p>1、previousValue ( 上一次调用回调返回的值，或者是提供的初始值(initialalue) )</p> <p>2、currentValue (数组中当前被处理的元素)</p> <p>3、index (当前元素在数组中的索引)</p> <p>4、array (调用reduce 的数组)</p> <p>initialValue (作为第 一次调用callback 的第一个参数。 )</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>		&lt;script&gt;
			//map():接受一个函数,将原来这个数组中的所有元素处理以后返回
			
			let arr=[1,2,3]
			arr1=arr.map(item =&gt; item*2)
			console.log(arr1)
			
			
			//reduce()：维数组中的每一个元素依次执行回调函数（不包括已删除的）
			 arr=arr.reduce((a,b) =&gt; {
				 console.log(&quot;上一次处理后：&quot;+a)
				 console.log(&quot;当前正在处理：&quot;+b)
				 return a+b
			 },1)
			 console.log(arr)
		&lt;/script&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>(3) [2, 4, 6]
map,reduce.html:18 上一次处理后：1
map,reduce.html:19 当前正在处理：1
map,reduce.html:18 上一次处理后：11
map,reduce.html:19 当前正在处理：2
map,reduce.html:18 上一次处理后：112
map,reduce.html:19 当前正在处理：3
map,reduce.html:22 1123
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>7、 promise异步编排</strong></p> <ul><li>在JavaScript的世界中，所有代码都是单线程执行的。由于这个“缺陷”，导致JavaScript的所有网络操作，浏览器事件，都必须是异步执行。异步执行可以用回调函数实现。一旦有一连串的ajax请求a,b,d…，后面的请求依赖前面的请求结果，就需要层层嵌套。这种缩进和层层嵌套的方式，非常容易造成上下文代码混乱，我们不得不非常小心翼翼处理内层函数与外层函数的数据，一旦内层函数使用了上层函数的变量，这种混乱程度就会加剧…总之，这种层叠上下文的层层嵌套方式，着实增加了神经的紧张程度。</li></ul> <p>案例：用户登录，并展示该用户的各科成绩。在页面发送两次请求:</p> <p>1.查询用户，查询成功说明可以登录</p> <p>2.查询用户成功，查询科目</p> <p>3.根据科目的查询结果，获取去成绩</p> <p>分析：此时后台应该提供三个接口，一个提供用户查询接口，一个提供科目的接口，一个提供各科成绩的接口，为了渲染方便，最好响应json数据。在这里就不编写后台接口了，而是提供三个json文件，直接提供json数据，模拟后台接口：</p> <p>我们以前使用的是ajax请求来完成，如下图</p> <p><img src="https://404500.oss-cn-beijing.aliyuncs.com/picture/mall5/21.png" alt=""></p> <p>我们作如上的操作发现是非常复杂的嵌套程序，无限嵌套的方式总是让人感觉到非常凌乱，不工整，我们希望有一种操作来给他们从新编排一下，让我们感觉到操作的顺序性，逻辑性，es6就给我提供了promise功能，如下演示</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;head&gt;
		&lt;meta charset=&quot;utf-8&quot;&gt;
		//要导入script 
        &lt;script src=&quot;https://cdn.bootcss.com/jquery/3.4.1/jquery.js&quot;&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;script &gt;
			//1.promise可以封装异步操作
			//resolve操作成功以后解析数据
			//reject操作失败来拒绝
			let p=new Promise((resolve,reject) =&gt; {
				//1.异步操作
				$.ajax({
					url: &quot;/mock/user.json&quot;,
					//操作成功以后解析数据
					sucess:function(data){
						console.log(&quot;查询用户成功：&quot;+data)
						resolve(data)
					},
					//操作失败来拒绝
					failure:function(err){
						console.log(&quot;查询用户失败：&quot;+err)
					
						reject(err)
					}
				});
			});
			p.then((obj) =&gt; {
			  return new promise((resolve,reject) =&gt; {
					console.log(&quot;接受到前面传来的信息：&quot;+obj);
					$.ajax({
						url: &quot;mock/user_corse_${obj.id}.json&quot;,
						//操作成功以后解析数据
						sucess:function(data){
							console.log(&quot;查询用户课程成功：&quot;+data)
							resolve(data)
						},
						//操作失败来拒绝
						failure:function(err){
							console.log(&quot;查询用户课程失败：&quot;+data)
							
							reject(err)
						}
					})
				})
				
			}).then((data) =&gt; {
				console.log(&quot;上一步的结果&quot;+data)
				$.ajax({
					url: &quot;mock/user_score_${data.id}.json&quot;,
					//操作成功以后解析数据
					sucess:function(data){
						console.log(&quot;查询用户课程分数成功：&quot;+data)
						resolve(data)
					},
					//操作失败来拒绝
					failure:function(err){
						console.log(&quot;查询用户课程分数失败：&quot;+data)
						
						reject(err)
					}
				})
			})
&lt;/script&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br></div></div><p>我们对上面的方法进行改造，把ajax的请求封装成一个方法，并返回</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;script&gt;
			//对上面的方法进行封装
			function get(url,data){
				return new Promise((resolve,reject) =&gt; {
					$.ajax({
						url: url,
						data: data,
						//操作成功以后解析数据
						sucess:function(data){
							console.log(&quot;查询用户课程分数成功：&quot;+data)
							resolve(data)
						},
						//操作失败来拒绝
						failure:function(err){
							console.log(&quot;查询用户课程分数失败：&quot;+data)
							
							reject(err)
						}
					})
				})
			}
			
			get(&quot;mock/user.json&quot;)
			.then( (data) =&gt; {
				console.log(&quot;用户查询成功-----&quot;)
			 return	get(&quot;mock/user_corse_${data.id}&quot;,data)
			 })
				.then((data) =&gt; {
					console.log(&quot;用户课程查询成功------&quot;)
				 return	get(&quot;mock/user_score_${data.id}&quot;,data)
				})
			      .then((data)=&gt;{
					  console.log(&quot;用户课程成绩查询成功-------&quot;)
					  
				  })
&lt;/script&gt;		
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p><strong>8、 模块化</strong></p> <p>1)、什么是模块化</p> <p>模块化就是把代码进行拆分，方便重复利用。类似java中的导包:要使用一一个包，必须先导包。而JS中没有包的概念，换来的是模块。</p> <p>在ES6中每一个模块即是一个文件，在文件中定义的变量，函数，对象在外部是无法获取的</p> <p>模块功能主要由两个命令构成: ‘export’ 和import’。</p> <ul><li><p>'export’命令用于规定模块的对外接口，如果你希望外部可以读取模块当中的内容，就必须使用export来对其进行暴露（输出）</p></li> <li><ul><li>export`不仅可以导出对象，一切JS变量都可以导出。比如：基本类型变量、函数、数组、对象。</li></ul></li> <li><p>import  命令永固导入模块</p></li></ul> <p>hello.js</p> <div class="language- line-numbers-mode"><pre class="language-text"><code> // 到处指定组件
 export const util = {
     sum(a, b) {
         return a + b;
     }
 }

// 到处默认组件
export default {
    sum(a, b) {
        return a + b;
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>user.js</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>var name = &quot;jack&quot;
var age = 21
function add(a,b){
    return a + b;
}

export {name,age,add}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>main.js</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>import abc from &quot;./hello.js&quot;
import {name,add} from &quot;./user.js&quot;

abc.sum(1,2);
console.log(name);
add(1,3);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>注意：</p> <p><strong>1.模块化一定要以web服务器方式运行</strong></p> <p><strong>2.如果要在html中运行要****在</strong></p></div></div>  <div class="page-edit"><!----> <!----> <!----></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/6f8d3f/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">项目搭建</div></a> <a href="/pages/165d97/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">商品详细页多级缓存实战1</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/6f8d3f/" class="prev">项目搭建</a></span> <span class="next"><a href="/pages/165d97/">商品详细页多级缓存实战1</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/80365f/"><div>
            证券市场基本法律法规
            <!----></div></a> <span class="date">03-13</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/d9e4f4/"><div>
            证券考试规则
            <!----></div></a> <span class="date">03-12</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/cb2c17/"><div>
            金融市场基础知识
            <!----></div></a> <span class="date">03-12</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:cloudjava@163.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/bigdatajava" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://gitee.com/nylg" title="Gitee" target="_blank" class="iconfont icon-gitee"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2014-2025
    <span>wen chao | <a href="https://github.com/bigdatajava/blog-talk/blob/main/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.af2629f3.js" defer></script><script src="/assets/js/2.c7acc05c.js" defer></script><script src="/assets/js/256.5a2b4630.js" defer></script>
  </body>
</html>

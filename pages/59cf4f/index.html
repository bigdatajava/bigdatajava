<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Java并发编程和高并发解决方案 | wen chao</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_3129839_xft6cqs5gc.css">
    <meta name="description" content="架构进阶之路...">
    <meta name="keywords" content="全栈博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,js,ES6,TypeScript,vue">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.877370ef.css" as="style"><link rel="preload" href="/assets/js/app.af2629f3.js" as="script"><link rel="preload" href="/assets/js/2.c7acc05c.js" as="script"><link rel="preload" href="/assets/js/145.c5c5aca2.js" as="script"><link rel="prefetch" href="/assets/js/10.003809e3.js"><link rel="prefetch" href="/assets/js/100.05e6d7b0.js"><link rel="prefetch" href="/assets/js/101.aedcfb99.js"><link rel="prefetch" href="/assets/js/102.0f45ef0b.js"><link rel="prefetch" href="/assets/js/103.f6349067.js"><link rel="prefetch" href="/assets/js/104.159e4fea.js"><link rel="prefetch" href="/assets/js/105.cf376772.js"><link rel="prefetch" href="/assets/js/106.4a24f110.js"><link rel="prefetch" href="/assets/js/107.9130a4fc.js"><link rel="prefetch" href="/assets/js/108.557f1de3.js"><link rel="prefetch" href="/assets/js/109.0eae2c98.js"><link rel="prefetch" href="/assets/js/11.46d1f704.js"><link rel="prefetch" href="/assets/js/110.be00b9ae.js"><link rel="prefetch" href="/assets/js/111.454bc20b.js"><link rel="prefetch" href="/assets/js/112.c987bc96.js"><link rel="prefetch" href="/assets/js/113.f07c8b3c.js"><link rel="prefetch" href="/assets/js/114.ab099d7d.js"><link rel="prefetch" href="/assets/js/115.a5bda3c7.js"><link rel="prefetch" href="/assets/js/116.eb280ad8.js"><link rel="prefetch" href="/assets/js/117.1863722f.js"><link rel="prefetch" href="/assets/js/118.3f192a2d.js"><link rel="prefetch" href="/assets/js/119.66b89deb.js"><link rel="prefetch" href="/assets/js/12.03486813.js"><link rel="prefetch" href="/assets/js/120.69b1d465.js"><link rel="prefetch" href="/assets/js/121.113b1b5a.js"><link rel="prefetch" href="/assets/js/122.917086b7.js"><link rel="prefetch" href="/assets/js/123.ef1b72cd.js"><link rel="prefetch" href="/assets/js/124.a52fd442.js"><link rel="prefetch" href="/assets/js/125.65cf0d15.js"><link rel="prefetch" href="/assets/js/126.9257bcef.js"><link rel="prefetch" href="/assets/js/127.c080527e.js"><link rel="prefetch" href="/assets/js/128.90389431.js"><link rel="prefetch" href="/assets/js/129.582bff3e.js"><link rel="prefetch" href="/assets/js/13.ba8e34d1.js"><link rel="prefetch" href="/assets/js/130.fb170212.js"><link rel="prefetch" href="/assets/js/131.ed138ac9.js"><link rel="prefetch" href="/assets/js/132.4223d6f9.js"><link rel="prefetch" href="/assets/js/133.012411be.js"><link rel="prefetch" href="/assets/js/134.ed98c78a.js"><link rel="prefetch" href="/assets/js/135.2b6eb13f.js"><link rel="prefetch" href="/assets/js/136.65149943.js"><link rel="prefetch" href="/assets/js/137.341d7363.js"><link rel="prefetch" href="/assets/js/138.e9834544.js"><link rel="prefetch" href="/assets/js/139.ff517435.js"><link rel="prefetch" href="/assets/js/14.71b2ed4a.js"><link rel="prefetch" href="/assets/js/140.bf2b9d2d.js"><link rel="prefetch" href="/assets/js/141.ef8d876a.js"><link rel="prefetch" href="/assets/js/142.c28e6ef9.js"><link rel="prefetch" href="/assets/js/143.d0b43d89.js"><link rel="prefetch" href="/assets/js/144.9545dbb1.js"><link rel="prefetch" href="/assets/js/146.c6989cd8.js"><link rel="prefetch" href="/assets/js/147.fe16ad8a.js"><link rel="prefetch" href="/assets/js/148.102ea00d.js"><link rel="prefetch" href="/assets/js/149.2e62b9d1.js"><link rel="prefetch" href="/assets/js/15.1736a531.js"><link rel="prefetch" href="/assets/js/150.daf684ac.js"><link rel="prefetch" href="/assets/js/151.988a3ba9.js"><link rel="prefetch" href="/assets/js/152.4742bb74.js"><link rel="prefetch" href="/assets/js/153.02bcce99.js"><link rel="prefetch" href="/assets/js/154.ebde7923.js"><link rel="prefetch" href="/assets/js/155.c906862e.js"><link rel="prefetch" href="/assets/js/156.3b3d94d4.js"><link rel="prefetch" href="/assets/js/157.81d8c740.js"><link rel="prefetch" href="/assets/js/158.40095645.js"><link rel="prefetch" href="/assets/js/159.2abc32c5.js"><link rel="prefetch" href="/assets/js/16.fb9d3b9b.js"><link rel="prefetch" href="/assets/js/160.dfa13df3.js"><link rel="prefetch" href="/assets/js/161.5697eb79.js"><link rel="prefetch" href="/assets/js/162.fef5ab87.js"><link rel="prefetch" href="/assets/js/163.8b3dff03.js"><link rel="prefetch" href="/assets/js/164.826228d2.js"><link rel="prefetch" href="/assets/js/165.e0099d56.js"><link rel="prefetch" href="/assets/js/166.8294f6c0.js"><link rel="prefetch" href="/assets/js/167.d07b77dd.js"><link rel="prefetch" href="/assets/js/168.c23c0d7b.js"><link rel="prefetch" href="/assets/js/169.c7f7599b.js"><link rel="prefetch" href="/assets/js/17.e42188aa.js"><link rel="prefetch" href="/assets/js/170.b11ea482.js"><link rel="prefetch" href="/assets/js/171.73278046.js"><link rel="prefetch" href="/assets/js/172.040cd7fc.js"><link rel="prefetch" href="/assets/js/173.e0199ce5.js"><link rel="prefetch" href="/assets/js/174.3010733d.js"><link rel="prefetch" href="/assets/js/175.05c196ea.js"><link rel="prefetch" href="/assets/js/176.c490fc2b.js"><link rel="prefetch" href="/assets/js/177.7bcb888a.js"><link rel="prefetch" href="/assets/js/178.34093cd3.js"><link rel="prefetch" href="/assets/js/179.b2413571.js"><link rel="prefetch" href="/assets/js/18.383f6a09.js"><link rel="prefetch" href="/assets/js/180.9648ec05.js"><link rel="prefetch" href="/assets/js/181.342f0059.js"><link rel="prefetch" href="/assets/js/182.35eac70e.js"><link rel="prefetch" href="/assets/js/183.f4a83742.js"><link rel="prefetch" href="/assets/js/184.d82b8a96.js"><link rel="prefetch" href="/assets/js/185.9f5f32ef.js"><link rel="prefetch" href="/assets/js/186.600a4950.js"><link rel="prefetch" href="/assets/js/187.df953d4f.js"><link rel="prefetch" href="/assets/js/188.2491fa83.js"><link rel="prefetch" href="/assets/js/189.32d3c1a4.js"><link rel="prefetch" href="/assets/js/19.cb72d9a9.js"><link rel="prefetch" href="/assets/js/190.39ac92fc.js"><link rel="prefetch" href="/assets/js/191.3125fa77.js"><link rel="prefetch" href="/assets/js/192.7655632a.js"><link rel="prefetch" href="/assets/js/193.7f55a678.js"><link rel="prefetch" href="/assets/js/194.b9c56642.js"><link rel="prefetch" href="/assets/js/195.189fe681.js"><link rel="prefetch" href="/assets/js/196.71658166.js"><link rel="prefetch" href="/assets/js/197.af445c6a.js"><link rel="prefetch" href="/assets/js/198.1de2afd9.js"><link rel="prefetch" href="/assets/js/199.2c218726.js"><link rel="prefetch" href="/assets/js/20.0e9f2f72.js"><link rel="prefetch" href="/assets/js/200.26590f9f.js"><link rel="prefetch" href="/assets/js/201.36d7a8ea.js"><link rel="prefetch" href="/assets/js/202.6c36d934.js"><link rel="prefetch" href="/assets/js/203.d4ae9b00.js"><link rel="prefetch" href="/assets/js/204.c3b2f994.js"><link rel="prefetch" href="/assets/js/205.f480166b.js"><link rel="prefetch" href="/assets/js/206.90dc53ae.js"><link rel="prefetch" href="/assets/js/207.f959801b.js"><link rel="prefetch" href="/assets/js/208.5da4dac0.js"><link rel="prefetch" href="/assets/js/209.217e41a9.js"><link rel="prefetch" href="/assets/js/21.7a7c5c4f.js"><link rel="prefetch" href="/assets/js/210.fb1d985a.js"><link rel="prefetch" href="/assets/js/211.5a3d515c.js"><link rel="prefetch" href="/assets/js/212.bb654f9b.js"><link rel="prefetch" href="/assets/js/213.b8f5ac66.js"><link rel="prefetch" href="/assets/js/214.cfb1547f.js"><link rel="prefetch" href="/assets/js/215.a1de2fe7.js"><link rel="prefetch" href="/assets/js/216.d76003a4.js"><link rel="prefetch" href="/assets/js/217.ad201174.js"><link rel="prefetch" href="/assets/js/218.5adcad1a.js"><link rel="prefetch" href="/assets/js/219.9f3b9b01.js"><link rel="prefetch" href="/assets/js/22.b9540503.js"><link rel="prefetch" href="/assets/js/220.af64e5ad.js"><link rel="prefetch" href="/assets/js/221.379beb37.js"><link rel="prefetch" href="/assets/js/222.85aa5cd0.js"><link rel="prefetch" href="/assets/js/223.13475fe5.js"><link rel="prefetch" href="/assets/js/224.d06abfcb.js"><link rel="prefetch" href="/assets/js/225.1f738876.js"><link rel="prefetch" href="/assets/js/226.a09031a1.js"><link rel="prefetch" href="/assets/js/227.f6018b9a.js"><link rel="prefetch" href="/assets/js/228.ae3296e4.js"><link rel="prefetch" href="/assets/js/229.d9bcea85.js"><link rel="prefetch" href="/assets/js/23.6b5fd8ae.js"><link rel="prefetch" href="/assets/js/230.68a89532.js"><link rel="prefetch" href="/assets/js/231.b31aa02f.js"><link rel="prefetch" href="/assets/js/232.cc07d501.js"><link rel="prefetch" href="/assets/js/233.76443c50.js"><link rel="prefetch" href="/assets/js/234.5efbcd6a.js"><link rel="prefetch" href="/assets/js/235.dfcf36cf.js"><link rel="prefetch" href="/assets/js/236.4bb99856.js"><link rel="prefetch" href="/assets/js/237.79a22c20.js"><link rel="prefetch" href="/assets/js/238.1b592be7.js"><link rel="prefetch" href="/assets/js/239.a4c119aa.js"><link rel="prefetch" href="/assets/js/24.63372db7.js"><link rel="prefetch" href="/assets/js/240.22d7d47a.js"><link rel="prefetch" href="/assets/js/241.36336698.js"><link rel="prefetch" href="/assets/js/242.b7db4d20.js"><link rel="prefetch" href="/assets/js/243.f156bf47.js"><link rel="prefetch" href="/assets/js/244.14f3046b.js"><link rel="prefetch" href="/assets/js/245.984447ea.js"><link rel="prefetch" href="/assets/js/246.cd55bf13.js"><link rel="prefetch" href="/assets/js/247.d2a77b3d.js"><link rel="prefetch" href="/assets/js/248.c23e38fd.js"><link rel="prefetch" href="/assets/js/249.a0b42d1f.js"><link rel="prefetch" href="/assets/js/25.d3f99e2a.js"><link rel="prefetch" href="/assets/js/250.870b2e9a.js"><link rel="prefetch" href="/assets/js/251.ee8edd7f.js"><link rel="prefetch" href="/assets/js/252.15e2c05e.js"><link rel="prefetch" href="/assets/js/253.18d0fc46.js"><link rel="prefetch" href="/assets/js/254.39ecf5f7.js"><link rel="prefetch" href="/assets/js/255.d42ae6e7.js"><link rel="prefetch" href="/assets/js/256.5a2b4630.js"><link rel="prefetch" href="/assets/js/257.df147154.js"><link rel="prefetch" href="/assets/js/258.f42bcf46.js"><link rel="prefetch" href="/assets/js/259.022f92f9.js"><link rel="prefetch" href="/assets/js/26.c6b54266.js"><link rel="prefetch" href="/assets/js/260.abb07bf2.js"><link rel="prefetch" href="/assets/js/261.74b1bebb.js"><link rel="prefetch" href="/assets/js/262.680edf56.js"><link rel="prefetch" href="/assets/js/263.0cdbe35a.js"><link rel="prefetch" href="/assets/js/264.ea699edd.js"><link rel="prefetch" href="/assets/js/265.cf168b25.js"><link rel="prefetch" href="/assets/js/266.18f03883.js"><link rel="prefetch" href="/assets/js/267.007dcd30.js"><link rel="prefetch" href="/assets/js/268.41de028b.js"><link rel="prefetch" href="/assets/js/269.e206560c.js"><link rel="prefetch" href="/assets/js/27.120b6069.js"><link rel="prefetch" href="/assets/js/270.164398a3.js"><link rel="prefetch" href="/assets/js/271.7d100757.js"><link rel="prefetch" href="/assets/js/272.0b83e5d3.js"><link rel="prefetch" href="/assets/js/273.f317bcb6.js"><link rel="prefetch" href="/assets/js/274.2947d9f0.js"><link rel="prefetch" href="/assets/js/275.e99b65f2.js"><link rel="prefetch" href="/assets/js/276.ea03cf89.js"><link rel="prefetch" href="/assets/js/277.93476fbc.js"><link rel="prefetch" href="/assets/js/278.db0ff8eb.js"><link rel="prefetch" href="/assets/js/279.b36007aa.js"><link rel="prefetch" href="/assets/js/28.91595b48.js"><link rel="prefetch" href="/assets/js/280.14723ae7.js"><link rel="prefetch" href="/assets/js/281.f27b79de.js"><link rel="prefetch" href="/assets/js/282.718708d7.js"><link rel="prefetch" href="/assets/js/283.f91a771c.js"><link rel="prefetch" href="/assets/js/284.25b1d4f7.js"><link rel="prefetch" href="/assets/js/285.a641722b.js"><link rel="prefetch" href="/assets/js/286.9d2d85fb.js"><link rel="prefetch" href="/assets/js/287.a8a0d7a2.js"><link rel="prefetch" href="/assets/js/288.ee27e2fe.js"><link rel="prefetch" href="/assets/js/289.e4300193.js"><link rel="prefetch" href="/assets/js/29.a5ef89d9.js"><link rel="prefetch" href="/assets/js/290.ba445f12.js"><link rel="prefetch" href="/assets/js/291.7a767d85.js"><link rel="prefetch" href="/assets/js/292.aa96cc76.js"><link rel="prefetch" href="/assets/js/293.e18d36c6.js"><link rel="prefetch" href="/assets/js/294.7113dff7.js"><link rel="prefetch" href="/assets/js/295.abae5e0e.js"><link rel="prefetch" href="/assets/js/296.010241c4.js"><link rel="prefetch" href="/assets/js/297.4bbe88fd.js"><link rel="prefetch" href="/assets/js/298.9f291f83.js"><link rel="prefetch" href="/assets/js/299.bf9e031a.js"><link rel="prefetch" href="/assets/js/3.1403d3ee.js"><link rel="prefetch" href="/assets/js/30.3bb57e98.js"><link rel="prefetch" href="/assets/js/300.fc58f3c4.js"><link rel="prefetch" href="/assets/js/301.69cd291f.js"><link rel="prefetch" href="/assets/js/302.c34ca8e9.js"><link rel="prefetch" href="/assets/js/303.25655f40.js"><link rel="prefetch" href="/assets/js/304.97a8e358.js"><link rel="prefetch" href="/assets/js/305.1c5e713f.js"><link rel="prefetch" href="/assets/js/306.b53f2ea6.js"><link rel="prefetch" href="/assets/js/307.e4a9a150.js"><link rel="prefetch" href="/assets/js/308.92931c17.js"><link rel="prefetch" href="/assets/js/309.6e452bde.js"><link rel="prefetch" href="/assets/js/31.f1ddaeee.js"><link rel="prefetch" href="/assets/js/310.6abc9668.js"><link rel="prefetch" href="/assets/js/311.1bd77809.js"><link rel="prefetch" href="/assets/js/312.78b7405d.js"><link rel="prefetch" href="/assets/js/313.3b23ded5.js"><link rel="prefetch" href="/assets/js/314.ae150cf1.js"><link rel="prefetch" href="/assets/js/315.d375ed9c.js"><link rel="prefetch" href="/assets/js/316.c8a05987.js"><link rel="prefetch" href="/assets/js/317.febd6c4f.js"><link rel="prefetch" href="/assets/js/318.34fe4d11.js"><link rel="prefetch" href="/assets/js/319.5b558d88.js"><link rel="prefetch" href="/assets/js/32.8019bc57.js"><link rel="prefetch" href="/assets/js/320.af89e963.js"><link rel="prefetch" href="/assets/js/321.f646b641.js"><link rel="prefetch" href="/assets/js/322.897f28f1.js"><link rel="prefetch" href="/assets/js/323.38229c39.js"><link rel="prefetch" href="/assets/js/324.7baf2418.js"><link rel="prefetch" href="/assets/js/325.e0225366.js"><link rel="prefetch" href="/assets/js/326.e30b69cd.js"><link rel="prefetch" href="/assets/js/327.6774c791.js"><link rel="prefetch" href="/assets/js/328.58239b5d.js"><link rel="prefetch" href="/assets/js/329.570eb01e.js"><link rel="prefetch" href="/assets/js/33.2009be2a.js"><link rel="prefetch" href="/assets/js/330.6c29d590.js"><link rel="prefetch" href="/assets/js/331.bbe673f1.js"><link rel="prefetch" href="/assets/js/332.6d2bbedd.js"><link rel="prefetch" href="/assets/js/333.7e60b6bd.js"><link rel="prefetch" href="/assets/js/334.9f9ea9bb.js"><link rel="prefetch" href="/assets/js/335.0f60cf92.js"><link rel="prefetch" href="/assets/js/336.3981edeb.js"><link rel="prefetch" href="/assets/js/337.0ca91dae.js"><link rel="prefetch" href="/assets/js/338.09e14c30.js"><link rel="prefetch" href="/assets/js/339.31147ffa.js"><link rel="prefetch" href="/assets/js/34.f4ffaa4e.js"><link rel="prefetch" href="/assets/js/340.b216b6b7.js"><link rel="prefetch" href="/assets/js/341.7af949b2.js"><link rel="prefetch" href="/assets/js/342.03e80905.js"><link rel="prefetch" href="/assets/js/343.147ff16c.js"><link rel="prefetch" href="/assets/js/344.c95f6de9.js"><link rel="prefetch" href="/assets/js/345.7cc8cfaa.js"><link rel="prefetch" href="/assets/js/346.d5ff42a4.js"><link rel="prefetch" href="/assets/js/347.f1f1478f.js"><link rel="prefetch" href="/assets/js/348.32ea340f.js"><link rel="prefetch" href="/assets/js/349.4d743984.js"><link rel="prefetch" href="/assets/js/35.6f997bc2.js"><link rel="prefetch" href="/assets/js/350.c218cb98.js"><link rel="prefetch" href="/assets/js/351.a6f08d8b.js"><link rel="prefetch" href="/assets/js/352.46538632.js"><link rel="prefetch" href="/assets/js/353.6702d9ff.js"><link rel="prefetch" href="/assets/js/354.10264327.js"><link rel="prefetch" href="/assets/js/355.bc66e304.js"><link rel="prefetch" href="/assets/js/356.36d9208c.js"><link rel="prefetch" href="/assets/js/357.708af07a.js"><link rel="prefetch" href="/assets/js/358.61ab6834.js"><link rel="prefetch" href="/assets/js/359.bb4ad887.js"><link rel="prefetch" href="/assets/js/36.5172c464.js"><link rel="prefetch" href="/assets/js/360.9ae57e7b.js"><link rel="prefetch" href="/assets/js/37.72aa4947.js"><link rel="prefetch" href="/assets/js/38.77129de5.js"><link rel="prefetch" href="/assets/js/39.01d84c7e.js"><link rel="prefetch" href="/assets/js/4.5517c98c.js"><link rel="prefetch" href="/assets/js/40.b2fb57bd.js"><link rel="prefetch" href="/assets/js/41.fa63fb49.js"><link rel="prefetch" href="/assets/js/42.c68fd691.js"><link rel="prefetch" href="/assets/js/43.071af6f3.js"><link rel="prefetch" href="/assets/js/44.99321348.js"><link rel="prefetch" href="/assets/js/45.4c105e24.js"><link rel="prefetch" href="/assets/js/46.91a5aa2c.js"><link rel="prefetch" href="/assets/js/47.18bd4930.js"><link rel="prefetch" href="/assets/js/48.deef5f67.js"><link rel="prefetch" href="/assets/js/49.12c80dd9.js"><link rel="prefetch" href="/assets/js/5.6b7a7b35.js"><link rel="prefetch" href="/assets/js/50.259ff32b.js"><link rel="prefetch" href="/assets/js/51.ee83db82.js"><link rel="prefetch" href="/assets/js/52.1cf54e16.js"><link rel="prefetch" href="/assets/js/53.821dd297.js"><link rel="prefetch" href="/assets/js/54.bf29c9d1.js"><link rel="prefetch" href="/assets/js/55.25e00784.js"><link rel="prefetch" href="/assets/js/56.b1112045.js"><link rel="prefetch" href="/assets/js/57.5923ed3a.js"><link rel="prefetch" href="/assets/js/58.ee7fa86f.js"><link rel="prefetch" href="/assets/js/59.7b9800f0.js"><link rel="prefetch" href="/assets/js/6.207c7bac.js"><link rel="prefetch" href="/assets/js/60.ca146265.js"><link rel="prefetch" href="/assets/js/61.77a27075.js"><link rel="prefetch" href="/assets/js/62.2839e098.js"><link rel="prefetch" href="/assets/js/63.6c8cdea8.js"><link rel="prefetch" href="/assets/js/64.1a5f538c.js"><link rel="prefetch" href="/assets/js/65.a3708a3e.js"><link rel="prefetch" href="/assets/js/66.63a1d86b.js"><link rel="prefetch" href="/assets/js/67.5563ad9d.js"><link rel="prefetch" href="/assets/js/68.182b4324.js"><link rel="prefetch" href="/assets/js/69.b695215c.js"><link rel="prefetch" href="/assets/js/7.00b0f0bb.js"><link rel="prefetch" href="/assets/js/70.819c0991.js"><link rel="prefetch" href="/assets/js/71.534cf941.js"><link rel="prefetch" href="/assets/js/72.b3c641ef.js"><link rel="prefetch" href="/assets/js/73.e613a0d5.js"><link rel="prefetch" href="/assets/js/74.d7fc07e0.js"><link rel="prefetch" href="/assets/js/75.d50101e4.js"><link rel="prefetch" href="/assets/js/76.18e7ac7b.js"><link rel="prefetch" href="/assets/js/77.bb898521.js"><link rel="prefetch" href="/assets/js/78.a08d2106.js"><link rel="prefetch" href="/assets/js/79.0f362a00.js"><link rel="prefetch" href="/assets/js/8.197a9ad8.js"><link rel="prefetch" href="/assets/js/80.8b74cf4c.js"><link rel="prefetch" href="/assets/js/81.3e8c87af.js"><link rel="prefetch" href="/assets/js/82.83cb55b7.js"><link rel="prefetch" href="/assets/js/83.7355f968.js"><link rel="prefetch" href="/assets/js/84.51061851.js"><link rel="prefetch" href="/assets/js/85.b5df8911.js"><link rel="prefetch" href="/assets/js/86.baf2296e.js"><link rel="prefetch" href="/assets/js/87.2e9ae95d.js"><link rel="prefetch" href="/assets/js/88.57a8401a.js"><link rel="prefetch" href="/assets/js/89.a0d99eba.js"><link rel="prefetch" href="/assets/js/9.53a0556a.js"><link rel="prefetch" href="/assets/js/90.6121d367.js"><link rel="prefetch" href="/assets/js/91.56f285e2.js"><link rel="prefetch" href="/assets/js/92.7d7c0428.js"><link rel="prefetch" href="/assets/js/93.17841bd6.js"><link rel="prefetch" href="/assets/js/94.832fcc1c.js"><link rel="prefetch" href="/assets/js/95.e9c523bc.js"><link rel="prefetch" href="/assets/js/96.d8aae52a.js"><link rel="prefetch" href="/assets/js/97.bd436fab.js"><link rel="prefetch" href="/assets/js/98.78f6e4f3.js"><link rel="prefetch" href="/assets/js/99.a405fc1f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.877370ef.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="wen chao" class="logo"> <span class="site-name can-hide">wen chao</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Algorithm" class="dropdown-title"><a href="/Algorithm/" class="link-title">Algorithm</a> <span class="title" style="display:none;">Algorithm</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/d8e764/" class="nav-link">Theory</a></li><li class="dropdown-item"><!----> <a href="/pages/81a4bd/" class="nav-link">LeetCode</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Spring" class="dropdown-title"><a href="/Spring/" class="link-title">Spring</a> <span class="title" style="display:none;">Spring</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/373439/" class="nav-link">Spring</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Technology" class="dropdown-title"><a href="/Technology/" class="link-title">Technology</a> <span class="title" style="display:none;">Technology</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/3b6841/" class="nav-link">DB</a></li><li class="dropdown-item"><!----> <a href="/pages/d7857e/" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/pages/b89362/" class="nav-link">Redis</a></li><li class="dropdown-item"><!----> <a href="/pages/ec8b81/" class="nav-link">MongoDB</a></li><li class="dropdown-item"><!----> <a href="/pages/4e3ff1/" class="nav-link">Zookeeper</a></li><li class="dropdown-item"><!----> <a href="/pages/a75fef/" class="nav-link">MQ</a></li><li class="dropdown-item"><!----> <a href="/pages/b194d7/" class="nav-link">Dubbo</a></li><li class="dropdown-item"><!----> <a href="/pages/371f2f/" class="nav-link">ElasticSearch</a></li><li class="dropdown-item"><!----> <a href="/pages/027aa3/" class="nav-link">Workflow</a></li><li class="dropdown-item"><!----> <a href="/pages/73ab4b/" class="nav-link">OAuth2</a></li><li class="dropdown-item"><!----> <a href="/pages/d7a38a/" class="nav-link">JPA</a></li><li class="dropdown-item"><!----> <a href="/pages/eb5dc1/" class="nav-link">Liquibase</a></li><li class="dropdown-item"><!----> <a href="/pages/e54277/" class="nav-link">Lombok</a></li><li class="dropdown-item"><!----> <a href="/pages/62e4f6/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/pages/13c836/" class="nav-link">Nginx</a></li><li class="dropdown-item"><!----> <a href="/pages/b50b3d/" class="nav-link">Mini Program</a></li><li class="dropdown-item"><!----> <a href="/pages/09d3b8/" class="nav-link">JVM</a></li><li class="dropdown-item"><!----> <a href="/pages/a526c7/" class="nav-link">Log</a></li><li class="dropdown-item"><!----> <a href="/pages/59cf4f/" aria-current="page" class="nav-link router-link-exact-active router-link-active">JDK</a></li><li class="dropdown-item"><!----> <a href="/pages/d50dab/" class="nav-link">Thymeleaf</a></li><li class="dropdown-item"><!----> <a href="/pages/97abaa/" class="nav-link">Maven</a></li><li class="dropdown-item"><!----> <a href="/pages/7879f1/" class="nav-link">Mybatis</a></li><li class="dropdown-item"><!----> <a href="/pages/745b7c/" class="nav-link">Network</a></li><li class="dropdown-item"><!----> <a href="/pages/274dac/" class="nav-link">Raspberrypi</a></li><li class="dropdown-item"><!----> <a href="/pages/87c097/" class="nav-link">Node</a></li><li class="dropdown-item"><!----> <a href="/pages/927664/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/pages/2c3f19/" class="nav-link">Vue</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Other" class="dropdown-title"><a href="/Other/" class="link-title">Other</a> <span class="title" style="display:none;">Other</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/fea344/" class="nav-link">Book</a></li><li class="dropdown-item"><!----> <a href="/pages/d62f72/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/pages/f3d338/" class="nav-link">问题</a></li><li class="dropdown-item"><!----> <a href="/pages/ff202b/" class="nav-link">友链</a></li><li class="dropdown-item"><!----> <a href="/pages/2b746e/" class="nav-link">证券</a></li></ul></div></div><div class="nav-item"><a href="/About/" class="nav-link">About</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Index" class="dropdown-title"><a href="/archives/" class="link-title">Index</a> <span class="title" style="display:none;">Index</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/touxiang-lanse.png"> <div class="blogger-info"><h3>wen chao</h3> <span>持之以恒做正确有价值的事!</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Algorithm" class="dropdown-title"><a href="/Algorithm/" class="link-title">Algorithm</a> <span class="title" style="display:none;">Algorithm</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/d8e764/" class="nav-link">Theory</a></li><li class="dropdown-item"><!----> <a href="/pages/81a4bd/" class="nav-link">LeetCode</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Spring" class="dropdown-title"><a href="/Spring/" class="link-title">Spring</a> <span class="title" style="display:none;">Spring</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/373439/" class="nav-link">Spring</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Technology" class="dropdown-title"><a href="/Technology/" class="link-title">Technology</a> <span class="title" style="display:none;">Technology</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/3b6841/" class="nav-link">DB</a></li><li class="dropdown-item"><!----> <a href="/pages/d7857e/" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/pages/b89362/" class="nav-link">Redis</a></li><li class="dropdown-item"><!----> <a href="/pages/ec8b81/" class="nav-link">MongoDB</a></li><li class="dropdown-item"><!----> <a href="/pages/4e3ff1/" class="nav-link">Zookeeper</a></li><li class="dropdown-item"><!----> <a href="/pages/a75fef/" class="nav-link">MQ</a></li><li class="dropdown-item"><!----> <a href="/pages/b194d7/" class="nav-link">Dubbo</a></li><li class="dropdown-item"><!----> <a href="/pages/371f2f/" class="nav-link">ElasticSearch</a></li><li class="dropdown-item"><!----> <a href="/pages/027aa3/" class="nav-link">Workflow</a></li><li class="dropdown-item"><!----> <a href="/pages/73ab4b/" class="nav-link">OAuth2</a></li><li class="dropdown-item"><!----> <a href="/pages/d7a38a/" class="nav-link">JPA</a></li><li class="dropdown-item"><!----> <a href="/pages/eb5dc1/" class="nav-link">Liquibase</a></li><li class="dropdown-item"><!----> <a href="/pages/e54277/" class="nav-link">Lombok</a></li><li class="dropdown-item"><!----> <a href="/pages/62e4f6/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/pages/13c836/" class="nav-link">Nginx</a></li><li class="dropdown-item"><!----> <a href="/pages/b50b3d/" class="nav-link">Mini Program</a></li><li class="dropdown-item"><!----> <a href="/pages/09d3b8/" class="nav-link">JVM</a></li><li class="dropdown-item"><!----> <a href="/pages/a526c7/" class="nav-link">Log</a></li><li class="dropdown-item"><!----> <a href="/pages/59cf4f/" aria-current="page" class="nav-link router-link-exact-active router-link-active">JDK</a></li><li class="dropdown-item"><!----> <a href="/pages/d50dab/" class="nav-link">Thymeleaf</a></li><li class="dropdown-item"><!----> <a href="/pages/97abaa/" class="nav-link">Maven</a></li><li class="dropdown-item"><!----> <a href="/pages/7879f1/" class="nav-link">Mybatis</a></li><li class="dropdown-item"><!----> <a href="/pages/745b7c/" class="nav-link">Network</a></li><li class="dropdown-item"><!----> <a href="/pages/274dac/" class="nav-link">Raspberrypi</a></li><li class="dropdown-item"><!----> <a href="/pages/87c097/" class="nav-link">Node</a></li><li class="dropdown-item"><!----> <a href="/pages/927664/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/pages/2c3f19/" class="nav-link">Vue</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Other" class="dropdown-title"><a href="/Other/" class="link-title">Other</a> <span class="title" style="display:none;">Other</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/fea344/" class="nav-link">Book</a></li><li class="dropdown-item"><!----> <a href="/pages/d62f72/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/pages/f3d338/" class="nav-link">问题</a></li><li class="dropdown-item"><!----> <a href="/pages/ff202b/" class="nav-link">友链</a></li><li class="dropdown-item"><!----> <a href="/pages/2b746e/" class="nav-link">证券</a></li></ul></div></div><div class="nav-item"><a href="/About/" class="nav-link">About</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Index" class="dropdown-title"><a href="/archives/" class="link-title">Index</a> <span class="title" style="display:none;">Index</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>DB</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Redis</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>MongoDB</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Zookeeper</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>MQ</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Dubbo</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ElasticSearch</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Workflow</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>OAuth2</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JPA</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Liquibase</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Lombok</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Nginx</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>小程序</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JVM</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Log</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>JDK</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/afb9b8/" class="sidebar-link">JDK8-ifPresent()</a></li><li><a href="/pages/4ddc4b/" class="sidebar-link">object-json互转工具类</a></li><li><a href="/pages/c4aae4/" class="sidebar-link">Arrays asList()和new ArrayList()区别</a></li><li><a href="/pages/e65dbb/" class="sidebar-link">BigDecimal理解</a></li><li><a href="/pages/da4263/" class="sidebar-link">Enum - 实现 ifelse优雅写法</a></li><li><a href="/pages/efd641/" class="sidebar-link">java Beanutils copyProperties( )用法</a></li><li><a href="/pages/343344/" class="sidebar-link">java util NoSuchElementException No value present报错解决</a></li><li><a href="/pages/f0dd98/" class="sidebar-link">Java8 stream sorted排序时包括null</a></li><li><a href="/pages/c43e49/" class="sidebar-link">Java开发环境配置汇总</a></li><li><a href="/pages/948cbb/" class="sidebar-link">JDK8-Stream（Map）</a></li><li><a href="/pages/3048da/" class="sidebar-link">JDK8-Stream流 API</a></li><li><a href="/pages/f45bfd/" class="sidebar-link">List转Map-JDK8实现</a></li><li><a href="/pages/47fe20/" class="sidebar-link">String在方法中的传递方式(调用外部方法给String变量赋值时，未得到预期结果)</a></li><li><a href="/pages/be0377/" class="sidebar-link">改动实体类后，报错java io InvalidClassException XXXDTO; local class incompatibl</a></li><li><a href="/pages/12c0ef/" class="sidebar-link">两个List集合取交集、并集、差集、去重并集</a></li><li><a href="/pages/175bc8/" class="sidebar-link">日期格式化</a></li><li><a href="/pages/a34205/" class="sidebar-link">Ｄebug深度理解应用</a></li><li><a href="/pages/346b6e/" class="sidebar-link">Collector toMap，Map中的key不能重复，如果重复的话，会抛出异常</a></li><li><a href="/pages/6bff51/" class="sidebar-link">java遍历文件目录，使用ztree js以树形结构展示并支持搜索功能</a></li><li><a href="/pages/3b7200/" class="sidebar-link">Mac安装JDK</a></li><li><a href="/pages/55530f/" class="sidebar-link">ConcurrentModificationException</a></li><li><a href="/pages/2cab9f/" class="sidebar-link">DOM4J-解析XML</a></li><li><a href="/pages/1c1e1b/" class="sidebar-link">高效代码方法汇总</a></li><li><a href="/pages/d0cacd/" class="sidebar-link">Lombok 工具中@Data注解生成hashCode()可能导致StackOverflowError情况</a></li><li><a href="/pages/23ea53/" class="sidebar-link">Demo-代码</a></li><li><a href="/pages/918ec6/" class="sidebar-link">doMain实体少写 get方法报错解决</a></li><li><a href="/pages/478c1f/" class="sidebar-link">POI导出Excel</a></li><li><a href="/pages/5f4238/" class="sidebar-link">pom xml报错找不到jar-解决</a></li><li><a href="/pages/1fda72/" class="sidebar-link">安装新的tomcat后，解决Windows控制台乱码问题</a></li><li><a href="/pages/62b882/" class="sidebar-link">查询ID下的树子节点</a></li><li><a href="/pages/ed73e7/" class="sidebar-link">待补充-Apache Commons CSV</a></li><li><a href="/pages/a71d41/" class="sidebar-link">构建XML方法（实体构建XML）</a></li><li><a href="/pages/59cf4f/" aria-current="page" class="active sidebar-link">Java并发编程和高并发解决方案</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/59cf4f/#_1-cpu多级缓存-缓存一致性-乱序执行优化" class="sidebar-link">1.CPU多级缓存（缓存一致性，乱序执行优化）</a></li><li class="sidebar-sub-header level2"><a href="/pages/59cf4f/#_2-java内存模型" class="sidebar-link">2.Java内存模型</a></li><li class="sidebar-sub-header level2"><a href="/pages/59cf4f/#_3-并发的优势和风险" class="sidebar-link">3.并发的优势和风险</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/59cf4f/#cpu多级缓存" class="sidebar-link">CPU多级缓存</a></li><li class="sidebar-sub-header level3"><a href="/pages/59cf4f/#cpu多级缓存-乱序执行优化" class="sidebar-link">CPU多级缓存-乱序执行优化</a></li><li class="sidebar-sub-header level3"><a href="/pages/59cf4f/#java内存模型-java-memory-model-jmm" class="sidebar-link">java内存模型（java memory model，JMM）</a></li><li class="sidebar-sub-header level3"><a href="/pages/59cf4f/#并发的优势与风险" class="sidebar-link">并发的优势与风险</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/59cf4f/#_1-线程安全性概念" class="sidebar-link">1.线程安全性概念</a></li><li class="sidebar-sub-header level2"><a href="/pages/59cf4f/#_2-线程安全性体现的三个方面" class="sidebar-link">2.线程安全性体现的三个方面</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/59cf4f/#线程安全性-2" class="sidebar-link">线程安全性</a></li><li class="sidebar-sub-header level3"><a href="/pages/59cf4f/#线程安全体现在以下三个方面" class="sidebar-link">线程安全体现在以下三个方面</a></li><li class="sidebar-sub-header level4"><a href="/pages/59cf4f/#原子性" class="sidebar-link">原子性</a></li><li class="sidebar-sub-header level5"><a href="/pages/59cf4f/#原子性-atomic包" class="sidebar-link">原子性——Atomic包</a></li><li class="sidebar-sub-header level5"><a href="/pages/59cf4f/#原子性-锁" class="sidebar-link">原子性——锁</a></li><li class="sidebar-sub-header level5"><a href="/pages/59cf4f/#原子性-对比" class="sidebar-link">原子性——对比</a></li><li class="sidebar-sub-header level4"><a href="/pages/59cf4f/#可见性" class="sidebar-link">可见性</a></li><li class="sidebar-sub-header level5"><a href="/pages/59cf4f/#可见性-synchronized" class="sidebar-link">可见性——synchronized</a></li><li class="sidebar-sub-header level5"><a href="/pages/59cf4f/#可见性-volatile" class="sidebar-link">可见性——volatile</a></li><li class="sidebar-sub-header level4"><a href="/pages/59cf4f/#有序性" class="sidebar-link">有序性</a></li><li class="sidebar-sub-header level5"><a href="/pages/59cf4f/#有序性-happens-before原则" class="sidebar-link">有序性——happens-before原则</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/59cf4f/#_1-发布与逸出" class="sidebar-link">1.发布与逸出</a></li><li class="sidebar-sub-header level2"><a href="/pages/59cf4f/#_2-四种方法" class="sidebar-link">2.四种方法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/59cf4f/#发布与逸出" class="sidebar-link">发布与逸出</a></li><li class="sidebar-sub-header level3"><a href="/pages/59cf4f/#安全发布对象四种方法" class="sidebar-link">安全发布对象四种方法</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/59cf4f/#_1-不可变对象" class="sidebar-link">1.不可变对象</a></li><li class="sidebar-sub-header level2"><a href="/pages/59cf4f/#_2-线程封闭" class="sidebar-link">2.线程封闭</a></li><li class="sidebar-sub-header level2"><a href="/pages/59cf4f/#_3-线程不安全类与写法" class="sidebar-link">3.线程不安全类与写法</a></li><li class="sidebar-sub-header level2"><a href="/pages/59cf4f/#_4-同步容器" class="sidebar-link">4.同步容器</a></li><li class="sidebar-sub-header level2"><a href="/pages/59cf4f/#_5-并发容器" class="sidebar-link">5.并发容器</a></li><li class="sidebar-sub-header level2"><a href="/pages/59cf4f/#_6-安全共享策略" class="sidebar-link">6.安全共享策略</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/59cf4f/#不可变对象" class="sidebar-link">不可变对象</a></li><li class="sidebar-sub-header level3"><a href="/pages/59cf4f/#线程封闭性" class="sidebar-link">线程封闭性</a></li><li class="sidebar-sub-header level3"><a href="/pages/59cf4f/#线程不安全类与写法" class="sidebar-link">线程不安全类与写法</a></li><li class="sidebar-sub-header level3"><a href="/pages/59cf4f/#线程安全-同步容器-在多线程环境下不推荐使用" class="sidebar-link">线程安全——同步容器（在多线程环境下不推荐使用）</a></li><li class="sidebar-sub-header level3"><a href="/pages/59cf4f/#线程安全-并发容器j-u-c-java-util-concurrent-在多线程环境下推荐使用" class="sidebar-link">线程安全——并发容器J.U.C（java.util.concurrent）（在多线程环境下推荐使用）</a></li><li class="sidebar-sub-header level3"><a href="/pages/59cf4f/#安全共享对象策略-总结" class="sidebar-link">安全共享对象策略——总结</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/59cf4f/#_1-aqs介绍" class="sidebar-link">1.AQS介绍</a></li><li class="sidebar-sub-header level2"><a href="/pages/59cf4f/#_2-aqs-countdownlatch" class="sidebar-link">2.AQS-CountDownLatch</a></li><li class="sidebar-sub-header level2"><a href="/pages/59cf4f/#_3-aqs-semaphore" class="sidebar-link">3.AQS-Semaphore</a></li><li class="sidebar-sub-header level2"><a href="/pages/59cf4f/#_4-aqs-cyclicbarrier" class="sidebar-link">4.AQS-CyclicBarrier</a></li><li class="sidebar-sub-header level2"><a href="/pages/59cf4f/#_5-aqs-reentrantlock与锁" class="sidebar-link">5.AQS-ReentrantLock与锁</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/59cf4f/#aqs介绍" class="sidebar-link">AQS介绍</a></li><li class="sidebar-sub-header level3"><a href="/pages/59cf4f/#countdownlatch" class="sidebar-link">CountDownLatch</a></li><li class="sidebar-sub-header level3"><a href="/pages/59cf4f/#semaphore" class="sidebar-link">Semaphore</a></li><li class="sidebar-sub-header level3"><a href="/pages/59cf4f/#cyclicbarrier" class="sidebar-link">CyclicBarrier</a></li><li class="sidebar-sub-header level3"><a href="/pages/59cf4f/#reentrantlock" class="sidebar-link">ReentrantLock</a></li><li class="sidebar-sub-header level3"><a href="/pages/59cf4f/#reentrantreadwritelock" class="sidebar-link">ReentrantReadWriteLock</a></li><li class="sidebar-sub-header level3"><a href="/pages/59cf4f/#stampedlock" class="sidebar-link">StampedLock</a></li><li class="sidebar-sub-header level3"><a href="/pages/59cf4f/#condition" class="sidebar-link">Condition</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/59cf4f/#_1-futuretask" class="sidebar-link">1.FutureTask</a></li><li class="sidebar-sub-header level2"><a href="/pages/59cf4f/#_2-fork-join" class="sidebar-link">2.Fork/Join</a></li><li class="sidebar-sub-header level2"><a href="/pages/59cf4f/#_3-blockingqueue" class="sidebar-link">3.BlockingQueue</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/59cf4f/#futuretask" class="sidebar-link">FutureTask</a></li><li class="sidebar-sub-header level3"><a href="/pages/59cf4f/#fork-join框架" class="sidebar-link">Fork/Join框架</a></li><li class="sidebar-sub-header level3"><a href="/pages/59cf4f/#blockingqueue-阻塞队列" class="sidebar-link">BlockingQueue——阻塞队列</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/59cf4f/#_1-线程池概念和特点" class="sidebar-link">1.线程池概念和特点</a></li><li class="sidebar-sub-header level2"><a href="/pages/59cf4f/#_2-线程池状态" class="sidebar-link">2.线程池状态</a></li><li class="sidebar-sub-header level2"><a href="/pages/59cf4f/#_3-线程池-相关类" class="sidebar-link">3.线程池-相关类</a></li><li class="sidebar-sub-header level2"><a href="/pages/59cf4f/#_4-线程池-相关方法" class="sidebar-link">4.线程池-相关方法</a></li><li class="sidebar-sub-header level2"><a href="/pages/59cf4f/#_5-线程池合理配置" class="sidebar-link">5.线程池合理配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/59cf4f/#线程池概念和特点" class="sidebar-link">线程池概念和特点</a></li><li class="sidebar-sub-header level3"><a href="/pages/59cf4f/#线程池状态" class="sidebar-link">线程池状态</a></li><li class="sidebar-sub-header level3"><a href="/pages/59cf4f/#线程池-相关类" class="sidebar-link">线程池-相关类</a></li><li class="sidebar-sub-header level3"><a href="/pages/59cf4f/#线程池-相关方法" class="sidebar-link">线程池-相关方法</a></li><li class="sidebar-sub-header level3"><a href="/pages/59cf4f/#线程池合理配置" class="sidebar-link">线程池合理配置</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/59cf4f/#_1-死锁" class="sidebar-link">1.死锁</a></li><li class="sidebar-sub-header level2"><a href="/pages/59cf4f/#_2-并发最佳实践" class="sidebar-link">2.并发最佳实践</a></li><li class="sidebar-sub-header level2"><a href="/pages/59cf4f/#_3-spring与线程安全" class="sidebar-link">3.Spring与线程安全</a></li><li class="sidebar-sub-header level2"><a href="/pages/59cf4f/#_4-hashmap与concurrenthashmap解析" class="sidebar-link">4.HashMap与ConcurrentHashMap解析</a></li><li class="sidebar-sub-header level2"><a href="/pages/59cf4f/#_5-多线程并发与线程安全总结" class="sidebar-link">5.多线程并发与线程安全总结</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/59cf4f/#死锁" class="sidebar-link">死锁</a></li><li class="sidebar-sub-header level3"><a href="/pages/59cf4f/#并发最佳实践" class="sidebar-link">并发最佳实践</a></li><li class="sidebar-sub-header level3"><a href="/pages/59cf4f/#spring与线程安全" class="sidebar-link">Spring与线程安全</a></li><li class="sidebar-sub-header level3"><a href="/pages/59cf4f/#hashmap与concurrenthashmap" class="sidebar-link">HashMap与ConcurrentHashMap</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/59cf4f/#_1-缓存-特征-场景及组件" class="sidebar-link">1.缓存-特征，场景及组件</a></li><li class="sidebar-sub-header level2"><a href="/pages/59cf4f/#_2-缓存-redis" class="sidebar-link">2.缓存-Redis</a></li><li class="sidebar-sub-header level2"><a href="/pages/59cf4f/#_3-高并发场景下缓存常见问题" class="sidebar-link">3.高并发场景下缓存常见问题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/59cf4f/#缓存-特征-场景及组件" class="sidebar-link">缓存-特征，场景及组件</a></li><li class="sidebar-sub-header level3"><a href="/pages/59cf4f/#高并发场景下缓存常见问题" class="sidebar-link">高并发场景下缓存常见问题</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/59cf4f/#_1-消息队列特性" class="sidebar-link">1.消息队列特性</a></li><li class="sidebar-sub-header level2"><a href="/pages/59cf4f/#_2-为什么需要消息队列" class="sidebar-link">2.为什么需要消息队列</a></li><li class="sidebar-sub-header level2"><a href="/pages/59cf4f/#_3-消息队列技术" class="sidebar-link">3.消息队列技术</a></li><li class="sidebar-sub-header level2"><a href="/pages/59cf4f/#_1-拆分原则" class="sidebar-link">1.拆分原则</a></li><li class="sidebar-sub-header level2"><a href="/pages/59cf4f/#_2-拆分思考" class="sidebar-link">2.拆分思考</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/59cf4f/#拆分原则" class="sidebar-link">拆分原则</a></li><li class="sidebar-sub-header level3"><a href="/pages/59cf4f/#拆分思考" class="sidebar-link">拆分思考</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/59cf4f/#_1-概念" class="sidebar-link">1.概念</a></li><li class="sidebar-sub-header level2"><a href="/pages/59cf4f/#_2-限流算法" class="sidebar-link">2.限流算法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/59cf4f/#概念" class="sidebar-link">概念</a></li><li class="sidebar-sub-header level3"><a href="/pages/59cf4f/#限流算法" class="sidebar-link">限流算法</a></li></ul></li></ul></li><li><a href="/pages/b27d2f/" class="sidebar-link">剑指-笔记</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Thymeleaf</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Maven</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Mybatis</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Network</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Raspberrypi</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Node</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Web</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/Technology/#Technology" data-v-06225672>Technology</a></li><li data-v-06225672><a href="/Technology/#JDK" data-v-06225672>JDK</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://gitee.com/nylg" target="_blank" title="作者" class="beLink" data-v-06225672>wenchao</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2017-12-16</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">Java并发编程和高并发解决方案<!----></h1>  <div class="theme-vdoing-content content__default"><p>@<a href="%E7%9B%AE%E5%BD%95">TOC</a></p> <h1 id="图示思维导图"><a href="#图示思维导图" class="header-anchor">#</a> 图示思维导图：</h1> <p><img src="https://img-blog.csdnimg.cn/20201101204347947.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2JhaW9mY2hhbw==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"> <img src="https://img-blog.csdnimg.cn/20201101204419491.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2JhaW9mY2hhbw==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"> <img src="https://img-blog.csdnimg.cn/20201101204430924.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2JhaW9mY2hhbw==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"> <img src="https://img-blog.csdnimg.cn/20201101210539538.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2JhaW9mY2hhbw==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p> <h1 id="并发和高并发基础概念"><a href="#并发和高并发基础概念" class="header-anchor">#</a> 并发和高并发基础概念</h1> <blockquote><p>并发
同时拥有两个或多个线程，如果程序在单核处理器上运行，多个线程将交替的换入或者换出内存，这些线程是同时“存在”的，每个线程都处于执行过程中的某个状态，如果运行在多核处理器上，此时，程序中的每个线程都将分配到一个处理器核上，因此可以同时运行。</p></blockquote> <blockquote><p>高并发
高并发（High Concurrency）是互联网分布式系统架构设计中必须考虑的因素之一，它通常是指，通过设计保证系统能够同时并行处理很多请求。</p></blockquote> <p>总结：</p> <blockquote><p><strong>并发</strong>：多个线程操作相同的资源，保证线程安全，合理使用资源
<strong>高并发</strong>：服务能同时处理很多请求，提高程序性能（更多的考虑技术手段）</p></blockquote> <h1 id="并发基础"><a href="#并发基础" class="header-anchor">#</a> 并发基础</h1> <h2 id="_1-cpu多级缓存-缓存一致性-乱序执行优化"><a href="#_1-cpu多级缓存-缓存一致性-乱序执行优化" class="header-anchor">#</a> 1.CPU多级缓存（缓存一致性，乱序执行优化）</h2> <h2 id="_2-java内存模型"><a href="#_2-java内存模型" class="header-anchor">#</a> 2.Java内存模型</h2> <h2 id="_3-并发的优势和风险"><a href="#_3-并发的优势和风险" class="header-anchor">#</a> 3.并发的优势和风险</h2> <h3 id="cpu多级缓存"><a href="#cpu多级缓存" class="header-anchor">#</a> CPU多级缓存</h3> <p>CPU 多级缓存：</p> <blockquote><p>主存和cpu通过主线连接，CPU缓存在主存和CPU之间，缓存的出现可以减少CPU读取共享主存的次数</p></blockquote> <p>为什么需要CPU cache：</p> <blockquote><p>CPU的频率太快了，快到主存跟不上，这样在处理器时钟周期内，CPU常常需要等待主存，浪费资源。所以cache的出现，是为了缓解CPU和内存之间速度不匹配问题（结构：cpu -&gt; cache -&gt; memery）.</p></blockquote> <p>CPU cache有什么意义：</p> <blockquote><p>1）时间局部性：如果某个数据被访问，name在不久的将来它很可能被再次访问。
2）空间局部性：如果某个数据被访问，那么与它相邻的数据很快也可能被访问</p></blockquote> <p>CPU多级缓存-缓存一致性（MESI）</p> <blockquote><p>MESI分别代表cache数据的四种状态，这四种状态可以相互转换
缓存四种操作：local read、local write、remote read、remote write</p></blockquote> <h3 id="cpu多级缓存-乱序执行优化"><a href="#cpu多级缓存-乱序执行优化" class="header-anchor">#</a> CPU多级缓存-乱序执行优化</h3> <p>乱序执行优化</p> <blockquote><p>处理器为提高运算速度而做出违背代码原有顺序的优化</p></blockquote> <h3 id="java内存模型-java-memory-model-jmm"><a href="#java内存模型-java-memory-model-jmm" class="header-anchor">#</a> java内存模型（java memory model，JMM）</h3> <p><img src="https://img-blog.csdnimg.cn/20201101210850129.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2JhaW9mY2hhbw==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"> <img src="https://img-blog.csdnimg.cn/20201101210923517.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2JhaW9mY2hhbw==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述">
Java内存模型抽象结构图
<img src="https://img-blog.csdnimg.cn/20201101211038504.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2JhaW9mY2hhbw==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p> <p>java内存模型-同步八种操作</p> <blockquote><p><strong>lock</strong>（锁定）：作用于主内存的变量，把一个变量标识为一条线程独占状态
<strong>unlock</strong>（解锁）：作用于主内存变脸个，把一个处于锁定状态的变量释放出来，释放后的变量才可以被其他线程锁定
<strong>read</strong>（读取）：作用于主内存变量，把一个变量值从主内存传输到线程的工作内存中，以便随后的load动作使用
<strong>load</strong>（载入）：作用于工作内存的变量，它把read操作从主内存中得到的变量值放入工作内存的变量副本中
<strong>use</strong>（使用）：作用于工作内存的变量，把工作内存中的一个变量值传递给执行引擎
<strong>assign</strong>（赋值）：作用于工作内存的变量，它把一个从执行引擎接收到的值赋值给工作内存的变量
<strong>store</strong>（存储）：作用于工作内存的变量，把工作内存中的一个变量的值传送到主内存中，以遍随后的write的操作
<strong>write</strong>（写入）：作用于主内存的变量，它把store操作从工作内存中的一个变量的值传送到主内存的变量中</p></blockquote> <p>java内存模型-同步规则</p> <blockquote><p>1,如果要把一个变量从主内存中复制到工作内存，就需要按顺序的执行read和load操作，如果把变量从工作内存中同步回主内存，就需要按顺序的执行store和write操作。但java内存模型只要求上述操作必须按顺序执行，而没有保证必须是连续执行</p></blockquote> <blockquote><p>2,不允许read和load、store和write操作之一单独出现</p></blockquote> <blockquote><p>3,不允许一个线程丢弃它的最近assign的操作，即变量在工作内存中改变了之后必须同步到主内存中。</p></blockquote> <blockquote><p>4,不允许一个线程无原因的（没发生过任何assign操作）把数据从工作内存同步回主内存中</p></blockquote> <blockquote><p>5,一个新的变量只能在主内存中诞生，不允许在工作内存中直接使用一个未被初始化（load或assign）的变量。即就是对一个变量实施use和store操作之前，必须先执行过了assign和load操作</p></blockquote> <blockquote><p>6,一个变量在同一时刻只允许一条线程对其进行lock操作，但lock操作可以被同一条线程重复执行多次，多次执行lock后，只有执行相同次数的unlock操作，变量才会被解锁。lock和unlock必须成对出现</p></blockquote> <blockquote><p>7,如果对一个变量执行lock操作，将会清空工作内存中此变量的值，在执行引擎使用这个变量之前需要重新执行load或assign操作初始化变量的值</p></blockquote> <blockquote><p>8,如果一个变量实现没有被lock操作锁定，怎不允许对它执行unlock操作，也不允许去unlock一个被其他线程锁定的变量</p></blockquote> <blockquote><p>9,对一个变量执行unlock操作之前，必须先把此变量同步到主内存中（执行store和write操作）</p></blockquote> <p>Java内存模型-同步操作与规则
<img src="https://img-blog.csdnimg.cn/20201101212321638.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2JhaW9mY2hhbw==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p> <h3 id="并发的优势与风险"><a href="#并发的优势与风险" class="header-anchor">#</a> 并发的优势与风险</h3> <blockquote><p>优势</p> <blockquote><p>1,速度：同时处理多个请求，响应更快；复杂的操作可以分成多个进程同时进行
2,设计：程序设计在某些情况下更简单，也可以更多的选择
3,资源利用：CPU能够在等待IO的时候做一些其他的事情</p></blockquote></blockquote> <blockquote><p>风险</p> <blockquote><p>1,安全性：多个线程共享数据时可能会产生于期望不相符的结果
2,活跃性：某个操作无法继续进行下去时，就会发生活跃性问题。比如死锁、饥饿等问题
3,性能：线程过多时会使得CPU频繁切换，调度时间增多；同步机制；消耗过多内存</p></blockquote></blockquote> <h1 id="线程安全性"><a href="#线程安全性" class="header-anchor">#</a> 线程安全性</h1> <h2 id="_1-线程安全性概念"><a href="#_1-线程安全性概念" class="header-anchor">#</a> 1.线程安全性概念</h2> <h2 id="_2-线程安全性体现的三个方面"><a href="#_2-线程安全性体现的三个方面" class="header-anchor">#</a> 2.线程安全性体现的三个方面</h2> <h3 id="线程安全性-2"><a href="#线程安全性-2" class="header-anchor">#</a> 线程安全性</h3> <blockquote><p>当多个线程访问某个类时，不管运行时环境采用何种调度方式或者这些线程将如何交替执行，并且在主调代码中不需要任何额外的同步或协同，这个类都能表现出正确的行为，那么就称这个类时线程安全的。</p></blockquote> <h3 id="线程安全体现在以下三个方面"><a href="#线程安全体现在以下三个方面" class="header-anchor">#</a> 线程安全体现在以下三个方面</h3> <blockquote><p>1,原子性：提供了互斥访问，同一时刻只能有一个线程来对他进行操作
2,可见性：一个线程对主内存的修改可以及时的被其他线程观察到
3,有序性：一个线程观察其他线程中的指令执行顺序，由于指令重排序的存在，该观察结果一般杂乱无序</p></blockquote> <h4 id="原子性"><a href="#原子性" class="header-anchor">#</a> 原子性</h4> <h5 id="原子性-atomic包"><a href="#原子性-atomic包" class="header-anchor">#</a> 原子性——Atomic包</h5> <blockquote><p>1,AtomicXxxx：CAS、Unsafe.compareAndSwapInt
2,AtomicLong，LongAdder
3.AtomicReference，AtomicReferenceFieldUpdater</p></blockquote> <p>理解：</p> <blockquote><p>AtomicXxxx类中方法incrementAndGet()是重点，
incrementAndGet方法中调用unsafe.getAndAddInt()，
getAndAddInt方法中主题是do-while语句，while语句中调用<strong>compareAndSwapInt</strong>(var1, var2, var5, var5 + var4),
compareAndSwapInt方法就是<strong>CAS</strong>核心:</p> <blockquote><p>在死循环内，不断尝试修改目标值，直到修改成功，如果竞争不激烈，修改成功率很高，否则失败概率很高，性能会受到影响</p></blockquote></blockquote> <blockquote><p>jdk8中新增LongAdder，它和AtomicLong比较
优点：性能好，在处理高并发情况下统计优先使用LongAdder
<strong>LongAddr原理？</strong></p></blockquote> <blockquote><p>AtomicReference、AtomicReferenceFieldUpdater原子性更新字段（字段要求volatile修饰，并且是非static）</p></blockquote> <blockquote><p>AtomicStampReference：CAS的ABA问题
ABA问题：变量已经被修改了，但是最终的值和原来的一样，那么如何区分是否被修改过呢，用版本号解决</p></blockquote> <blockquote><p>AtomicBoolean可以让某些代码只执行一次</p></blockquote> <h5 id="原子性-锁"><a href="#原子性-锁" class="header-anchor">#</a> 原子性——锁</h5> <blockquote><p>synchronized：依赖JVM，作用对象的作用范围内
Lock：依赖特殊的CPU指令，代码实现，ReentrantLock</p></blockquote> <blockquote><p>synchronized</p> <blockquote><p>1,修饰代码块：同步代码块，大括号括起来的代码，作用于调用的对象
2,修饰方法：同步方法，整个方法，作用于调用的对象
3,修饰静态方法：整个静态方法，作用于所有对象
4,修饰类：括号括起来的部分，作用于所有对象</p></blockquote></blockquote> <blockquote><p>Lock</p> <blockquote><p>依赖特殊的CPU指令，代码实现，ReentrantLock</p></blockquote></blockquote> <h5 id="原子性-对比"><a href="#原子性-对比" class="header-anchor">#</a> 原子性——对比</h5> <blockquote><p>synchronized：不可中断锁，适合竞争不激烈，可读性好
Lock：可中断锁，多样化同步，竞争激烈时能维持常态
Atomic：竞争激烈时能维持常态，比Lock性能好，只能同步一个值</p></blockquote> <h4 id="可见性"><a href="#可见性" class="header-anchor">#</a> 可见性</h4> <blockquote><p>导致共享变量在线程间不可见的原因：</p> <blockquote><p>1 线程交叉执行
2 重排序结合线程交叉执行
3 共享变量更新后的值没有在工作内存与主内存间及时更新</p></blockquote></blockquote> <h5 id="可见性-synchronized"><a href="#可见性-synchronized" class="header-anchor">#</a> 可见性——synchronized</h5> <blockquote><p>JMM关于synchronized的两条规定：
1,线程解锁前，必须把共享变量的最新值刷新到主内存
2,线程加锁时，将清空工作内存中共享变量的值，从而使用共享变量时需要从主内存中重新读取最新的值（注意，加锁和解锁是同一把锁）</p></blockquote> <h5 id="可见性-volatile"><a href="#可见性-volatile" class="header-anchor">#</a> 可见性——volatile</h5> <blockquote><p>通过加入内存屏障和禁止重排序优化来实现</p> <blockquote><p>1 对volatile变量写操作时，会在写操作后加入一条store屏障指令，将本地内存中的共享变量值刷新到主内存
2 随volatile变量度操作时，会在读操作前加入一条load屏障指令，从主内存中读取共享变量
图示：
<img src="https://img-blog.csdnimg.cn/20201101222034299.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2JhaW9mY2hhbw==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"> <img src="https://img-blog.csdnimg.cn/20201101222056432.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2JhaW9mY2hhbw==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p></blockquote></blockquote> <blockquote><p>使用volatile修饰变量，无法保证线程安全</p></blockquote> <blockquote><p>volatile适合修饰状态标识量
<img src="https://img-blog.csdnimg.cn/20201101222129700.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2JhaW9mY2hhbw==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p></blockquote> <h4 id="有序性"><a href="#有序性" class="header-anchor">#</a> 有序性</h4> <blockquote><p>java内存模型中，允许编译器和处理器对指令进行重排序，但是重排序过程不会影响到单线程程序的执行，却会影响到多线程并发执行的正确性</p></blockquote> <h5 id="有序性-happens-before原则"><a href="#有序性-happens-before原则" class="header-anchor">#</a> 有序性——happens-before原则</h5> <blockquote><p>1 程序次序规则：一个线程内，按照代码顺序，书写在前面的操作先行发生于书写在后面的操作
注：在单线程中，看起来是这样的，虚拟机可能会对代码进行指令重排序，虽然重排序了，但是运行结果在单线程中和指令书写顺序是一致的，事实上，这条规则是用来保证程序单在单线程中执行结果的正确性，无法保证程序在多线程中的正确性.
2 锁定规则：一个unlock操作先行发生于后面对同一个锁的lock操作
3 volatile变量规则：对一个变量的写操作先行发生于后面对这个变量的读操作
4 传递规则：如果操作A先行发生于操作B，而操作B又先行发生于操作C，则可以得出操作A先行发生于操作C
前四条规则比较重要
5 线程启动规则：Thread对象的start()方法先行发生于次线程的每一个动作
6 线程中断规则：对线程interrupt()方法的调用先行发生于被中断线程的代码监测到中断事件的发生
7 线程终结规则：线程中所有的操作都先行发生于线程的终止检测，我们可以通过Thread.join()方法结束、Thread.isAlive()的返回值手段检测到线程已经终止执行
8 对象终结规则：一个对象的初始化完成先行发生于他的finalize()方法的开始</p></blockquote> <blockquote><p>理解：</p> <blockquote><p>一个线程观察其他线程指令执行顺序，由于重排序的存在，观察结果一般是无序的，如果两个操作执行顺序无法从happens-before原则推导出来，那么他们就不能保证有序性，虚拟机可以随意的对他们重排序</p></blockquote></blockquote> <h1 id="安全发布对象"><a href="#安全发布对象" class="header-anchor">#</a> 安全发布对象</h1> <h2 id="_1-发布与逸出"><a href="#_1-发布与逸出" class="header-anchor">#</a> 1.发布与逸出</h2> <h2 id="_2-四种方法"><a href="#_2-四种方法" class="header-anchor">#</a> 2.四种方法</h2> <h3 id="发布与逸出"><a href="#发布与逸出" class="header-anchor">#</a> 发布与逸出</h3> <blockquote><p>发布对象</p> <blockquote><p>使一个对象能够被当前范围之外的代码所使用</p></blockquote></blockquote> <blockquote><p>对象逸出</p> <blockquote><p>一种错误的发布。当一个对象还没有构造完成时，就使它被其他线程所见</p></blockquote></blockquote> <h3 id="安全发布对象四种方法"><a href="#安全发布对象四种方法" class="header-anchor">#</a> 安全发布对象四种方法</h3> <blockquote><p>1 在静态初始化函数中初始化一个对象引用
2 将对象的引用保存到volatile类型域或者AtomicReference对象中
3 将对象的引用保存到某个正确构造对象的final类型域中
4 将对象的引用保存到一个由锁保护的域中</p></blockquote> <blockquote><p>理解</p> <blockquote><p>私有构造函数，单例对象，静态工厂方法获取对象</p></blockquote></blockquote> <p>以单例模式为例</p> <p>懒汉模式：单例实例在第一次使用时进行创建（线程不安全）</p> <p>懒汉模式也可以实现线程安全，给getInstance方法添加synchronized关键字（不推荐，因为性能不好）</p> <p>双重同步锁单例模式：双重监测机制，在方法内部加synchronized关键字（不是线程安全的）</p> <p>原因是，创建对象是，分为以下三个步骤：</p> <p>1） memory = allocate() 分配对象的内存空间</p> <p>2）ctorInstance() 初始化对象</p> <p>3）instance = memory() 设置instance指向刚分配的内存</p> <p>由于JVM和cpu优化，可能会发生指令重排：</p> <p>1） memory = allocate() 分配对象的内存空间</p> <p>3） instance = memory() 设置instance指向刚分配的内存</p> <p>2） ctorInstance() 初始化对象</p> <p>当以上面这种指令执行时，线程A执行到3 instance = memory() 设置instance指向刚分配的内存 这一步时，线程B执行if(instance == null)这段代码，此时instance ！= null，线程B直接return instance，导致对象没有初始化完毕就返回</p> <p>解决办法就是限制对象创建时进行指令重排，volatile+双重监测机制-&gt;禁止指令重排引起非线程安全</p> <p>饿汉模式：单例实例在类装载时进行创建（线程安全）</p> <p>枚举模式：线程安全</p> <h1 id="线程安全策略"><a href="#线程安全策略" class="header-anchor">#</a> 线程安全策略</h1> <h2 id="_1-不可变对象"><a href="#_1-不可变对象" class="header-anchor">#</a> 1.不可变对象</h2> <h2 id="_2-线程封闭"><a href="#_2-线程封闭" class="header-anchor">#</a> 2.线程封闭</h2> <h2 id="_3-线程不安全类与写法"><a href="#_3-线程不安全类与写法" class="header-anchor">#</a> 3.线程不安全类与写法</h2> <h2 id="_4-同步容器"><a href="#_4-同步容器" class="header-anchor">#</a> 4.同步容器</h2> <h2 id="_5-并发容器"><a href="#_5-并发容器" class="header-anchor">#</a> 5.并发容器</h2> <h2 id="_6-安全共享策略"><a href="#_6-安全共享策略" class="header-anchor">#</a> 6.安全共享策略</h2> <h3 id="不可变对象"><a href="#不可变对象" class="header-anchor">#</a> 不可变对象</h3> <blockquote><p>不可变对象需要满足的条件：</p> <blockquote><p>对象创建以后其状态就不能修改
对象所有域都是final类型
对象是正确创建的（在对象创建期间，this引用没有逸出）</p></blockquote></blockquote> <blockquote><p>final关键字定义不可变对象</p> <blockquote><p>修饰类、方法、变量
修饰类：不能被继承
修饰方法：1.锁定方法不被继承类修改 2.效率
修饰变量：基本数据类型，数值不可变；引用类型变量，不能再指向另外一个对象，因此容易引起线程安全问题</p></blockquote></blockquote> <blockquote><p>其他实现不可变对象</p> <blockquote><p>Collections.unmodifiableXXX：Collection、List、Set、Map（线程安全）
Guava：ImmutableXXX：Collection、List、Set、Map</p></blockquote></blockquote> <h3 id="线程封闭性"><a href="#线程封闭性" class="header-anchor">#</a> 线程封闭性</h3> <blockquote><p>线程封闭</p> <blockquote><p>把对象封装到一个线程里，只有这个线程可以看到该对象，那么就算该对象不是线程安全的，也不会出现任何线程安全方面的问题。实现线程封闭的方法：</p></blockquote></blockquote> <blockquote><p>线程封闭方法</p> <blockquote><p>1 Ad-hoc线程封闭：程序控制实现，最糟糕，忽略
2 堆栈封闭：局部变量，无并发问题
3 threadLocal是线程安全的，做到了线程封闭</p> <blockquote><p>ThreadLocal内部维护了一个map，map的key是每个线程的名称，map的值是要封闭的对象，每一个线程中的对象都对应者一个map中的值</p></blockquote></blockquote></blockquote> <blockquote><p>线程封闭的应用场景：
数据库连接jdbc的Connection对象</p></blockquote> <h3 id="线程不安全类与写法"><a href="#线程不安全类与写法" class="header-anchor">#</a> 线程不安全类与写法</h3> <blockquote><p>字符串</p> <blockquote><p>StringBuilder：线程不安全<br>
StringBuffer：线程安全</p></blockquote></blockquote> <blockquote><p>时间转换</p> <blockquote><p>SimpleDateFormat：线程不安全
JodaTime：线程安全</p></blockquote></blockquote> <blockquote><p>集合</p> <blockquote><p>ArrayList,HashSet,HashMap等Collections：线程不安全</p></blockquote></blockquote> <blockquote><p>编程注意：</p> <blockquote><p>if(condition(a)){handle(a)}; 不是线程安全的，因为这条判断语句不是原子性的，如果有线程共享这条代码，则会出现并发问题，解决方案是想办法这这段代码是原子性的（加锁）</p></blockquote></blockquote> <h3 id="线程安全-同步容器-在多线程环境下不推荐使用"><a href="#线程安全-同步容器-在多线程环境下不推荐使用" class="header-anchor">#</a> 线程安全——同步容器（在多线程环境下不推荐使用）</h3> <blockquote><p>ArrayList -&gt; Vector, Stack（Vector中的方法使用synchronized修饰过，Stack继承Vector）
HashMap -&gt; HashTable(key、value不能为null，HashTable使用synchronized修饰方法）
Collections.synchronizedXXX（List、Set、Map）</p></blockquote> <blockquote><p>同步容器不完全是线程安全的
编程注意：如果使用foreach或者iterator遍历集合时，尽量不要对集合进行修改操作</p></blockquote> <h3 id="线程安全-并发容器j-u-c-java-util-concurrent-在多线程环境下推荐使用"><a href="#线程安全-并发容器j-u-c-java-util-concurrent-在多线程环境下推荐使用" class="header-anchor">#</a> 线程安全——并发容器J.U.C（java.util.concurrent）（在多线程环境下推荐使用）</h3> <blockquote><p>ArrayList -&gt; CopyOnWriteArrayList：</p> <blockquote><p>相比ArrayList，CopyOnWriteArrayList是线程安全的，写操作时复制，即当有新元素添加到CopyOnWriteArrayList时，先从原有的数组里拷贝一份出来，然后在新的数组上写操作，写完之后再将原来的数组指向新的数组，CopyOnWriteArrayList整个操作都是在锁（ReentrantLock锁）的保护下进行的，这么做主要是避免在多线程并发做add操作时复制出多个副本出来，把数据搞乱了。第一个缺点是做写操作时，需要拷贝数组，就会消耗内存，如果元素内容比较多会导致youngGC或者是fullGc；第二个缺点是不能用于实时读的场景，比如拷贝数组、新增元素都需要时间，所以调用一个set操作后，读取到的数据可能还是旧的，虽然CopyOnWriteArrayList能够做到最终的一致性，但是没法满足实时性要求，因此CopyOnWriteArrayList更适合读多写少的场景
CopyOnWriteArrayList设计思想：1读写分离 2最终一致性 3使用时另外开辟空间解决并发冲突</p></blockquote></blockquote> <blockquote><p>HashSet -&gt; CopyOnWriteArraySet</p> <blockquote><p>CopyOnWriteArraySet：底层实现是CopyOnWriteArrayList</p></blockquote></blockquote> <blockquote><p>TreeSet -&gt; ConcurrentSkipListSet
ConcurrentSkipListSet：和TreeSet 一样支持自然排序，基于map集合，但是批量操作不是线程安全的</p></blockquote> <blockquote><p>HashMap -&gt; ConcurrentHashMap ：不允许空值，针对读操作做了大量的优化，具有特别高的并发性</p></blockquote> <blockquote><p>TreeMap  -&gt; ConcurrentSkipListMap ：内部使用SkipList跳表结构实现的，key是有序的，支持更高的并发</p></blockquote> <h3 id="安全共享对象策略-总结"><a href="#安全共享对象策略-总结" class="header-anchor">#</a> 安全共享对象策略——总结</h3> <blockquote><p>1 线程限制：一个呗线程限制的对象，由线程独占，并且只能被占有它的线程修改
2 共享只读：一个共享只读的对象，在没有额外的同步情况下，可以被多个线程并发访问，但是任何线程都不能修改它
3 线程安全对象：一个线程安全的对象或容器，在内部通过同步机制来保证线程安全，所以其他线程无序额外的同步就可以通过公共接口随意访问它
4 被守护对象：被守护对象只能通过获取特定的锁来访问</p></blockquote> <h1 id="j-u-c之aqs-abstractqueuedsynchronizer"><a href="#j-u-c之aqs-abstractqueuedsynchronizer" class="header-anchor">#</a> J.U.C之AQS（AbstractQueuedSynchronizer）</h1> <h2 id="_1-aqs介绍"><a href="#_1-aqs介绍" class="header-anchor">#</a> 1.AQS介绍</h2> <h2 id="_2-aqs-countdownlatch"><a href="#_2-aqs-countdownlatch" class="header-anchor">#</a> 2.AQS-CountDownLatch</h2> <h2 id="_3-aqs-semaphore"><a href="#_3-aqs-semaphore" class="header-anchor">#</a> 3.AQS-Semaphore</h2> <h2 id="_4-aqs-cyclicbarrier"><a href="#_4-aqs-cyclicbarrier" class="header-anchor">#</a> 4.AQS-CyclicBarrier</h2> <h2 id="_5-aqs-reentrantlock与锁"><a href="#_5-aqs-reentrantlock与锁" class="header-anchor">#</a> 5.AQS-ReentrantLock与锁</h2> <h3 id="aqs介绍"><a href="#aqs介绍" class="header-anchor">#</a> AQS介绍</h3> <blockquote><p>1 使用Node实现FIFO队列，可以用于构建锁或者其他同步装置的基础框架
2 利用了int类型表示状态
3 使用方法是继承
4 子类通过继承并通过实现它的方法管理器状态{acquire和release}的方法操纵状态
5 可以同时实现排它锁和共享锁模式（独占、共享）</p></blockquote> <blockquote><p>AQS实现原理</p> <blockquote><p>?</p></blockquote></blockquote> <blockquote><p>AQS同步组件
1 CountDownLatch：闭锁，通过计数来保证线程是否需要一直阻塞
2 Semaphore：控制同一时间并发线程的数目
3 CyclicBarrier：和CountDownLatch相似，都能阻阻塞线程
4 ReentrantLock
5 Condition
6 FutureTask</p></blockquote> <h3 id="countdownlatch"><a href="#countdownlatch" class="header-anchor">#</a> CountDownLatch</h3> <blockquote><p>CountDownLatch是一个同步辅助类，应用场景：并行运算，所有线程执行完毕才可执行</p></blockquote> <p><img src="https://img-blog.csdnimg.cn/2020110210193350.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2JhaW9mY2hhbw==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述">
代码示例1：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>import java.util.concurrent.CountDownLatch;
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;
import java.util.concurrent.TimeUnit;

class Scratch{
    private final static int threadCount = 50;
    public static void main(String[] args) throws Exception{

        ExecutorService executorService = Executors.newCachedThreadPool();
        final CountDownLatch countDownLatch = new CountDownLatch(threadCount);

        for (int i=0;i&lt;threadCount;i++){
            final int threadNum = i;
            executorService.execute(()-&gt;{
                try {
                    test(threadNum);
                } catch (Exception e) {
                    System.out.println(&quot;exception:&quot;+e);
                }finally {
                    countDownLatch.countDown();
                }
            });
        }

        countDownLatch.await();// countDownLatch减为0时才会继续下面流程
        System.out.println(&quot;run finish&quot;);
        executorService.shutdown();
    }

    private static void test(int threadNum) throws Exception{
        Thread.sleep(100);
        System.out.println(&quot;run:&quot;+threadNum);
        Thread.sleep(100);
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p>代码示例2：
await方法可以设定指定等待时间，超过这个时间久不再等待</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>public static void main(String[] args) throws Exception{

        ExecutorService executorService = Executors.newCachedThreadPool();
        final CountDownLatch countDownLatch = new CountDownLatch(threadCount);

        for (int i=0;i&lt;threadCount;i++){
            final int threadNum = i;
            executorService.execute(()-&gt;{
                try {
                    test(threadNum);
                } catch (Exception e) {
                    System.out.println(&quot;exception:&quot;+e);
                }finally {
                    countDownLatch.countDown();
                }
            });
        }

        countDownLatch.await(10, TimeUnit.MILLISECONDS);//超过这个时间久不再等待
        System.out.println(&quot;run finish&quot;);
        executorService.shutdown();
    }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="semaphore"><a href="#semaphore" class="header-anchor">#</a> Semaphore</h3> <blockquote><p>Semaphore可以很容易控制某个资源可同时访问的线程个数，
和CountDownLatch使用有些类似，提供acquire和release两个方法，
acquire是获取一个许可，如果没有就等待，
release是在操作完成后释放许可出来。
Semaphore维护了当前访问的线程的个数，提供同步机制来控制同时访问的个数，Semaphore可以实现有限大小的链表，重入锁（如ReentrantLock）也可以实现这个功能，但是实现上比较复杂。</p></blockquote> <blockquote><p>Semaphore使用场景：适用于仅能提供有限资源，如数据库连接数</p></blockquote> <p>代码示例1：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>import java.time.LocalDate;
import java.util.concurrent.*;

class Scratch{
    private final static int threadCount = 20;
    public static void main(String[] args) throws Exception{

        ExecutorService executorService = Executors.newCachedThreadPool();
        final Semaphore semaphore = new Semaphore(3);

        for (int i=0;i&lt;threadCount;i++){
            final int threadNum = i;
            executorService.execute(()-&gt;{
                try {
                    semaphore.acquire();
                    test(threadNum);
                    semaphore.release();
                } catch (Exception e) {
                    System.out.println(&quot;exception:&quot;+e);
                }
            });
        }
        executorService.shutdown();
    }

    private static void test(int threadNum) throws Exception{
        System.out.println(&quot;time:&quot;+ LocalDate.now() +&quot;-&quot;+threadNum);
        Thread.sleep(1000);
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>代码示例2：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>public static void main(String[] args) throws Exception{

        ExecutorService executorService = Executors.newCachedThreadPool();
        final Semaphore semaphore = new Semaphore(3);

        for (int i=0;i&lt;threadCount;i++){
            final int threadNum = i;
            executorService.execute(()-&gt;{
                try {
                    if (semaphore.tryAcquire()){ //尝试获取一个许可
                        test(threadNum);
                        semaphore.release(); // 释放一个许可
                    }
                } catch (Exception e) {
                    System.out.println(&quot;exception:&quot;+e);
                }
            });
        }
        executorService.shutdown();
    }

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>代码示例3</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>public static void main(String[] args) throws Exception{

        ExecutorService executorService = Executors.newCachedThreadPool();
        final Semaphore semaphore = new Semaphore(3);

        for (int i=0;i&lt;threadCount;i++){
            final int threadNum = i;
            executorService.execute(()-&gt;{
                try {
                    if (semaphore.tryAcquire(1,5000,TimeUnit.MICROSECONDS)){
                        test(threadNum);
                        semaphore.release();
                    }
                } catch (Exception e) {
                    System.out.println(&quot;exception:&quot;+e);
                }
            });
        }
        executorService.shutdown();
    }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="cyclicbarrier"><a href="#cyclicbarrier" class="header-anchor">#</a> CyclicBarrier</h3> <p><img src="https://img-blog.csdnimg.cn/20201102121422555.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2JhaW9mY2hhbw==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p> <blockquote><p>与CountDownLatch相似，都是通过计数器实现，当某个线程调用await方法，该线程就进入等待状态，且计数器进行加1操作，当计数器的值达到设置的初始值，进入await等待的线程会被唤醒，继续执行他们后续的操作。由于CyclicBarrier在释放等待线程后可以重用，所以又称循环屏障。使用场景和CountDownLatch相似，可用于并发运算。</p></blockquote> <blockquote><p>CyclicBarrier和CountDownLatch区别：</p> <blockquote><p>1 CountDownLatch计数器只能使用一次，CyclicBarrier的计数器可以使用reset方法重置循环使用
2 CountDownLatch主要是视线1个或n个线程需要等待其他线程完成某项操作才能继续往下执行，<strong>CyclicBarrier主要是实现多个线程之间相互等待知道所有线程都满足了条件之后才能继续执行后续的操作，CyclicBarrier能处理更复杂的场</strong>景</p></blockquote></blockquote> <p>代码示例：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>import java.util.concurrent.*;

class Scratch{
    private final static int threadCount = 10;
    private static CyclicBarrier barrier = new CyclicBarrier(5);
    public static void main(String[] args) throws Exception{

        ExecutorService executorService = Executors.newCachedThreadPool();

        for (int i=0;i&lt;threadCount;i++){
            final int threadNum = i;
            Thread.sleep(1000);
            executorService.execute(()-&gt;{
                try {
                   test(threadNum);
                } catch (Exception e) {
                    System.out.println(&quot;exception:&quot;+e);
                }
            });
        }
        executorService.shutdown();
    }

    private static void test(int threadNum) throws Exception{
        Thread.sleep(1000);
        System.out.println(threadNum+&quot; is ready&quot;);
        barrier.await();
        System.out.println(threadNum+&quot; continue&quot;);
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h3 id="reentrantlock"><a href="#reentrantlock" class="header-anchor">#</a> ReentrantLock</h3> <blockquote><p>reentrantLock（可重入锁）和synchronized区别</p> <blockquote><p>1 可重入性：同一线程可以重入获得相同的锁，计数器加1，释放锁计数器减1
synchronized也是可重入锁
2 锁的实现：synchronized依赖jvm实现（操作系统级别的实现），reentrantLock是jdk实现的（用户自己编程实现）
3 性能区别：synchronized在优化前性能比reentrantLock差，优化后性能有了恨到提升，相同条件下优先使用synchronized
4 功能区别：1）便利性方面，synchronized使用简单，reentrantLock需要手工加锁和释放锁2）锁的细粒度和灵活度方面，reentrantLock优于synchronized
5 reentrantlock独有的功能：1）可指定是公平锁还是非公平锁，synchronized只能是非公平锁 2）提供了一个Condition类，可以分组唤醒需要唤醒的线程 3）能够提供中断等待锁的线程机制，lock.lockInterruptibly()</p></blockquote></blockquote> <p>代码示例：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>import java.util.concurrent.*;
import java.util.concurrent.locks.Lock;
import java.util.concurrent.locks.ReentrantLock;

class Scratch{
    private final static int threadCount = 10;
    private static CyclicBarrier barrier = new CyclicBarrier(5);
    // 请求总数
    public static int clientTotal = 5000;

    // 同时并发执行的线程数
    public static int threadTotal = 200;

    public static int count = 0;

    private final static Lock lock = new ReentrantLock();

    public static void main(String[] args) throws Exception {
        ExecutorService executorService = Executors.newCachedThreadPool();
        final Semaphore semaphore = new Semaphore(threadTotal);
        final CountDownLatch countDownLatch = new CountDownLatch(clientTotal);
        for (int i = 0; i &lt; clientTotal ; i++) {
            executorService.execute(() -&gt; {
                try {
                    semaphore.acquire();
                    add();
                    semaphore.release();
                } catch (Exception e) {
                    System.out.println(e);
                }
                countDownLatch.countDown();
            });
        }
        countDownLatch.await();
        executorService.shutdown();
        System.out.println(&quot;count:&quot;+count);
    }

    private static void add() {
        lock.lock();
        try {
            count++;
        } finally {
            lock.unlock();
        }
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div><h3 id="reentrantreadwritelock"><a href="#reentrantreadwritelock" class="header-anchor">#</a> ReentrantReadWriteLock</h3> <blockquote><p>在没有任何读写锁时，才可以取得写入锁
悲观写锁，即当所有读锁释放之后，才能加写锁，对于读多写少的程序，会引起堵塞或者死锁</p></blockquote> <p>代码示例：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>import java.util.Map;
import java.util.Set;
import java.util.TreeMap;
import java.util.concurrent.locks.Lock;
import java.util.concurrent.locks.ReentrantReadWriteLock;

class Scratch{
    private final Map&lt;String, Data&gt; map = new TreeMap&lt;&gt;();

    private final ReentrantReadWriteLock lock = new ReentrantReadWriteLock();

    private final Lock readLock = lock.readLock();

    private final Lock writeLock = lock.writeLock();

    public Scratch.Data get(String key) {
        readLock.lock();
        try {
            return map.get(key);
        } finally {
            readLock.unlock();
        }
    }

    public Set&lt;String&gt; getAllKeys() {
        readLock.lock();
        try {
            return map.keySet();
        } finally {
            readLock.unlock();
        }
    }

    public Scratch.Data put(String key, Scratch.Data value) {
        writeLock.lock();
        try {
            return map.put(key, value);
        } finally {
            readLock.unlock();
        }
    }

    class Data {

    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><h3 id="stampedlock"><a href="#stampedlock" class="header-anchor">#</a> StampedLock</h3> <blockquote><p>StampedLock</p> <blockquote><p>?</p></blockquote></blockquote> <p>示例代码1</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>import java.util.concurrent.locks.StampedLock;

class Scratch{

    class Point {
        private double x, y;
        private final StampedLock sl = new StampedLock();

        void move(double deltaX, double deltaY) { // an exclusively locked method
            long stamp = sl.writeLock();
            try {
                x += deltaX;
                y += deltaY;
            } finally {
                sl.unlockWrite(stamp);
            }
        }

        //下面看看乐观读锁案例
        double distanceFromOrigin() { // A read-only method
            long stamp = sl.tryOptimisticRead(); //获得一个乐观读锁
            double currentX = x, currentY = y;  //将两个字段读入本地局部变量
            if (!sl.validate(stamp)) { //检查发出乐观读锁后同时是否有其他写锁发生？
                stamp = sl.readLock();  //如果没有，我们再次获得一个读悲观锁
                try {
                    currentX = x; // 将两个字段读入本地局部变量
                    currentY = y; // 将两个字段读入本地局部变量
                } finally {
                    sl.unlockRead(stamp);
                }
            }
            return Math.sqrt(currentX * currentX + currentY * currentY);
        }

        //下面是悲观读锁案例
        void moveIfAtOrigin(double newX, double newY) { // upgrade
            // Could instead start with optimistic, not read mode
            long stamp = sl.readLock();
            try {
                while (x == 0.0 &amp;&amp; y == 0.0) { //循环，检查当前状态是否符合
                    long ws = sl.tryConvertToWriteLock(stamp); //将读锁转为写锁
                    if (ws != 0L) { //这是确认转为写锁是否成功
                        stamp = ws; //如果成功 替换票据
                        x = newX; //进行状态改变
                        y = newY;  //进行状态改变
                        break;
                    } else { //如果不能成功转换为写锁
                        sl.unlockRead(stamp);  //我们显式释放读锁
                        stamp = sl.writeLock();  //显式直接进行写锁 然后再通过循环再试
                    }
                }
            } finally {
                sl.unlock(stamp); //释放读锁或写锁
            }
        }
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div><p>代码示例2</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>import java.util.concurrent.CountDownLatch;
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;
import java.util.concurrent.Semaphore;
import java.util.concurrent.locks.StampedLock;

class Scratch{
    // 请求总数
    public static int clientTotal = 5000;
    // 同时并发执行的线程数
    public static int threadTotal = 200;

    public static int count = 0;

    private final static StampedLock lock = new StampedLock();

    public static void main(String[] args) throws Exception {
        ExecutorService executorService = Executors.newCachedThreadPool();
        final Semaphore semaphore = new Semaphore(threadTotal);
        final CountDownLatch countDownLatch = new CountDownLatch(clientTotal);
        for (int i = 0; i &lt; clientTotal ; i++) {
            executorService.execute(() -&gt; {
                try {
                    semaphore.acquire();
                    add();
                    semaphore.release();
                } catch (Exception e) {
                    log.error(&quot;exception&quot;, e);
                }
                countDownLatch.countDown();
            });
        }
        countDownLatch.await();
        executorService.shutdown();
        log.info(&quot;count:{}&quot;, count);
    }

    private static void add() {
        long stamp = lock.writeLock();
        try {
            count++;
        } finally {
            lock.unlock(stamp);
        }
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><h3 id="condition"><a href="#condition" class="header-anchor">#</a> Condition</h3> <blockquote><p>多线程建协调通信的工具类</p></blockquote> <p>代码示例：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>import java.util.concurrent.locks.Condition;
import java.util.concurrent.locks.ReentrantLock;

class Scratch{
    public static void main(String[] args) {
        ReentrantLock reentrantLock = new ReentrantLock();
        Condition condition = reentrantLock.newCondition();

        new Thread(() -&gt; {
            try {
                reentrantLock.lock();
                log.info(&quot;wait signal&quot;); // 1
                condition.await();
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
            log.info(&quot;get signal&quot;); // 4
            reentrantLock.unlock();
        }).start();

        new Thread(() -&gt; {
            reentrantLock.lock();
            log.info(&quot;get lock&quot;); // 2
            try {
                Thread.sleep(3000);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
            condition.signalAll();
            log.info(&quot;send signal ~ &quot;); // 3
            reentrantLock.unlock();
        }).start();
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h1 id="j-u-c组件扩展"><a href="#j-u-c组件扩展" class="header-anchor">#</a> J.U.C组件扩展</h1> <h2 id="_1-futuretask"><a href="#_1-futuretask" class="header-anchor">#</a> 1.FutureTask</h2> <h2 id="_2-fork-join"><a href="#_2-fork-join" class="header-anchor">#</a> 2.Fork/Join</h2> <h2 id="_3-blockingqueue"><a href="#_3-blockingqueue" class="header-anchor">#</a> 3.BlockingQueue</h2> <h3 id="futuretask"><a href="#futuretask" class="header-anchor">#</a> FutureTask</h3> <blockquote><p>Callable与Runnable接口对比
Future接口，可以得到任务的返回值
FutureTask父类是RunnableFuture，RunnableFuture继承了Runnable和Future两个接口</p></blockquote> <blockquote><p>使用场景</p> <blockquote><p>假设又一个很费事逻辑，需要计算，并且返回这个值，同时这个值又不是马上需要，
那么就可以使用这个组合，用另外一个线程去计算返回值，
而当前线程在使用这个返回值之前可以做其他操作，等到需要这个返回值时，再通过Future得到</p></blockquote></blockquote> <p>Future代码示例1：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>import lombok.extern.slf4j.Slf4j;

import java.util.concurrent.Callable;
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;
import java.util.concurrent.Future;

@Slf4j
public class FutureExample {

    static class MyCallable implements Callable&lt;String&gt; {

        @Override
        public String call() throws Exception {
            log.info(&quot;do something in callable&quot;);
            Thread.sleep(5000);
            return &quot;Done&quot;;
        }
    }

    public static void main(String[] args) throws Exception {
        ExecutorService executorService = Executors.newCachedThreadPool();
        Future&lt;String&gt; future = executorService.submit(new MyCallable());
        log.info(&quot;do something in main&quot;);
        Thread.sleep(1000);
        String result = future.get();
        log.info(&quot;result：{}&quot;, result);
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>FutureTask示例代码2：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>@Slf4j
public class FutureTaskExample {

    public static void main(String[] args) throws Exception {
        FutureTask&lt;String&gt; futureTask = new FutureTask&lt;String&gt;(new Callable&lt;String&gt;() {
            @Override
            public String call() throws Exception {
                log.info(&quot;do something in callable&quot;);
                Thread.sleep(5000);
                return &quot;Done&quot;;
            }
        });

        new Thread(futureTask).start();
        log.info(&quot;do something in main&quot;);
        Thread.sleep(1000);
        String result = futureTask.get();
        log.info(&quot;result：{}&quot;, result);
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="fork-join框架"><a href="#fork-join框架" class="header-anchor">#</a> Fork/Join框架</h3> <blockquote><p>将大人物切分成多个小任务并行执行，最后将结果汇总，思想和mapreduce类似。采用工作窃取算法，充分利用线程并行计算
<img src="https://img-blog.csdnimg.cn/20201102134647914.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2JhaW9mY2hhbw==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p></blockquote> <p>代码示例</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>public class ForkJoinTaskExample extends RecursiveTask&lt;Integer&gt; {

    public static final int threshold = 2;
    private int start;
    private int end;

    public ForkJoinTaskExample(int start, int end) {
        this.start = start;
        this.end = end;
    }

    @Override
    protected Integer compute() {
        int sum = 0;

        //如果任务足够小就计算任务
        boolean canCompute = (end - start) &lt;= threshold;
        if (canCompute) {
            for (int i = start; i &lt;= end; i++) {
                sum += i;
            }
        } else {
            // 如果任务大于阈值，就分裂成两个子任务计算
            int middle = (start + end) / 2;
            ForkJoinTaskExample leftTask = new ForkJoinTaskExample(start, middle);
            ForkJoinTaskExample rightTask = new ForkJoinTaskExample(middle + 1, end);

            // 执行子任务
            leftTask.fork();
            rightTask.fork();

            // 等待任务执行结束合并其结果
            int leftResult = leftTask.join();
            int rightResult = rightTask.join();

            // 合并子任务
            sum = leftResult + rightResult;
        }
        return sum;
    }

    public static void main(String[] args) {
        ForkJoinPool forkjoinPool = new ForkJoinPool();

        //生成一个计算任务，计算1+2+3+4
        ForkJoinTaskExample task = new ForkJoinTaskExample(1, 100);

        //执行一个任务
        Future&lt;Integer&gt; result = forkjoinPool.submit(task);

        try {
            log.info(&quot;result:{}&quot;, result.get());
        } catch (Exception e) {
            log.error(&quot;exception&quot;, e);
        }
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div><h3 id="blockingqueue-阻塞队列"><a href="#blockingqueue-阻塞队列" class="header-anchor">#</a> BlockingQueue——阻塞队列</h3> <blockquote><p>当队列满进行入队操作，线程阻塞，
当队列空时进行出队操作，将会阻塞<img src="https://img-blog.csdnimg.cn/2020110213492915.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2JhaW9mY2hhbw==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p></blockquote> <blockquote><p>方法
<img src="https://img-blog.csdnimg.cn/20201102135448651.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2JhaW9mY2hhbw==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p></blockquote> <blockquote><p>实现类</p> <blockquote><p>ArrayBlockingQueue
DelayQueue
LinkedBlockingQueue
PriorityBlockingQueue
SynchronousQueue</p></blockquote></blockquote> <blockquote><p>应用场景</p> <blockquote><p>生产者、消费者</p></blockquote></blockquote> <h1 id="线程调度-线程池"><a href="#线程调度-线程池" class="header-anchor">#</a> 线程调度-线程池</h1> <h2 id="_1-线程池概念和特点"><a href="#_1-线程池概念和特点" class="header-anchor">#</a> 1.线程池概念和特点</h2> <h2 id="_2-线程池状态"><a href="#_2-线程池状态" class="header-anchor">#</a> 2.线程池状态</h2> <h2 id="_3-线程池-相关类"><a href="#_3-线程池-相关类" class="header-anchor">#</a> 3.线程池-相关类</h2> <h2 id="_4-线程池-相关方法"><a href="#_4-线程池-相关方法" class="header-anchor">#</a> 4.线程池-相关方法</h2> <h2 id="_5-线程池合理配置"><a href="#_5-线程池合理配置" class="header-anchor">#</a> 5.线程池合理配置</h2> <h3 id="线程池概念和特点"><a href="#线程池概念和特点" class="header-anchor">#</a> 线程池概念和特点</h3> <blockquote><p>new Thread弊端：</p> <blockquote><p>1 每次new Thread新建对象，性能差
2 线程缺乏统一的管理，可能无限制的新建线程，相互竞争，有可能占用过多系统资源导致死机或者OOM
3 缺少更多功能，如更多执行、定期执行、线程中断</p></blockquote></blockquote> <blockquote><p>线程池的好处：</p> <blockquote><p>1 重用存在的线程，减少对象创建、消亡的开销，性能佳
2 可有效控制最大并发的线程数，提高系统资源利用率，同时可以避免过多资源竞争，避免阻塞
3 提供定时执行、定期执行、单线程、并发数控制等功能</p></blockquote></blockquote> <h3 id="线程池状态"><a href="#线程池状态" class="header-anchor">#</a> 线程池状态</h3> <p><img src="https://img-blog.csdnimg.cn/20201102140507871.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2JhaW9mY2hhbw==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p> <h3 id="线程池-相关类"><a href="#线程池-相关类" class="header-anchor">#</a> 线程池-相关类</h3> <blockquote><p>ThreadPoolExecutor
ThreadPoolExecutor参数：</p> <blockquote><p>1 corePoolSize：核心线程数
2 maximumPoolSize：最大线程数
3 workQueue：阻塞队列，存储等待执行的任务，很重要，会对线程池运行过程产生重大影响
4 keepAliveTime：线程没有任务执行时最多保持多久的时间终止
5 unit：keepAliveTime的时间单位
6 threadFactory：线程工厂，用来创建线程
7 rejectHandler：当拒绝处理任务时的策略</p></blockquote> <blockquote><blockquote><p>如果当前系统运行的线程数量小于corePoolSize，直接新建线程执行处理任务，即使线程池中的其他线程是空闲的。
如果当前系统运行的线程数量大于或等于corePoolSize，且小于maximumPoolSize，只有当workQueue满的时候才创建新的线程去处理任务，
如果设置corePoolSize和maximumPoolSize相同的话，那么创建的线程池大小是固定的，这时如果有新任务提交，当workQueue没满时，把请求放进workQueue中，等待有空闲的线程从workQueue中取出任务去处理。
如果运行的线程数量大于maximumPoolSize，这时如果workQueue满，根据拒绝策略去处理。</p></blockquote></blockquote></blockquote> <h3 id="线程池-相关方法"><a href="#线程池-相关方法" class="header-anchor">#</a> 线程池-相关方法</h3> <blockquote><p>ThreadPoolExecutor</p> <blockquote><p>execute()：提交任务，交给线程池执行
submit()：提交任务，能够返回执行结果
shutdown()：关闭线程池，等待任务都执行完
shutdownNow()：关闭线程池，不等待任务执行完
getTaskCount()：线程池已执行和未执行的任务总数
getCompletedTaskCount()：已完成的任务数量
getPoolSize()：线程池当前的线程数量
getActiveCount()：当前线程池中正在执行任务的线程数量</p></blockquote></blockquote> <blockquote><p>Executor框架接口</p> <blockquote><p>Executors.newCachedThreadPool
Executors.newFixedThreadPool
Executors.newScheduledThreadPool
Executors.newSingleThreadExecutor</p></blockquote></blockquote> <p>代码示例</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;
class Scratch{
    public static void main(String[] args) {

        ExecutorService executorService = Executors.newFixedThreadPool(3);

        for (int i = 0; i &lt; 10; i++) {
            final int index = i;
            executorService.execute(new Runnable() {
                @Override
                public void run() {
                    System.out.println(&quot;task:&quot;+index);
                }
            });
        }
        executorService.shutdown();
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="线程池合理配置"><a href="#线程池合理配置" class="header-anchor">#</a> 线程池合理配置</h3> <blockquote><p>CPU密集型任务，就需要尽量压榨CPU，参考值可以设为NCPU+1
IO密集型任务，参考值可以设置为2*NCPU</p></blockquote> <h1 id="多线程并发扩展"><a href="#多线程并发扩展" class="header-anchor">#</a> 多线程并发扩展</h1> <h2 id="_1-死锁"><a href="#_1-死锁" class="header-anchor">#</a> 1.死锁</h2> <h2 id="_2-并发最佳实践"><a href="#_2-并发最佳实践" class="header-anchor">#</a> 2.并发最佳实践</h2> <h2 id="_3-spring与线程安全"><a href="#_3-spring与线程安全" class="header-anchor">#</a> 3.Spring与线程安全</h2> <h2 id="_4-hashmap与concurrenthashmap解析"><a href="#_4-hashmap与concurrenthashmap解析" class="header-anchor">#</a> 4.HashMap与ConcurrentHashMap解析</h2> <h2 id="_5-多线程并发与线程安全总结"><a href="#_5-多线程并发与线程安全总结" class="header-anchor">#</a> 5.多线程并发与线程安全总结</h2> <h3 id="死锁"><a href="#死锁" class="header-anchor">#</a> 死锁</h3> <blockquote><p>线程（进程）互相等待对方释放资源产生死锁</p></blockquote> <blockquote><p>死锁条件</p> <blockquote><p>互斥条件
请求和保持条件
不剥夺条件
环路等待条件</p></blockquote></blockquote> <h3 id="并发最佳实践"><a href="#并发最佳实践" class="header-anchor">#</a> 并发最佳实践</h3> <blockquote><p>使用本地变量
使用不可变类
最小化锁的作用锁范围 ：S=1/（1-a+a/n）
使用线程池的Executor，而不是直接new Thread执行
宁可使用同步也不要使用线程的wait和notify
使用BlockingQueue实现生产-消费模式
使用并发集合而不是加了锁的同步集合
使用Semaphore创建有界的访问
宁可使用同步代码块，也不使用同步的方法
避免使用静态变量</p></blockquote> <h3 id="spring与线程安全"><a href="#spring与线程安全" class="header-anchor">#</a> Spring与线程安全</h3> <blockquote><p>SpringBean：Singleton，Prototype
无状态变量</p></blockquote> <h3 id="hashmap与concurrenthashmap"><a href="#hashmap与concurrenthashmap" class="header-anchor">#</a> HashMap与ConcurrentHashMap</h3> <blockquote><p>HashMap与ConcurrentHashMap
HashMap在多线程环境中做rehash时容易产生死循环</p></blockquote> <blockquote><p>Guava Cache是谷歌开源的java工具库，借鉴ConcurrentHashMap的设计思想</p></blockquote> <h1 id="高并发之扩容思路"><a href="#高并发之扩容思路" class="header-anchor">#</a> 高并发之扩容思路</h1> <blockquote><p>挫直扩容（纵向扩展）：提供系统部件能力
水平扩容（横向扩展）：增加更多系统成员来实现</p></blockquote> <blockquote><p>扩容-数据库</p> <blockquote><p>读操作扩展：memcache，redis，CDN等缓存
写操作扩展：Cassandra，Hbase等</p></blockquote></blockquote> <h1 id="高并发之缓存思路"><a href="#高并发之缓存思路" class="header-anchor">#</a> 高并发之缓存思路</h1> <h2 id="_1-缓存-特征-场景及组件"><a href="#_1-缓存-特征-场景及组件" class="header-anchor">#</a> 1.缓存-特征，场景及组件</h2> <h2 id="_2-缓存-redis"><a href="#_2-缓存-redis" class="header-anchor">#</a> 2.缓存-Redis</h2> <h2 id="_3-高并发场景下缓存常见问题"><a href="#_3-高并发场景下缓存常见问题" class="header-anchor">#</a> 3.高并发场景下缓存常见问题</h2> <h3 id="缓存-特征-场景及组件"><a href="#缓存-特征-场景及组件" class="header-anchor">#</a> 缓存-特征，场景及组件</h3> <blockquote><p>图片中的1，2，3，4都可以缓存
<img src="https://img-blog.csdnimg.cn/20201102182326124.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2JhaW9mY2hhbw==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p></blockquote> <blockquote><p>命中率：命中数/（命中数+没有命中数）
最大元素（空间）
清空策略：FIFO，LFU，LRU，过期时间，随机等</p></blockquote> <blockquote><p>缓存命中率影响因素</p> <blockquote><p>业务场景和业务需求
缓存的设计（粒度和策略）
缓存容量和基础设施</p></blockquote></blockquote> <blockquote><p>缓存分类和应用场景</p> <blockquote><p>本地缓存：编码实现（成员变量，局部变量，静态变量），Guava Cache
分布式缓存：Memcache，Redis</p></blockquote></blockquote> <h3 id="高并发场景下缓存常见问题"><a href="#高并发场景下缓存常见问题" class="header-anchor">#</a> 高并发场景下缓存常见问题</h3> <blockquote><p>缓存一致性
缓存并发问题
缓存穿透问题
缓存的雪崩现象</p></blockquote> <blockquote><p>缓存一致性
<img src="https://img-blog.csdnimg.cn/2020110218330043.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2JhaW9mY2hhbw==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p></blockquote> <blockquote><p>缓存并发问题
<img src="https://img-blog.csdnimg.cn/20201102183330842.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2JhaW9mY2hhbw==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p></blockquote> <blockquote><p>缓存穿透问题
<img src="https://img-blog.csdnimg.cn/20201102183356510.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2JhaW9mY2hhbw==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p></blockquote> <blockquote><p>缓存雪崩现象
<img src="https://img-blog.csdnimg.cn/20201102183438540.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2JhaW9mY2hhbw==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p></blockquote> <h1 id="高并发之消息队列"><a href="#高并发之消息队列" class="header-anchor">#</a> 高并发之消息队列</h1> <h2 id="_1-消息队列特性"><a href="#_1-消息队列特性" class="header-anchor">#</a> 1.消息队列特性</h2> <h2 id="_2-为什么需要消息队列"><a href="#_2-为什么需要消息队列" class="header-anchor">#</a> 2.为什么需要消息队列</h2> <h2 id="_3-消息队列技术"><a href="#_3-消息队列技术" class="header-anchor">#</a> 3.消息队列技术</h2> <blockquote><p>消息队列特性</p> <blockquote><p>业务无关：只做消息分发
FIFO：先投递先到达
容灾：节点的动态增删和消息的持久化
性能：吞吐量提升，系统内部通信效率提高</p></blockquote></blockquote> <blockquote><p>为什么需要消息队列</p> <blockquote><p>生产和消费的速度或稳定性等因素不一致</p></blockquote></blockquote> <blockquote><p>消息队列好处</p> <blockquote><p>业务结偶
最终一致性
广播
错峰与流控</p></blockquote></blockquote> <blockquote><p>消息队列技术</p> <blockquote><p>kafka，RabbitMQ</p></blockquote></blockquote> <h1 id="高并发之应用拆分"><a href="#高并发之应用拆分" class="header-anchor">#</a> 高并发之应用拆分</h1> <h2 id="_1-拆分原则"><a href="#_1-拆分原则" class="header-anchor">#</a> 1.拆分原则</h2> <h2 id="_2-拆分思考"><a href="#_2-拆分思考" class="header-anchor">#</a> 2.拆分思考</h2> <h3 id="拆分原则"><a href="#拆分原则" class="header-anchor">#</a> 拆分原则</h3> <blockquote><p>业务优先
循序渐进
兼顾技术：重构，分层
可靠测试</p></blockquote> <h3 id="拆分思考"><a href="#拆分思考" class="header-anchor">#</a> 拆分思考</h3> <blockquote><p>应用之间通信：RPC（dubbo等），消息队列等
应用之间数据库设计：每个应用都有独立的数据库
避免事务操作跨应用</p></blockquote> <h1 id="高并发之应用限流"><a href="#高并发之应用限流" class="header-anchor">#</a> 高并发之应用限流</h1> <h2 id="_1-概念"><a href="#_1-概念" class="header-anchor">#</a> 1.概念</h2> <h2 id="_2-限流算法"><a href="#_2-限流算法" class="header-anchor">#</a> 2.限流算法</h2> <h3 id="概念"><a href="#概念" class="header-anchor">#</a> 概念</h3> <p><img src="https://img-blog.csdnimg.cn/20201102185130990.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2JhaW9mY2hhbw==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p> <h3 id="限流算法"><a href="#限流算法" class="header-anchor">#</a> 限流算法</h3> <blockquote><p>限流算法</p> <blockquote><p>计数算法
滑动窗口
漏桶算法
令牌桶算法</p></blockquote></blockquote> <blockquote><p>计数算法<img src="https://img-blog.csdnimg.cn/20201102185434583.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2JhaW9mY2hhbw==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述">
滑动窗口
<img src="https://img-blog.csdnimg.cn/20201102185508653.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2JhaW9mY2hhbw==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述">
漏桶算法
<img src="https://img-blog.csdnimg.cn/20201102185532854.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2JhaW9mY2hhbw==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述">
令牌桶算法
<img src="https://img-blog.csdnimg.cn/20201102185554385.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2JhaW9mY2hhbw==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p></blockquote> <h1 id="高并发之服务降级与服务熔断"><a href="#高并发之服务降级与服务熔断" class="header-anchor">#</a> 高并发之服务降级与服务熔断</h1> <blockquote><p>服务降级分类</p> <blockquote><p>自动降级：超时，失败次数，故障，限流
人工降级：秒杀，双11大促等</p></blockquote></blockquote> <blockquote><p>服务降级与服务熔断</p> <blockquote><p>共性：目的，最终表现，粒度，自治
区别：触发原因，管理目标层次，实现方式</p></blockquote></blockquote> <blockquote><p>服务降级要考虑的问题</p> <blockquote><p>核心服务，非核心服务
是否支持降级，降级策略
业务放通场景，策略</p></blockquote></blockquote> <blockquote><p>技术实现</p> <blockquote><p>Hystrix</p></blockquote></blockquote> <h1 id="高并发之数据库切库分库分表"><a href="#高并发之数据库切库分库分表" class="header-anchor">#</a> 高并发之数据库切库分库分表</h1> <blockquote><p>数据库瓶颈</p> <blockquote><p>单个库数据量太大（1T-2T）：多个库
单个数据库服务器压力过大，读写瓶颈：多个库
单个表数据量过大：分表</p></blockquote></blockquote> <blockquote><p>数据库切库，分库分表：切库、分表、多数据源</p></blockquote> <h1 id="高并发之高可用手段"><a href="#高并发之高可用手段" class="header-anchor">#</a> 高并发之高可用手段</h1> <blockquote><p>高可用的一些手段</p> <blockquote><p>任务调度分布式elastic-job + zookeeper
主备切换：Apache curator+zookeeper 分布式锁实现
监控报警机制</p></blockquote></blockquote></div></div>  <div class="page-edit"><!----> <!----> <!----></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/a71d41/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">构建XML方法（实体构建XML）</div></a> <a href="/pages/b27d2f/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">剑指-笔记</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/a71d41/" class="prev">构建XML方法（实体构建XML）</a></span> <span class="next"><a href="/pages/b27d2f/">剑指-笔记</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/80365f/"><div>
            证券市场基本法律法规
            <!----></div></a> <span class="date">03-13</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/d9e4f4/"><div>
            证券考试规则
            <!----></div></a> <span class="date">03-12</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/cb2c17/"><div>
            金融市场基础知识
            <!----></div></a> <span class="date">03-12</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:cloudjava@163.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/bigdatajava" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://gitee.com/nylg" title="Gitee" target="_blank" class="iconfont icon-gitee"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2014-2025
    <span>wen chao | <a href="https://github.com/bigdatajava/blog-talk/blob/main/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.af2629f3.js" defer></script><script src="/assets/js/2.c7acc05c.js" defer></script><script src="/assets/js/145.c5c5aca2.js" defer></script>
  </body>
</html>

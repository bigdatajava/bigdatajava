(window.webpackJsonp=window.webpackJsonp||[]).push([[272],{613:function(s,e,a){"use strict";a.r(e);var t=a(1),n=Object(t.a)({},(function(){var s=this,e=s._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("U2FsdGVkX18cxPG3XhC81G1Lgy4FH7yvi3bHvtCpGUQvVvWvWnxZ/C0hlanBW74z\nNJpH+WHRisGp9l1H2DJm3eYBenPZdyhI/QBmXMCPpjM8hyejtk2f5pVEuLBRq2ep\n4A==\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("Prometheus 算是一个全能型选手，原生支持容器监控，当然监控传统应用也不是吃干饭的，所以就是容器和非容器他都支持，所有的监控系统都具备这个流程，"),e("strong",[s._v("数据采集→数据处理→数据存储→数据展示→告警")]),s._v("，本文就是针对 Prometheus 展开的，所以先看看 Prometheus 概述")]),s._v(" "),e("p",[e("strong",[s._v("Prometheus 概述")]),s._v("展开目录")]),s._v(" "),e("p",[s._v("先来看一下 Prometheus 是个啥")]),s._v(" "),e("p",[e("strong",[s._v("Prometheus 是什么")])]),s._v(" "),e("p",[s._v("中文名普罗米修斯，最初在 SoundCloud 上构建的监控系统，自 2012 年成为社区开源项目，用户非常活跃的开发人员和用户社区，2016 年加入 CNCF，成为继 kubernetes 之后的第二个托管项目，"),e("a",{attrs:{href:"https://prometheus.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方网站"),e("OutboundLink")],1)]),s._v(" "),e("p",[e("strong",[s._v("Prometheus 特点")]),s._v("展开目录")]),s._v(" "),e("ul",[e("li",[s._v("多维数据模型：由度量名称和键值对标识的时间序列数据")]),s._v(" "),e("li",[s._v("PromSQL: — 种灵活的查询语言，可以利用多维数据完成复杂的查询")]),s._v(" "),e("li",[s._v("不依赖分布式存储，单个服务器节点可直接工作")]),s._v(" "),e("li",[s._v("基于 HTTP 的 pull 方式釆集时间序列数据")]),s._v(" "),e("li",[s._v("推送时间序列数据通过 PushGateway 组件支持")]),s._v(" "),e("li",[s._v("通过服务发现或静态配罝发现目标")]),s._v(" "),e("li",[s._v("多种图形模式及仪表盘支持 (grafana)")])]),s._v(" "),e("p",[e("strong",[s._v("Prometheus 组成与架构")]),s._v("展开目录")]),s._v(" "),e("p",[s._v("来看一张图，官方扒到的")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://gitee.com/nylg/picture/raw/master/springboot/image-20220624142202981.png",alt:"image-20220624142202981"}})]),s._v(" "),e("table",[e("thead",[e("tr",[e("th",[e("strong",[s._v("名称")])]),s._v(" "),e("th",[e("strong",[s._v("说明")])])])]),s._v(" "),e("tbody",[e("tr",[e("td",[s._v("Prometheus Server")]),s._v(" "),e("td",[s._v("收集指标和存储时间序列数据，并提供查询接口")])]),s._v(" "),e("tr",[e("td",[s._v("Push Gateway")]),s._v(" "),e("td",[s._v("短期存储指标数据，主要用于临时性任务")])]),s._v(" "),e("tr",[e("td",[s._v("Exporters")]),s._v(" "),e("td",[s._v("采集已有的三方服务监控指标并暴露 metrics")])]),s._v(" "),e("tr",[e("td",[s._v("Alertmanager")]),s._v(" "),e("td",[s._v("告警")])]),s._v(" "),e("tr",[e("td",[s._v("Web UI")]),s._v(" "),e("td",[s._v("简单的 WEB 控制台")])])])]),s._v(" "),e("p",[s._v("集成了数据的采集，处理，存储，展示，告警一系列流程都已经具备了")]),s._v(" "),e("p",[e("strong",[s._v("数据模型")]),s._v("展开目录")]),s._v(" "),e("p",[s._v("Prometheus 将所有数据存储为时间序列，具有相同度量名称以及标签属于同个指标，也就是说 Prometheus 从数据源拿到数据之后都会存到内置的 TSDB 中，这里存储的就是时间序列数据，它存储的数据会有一个度量名称，譬如你现在监控一个 nginx，首先你要给他起个名字，这个名称也就是度量名，还会有 N 个标签，你可以理解名称为表名，标签为字段，所以，每个时间序列都由度量标准名称和一组键值对 (也称为标签) 唯一标识。")]),s._v(" "),e("p",[s._v("时间序列的格式是这样的，")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("<metricename> {<labelname>=<labelvalue>,...}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("metrice name 指的就是度量标准名称，label name 也就是标签名，这个标签可以有多个，例子")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('jvm_memory_max_bytes{area="heap",id="Eden Space",}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("这个度量名称为 jvm_memory_max_bytes，后面是两个标签，和他们各对应的值，当然你还可以继续指定标签，你指定的标签越多查询的维度就越多。")]),s._v(" "),e("p",[e("strong",[s._v("指标类型")]),s._v("展开目录")]),s._v(" "),e("p",[s._v("看表格吧")]),s._v(" "),e("table",[e("thead",[e("tr",[e("th",[e("strong",[s._v("类型名称")])]),s._v(" "),e("th",[e("strong",[s._v("说明")])])])]),s._v(" "),e("tbody",[e("tr",[e("td",[s._v("Counter")]),s._v(" "),e("td",[s._v("递增计数器，适合收集接口请求次数")])]),s._v(" "),e("tr",[e("td",[s._v("Guage")]),s._v(" "),e("td",[s._v("可以任意变化的数值，适用 CPU 使用率")])]),s._v(" "),e("tr",[e("td",[s._v("Histogram")]),s._v(" "),e("td",[s._v("对一段时间内数据进行采集，并对有所数值求和于统计数量")])]),s._v(" "),e("tr",[e("td",[s._v("Summary")]),s._v(" "),e("td",[s._v("与 Histogram 类型类似")])])])]),s._v(" "),e("p",[e("strong",[s._v("任务和实例")]),s._v("展开目录")]),s._v(" "),e("p",[s._v("实例指的就是你可以抓取的目标target，这个会在 Prometheus 配置文件中体现，任务是具有相同目标的实例集合，你可以理解为是一个组(比如，订单服务多台实例机器，可以放入一个任务里，分多个实例target抓取)，一会写配置文件的时候会详细解析，下面开始安装 Prometheus。")]),s._v(" "),e("p",[e("strong",[s._v("Prometheus 部署")])]),s._v(" "),e("p",[s._v("我们借助docker来安装，新建目录docker-monitor，在里面创建文件docker-compose.yml，内容如下：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("version: \"3\"\nservices:\n  prometheus:\n    image: prom/prometheus:v2.4.3\n    container_name: 'prometheus'\n    volumes:\n    - ./prometheus/:/etc/prometheus/    #映射prometheus的配置文件\n    - /etc/localtime:/etc/localtime:ro  #同步容器与宿主机的时间，这个非常重要，如果时间不一致，会导致prometheus抓不到数据\n    ports:\n    - '9090:9090'\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br")])]),e("p",[e("strong",[s._v("监控web应用性能指标")])]),s._v(" "),e("p",[s._v("在docker-monitor目录下新增prometheus目录，在里面创建prometheus配置文件prometheus.yml，内容如下：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("global:  #全局配置\n  scrape_interval:   15s  #全局定时任务抓取性能数据间隔\n\nscrape_configs:  #抓取性能数据任务配置\n- job_name:       'tulingmall-order'  #抓取订单服务性能指标数据任务，一个job下可以配置多个抓紧的targets，比如订单服务多个实例机器\n  scrape_interval: 10s  #每10s抓取一次\n  metrics_path: '/actuator/prometheus'  #抓取的数据url\n  static_configs:\n  - targets: ['192.168.31.60:8844']  #抓取的服务器地址\n    labels:\n      application: 'tulingmall-order-label'  #抓取任务标签\n\n- job_name: 'prometheus'  #抓取prometheus自身性能指标数据任务\n  scrape_interval: 5s\n  static_configs:\n  - targets: ['localhost:9090']\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br")])]),e("p",[s._v("在docker-monitor目录下执行如下命令启动prometheus")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker-compose up -d\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("在浏览器访问prometheus："),e("a",{attrs:{href:"http://192.168.31.60:9090/",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://192.168.31.60:9090"),e("OutboundLink")],1),s._v("，如下图所示：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://gitee.com/nylg/picture/raw/master/springboot/image-20220624142218664.png",alt:"image-20220624142218664"}})]),s._v(" "),e("p",[s._v("点击Status下拉，选中Targets，界面如下：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://gitee.com/nylg/picture/raw/master/springboot/image-20220624142231540.png",alt:"image-20220624142231540"}})]),s._v(" "),e("p",[s._v("这里显示了在prometheus里配置的两个抓取任务，不过tulingmall-order任务是失败的，state是down，接下来我们需要配置下tulingmall-order服务才能让prometheus抓取数据。")]),s._v(" "),e("p",[s._v("首先需要在tulingmall-order服务下增加pom依赖，如下：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("\x3c!-- 开启springboot的应用监控 --\x3e\n<dependency>\n   <groupId>org.springframework.boot</groupId>\n   <artifactId>spring-boot-starter-actuator</artifactId>\n</dependency>\n\x3c!-- 增加prometheus整合 --\x3e\n<dependency>\n   <groupId>io.micrometer</groupId>\n   <artifactId>micrometer-registry-prometheus</artifactId>\n</dependency>\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br")])]),e("p",[s._v("还需要在tulingmall-order服务的配置文件里增加开启springboot admin监控的配置，如下：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("management: #开启SpringBoot Admin的监控\n  endpoints:\n    promethus:\n      enable: true\n    web:\n      exposure:\n        include: '*'\n  endpoint:\n    health:\n      show-details: always\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br")])]),e("p",[s._v("​")]),s._v(" "),e("p",[s._v("重启tulingmall-order服务，刷新prometheus页面，如下所示：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://gitee.com/nylg/picture/raw/master/springboot/image-20220624142242251.png",alt:"image-20220624142242251"}})]),s._v(" "),e("p",[s._v("点击tulingmall-order下面的prometheus链接：http://192.168.31.60:8844/actuator/prometheus，会打开order服务对外暴露的性能指标数据，如下图：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://gitee.com/nylg/picture/raw/master/springboot/image-20220624142328171.png",alt:"image-20220624142328171"}})]),s._v(" "),e("p",[s._v("展开目录")]),s._v(" "),e("p",[s._v('拿其中一个指标举例：jvm_threads_states_threads{state="runnable",} 13.0，这代表jvm_threads_states_threads这个度量指标，其中state等于runnable的数据有13条')]),s._v(" "),e("p",[s._v("我们点prometheus页面的Graph链接，进入指标查询页面可以查询相关指标，如下：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://gitee.com/nylg/picture/raw/master/springboot/image-20220624142338074.png",alt:"image-20220624142338074"}})]),s._v(" "),e("p",[s._v("将度量指标输入查询框，点击Execute按钮，如下：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://gitee.com/nylg/picture/raw/master/springboot/image-20220624142347833.png",alt:"image-20220624142347833"}})]),s._v(" "),e("p",[s._v("点击Execute按钮下的Graph链接可以查看指标对应的图标，如下：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://gitee.com/nylg/picture/raw/master/springboot/image-20220624142418510.png",alt:"image-20220624142418510"}})]),s._v(" "),e("p",[s._v("以上是prometheus自带的指标查询界面，但是太简陋，一般我们都是使用grafana图形展示工具配合prometheus一起使用")]),s._v(" "),e("p",[e("strong",[s._v("Grafana 部署")])]),s._v(" "),e("p",[s._v("先用docker来安装下grafana，在上面的docker-compose.yml文件里加入grafana的安装配置，如下所示：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("version: \"3\"\nservices:\n  prometheus:\n    image: prom/prometheus:v2.4.3\n    container_name: 'prometheus'\n    volumes:\n    - ./prometheus/:/etc/prometheus/    #映射prometheus的配置文件\n    - /etc/localtime:/etc/localtime:ro  #同步容器与宿主机的时间，这个非常重要，如果时间不一致，会导致prometheus抓不到数据\n    ports:\n    - '9090:9090'\n  grafana:  \n    image: grafana/grafana:5.2.4\n    container_name: 'grafana'\n    ports:  \n    - '3000:3000'\n    volumes: \n    - ./grafana/config/grafana.ini:/etc/grafana/grafana.ini  #grafana报警邮件配置\n    - ./grafana/provisioning/:/etc/grafana/provisioning/  #配置grafana的prometheus数据源\n    - /etc/localtime:/etc/localtime:ro\n    env_file:\n    - ./grafana/config.monitoring  #grafana登录配置\n    depends_on:\n    - prometheus  #grafana需要在prometheus之后启动\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br")])]),e("p",[s._v("在docker-monitor目录下新增grafana目录，在里面创建文件config.monitoring，内容如下：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("GF_SECURITY_ADMIN_PASSWORD=password  #grafana管理界面的登录用户密码，用户名是admin\nGF_USERS_ALLOW_SIGN_UP=false  #grafana管理界面是否允许注册，默认不允许\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("​")]),s._v(" "),e("p",[s._v("在grafana目录下创建目录provisioning，在里面创建datasources目录，在datasources目录里新建文件datasource.yml，内容如下：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# config file version\napiVersion: 1\n\ndeleteDatasources:  #如果之前存在name为Prometheus，orgId为1的数据源先删除\n- name: Prometheus\n  orgId: 1\n\ndatasources:  #配置Prometheus的数据源\n- name: Prometheus\n  type: prometheus\n  access: proxy\n  orgId: 1\n  url: http://prometheus:9090  #在相同的docker compose下，可以直接用prometheus服务名直接访问\n  basicAuth: false\n  isDefault: true\n  version: 1\n  editable: true\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br")])]),e("p",[s._v("​")]),s._v(" "),e("p",[s._v("在grafana目录下创建目录config，在里面创建文件grafana.ini，内容如下：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("#################################### SMTP / Emailing ##########################\n# 配置邮件服务器\n[smtp]\nenabled = true\n# 发件服务器\nhost = smtp.qq.com:465\n# smtp账号\nuser = 3376224996@qq.com\n# smtp 授权码，授权码获取请参看课上视频演示\npassword = test123\n# 发信邮箱\nfrom_address = 3376224996@qq.com\n# 发信人\nfrom_name = zhuge\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br")])]),e("p",[s._v("用docker compose启动grafana，访问grafana页面："),e("a",{attrs:{href:"http://192.168.31.60:3000/",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://192.168.31.60:3000"),e("OutboundLink")],1),s._v("，用户名为admin，密码为password，如下：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://gitee.com/nylg/picture/raw/master/springboot/image-20220624142427875.png",alt:"image-20220624142427875"}})]),s._v(" "),e("p",[s._v("登录进去首页如下：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://gitee.com/nylg/picture/raw/master/springboot/image-20220624142436838.png",alt:"image-20220624142436838"}})]),s._v(" "),e("p",[s._v("点击左边的加号并import一个我们事先准备好的可视化指标文件web-dashboard.json(文件在本节课的课程资料里，都是些运维的指标，网上可以找现成的)")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://gitee.com/nylg/picture/raw/master/springboot/image-20220624142445507.png",alt:"image-20220624142445507"}})]),s._v(" "),e("p",[s._v("导入web-dashboard.json后在页面上选择Prometheus，点击import按钮之后页面显示如下(有可能没有任何数据)：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://gitee.com/nylg/picture/raw/master/springboot/image-20220624142455313.png",alt:"image-20220624142455313"}})]),s._v(" "),e("p",[s._v("​")]),s._v(" "),e("p",[e("strong",[s._v("写一个监控指标报警示例，比如系统报错5XX达到一定程度就报警发邮件通知：")])]),s._v(" "),e("p",[s._v("点击Errors面板选择Edit，进入到Errors指标的详细面板，如下：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://gitee.com/nylg/picture/raw/master/springboot/image-20220624142502872.png",alt:"image-20220624142502872"}})]),s._v(" "),e("p",[s._v("​")]),s._v(" "),e("p",[s._v("点击下图所示新增报警渠道：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://gitee.com/nylg/picture/raw/master/springboot/image-20220624142513534.png",alt:"image-20220624142513534"}})]),s._v(" "),e("p",[s._v("​")]),s._v(" "),e("p",[s._v("然后选择邮件报警，也可以选择webhook方式配置一个报警通知的http调用接口，这个可以间接实现所有的通知方式，如下：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://gitee.com/nylg/picture/raw/master/springboot/image-20220624142521406.png",alt:"image-20220624142521406"}})]),s._v(" "),e("p",[s._v("最后点击save按钮保存")]),s._v(" "),e("p",[s._v("进入Errors详细页面，配置alert报警，有如下几个地方需要配置，如图所示：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://gitee.com/nylg/picture/raw/master/springboot/image-20220624142529786.png",alt:"image-20220624142529786"}})]),s._v(" "),e("p",[s._v("​    "),e("img",{attrs:{src:"https://gitee.com/nylg/picture/raw/master/springboot/image-20220624142538030.png",alt:"image-20220624142538030"}})]),s._v(" "),e("p",[s._v("​    "),e("img",{attrs:{src:"https://gitee.com/nylg/picture/raw/master/springboot/image-20220624142547217.png",alt:"image-20220624142547217"}})]),s._v(" "),e("p",[s._v("​")]),s._v(" "),e("p",[s._v("报警邮件如下所示：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://gitee.com/nylg/picture/raw/master/springboot/image-20220624142555004.png",alt:"image-20220624142555004"}})]),s._v(" "),e("p",[s._v("​")]),s._v(" "),e("p",[e("strong",[s._v("监控Mysql性能指标")])]),s._v(" "),e("p",[s._v("1、下载mysql客户端的exporter镜像")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker pull prom/mysqld-exporter\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("2、启动监控的数据库连接，容器创建的时候需要指定")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('docker run -d -p 9104:9104 -e DATA_SOURCE_NAME="root:password@(mysql服务器ip:3306)/databaseName" prom/mysqld-exporter\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("3、在prometheus.yml文件末尾追加如下配置：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("- job_name: 'mysql'\n  scrape_interval: 5s\n  static_configs:\n  - targets: ['192.168.50.60:9104']\n    labels:\n      instance: mysql\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("p",[s._v("4、重新启动Prometheus镜像，查看Prometheus是否启动完成，访问：http://服务器ip:9090")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker-compose up --force-recreate -d\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("5、导入Prometheus模板，添加mysql-dashboard.json格式模板(文件在本节课的课程资料里)，更多模板下载地址：")]),s._v(" "),e("p",[s._v("https://grafana.com/grafana/dashboards")]),s._v(" "),e("p",[s._v("https://github.com/percona/grafana-dashboards.git")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://gitee.com/nylg/picture/raw/master/springboot/image-20220624142602898.png",alt:"image-20220624142602898"}})]),s._v(" "),e("p",[s._v("​")]),s._v(" "),e("p",[e("strong",[s._v("监控Redis性能指标")])]),s._v(" "),e("p",[s._v("1、下载redis客户端的exporter镜像")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker pull oliver006/redis_exporter\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("2、启动监控的数据库连接，容器创建的时候需要指定")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker run -d -p 9121:9121 oliver006/redis_exporter --redis.addr redis://redis连接IP:6379\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("3、在prometheus.yml文件末尾追加如下配置：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("- job_name: 'redis'\n  scrape_interval: 5s\n  static_configs:\n  - targets: ['192.168.50.60:9121']\n    labels:\n      instance: redis\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("p",[s._v("​")]),s._v(" "),e("p",[s._v("4、重新启动Prometheus镜像，查看Prometheus是否启动完成，访问：http://服务器ip:9090")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker-compose up --force-recreate -d\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("5、导入Prometheus模板，添加redis-dashboard.json格式模板(文件在本节课的课程资料里)")]),s._v(" "),e("p",[e("strong",[s._v("监控Linux服务器性能指标")])]),s._v(" "),e("p",[s._v("1、下载linux监控的exporter镜像")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker pull prom/node-exporter\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("2、启动监控的数据库连接，容器创建的时候需要指定")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker run -d -p 9100:9100 prom/node-exporter\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("3、在prometheus.yml文件末尾追加如下配置：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("- job_name: linux\n  scrape_interval: 10s\n  static_configs:\n    - targets: ['IP地址1:9100']\n      labels:\n      instance: linux-1\n    - targets: ['IP地址2:9100']\n      labels:\n        instance: linux-2\n\n- job_name: linux\n  scrape_interval: 10s\n  static_configs:\n    - targets: ['192.168.65.160:9100']\n      labels:\n        instance: linux-160\n    - targets: ['192.168.65.203:9100']\n      labels:\n        instance: linux-203\n    - targets: ['192.168.65.210:9100']\n      labels:\n        instance: linux-210\n    - targets: ['192.168.65.42:9100']\n      labels:\n        instance: linux-42\n         \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br")])]),e("p",[s._v("​")]),s._v(" "),e("p",[s._v("4、重新启动Prometheus镜像，查看Prometheus是否启动完成，访问：http://服务器ip:9090")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker-compose up --force-recreate -d\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("5、导入Prometheus模板，添加node-exporter-for-prometheus-dashboard-cn-v20201010_rev24.json格式模板(文件在本节课的课程资料里)")])])}),[],!1,null,null,null);e.default=n.exports}}]);
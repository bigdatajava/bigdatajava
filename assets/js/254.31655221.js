(window.webpackJsonp=window.webpackJsonp||[]).push([[254],{598:function(s,n,e){"use strict";e.r(n);var a=e(1),t=Object(a.a)({},(function(){var s=this,n=s._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("U2FsdGVkX1+LjWR4oYsXYmJlRuDH0G8mx2NyXUgHmrASbyrp+kr89XRWB8/KGGvX\n3PtovU1epxa8dZMfSwe7uze+5RT2IRgM/PvHQMxWK4OCgZ7qyllMaqIqYnZy5608\nqw==\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("1、IK分词器源码下载：https://github.com/medcl/elasticsearch-analysis-ik")]),s._v(" "),n("p",[s._v("本案例以ES7.6.1和MySql数据库5.7为例进行配置；")]),s._v(" "),n("p",[n("strong",[s._v("修改源码步骤")])]),s._v(" "),n("p",[n("strong",[s._v("1、修改maven依赖es版本号")])]),s._v(" "),n("p",[s._v("使用工具打开IK源码后，打开pom.xml文件，修改elasticsearch版本号为7.8.0")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("<elasticsearch.version>7.8.0</elasticsearch.version>\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("​")]),s._v(" "),n("p",[n("strong",[s._v("2、引入MySql驱动到项目中")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("<dependency>\n    <groupId>mysql</groupId>\n    <artifactId>mysql-connector-java</artifactId>\n    <version>5.1.38</version>\n</dependency>\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("​")]),s._v(" "),n("p",[n("strong",[s._v("3、开始修改源码")])]),s._v(" "),n("p",[s._v("在项目中找到Dictionary类，找到Dictionary单例类的初始化方法"),n("strong",[s._v("initial方法")]),s._v("，在初始化方法中我们起一个线程，用来执行远程词库的热更新，再修改之前，我们在Dictionary类同目录下新建一个类HotDictReloadThread，代码如下：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('public class HotDictReloadThread {\n    private static final Logger log = ESPluginLoggerFactory.getLogger(HotDictReloadThread.class.getName());\n    public void initial(){\n        while (true) {\n            log.info("正在调用HotDictReloadThread...");\n            Dictionary.getSingleton().reLoadMainDict();\n        }\n    }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[s._v("​")]),s._v(" "),n("p",[s._v("上述代码的含义为: 获取词典单子实例，并执行它的"),n("strong",[s._v("reLoadMainDict方法")]),s._v(";")]),s._v(" "),n("p",[s._v("完成上述操作后，我们就来开始修改"),n("strong",[s._v("initial方法")]),s._v("，改动如下图，创建上面新建的类并调用它的initial方法，从而执行Dictionary类的"),n("strong",[s._v("reLoadMainDict方法")]),s._v("；改动代码如下，在字典实例初始化完成后新起一个线程来执行字典的热更新操作；")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("pool.execute(() -> new HotDictReloadThread().initial());\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("​")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://gitee.com/nylg/picture/raw/master/springboot/image-20220623180819014.png",alt:"image-20220623180819014"}})]),s._v(" "),n("p",[s._v("跟着程序一步步走下去，找到Dictionary类的reLoadMainDict方法，可以看到在方面里面，有2个方法"),n("strong",[s._v("tmpDict.loadMainDict()和tmpDict.loadStopWordDict()")]),s._v("，分别维护的是扩展词库和停用词库，一块先看一下对扩展词库的维护；")]),s._v(" "),n("p",[s._v("在方法tmpDict.loadMainDict()中，我们在最后一行加载远程自定义词库后面新增一个方法"),n("strong",[s._v("this.loadMySQLExtDict()")]),s._v("，用于加载MySql词库，在加载MySql词库之前，我们需先准备一下MySql相关的配置以及sql语句；在数据库中新建一张表，用户维护扩展词和停用词，表结构如下")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("CREATE TABLE `es_lexicon`  (\n  `lexicon_id` bigint(8) NOT NULL AUTO_INCREMENT COMMENT '词库id',\n  `lexicon_text` varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL COMMENT '词条关键词',\n  `lexicon_type` int(1) NOT NULL DEFAULT 0 COMMENT '0扩展词库 1停用词库',\n  `lexicon_status` int(1) NOT NULL DEFAULT 0 COMMENT '词条状态 0正常 1暂停使用',\n  `del_flag` int(1) NOT NULL DEFAULT 0 COMMENT '作废标志 0正常 1作废',\n  `create_time` datetime(0) NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',\n  PRIMARY KEY (`lexicon_id`) USING BTREE\n) ENGINE = InnoDB AUTO_INCREMENT = 1 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_general_ci COMMENT = 'ES远程扩展词库表' ROW_FORMAT = Dynamic;\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[s._v("​")]),s._v(" "),n("p",[s._v("然后我们在项目的根路径的config目录下新建配置文件jdbc-reload.properties，内容如下")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# 数据库地址\njdbc.url=jdbc:mysql://127.0.0.1:3306/test?serverTimezone=GMT&autoReconnect=true&useUnicode=true&characterEncoding=utf8&zeroDateTimeBehavior=convertToNull&useAffectedRows=true&useSSL=false\n# 数据库用户名\njdbc.user=root\n# 数据库密码\njdbc.password=123456\n# 数据库查询扩展词库sql语句\njdbc.reload.sql=select gel.lexicon_text as word from es_lexicon gel where gel.lexicon_type = 0 and gel.lexicon_status = 0 and gel.del_flag = 0 order by gel.lexicon_id desc \n# 数据库查询停用词sql语句\njdbc.reload.stopword.sql=select gel.lexicon_text as word from ges_lexicon gel where gel.lexicon_type = 1 and gel.lexicon_status = 0 and gel.del_flag = 0 order by gel.lexicon_id desc \n# 数据库查询间隔时间 每隔10秒请求一次\njdbc.reload.interval=10\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("p",[s._v("完成了这些基础配置之后，我们再一同看看关于同步MySql词库的方法loadMySQLExtDict()；代码较长，粘贴如下")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('   /**\n* 从MySql中加载动态词库\n*/\nprivate void loadMySQLExtDict() {\n  Connection conn = null;\n  Statement stmt = null;\n  ResultSet rs = null;\n  try {\n     Path file = PathUtils.get(getDictRoot(), "jdbc-reload.properties");\n     props.load(new FileInputStream(file.toFile()));\n\n     logger.info("[==========]jdbc-reload.properties");\n     for(Object key : props.keySet()) {\n        logger.info("[==========]" + key + "=" + props.getProperty(String.valueOf(key)));\n     }\n\n     logger.info("[==========]query hot dict from mysql, " + props.getProperty("jdbc.reload.sql") + "......");\n//       Class.forName(props.getProperty("jdbc.className"));\n     conn = DriverManager.getConnection(\n           props.getProperty("jdbc.url"),\n           props.getProperty("jdbc.user"),\n           props.getProperty("jdbc.password"));\n     stmt = conn.createStatement();\n     rs = stmt.executeQuery(props.getProperty("jdbc.reload.sql"));\n\n     while(rs.next()) {\n        String theWord = rs.getString("word");\n        logger.info("[==========]正在加载Mysql自定义IK扩展词库词条: " + theWord);\n        _MainDict.fillSegment(theWord.trim().toCharArray());\n     }\n\n     Thread.sleep(Integer.valueOf(String.valueOf(props.get("jdbc.reload.interval"))) * 1000);\n  } catch (Exception e) {\n     logger.error("erorr", e);\n  } finally {\n     if(rs != null) {\n        try {\n           rs.close();\n        } catch (SQLException e) {\n           logger.error("error", e);\n        }\n     }\n     if(stmt != null) {\n        try {\n           stmt.close();\n        } catch (SQLException e) {\n           logger.error("error", e);\n        }\n     }\n     if(conn != null) {\n        try {\n           conn.close();\n        } catch (SQLException e) {\n           logger.error("error", e);\n        }\n     }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br")])]),n("p",[s._v("​")]),s._v(" "),n("p",[s._v("在上述代码中，通过加载配置文件，获取数据库连接，执行扩展词sql，将结果集添加到扩展词库中；")]),s._v(" "),n("p",[s._v("同理，同步MySql停用词的逻辑也是一样的，这里我直接把代码粘贴过来；停用词方法调用顺序为tmpDict.loadStopWordDict()，在方法后面，新增一个方法调用this.loadMySQLStopwordDict()，新方法中处理通用词逻辑，代码如下")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('/**\n* 从MySql中加载远程停用词库\n*/\nprivate void loadMySQLStopwordDict() {\n  Connection conn = null;\n  Statement stmt = null;\n  ResultSet rs = null;\n\n  try {\n     Path file = PathUtils.get(getDictRoot(), "jdbc-reload.properties");\n     props.load(new FileInputStream(file.toFile()));\n\n     logger.info("[==========]jdbc-reload.properties");\n     for(Object key : props.keySet()) {\n        logger.info("[==========]" + key + "=" + props.getProperty(String.valueOf(key)));\n     }\n     logger.info("[==========]query hot stopword dict from mysql, " + props.getProperty("jdbc.reload.stopword.sql") + "......");\n//       Class.forName(props.getProperty("jdbc.className"));\n     conn = DriverManager.getConnection(\n           props.getProperty("jdbc.url"),\n           props.getProperty("jdbc.user"),\n           props.getProperty("jdbc.password"));\n     stmt = conn.createStatement();\n     rs = stmt.executeQuery(props.getProperty("jdbc.reload.stopword.sql"));\n\n     while(rs.next()) {\n        String theWord = rs.getString("word");\n        logger.info("[==========]正在加载Mysql自定义IK停用词库词条: " + theWord);\n        _StopWords.fillSegment(theWord.trim().toCharArray());\n     }\n     Thread.sleep(Integer.valueOf(String.valueOf(props.get("jdbc.reload.interval"))) * 1000);\n  } catch (Exception e) {\n     logger.error("erorr", e);\n  } finally {\n     if(rs != null) {\n        try {\n           rs.close();\n        } catch (SQLException e) {\n           logger.error("error", e);\n        }\n     }\n     if(stmt != null) {\n        try {\n           stmt.close();\n        } catch (SQLException e) {\n           logger.error("error", e);\n        }\n     }\n     if(conn != null) {\n        try {\n           conn.close();\n        } catch (SQLException e) {\n           logger.error("error", e);\n        }\n     }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br")])]),n("p",[s._v("完成这些，整体代码改造完毕；在上述代码中，有很多的地方是可以进一步优化的，比如扩展词和停用词的大量重复代码，以及读取本地配置文件项可以做到只读取一次等，这个大家可以自行优化；")]),s._v(" "),n("p",[s._v("完成了这些之后，我们就可以开始打包插件了；直接使用maven package命令进行打包，在target/releases/elasticsearch-analysis-ik-7.6.1.zip文件；")]),s._v(" "),n("p",[n("strong",[s._v("安装插件")])]),s._v(" "),n("p",[s._v("完成上述步骤后，拿到elasticsearch-analysis-ik-7.8.0.zip插件，我们将其放在ES安装目录下的plugins目录下，新建一个ik文件夹，将其解压到ik文件夹下；目录结构大概如下")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://gitee.com/nylg/picture/raw/master/springboot/image-20220623180904455.png",alt:"image-20220623180904455"}})]),s._v(" "),n("p",[s._v("完成上述步骤后，我们就可以启动ES了，在启动过程中，可以看到关于IK热更新MySql词库相关的日志输出；在实际过程中，可能会报很多的异常，下面是我所遇到的一些问题以及解决方案；")]),s._v(" "),n("p",[n("strong",[s._v("常见问题")])]),s._v(" "),n("p",[n("strong",[s._v("1、异常1")]),s._v("：java.sql.SQLException: Column 'word' not found.")]),s._v(" "),n("p",[s._v("此异常是因为编写sql时，查询的数据库字段需要起别名为 word，修改一下sql即可解决这个问题；")]),s._v(" "),n("p",[n("strong",[s._v("2、异常2")]),s._v("：Could not create connection to database server")]),s._v(" "),n("p",[s._v('此异常通常是因为引用的mysql驱动和mysql版本号不一致导致的，只需要替换成对应的版本号即可解决，另外，数据库连接我们不需要再额外的去配置显示加载，即不需要写 Class.forName(props.getProperty("jdbc.className"));')]),s._v(" "),n("p",[n("strong",[s._v("3、异常3")]),s._v("：no suitable driver found for jdbc:mysql://...")]),s._v(" "),n("p",[s._v("此异常我们需要在环境的JDK安装目录的jre\\lib\\ext目录下添加mysql驱动mysql-connector-java.jar；比如我本地的是C:\\Java\\jdk_8u_231\\jre\\lib\\ext 目录，服务器上是/usr/local/jdk/jdk1.8.0_181/jre/lib/ext")]),s._v(" "),n("p",[n("strong",[s._v("4、异常4")]),s._v('：AccessControlException: access denied ("java.net.SocketPermission" "127.0.0.1:3306" "connect,resolve")')]),s._v(" "),n("p",[s._v("这个异常，我们修改jdk安装路径下的C:\\Java\\jdk_8u_231\\jre\\lib\\security目录下的文件"),n("strong",[s._v("java.policy")]),s._v("，在下面新增一行即可解决")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('permission java.net.SocketPermission "*", "connect,resolve";\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[n("img",{attrs:{src:"https://gitee.com/nylg/picture/raw/master/springboot/image-20220623180921648.png",alt:"image-20220623180921648"}})])])}),[],!1,null,null,null);n.default=t.exports}}]);
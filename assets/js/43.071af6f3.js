(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{411:function(s,e,a){"use strict";a.r(e);var n=a(5),t=Object(n.a)({},(function(){var s=this,e=s._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"新特性1-多线程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#新特性1-多线程"}},[s._v("#")]),s._v(" 新特性1：多线程")]),s._v(" "),e("p",[s._v("redis 6.0 提供了多线程的支持，redis 6 以前的版本，严格来说也是多线程，只不过执行用户命令的请求时单线程模型，还有一些线程用来执行后台任务， 比如 unlink 删除 大key，rdb持久化等。")]),s._v(" "),e("p",[s._v("redis 6.0 提供了多线程的读写IO, 但是最终执行用户命令的线程依然是单线程的，这样，就没有多线程数据的竞争关系，依然很高效。")]),s._v(" "),e("p",[s._v("redis 6.0 以前线程执行模式，如下操作在一个线程中执行完成")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/redis/50.png",alt:""}})]),s._v(" "),e("p",[s._v("redis 6.0 线程执行模式：")]),s._v(" "),e("p",[s._v("可以通过如下参数配置多线程模型：")]),s._v(" "),e("p",[s._v("如：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("io-threads 4  // 这里说 有三个IO 线程，还有一个线程是main线程，main线程负责IO读写和命令执行操作\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("默认情况下，如上配置，有三个IO线程， 这三个IO线程只会执行 IO中的write 操作，也就是说，read 和 命令执行 都由main线程执行。最后多线程将数据写回到客户端。")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/redis/51.jpg",alt:""}})]),s._v(" "),e("p",[s._v("开启了如下参数：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("io-threads-do-reads yes // 将支持IO线程执行 读写任务。\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[e("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/redis/52.jpg",alt:""}})]),s._v(" "),e("h2",{attrs:{id:"新特性2-client-side-cache"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#新特性2-client-side-cache"}},[s._v("#")]),s._v(" 新特性2：Client Side Cache")]),s._v(" "),e("p",[s._v("客户端缓存：redis 6 提供了服务端追踪key的变化，客户端缓存数据的特性，这需要客户端实现")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/redis/53.png",alt:""}})]),s._v(" "),e("p",[s._v("执行流程为， 当客户端访问某个key时，服务端将记录key 和 client ，客户端拿到数据后，进行客户端缓存，这时，当key再次被访问时，key将被直接返回，避免了与redis 服务器的再次交互，节省服务端资源，当数据被其他请求修改时，服务端将主动通知客户端失效的key，客户端进行本地失效，下次请求时，重新获取最新数据。")]),s._v(" "),e("p",[s._v("目前只有lettuce对其进行了支持：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("<dependency>\n   <groupId>io.lettuce</groupId>\n   <artifactId>lettuce-core</artifactId>\n   <version>6.0.0.RELEASE</version>\n</dependency>\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('public static void main(String[] args) throws InterruptedException {\n    RedisClient redisClient = RedisClient.create("redis://192.168.109.200");\n\n    Map<String, String> clientCache = new ConcurrentHashMap<>();\n\n    StatefulRedisConnection<String, String> myself = redisClient.connect();\n\n    CacheFrontend<String, String> frontend =\n            ClientSideCaching.enable(CacheAccessor.forMap(clientCache),\n            myself,\n            TrackingArgs.Builder.enabled().noloop());\n\n    String key="csk";\n    int count = 0;\n    while (true){\n\n        System.out.println(frontend.get(key));\n        TimeUnit.SECONDS.sleep(3);\n        if (count++ == Integer.MAX_VALUE){\n            myself.close();\n            redisClient.shutdown();\n        }\n    }\n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br")])]),e("h2",{attrs:{id:"新特性3-acls"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#新特性3-acls"}},[s._v("#")]),s._v(" 新特性3：ACLS")]),s._v(" "),e("p",[s._v("ACL 是对于命令的访问和执行权限的控制，默认情况下，可以有执行任意的指令，兼容以前版本。")]),s._v(" "),e("p",[s._v("ACL设置有两种方式：")]),s._v(" "),e("ol",[e("li",[e("p",[s._v("命令方式")]),s._v(" "),e("p",[s._v("ACL SETUSER + 具体的权限规则， 通过 ACL SAVE 进行持久化")])]),s._v(" "),e("li",[e("p",[s._v("对 ACL 配置文件进行编写，并且执行 ACL LOAD 进行加载")])])]),s._v(" "),e("p",[s._v("ACL存储有两种方式，但是两种方式不能同时配置，否则直接报错退出进程")]),s._v(" "),e("ol",[e("li",[e("p",[s._v("redis 配置文件： redis.conf")])]),s._v(" "),e("li",[e("p",[s._v("ACL配置文件, 在redis.conf 中通过 aclfile  /path  配置acl文件的路径")])])]),s._v(" "),e("p",[s._v("命令方式：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("ACL SETUSER alice   // 创建一个 用户名为 alice的用户\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("用如上的命令创建的用户语义为：")]),s._v(" "),e("ol",[e("li",[e("p",[s._v("处于 off 状态， 它是被禁用的，不能用auth进行认证")])]),s._v(" "),e("li",[e("p",[s._v("不能访问任何命令")])]),s._v(" "),e("li",[e("p",[s._v("不能访问任意的key")])]),s._v(" "),e("li",[e("p",[s._v("没有密码")])])]),s._v(" "),e("p",[s._v("如上用户alice 没有任何意义。")]),s._v(" "),e("p",[s._v("创建一个对 cached: 前缀具有get命令执行权限的用户，并且设置密码：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("acl setuser alice on >pass123  ~cached:* +get \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("auth alice pass123\nset a a\n(error) NOPERM this user has no permissions to run the 'set' command or its subcommand\nget a a \n(error) NOPERM this user has no permissions to access one of the keys used as arguments\nget cached:name\nvvv\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("p",[s._v("如上，如果访问没有被授权的命令，或者key， 将报错，set 命令没有被授权， key  a 没有被授权，")]),s._v(" "),e("p",[s._v("cached:name 可以通过验证。")]),s._v(" "),e("p",[s._v("更符合阅读习惯的格式")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("ACL GETUSER alice\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("添加多个访问模式，空格分隔， 注意，切换其他用户进行登录，alice没有admin权限")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("ACL SETUSER alice ~objects:* ~items:* ~public:*\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("针对类型命令的约束")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("ACL SETUSER alice on +@all -@dangerous >密码 ~*\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("这里+@all:  包含所有得命令 然后用-@ 去除在redis command table 中定义的 dangerous 命令")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/redis/55.png",alt:""}})]),s._v(" "),e("p",[s._v("可以通过如下命令进行查看具体有哪些命令属于某个类别")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("acl cat // 查看所有类别\nacl cat dangerous // 查看所有的 dangerous 命令\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("开放子命令")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("ACL SETUSER myuser -client +client|setname +client|getname\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("禁用client 命令，但是开放 client 命令中的子命令  setname 和 getname ，只能是先禁用，后追加子命令，因为后续可能会有新的命令增加。")])])}),[],!1,null,null,null);e.default=t.exports}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[284],{651:function(e,s,a){"use strict";a.r(s);var n=a(5),r=Object(n.a)({},(function(){var e=this,s=e._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"简介"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[e._v("#")]),e._v(" 简介")]),e._v(" "),s("p",[s("strong",[e._v("说明")])]),e._v(" "),s("p",[e._v("本文用示例介绍观察者模式的JDK写法。")]),e._v(" "),s("p",[s("strong",[e._v("本写法的优缺点")])]),e._v(" "),s("p",[e._v("优点")]),e._v(" "),s("ol",[s("li",[e._v("比纯手写稍微简单一点。")])]),e._v(" "),s("p",[e._v("缺点")]),e._v(" "),s("ol",[s("li",[e._v("需要手动注册观察者，不能自动地去感知。")]),e._v(" "),s("li",[e._v("观察者只能有一个JDK指定的方法：update，不能改为其他名字。")]),e._v(" "),s("li",[e._v("不能方便地指定观察者的执行顺序。（不过观察者中一般不需要指定顺序）")])]),e._v(" "),s("p",[s("strong",[e._v("JDK的观察者模式简介")])]),e._v(" "),s("p",[e._v("在 Java 中，java.util.Observable 类和 java.util.Observer 接口定义了观察者模式，只要实现这两个接口就可以编写观察者模式。")]),e._v(" "),s("ol",[s("li",[e._v("Observable")])]),e._v(" "),s("p",[e._v("Observable 类是抽象目标类（被观察者），它有一个 Vector 集合成员变量，用于保存所有要通知的观察者对象，下面来介绍它最重要的 3 个方法。")]),e._v(" "),s("ul",[s("li",[e._v("void addObserver(Observer o) 方法：用于将新的观察者对象添加到集合中。")]),e._v(" "),s("li",[e._v("void notifyObservers(Object arg) 方法：调用集合中的所有观察者对象的 update方法，通知它们数据发生改变。通常越晚加入集合的观察者越先得到通知。")]),e._v(" "),s("li",[e._v("void setChange() 方法：用来设置一个 boolean 类型的内部标志，注明目标对象发生了变化。当它为true时，notifyObservers() 才会通知观察者。")])]),e._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[e._v("Observer")])]),e._v(" "),s("p",[e._v("Observer 接口是抽象观察者，它监视目标对象的变化，当目标对象发生变化时，观察者得到通知，并调用 update 方法，进行相应的工作。")]),e._v(" "),s("h1",{attrs:{id:"实例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实例"}},[e._v("#")]),e._v(" 实例")]),e._v(" "),s("p",[e._v("本处使用一个贴近真实场景的案例：订单取消时，要有一系列操作，比如：账户业务需要给用户退钱、库存业务需要给商品退回数量。")]),e._v(" "),s("p",[e._v("在这个场景中，取消订单就是被观察者，账户业务和库存业务是观察者。")]),e._v(" "),s("p",[e._v("项目结构")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/springboot/image-20230912174742578.png",alt:"image-20230912174742578"}})]),e._v(" "),s("h2",{attrs:{id:"代码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#代码"}},[e._v("#")]),e._v(" 代码")]),e._v(" "),s("p",[s("strong",[e._v("源码下载")])]),e._v(" "),s("p",[s("a",{attrs:{href:"https://resource.skyofit.com/learn/resource/project/backend/design-pattern/observer/jdk.zip",target:"_blank",rel:"noopener noreferrer"}},[e._v("这里"),s("OutboundLink")],1)]),e._v(" "),s("h2",{attrs:{id:"业务数据类"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#业务数据类"}},[e._v("#")]),e._v(" 业务数据类")]),e._v(" "),s("p",[e._v("取消订单时，主题会将这个数据给到感兴趣的观察者。")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("package com.knife.designPattern.bo;\nimport lombok.Data;\n@Data\npublic class CancelOrderBO {\n    private String orderNo;\n}\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br")])]),s("h2",{attrs:{id:"主题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#主题"}},[e._v("#")]),e._v(" 主题")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("package com.knife.designPattern.jdk.subject;\nimport com.knife.designPattern.jdk.bo.CancelOrderBO;\nimport java.util.Observable;\npublic class CancelOrderSubject extends Observable {\n    public void process(CancelOrderBO cancelOrderBO) {\n        super.setChanged(); //changed  = true\n        super.notifyObservers(cancelOrderBO);\n    }\n}\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br")])]),s("h2",{attrs:{id:"观察者"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#观察者"}},[e._v("#")]),e._v(" 观察者")]),e._v(" "),s("p",[e._v("账户业务观察者")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('package com.knife.designPattern.observer;\nimport java.util.Observable;\nimport java.util.Observer;\n/**\n * 具体观察者: 账户业务\n */\npublic class AccountCancelOrderObserver implements Observer {\n    @Override\n    public void update(Observable o, Object arg) {\n        System.out.println("账户业务开始处理订单取消。接收到的消息：" + arg);\n    }\n}\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br")])]),s("p",[e._v("库存业务观察者")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('package com.knife.designPattern.observer;\nimport java.util.Observable;\nimport java.util.Observer;\n/**\n * 具体观察者: 库存业务\n */\npublic class StorageCancelOrderObserver implements Observer {\n    @Override\n    public void update(Observable o, Object arg) {\n        System.out.println("库存业务开始处理订单取消。接收到的消息：" + arg);\n    }\n}\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br")])]),s("h2",{attrs:{id:"主题持有者"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#主题持有者"}},[e._v("#")]),e._v(" 主题持有者")]),e._v(" "),s("p",[e._v("只有主题还不行，需要有一个地方去调用它，添加一个主题持有者")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("package com.knife.designPattern.subject;\nimport com.knife.designPattern.bo.CancelOrderBO;\nimport com.knife.designPattern.observer.AccountCancelOrderObserver;\nimport com.knife.designPattern.observer.StorageCancelOrderObserver;\npublic class SubjectHolder {\n    private static final CancelOrderSubject instance = init();\n    private SubjectHolder() {\n    }\n    private static CancelOrderSubject init() {\n        // 创建被观察者\n        CancelOrderSubject orderCancelSubject = new CancelOrderSubject();\n        // 创建观察者\n        AccountCancelOrderObserver accountCancelOrderObserver =\n                new AccountCancelOrderObserver();\n        StorageCancelOrderObserver storageCancelOrderObserver =\n                new StorageCancelOrderObserver();\n        // 添加观察者，这样被观察者有数据时观察者就能感知到\n        orderCancelSubject.addObserver(accountCancelOrderObserver);\n        orderCancelSubject.addObserver(storageCancelOrderObserver);\n        return orderCancelSubject;\n    }\n    public static void process(CancelOrderBO cancelOrderBO) {\n        instance.process(cancelOrderBO);\n    }\n}\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br"),s("span",{staticClass:"line-number"},[e._v("15")]),s("br"),s("span",{staticClass:"line-number"},[e._v("16")]),s("br"),s("span",{staticClass:"line-number"},[e._v("17")]),s("br"),s("span",{staticClass:"line-number"},[e._v("18")]),s("br"),s("span",{staticClass:"line-number"},[e._v("19")]),s("br"),s("span",{staticClass:"line-number"},[e._v("20")]),s("br"),s("span",{staticClass:"line-number"},[e._v("21")]),s("br"),s("span",{staticClass:"line-number"},[e._v("22")]),s("br"),s("span",{staticClass:"line-number"},[e._v("23")]),s("br"),s("span",{staticClass:"line-number"},[e._v("24")]),s("br"),s("span",{staticClass:"line-number"},[e._v("25")]),s("br")])]),s("h2",{attrs:{id:"测试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#测试"}},[e._v("#")]),e._v(" 测试")]),e._v(" "),s("p",[e._v("测试类")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('package com.knife.designPattern.controller;\nimport com.knife.designPattern.bo.CancelOrderBO;\nimport com.knife.designPattern.subject.SubjectHolder;\nimport io.swagger.annotations.Api;\nimport io.swagger.annotations.ApiOperation;\nimport org.springframework.web.bind.annotation.PostMapping;\nimport org.springframework.web.bind.annotation.RequestBody;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RestController;\n@Api(tags = "订单")\n@RestController\n@RequestMapping("order")\npublic class OrderController {\n    @ApiOperation("取消订单")\n    @PostMapping("cancel")\n    public String cancel(@RequestBody CancelOrderBO cancelOrderBO) {\n        SubjectHolder.process(cancelOrderBO);\n        return "success";\n    }\n}\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br"),s("span",{staticClass:"line-number"},[e._v("15")]),s("br"),s("span",{staticClass:"line-number"},[e._v("16")]),s("br"),s("span",{staticClass:"line-number"},[e._v("17")]),s("br"),s("span",{staticClass:"line-number"},[e._v("18")]),s("br"),s("span",{staticClass:"line-number"},[e._v("19")]),s("br"),s("span",{staticClass:"line-number"},[e._v("20")]),s("br")])]),s("p",[e._v("访问接口")]),e._v(" "),s("p",[e._v("启动项目后，访问Knife4j（接口文档）的地址：http://localhost:8080/doc.html")]),e._v(" "),s("p",[e._v("（当然，你用postman也完全可以）")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/springboot/image-20230912174856698.png",alt:"image-20230912174856698"}})]),e._v(" "),s("p",[e._v("结果")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("库存业务开始处理订单取消。接收到的消息：CancelOrderBO(orderNo=666)\n账户业务开始处理订单取消。接收到的消息：CancelOrderBO(orderNo=666)\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br")])]),s("p",[e._v("​\t\t\t\t\t\t\t\t\t[ 0](javascript:😉")])])}),[],!1,null,null,null);s.default=r.exports}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[52],{395:function(s,n,a){"use strict";a.r(n);var e=a(1),t=Object(e.a)({},(function(){var s=this,n=s._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("p",[n("strong",[s._v("1. MongoDB 高可用复制集架构")])]),s._v(" "),n("p",[n("strong",[s._v("2. MongoDB  集群分片机制原理")])]),s._v(" "),n("p",[n("strong",[s._v("3. MongoDB 应用与开发实战")])]),s._v(" "),n("p",[n("strong",[s._v("MongoDB 复制集")])]),s._v(" "),n("p",[s._v("MongoDB复制集的主要意义在于实现服务高可用，类似于Redis中的哨兵模式")]),s._v(" "),n("p",[n("strong",[s._v("它主要提供两个方面的功能")])]),s._v(" "),n("ol",[n("li",[n("p",[s._v("数据写入主节点（Primary）时将数据复制到另一个副本节（Secondary）点上")])]),s._v(" "),n("li",[n("p",[s._v("主节点发生故障时自动选举出一个新的替代节点")])])]),s._v(" "),n("p",[s._v("在实现高可用的同时，复制集实现了其他几个作用")]),s._v(" "),n("p",[s._v("数据分发：将数据从一个区域复制到另一个区域，减少另一个区域的读延迟")]),s._v(" "),n("p",[s._v("读写分离：不同类型的压力分别在不同的节点上执行")]),s._v(" "),n("p",[s._v("异地容灾：在数据中心故障时快速切换到异地")]),s._v(" "),n("p",[n("strong",[s._v("典型复制集结构")])]),s._v(" "),n("p",[s._v("一个典型的复制集由三个或三个以上具有投票权的节点组成，其中一个主节点（Primary）：接收写入操作，读操作和选举时投票，两个或多个从节点(Secondary)：复制主节点上的新数据和选举时投票")]),s._v(" "),n("p",[n("strong",[s._v("数据是如何复制的？")])]),s._v(" "),n("p",[s._v("当一个修改操作，无论是插入，更新或删除，到达主节点时，它对数据的操作将被记录下来（经过一些必要的转换）。这些记录称为oplog")]),s._v(" "),n("p",[s._v("从节点通过从主节点上不断获取新进入主节点的oplog，并在自己的数据上回放，以此保持跟主节点的数据一致。")]),s._v(" "),n("p",[s._v("​    "),n("img",{attrs:{src:"https://gitee.com/nylg/picture/raw/master/mongodb/30.png",alt:""}})]),s._v(" "),n("p",[n("strong",[s._v("通过选举完成故障恢复")])]),s._v(" "),n("p",[s._v("具有投票权的节点之间两两互相发送心跳；")]),s._v(" "),n("p",[s._v("当5次心跳未收到时判断为节点失联")]),s._v(" "),n("p",[s._v("如果失联的是主机点，从节点会发起选举，选出新的主节点")]),s._v(" "),n("p",[s._v("如果失联的是从节点则不会产生新的选举")]),s._v(" "),n("p",[s._v("选举基于RAFT一致性算法实现，选举成功的必要条件是大多数投票节点存活")]),s._v(" "),n("p",[s._v("复制集中最多可以有50个节点，但具有投票权的节点最多7个")]),s._v(" "),n("p",[n("strong",[s._v("影响选举的因素")])]),s._v(" "),n("p",[s._v("整个集群必须有大多数节点存活")]),s._v(" "),n("p",[s._v("被选举为主节点的节点必须")]),s._v(" "),n("p",[s._v("1.能够与多数节点建立连接")]),s._v(" "),n("p",[s._v("2.具有较新的oplog")]),s._v(" "),n("p",[s._v("3.具有较高的优先级（如果有配置）")]),s._v(" "),n("p",[n("strong",[s._v("复制集节点有以下的选配项")])]),s._v(" "),n("p",[s._v("是否具有投票权（v  参数）： 有则参与投票")]),s._v(" "),n("p",[s._v("优先级（priority参数）：优先级越高的节点越优先成为主节点。优先级为0的节点无法成为主节点,默认值为1。")]),s._v(" "),n("p",[s._v("隐藏（hidden参数）：复制数据，但对应用不可见。隐藏节点可以具有投票权，但优先级必须为0")]),s._v(" "),n("p",[s._v("延迟（slaveDelay参数）：复制 n 秒之前的数据，保持与主节点的时间差")]),s._v(" "),n("p",[s._v("从节点不建立索引( buildIndexes)")]),s._v(" "),n("p",[n("strong",[s._v("复制集注意事项")])]),s._v(" "),n("p",[s._v("硬件：")]),s._v(" "),n("p",[s._v("因为正常的复制集节点都有可能成为主节点，它们的地位是一样的，因此硬件配置上必须一致")]),s._v(" "),n("p",[s._v("为了保证节点不会同时宕机，各节点的硬件必须具有独立性。")]),s._v(" "),n("p",[s._v("软件：")]),s._v(" "),n("p",[s._v("复制集各节点软件版本必须一致，以避免出现不可预知的问题")]),s._v(" "),n("p",[s._v("增加节点不会增加系统写性能")]),s._v(" "),n("p",[n("strong",[s._v("复制集搭建")])]),s._v(" "),n("ol",[n("li",[s._v("创建数据目录文件")])]),s._v(" "),n("p",[s._v("Linux系统")]),s._v(" "),n("p",[s._v("mkdir -p /data/db{1,2,3}")]),s._v(" "),n("ol",{attrs:{start:"3"}},[n("li",[s._v("准备每个数据库的配置文件")])]),s._v(" "),n("p",[s._v("复制集的每个mongod进程应该位于不同的服务器。我们现在在一台服务器上运行三个实例，所以要为它们各自配置")]),s._v(" "),n("p",[s._v("1.不同的端口： 28017， 28018，28019.")]),s._v(" "),n("p",[s._v("2.不同的数据目录")]),s._v(" "),n("p",[s._v("data/db1,data/db2,data/db3")]),s._v(" "),n("ol",{attrs:{start:"3"}},[n("li",[s._v("不同的日志文件路径。实例中使用")])]),s._v(" "),n("p",[s._v("/data/db1/mongod.log")]),s._v(" "),n("p",[s._v("/data/db2/mongod.log")]),s._v(" "),n("p",[s._v("/data/db3/mongod.log")]),s._v(" "),n("p",[s._v("data/db1/mongod.conf")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("systemLog:\n  destination: file\n  path: /data/db1/mongod.log\n  logAppend: true\nstorage:\n  dbPath: /data/db1\nnet:\n  bindIp: 0.0.0.0\n  port: 28017\nreplication:\n  replSetName: rs0\nprocessManagement:\n  fork: true\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("p",[s._v("/data/db2/mongod.conf")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("systemLog:\n  destination: file\n  path: /data/db2/mongod.log\n  logAppend: true\nstorage:\n  dbPath: /data/db2\nnet:\n  bindIp: 0.0.0.0\n  port: 28018\nreplication:\n  replSetName: rs0\nprocessManagement:\n  fork: true\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("p",[s._v("/data/db3/mongod.conf")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("systemLog:\n  destination: file\n  path: /data/db3/mongod.log\n  logAppend: true\nstorage:\n  dbPath: /data/db3\nnet:\n  bindIp: 0.0.0.0\n  port: 28019\nreplication:\n  replSetName: rs0\nprocessManagement:\n  fork: true\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("p",[s._v("分别启动")]),s._v(" "),n("p",[s._v("mongod -f /data/db1/mongod.conf")]),s._v(" "),n("p",[s._v("mongod -f /data/db2/mongod.conf")]),s._v(" "),n("p",[s._v("mongod -f /data/db3/mongod.conf")]),s._v(" "),n("p",[s._v("window没法 fork， 所以只能用前台进程开启， 需要 开3个命令窗口分别启动")]),s._v(" "),n("p",[s._v("配置复制集")]),s._v(" "),n("p",[s._v("mongo --port 28017")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('> rs.initiate({\n\n_id:"rs0",\nmembers:[{\n_id:0,\nhost:"localhost:28017"\n},{\n_id:1,\nhost:"localhost:28018"\n},{\n_id:2,\nhost:"localhost:28019"\n}]\n})\n\n默认情况下非主节点不允许读数据\n可以通过执行 rs.secondaryOk() 开启读权限\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("p",[s._v("mongo --port 28017 连接到主节点")]),s._v(" "),n("p",[s._v("​    "),n("img",{attrs:{src:"https://gitee.com/nylg/picture/raw/master/mongodb/31.png",alt:""}})]),s._v(" "),n("p",[s._v("mongo --port 28018  连接到从节点上面")]),s._v(" "),n("p",[s._v("执行")]),s._v(" "),n("p",[s._v("​    "),n("img",{attrs:{src:"https://gitee.com/nylg/picture/raw/master/mongodb/32.png",alt:""}})]),s._v(" "),n("p",[n("strong",[s._v("分片集群")])]),s._v(" "),n("ol",[n("li",[s._v("什么是分片？")])]),s._v(" "),n("p",[s._v("将数据水平拆分到不同的服务器上")]),s._v(" "),n("ol",{attrs:{start:"2"}},[n("li",[s._v("为什么要使用分片集群")])]),s._v(" "),n("p",[s._v("数据量突破单机瓶颈，数据量大，恢复很慢，不利于数据管理")]),s._v(" "),n("p",[s._v("并发量突破单机性能瓶颈")]),s._v(" "),n("p",[n("strong",[s._v("MongoDB 分片集群由一下几部分组成")])]),s._v(" "),n("p",[s._v("​    "),n("img",{attrs:{src:"https://gitee.com/nylg/picture/raw/master/mongodb/33.png",alt:""}})]),s._v(" "),n("p",[n("strong",[s._v("分片集群角色：")])]),s._v(" "),n("p",[s._v("路由节点： mongos， 提供集群单一入口，转发应用端请求，选择合适的数据节点进行读写，合并多个数据节点的返回。无状态，建议  mongos节点集群部署以提供高可用性。客户请求应发给mongos，而不是 分片服务器，当查询包含分片片键时，mongos将查询发送到指定分片，否则，mongos将查询发送到所有分片，并汇总所有查询结果。")]),s._v(" "),n("p",[s._v("配置节点:  就是普通的mongod进程， 建议以复制集部署，提供高可用")]),s._v(" "),n("p",[s._v("提供集群元数据存储分片数据分布的数据。主节点故障时，配置服务器进入只读模式,")]),s._v(" "),n("p",[s._v("只读模式下，数据段分裂和集群平衡都不可执行。整个复制集故障时，分片集群不可用")]),s._v(" "),n("p",[s._v("数据节点：")]),s._v(" "),n("p",[s._v("以复制集为单位，横向扩展最大1024分片，分片之间数据不重复，所有数据在一起才可以完整工作。")]),s._v(" "),n("p",[n("strong",[s._v("分片键")])]),s._v(" "),n("p",[s._v("可以是单个字段， 也可以是复合字段")]),s._v(" "),n("ol",[n("li",[s._v("范围分片")])]),s._v(" "),n("p",[s._v("比如 key  的值 从 min -  max")]),s._v(" "),n("p",[s._v("可以把数据进行范围分片")]),s._v(" "),n("ol",{attrs:{start:"2"}},[n("li",[s._v("hash 分片")])]),s._v(" "),n("p",[s._v("通过 hash(key ) 进行数据分段")]),s._v(" "),n("p",[s._v("片键值用来将集合中的文档划分为数据段,片键必须对应一个索引或索引前缀（单键、复合键）,可以使用片键的值 或者片键值的哈希值进行分片")]),s._v(" "),n("p",[n("strong",[s._v("选择片键")])]),s._v(" "),n("ol",[n("li",[n("p",[s._v("片键值的范围更广（可以使用复合片键扩大范围）")])]),s._v(" "),n("li",[n("p",[s._v("片键值的分布更平衡（可使用复合片键平衡分布）")])]),s._v(" "),n("li",[n("p",[s._v("片键值不要单向增大、减小（可使用哈希片键）")])])]),s._v(" "),n("p",[n("strong",[s._v("数据段的分裂")])]),s._v(" "),n("p",[s._v("当数据段尺寸过大，或者包含过多文档时，触发数据段分裂,只有新增、更新文档时才可能自动触发数据段分裂,数据段分裂通过更新元数据来实现")]),s._v(" "),n("p",[n("strong",[s._v("集群的平衡")])]),s._v(" "),n("p",[s._v("后台运行的平衡器负责监视和调整集群的平衡,当最大和最小分片之间的数据段数量相差过大时触发")]),s._v(" "),n("p",[s._v("集群中添加或移除分片时也会触发")]),s._v(" "),n("p",[n("strong",[s._v("MongoDB分片集群特点")])]),s._v(" "),n("p",[s._v("1.应用全透明")]),s._v(" "),n("p",[s._v("2.数据自动均衡")]),s._v(" "),n("p",[s._v("3.动态扩容，无需下线")]),s._v(" "),n("p",[n("strong",[s._v("搭建集群环境：")])]),s._v(" "),n("p",[s._v("搭建一个2个分片的集群")]),s._v(" "),n("p",[s._v("步骤：")]),s._v(" "),n("p",[n("strong",[s._v("配置第一个 分片集群：")])]),s._v(" "),n("ol",[n("li",[s._v("创建数据目录 ： 准备给两个复制集使用，每个复制集有三个实例 ,共 6 个数据节点")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("mkdir -p /data/shard1    /data/shard1second1     /data/shard1second2     /data/shard2    /data/shard2second1     /data/shard2second2   \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ol",{attrs:{start:"2"}},[n("li",[s._v("创建日志文件，共6 个文件")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("touch  /data/shard1/mongod.log     /data/shard1second1/mongod.log    /data/shard1second2/mongod.log    /data/shard2/mongod.log     /data/shard2second1/mongod.log    /data/shard2second2/mongod.log \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ol",{attrs:{start:"3"}},[n("li",[s._v("启动第一个 mongod 分片实例( 一共三个实例)")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("mongod --bind_ip 0.0.0.0 --replSet shard1 --dbpath /data/shard1 --logpath /data/shard1/mongod.log --port 27010   --fork   --shardsvr\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("mongod --bind_ip 0.0.0.0 --replSet shard1 --dbpath /data/shard1second1  --logpath /data/shard1second1/mongod.log --port 27011   --fork   --shardsvr\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("mongod --bind_ip 0.0.0.0 --replSet shard1 --dbpath /data/shard1second2 --logpath /data/shard1second2/mongod.log --port 27012   --fork   --shardsvr\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ol",{attrs:{start:"4"}},[n("li",[s._v("第一个分片的mongod 实例都启动好了后，将其加入到复制集中")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('rs.initiate(\n{_id:"shard1",\n    "members":[ \n                {"_id":0,"host":"192.168.109.200:27010"},\n                {"_id":1,"host":"192.168.109.200:27011"},\n                {"_id":2,"host":"192.168.109.200:27012"}\n                ]\n});\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("​")]),s._v(" "),n("p",[s._v("等待集群选举")]),s._v(" "),n("ol",{attrs:{start:"5"}},[n("li",[s._v("查看状态")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("rs.status();\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[n("strong",[s._v("配置Config 复制集：一共三个实例")])]),s._v(" "),n("ol",[n("li",[s._v("创建数据目录：")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("mkdir -p /data/config    /data/configsecond1     /data/configsecond2\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ol",{attrs:{start:"2"}},[n("li",[s._v("创建日志文件")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("touch  /data/config/mongod.log     /data/configsecond1/mongod.log    /data/configsecond2/mongod.log \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ol",{attrs:{start:"3"}},[n("li",[s._v("启动配置复制集")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("mongod --bind_ip 0.0.0.0 --replSet config --dbpath /data/config  --logpath /data/config/mongod.log --port 37010   --fork   --configsvr \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("mongod --bind_ip 0.0.0.0 --replSet config --dbpath /data/configsecond1 --logpath /data/configsecond1/mongod.log --port 37011   --fork   --configsvr \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("mongod --bind_ip 0.0.0.0 --replSet config --dbpath /data/configsecond2  --logpath /data/configsecond2/mongod.log --port 37012   --fork   --configsvr \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ol",{attrs:{start:"4"}},[n("li",[s._v("配置复制集进行初始化")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('    rs.initiate(\n    {_id:"config",\n        "members":[ \n                    {"_id":0,"host":"192.168.109.200:37010"},\n                    {"_id":1,"host":"192.168.109.200:37011"},\n                    {"_id":2,"host":"192.168.109.200:37012"}\n                    ]\n    });\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[n("strong",[s._v("配置mongs 路由节点")])]),s._v(" "),n("ol",[n("li",[s._v("启动mongos 实例，需要指定配置服务器的地址列表")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("mongos --bind_ip 0.0.0.0 --logpath /data/mongos/mongos.log --port 4000 --fork --configdb config/111.229.189.98:37010,111.229.189.98:37011,111.229.189.98:37012\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("其中 configdb  为配置服务器的地址列表")]),s._v(" "),n("ol",{attrs:{start:"2"}},[n("li",[s._v("连接到mongos中，并添加分片")])]),s._v(" "),n("p",[s._v("直接通过mongo shell 客户端进行连接")]),s._v(" "),n("p",[s._v("mongo --port 4000   本地直连")]),s._v(" "),n("p",[s._v("执行脚本")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('sh.addShard("shard1/111.229.189.98:27010,111.229.189.98:27011,111.229.189.98:27012");\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("查看分片状态：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("sh.status();\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("mongos 可以用同样的方式，创建多个")]),s._v(" "),n("p",[n("strong",[s._v("创建分片表：")])]),s._v(" "),n("ol",[n("li",[s._v("MongoDB的分片时基于集合的，就算有分片集群不等于数据会自动分片，需要显示分片表")])]),s._v(" "),n("p",[s._v("首先需要 启用数据库分片")]),s._v(" "),n("p",[s._v('sh.enableSharding("库名");')]),s._v(" "),n("p",[s._v("如：")]),s._v(" "),n("p",[s._v('sh.enableSharding("order");')]),s._v(" "),n("p",[s._v('sh.shardCollection("库名.集合名",{_id: "hashed"});')]),s._v(" "),n("p",[s._v('sh.shardCollection("order.account",{_id: "hashed"});')]),s._v(" "),n("p",[s._v("添加一组数据")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("for( var i =0;i<100; i++){\ndb.productdesc.insert({i:i});\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("动态扩容")]),s._v(" "),n("p",[s._v("创建第二个复制集来实现分片")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("mongod --bind_ip 0.0.0.0 --replSet shard2 --dbpath /data/shard2 --logpath /data/shard2/mongod.log --port 27013   --fork   --shardsvr\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("mongod --bind_ip 0.0.0.0 --replSet shard2 --dbpath /data/shard2second1  --logpath /data/shard2second1/mongod.log --port 27014   --fork   --shardsvr\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("mongod --bind_ip 0.0.0.0 --replSet shard2 --dbpath /data/shard2second2 --logpath /data/shard2second2/mongod.log --port 27015   --fork   --shardsvr\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("初始化复制集")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('rs.initiate(\n{_id:"shard2",\n    "members":[ \n                {"_id":0,"host":"111.229.189.98:27013"},\n                {"_id":1,"host":"111.229.189.98:27014"},\n                {"_id":2,"host":"111.229.189.98:27015"}\n                ]\n});\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("​")]),s._v(" "),n("p",[s._v("加入到集群分片")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('mongo --port 4000\nsh.addShard("shard2/111.229.189.98:27013,111.229.189.98:27014,111.229.189.98:27015");\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("课上异常说明：")]),s._v(" "),n("p",[s._v("https://www.cnblogs.com/lazyboy/archive/2012/11/26/2789401.html")]),s._v(" "),n("p",[s._v("​    "),n("img",{attrs:{src:"https://gitee.com/nylg/picture/raw/master/mongodb/34.png",alt:""}})]),s._v(" "),n("p",[s._v("前面有数据了， 再分配分片键会报错")]),s._v(" "),n("p",[n("strong",[s._v("MongoDB 应用实战")])]),s._v(" "),n("p",[s._v("代码示例：")]),s._v(" "),n("p",[s._v("https://gitee.com/nylg/picture/tree/master/file/mongojavadriver")]),s._v(" "),n("p",[s._v("https://gitee.com/nylg/picture/tree/master/file/mongodb-demo")]),s._v(" "),n("p",[s._v("最新驱动的地址")]),s._v(" "),n("p",[s._v("https://mongodb.github.io/mongo-java-driver/4.1/driver/")]),s._v(" "),n("ol",[n("li",[s._v("java 原生客户端")])]),s._v(" "),n("p",[s._v("引入maven")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("<dependencies>\n    <dependency>\n        <groupId>org.mongodb</groupId>\n        <artifactId>mongodb-driver-sync</artifactId>\n        <version>4.1.1</version>\n    </dependency>\n</dependencies>\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('public class QuickStart {\n\n    public static void main(String[] args) {\n        // 连接本地默认端口的Mongod\n        // MongoClient mongoClient = MongoClients.create()\n        // 连接远程服务的指定端口的Mongod\n        // MongoClient mongoClient = MongoClients.create("mongodb://host1:27017");\n        // 连接指定端口复制集\n        // MongoClient mongoClient = MongoClients.create("mongodb://host1:27017,host2:27017,host3:27017/?replicaSet=myReplicaSet");\n        // 连接 mongos路由: 连接一个\n        // MongoClient mongoClient = MongoClients.create( "mongodb://localhost:27017" );\n        // 连接多个mongos路由\n        MongoClient mongoClient = MongoClients.create("mongodb://111.229.189.98:4000");\n\n\n        //获取数据库\n        MongoDatabase database = mongoClient.getDatabase("productdb");\n\n        // 获取集合\n        MongoCollection<Document> productdesc=database.getCollection( "productdesc" );\n\n        Document doc = new Document("name", "MongoDB")\n                .append("type", "database")\n                .append("count", 1)\n                .append("versions", Arrays.asList("v3.2", "v3.0", "v2.6"))\n                .append("info", new Document("x", 203).append("y", 102));\n\n        productdesc.insertOne(doc);\n\n\n        Bson eq = eq("name", "MongoDB");\n        FindIterable<Document> find = productdesc.find(eq);\n        Document first=find.first();\n        System.out.println(first);\n\n    }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br")])]),n("ol",{attrs:{start:"2"}},[n("li",[s._v("Spring Boot 整合：")])]),s._v(" "),n("p",[s._v("https://docs.spring.io/spring-data/mongodb/docs/3.1.2/reference/html/#preface")]),s._v(" "),n("ol",[n("li",[s._v("引入maven")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('<?xml version="1.0" encoding="UTF-8"?>\n<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n   xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">\n   <modelVersion>4.0.0</modelVersion>\n   <parent>\n      <groupId>org.springframework.boot</groupId>\n      <artifactId>spring-boot-starter-parent</artifactId>\n      <version>2.4.0</version>\n      <relativePath/> \x3c!-- lookup parent from repository --\x3e\n   </parent>\n   <groupId>com.example</groupId>\n   <artifactId>demo</artifactId>\n   <version>0.0.1-SNAPSHOT</version>\n   <name>demo</name>\n   <description>Demo project for Spring Boot</description>\n\n   <properties>\n      <java.version>1.8</java.version>\n   </properties>\n\n   <dependencies>\n      <dependency>\n         <groupId>org.springframework.boot</groupId>\n         <artifactId>spring-boot-starter-data-mongodb</artifactId>\n      </dependency>\n      <dependency>\n         <groupId>org.springframework.boot</groupId>\n         <artifactId>spring-boot-starter-web</artifactId>\n      </dependency>\n\n      <dependency>\n         <groupId>org.springframework.boot</groupId>\n         <artifactId>spring-boot-starter-test</artifactId>\n         <scope>test</scope>\n      </dependency>\n      <dependency>\n         <groupId>org.projectlombok</groupId>\n         <artifactId>lombok</artifactId>\n         <version>1.18.12</version>\n      </dependency>\n\n\n   </dependencies>\n\n   <build>\n      <plugins>\n         <plugin>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-maven-plugin</artifactId>\n         </plugin>\n      </plugins>\n   </build>\n\n</project>\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br")])]),n("ol",{attrs:{start:"2"}},[n("li",[s._v("添加配置类")])]),s._v(" "),n("p",[s._v("比如连接上述的 mongos, 使用MongoTemplate 进行数据库操作")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('package com.example.demo.config;\n\nimport com.mongodb.client.MongoClient;\nimport com.mongodb.client.MongoClients;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.data.mongodb.core.MongoTemplate;\n\n@Configuration\npublic class AppConfig {\n\n    public @Bean\n    MongoClient mongoClient() {\n        return MongoClients.create("mongodb://111.229.189.98:4000");\n    }\n\n    public @Bean\n    MongoTemplate mongoTemplate() {\n        return new MongoTemplate(mongoClient(), "productdb");\n    }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br")])]),n("ol",{attrs:{start:"3"}},[n("li",[s._v("测试类")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('package com.example.demo;\n\npublic class Person {\n\n  private String id;\n  private String name;\n  private int age;\n\n  public Person(String name, int age) {\n    this.name = name;\n    this.age = age;\n  }\n\n  public String getId() {\n    return id;\n  }\n  public String getName() {\n    return name;\n  }\n  public int getAge() {\n    return age;\n  }\n\n  @Override\n  public String toString() {\n    return "Person [id=" + id + ", name=" + name + ", age=" + age + "]";\n  }\n\n}\n\npackage com.example.demo;\n\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.ApplicationArguments;\nimport org.springframework.boot.ApplicationRunner;\nimport org.springframework.data.mongodb.core.MongoTemplate;\nimport org.springframework.stereotype.Component;\n\nimport java.util.List;\n\nimport static org.springframework.data.mongodb.core.query.Criteria.where;\nimport static org.springframework.data.mongodb.core.query.Query.query;\nimport static org.springframework.data.mongodb.core.query.Update.update;\n \n@Component\n@Slf4j\npublic class ApplicationRunnerTest implements ApplicationRunner{\n\n    @Autowired\n    private MongoTemplate mongoOps;\n\n    @Override\n    public void run(ApplicationArguments applicationArguments) throws Exception {\n\n        Person p = new Person("Joe", 34);\n\n          // 插入文档\n        mongoOps.insert(p);\n        log.info("Insert: " + p);\n\n        // 查询文档\n        p = mongoOps.findById(p.getId(), Person.class);\n        log.info("Found: " + p);\n\n        // 更新文档\n        mongoOps.updateFirst(query(where("name").is("Joe")), update("age", 35), Person.class);\n        p = mongoOps.findOne(query(where("name").is("Joe")), Person.class);\n        log.info("Updated: " + p);\n\n        // 删除文档\n        mongoOps.remove(p);\n\n        // Check that deletion worked\n        List<Person> people =  mongoOps.findAll(Person.class);\n        log.info("Number of people = : " + people.size());\n        mongoOps.dropCollection(Person.class);\n    }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br")])]),n("p",[s._v("​")])])}),[],!1,null,null,null);n.default=t.exports}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{410:function(e,s,t){"use strict";t.r(s);var r=t(5),n=Object(r.a)({},(function(){var e=this,s=e._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h2",{attrs:{id:"stringredistemplate与redistemplate详解"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#stringredistemplate与redistemplate详解"}},[e._v("#")]),e._v(" StringRedisTemplate与RedisTemplate详解")]),e._v(" "),s("p",[e._v("spring 封装了 RedisTemplate 对象来进行对redis的各种操作，它支持所有的 redis 原生的 api。在RedisTemplate中提供了几个常用的接口方法的使用，分别是:")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("private ValueOperations<K, V> valueOps;\nprivate HashOperations<K, V> hashOps;\nprivate ListOperations<K, V> listOps;\nprivate SetOperations<K, V> setOps;\nprivate ZSetOperations<K, V> zSetOps;\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br")])]),s("p",[e._v("RedisTemplate中定义了对5种数据结构操作")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("redisTemplate.opsForValue();//操作字符串\nredisTemplate.opsForHash();//操作hash\nredisTemplate.opsForList();//操作list\nredisTemplate.opsForSet();//操作set\nredisTemplate.opsForZSet();//操作有序set\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br")])]),s("p",[e._v("​")]),e._v(" "),s("p",[e._v("StringRedisTemplate继承自RedisTemplate，也一样拥有上面这些操作。")]),e._v(" "),s("p",[e._v("StringRedisTemplate默认采用的是String的序列化策略，保存的key和value都是采用此策略序列化保存的。")]),e._v(" "),s("p",[e._v("RedisTemplate默认采用的是JDK的序列化策略，保存的key和value都是采用此策略序列化保存的。")]),e._v(" "),s("p",[s("strong",[e._v("Redis客户端命令对应的RedisTemplate中的方法列表：")])]),e._v(" "),s("table",[s("thead",[s("tr",[s("th",[s("strong",[e._v("String类型结构")])]),e._v(" "),s("th")])]),e._v(" "),s("tbody",[s("tr",[s("td",[e._v("Redis")]),e._v(" "),s("td",[e._v("RedisTemplate rt")])]),e._v(" "),s("tr",[s("td",[e._v("set key value")]),e._v(" "),s("td",[e._v('rt.opsForValue().set("key","value")')])]),e._v(" "),s("tr",[s("td",[e._v("get key")]),e._v(" "),s("td",[e._v('rt.opsForValue().get("key")')])]),e._v(" "),s("tr",[s("td",[e._v("del key")]),e._v(" "),s("td",[e._v('rt.delete("key")')])]),e._v(" "),s("tr",[s("td",[e._v("strlen key")]),e._v(" "),s("td",[e._v('rt.opsForValue().size("key")')])]),e._v(" "),s("tr",[s("td",[e._v("getset key value")]),e._v(" "),s("td",[e._v('rt.opsForValue().getAndSet("key","value")')])]),e._v(" "),s("tr",[s("td",[e._v("getrange key start end")]),e._v(" "),s("td",[e._v('rt.opsForValue().get("key",start,end)')])]),e._v(" "),s("tr",[s("td",[e._v("append key value")]),e._v(" "),s("td",[e._v('rt.opsForValue().append("key","value")')])]),e._v(" "),s("tr",[s("td"),e._v(" "),s("td")]),e._v(" "),s("tr",[s("td",[s("strong",[e._v("Hash结构")])]),e._v(" "),s("td")]),e._v(" "),s("tr",[s("td",[e._v("hmset key field1 value1 field2 value2...")]),e._v(" "),s("td",[e._v('rt.opsForHash().putAll("key",map) //map是一个集合对象')])]),e._v(" "),s("tr",[s("td",[e._v("hset key field value")]),e._v(" "),s("td",[e._v('rt.opsForHash().put("key","field","value")')])]),e._v(" "),s("tr",[s("td",[e._v("hexists key field")]),e._v(" "),s("td",[e._v('rt.opsForHash().hasKey("key","field")')])]),e._v(" "),s("tr",[s("td",[e._v("hgetall key")]),e._v(" "),s("td",[e._v('rt.opsForHash().entries("key") //返回Map对象')])]),e._v(" "),s("tr",[s("td",[e._v("hvals key")]),e._v(" "),s("td",[e._v('rt.opsForHash().values("key") //返回List对象')])]),e._v(" "),s("tr",[s("td",[e._v("hkeys key")]),e._v(" "),s("td",[e._v('rt.opsForHash().keys("key") //返回List对象')])]),e._v(" "),s("tr",[s("td",[e._v("hmget key field1 field2...")]),e._v(" "),s("td",[e._v('rt.opsForHash().multiGet("key",keyList)')])]),e._v(" "),s("tr",[s("td",[e._v("hsetnx key field value")]),e._v(" "),s("td",[e._v('rt.opsForHash().putIfAbsent("key","field","value"')])]),e._v(" "),s("tr",[s("td",[e._v("hdel key field1 field2")]),e._v(" "),s("td",[e._v('rt.opsForHash().delete("key","field1","field2")')])]),e._v(" "),s("tr",[s("td",[e._v("hget key field")]),e._v(" "),s("td",[e._v('rt.opsForHash().get("key","field")')])]),e._v(" "),s("tr",[s("td"),e._v(" "),s("td")]),e._v(" "),s("tr",[s("td",[s("strong",[e._v("List结构")])]),e._v(" "),s("td")]),e._v(" "),s("tr",[s("td",[e._v("lpush list node1 node2 node3...")]),e._v(" "),s("td",[e._v('rt.opsForList().leftPush("list","node")')])]),e._v(" "),s("tr",[s("td",[e._v('rt.opsForList().leftPushAll("list",list) //list是集合对象')]),e._v(" "),s("td")]),e._v(" "),s("tr",[s("td",[e._v("rpush list node1 node2 node3...")]),e._v(" "),s("td",[e._v('rt.opsForList().rightPush("list","node")')])]),e._v(" "),s("tr",[s("td",[e._v('rt.opsForList().rightPushAll("list",list) //list是集合对象')]),e._v(" "),s("td")]),e._v(" "),s("tr",[s("td",[e._v("lindex key index")]),e._v(" "),s("td",[e._v('rt.opsForList().index("list", index)')])]),e._v(" "),s("tr",[s("td",[e._v("llen key")]),e._v(" "),s("td",[e._v('rt.opsForList().size("key")')])]),e._v(" "),s("tr",[s("td",[e._v("lpop key")]),e._v(" "),s("td",[e._v('rt.opsForList().leftPop("key")')])]),e._v(" "),s("tr",[s("td",[e._v("rpop key")]),e._v(" "),s("td",[e._v('rt.opsForList().rightPop("key")')])]),e._v(" "),s("tr",[s("td",[e._v("lpushx list node")]),e._v(" "),s("td",[e._v('rt.opsForList().leftPushIfPresent("list","node")')])]),e._v(" "),s("tr",[s("td",[e._v("rpushx list node")]),e._v(" "),s("td",[e._v('rt.opsForList().rightPushIfPresent("list","node")')])]),e._v(" "),s("tr",[s("td",[e._v("lrange list start end")]),e._v(" "),s("td",[e._v('rt.opsForList().range("list",start,end)')])]),e._v(" "),s("tr",[s("td",[e._v("lrem list count value")]),e._v(" "),s("td",[e._v('rt.opsForList().remove("list",count,"value")')])]),e._v(" "),s("tr",[s("td",[e._v("lset key index value")]),e._v(" "),s("td",[e._v('rt.opsForList().set("list",index,"value")')])]),e._v(" "),s("tr",[s("td"),e._v(" "),s("td")]),e._v(" "),s("tr",[s("td",[s("strong",[e._v("Set结构")])]),e._v(" "),s("td")]),e._v(" "),s("tr",[s("td",[e._v("sadd key member1 member2...")]),e._v(" "),s("td",[e._v('rt.boundSetOps("key").add("member1","member2",...)')])]),e._v(" "),s("tr",[s("td",[e._v('rt.opsForSet().add("key", set) //set是一个集合对象')]),e._v(" "),s("td")]),e._v(" "),s("tr",[s("td",[e._v("scard key")]),e._v(" "),s("td",[e._v('rt.opsForSet().size("key")')])]),e._v(" "),s("tr",[s("td",[e._v("sidff key1 key2")]),e._v(" "),s("td",[e._v('rt.opsForSet().difference("key1","key2") //返回一个集合对象')])]),e._v(" "),s("tr",[s("td",[e._v("sinter key1 key2")]),e._v(" "),s("td",[e._v('rt.opsForSet().intersect("key1","key2")//同上')])]),e._v(" "),s("tr",[s("td",[e._v("sunion key1 key2")]),e._v(" "),s("td",[e._v('rt.opsForSet().union("key1","key2")//同上')])]),e._v(" "),s("tr",[s("td",[e._v("sdiffstore des key1 key2")]),e._v(" "),s("td",[e._v('rt.opsForSet().differenceAndStore("key1","key2","des")')])]),e._v(" "),s("tr",[s("td",[e._v("sinter des key1 key2")]),e._v(" "),s("td",[e._v('rt.opsForSet().intersectAndStore("key1","key2","des")')])]),e._v(" "),s("tr",[s("td",[e._v("sunionstore des key1 key2")]),e._v(" "),s("td",[e._v('rt.opsForSet().unionAndStore("key1","key2","des")')])]),e._v(" "),s("tr",[s("td",[e._v("sismember key member")]),e._v(" "),s("td",[e._v('rt.opsForSet().isMember("key","member")')])]),e._v(" "),s("tr",[s("td",[e._v("smembers key")]),e._v(" "),s("td",[e._v('rt.opsForSet().members("key")')])]),e._v(" "),s("tr",[s("td",[e._v("spop key")]),e._v(" "),s("td",[e._v('rt.opsForSet().pop("key")')])]),e._v(" "),s("tr",[s("td",[e._v("srandmember key count")]),e._v(" "),s("td",[e._v('rt.opsForSet().randomMember("key",count)')])]),e._v(" "),s("tr",[s("td",[e._v("srem key member1 member2...")]),e._v(" "),s("td",[e._v('rt.opsForSet().remove("key","member1","member2",...)')])])])]),e._v(" "),s("h2",{attrs:{id:"java操作redis集群"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#java操作redis集群"}},[e._v("#")]),e._v(" Java操作Redis集群")]),e._v(" "),s("p",[e._v("借助redis的java客户端jedis可以操作以上集群，引用jedis版本的maven坐标如下：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("<dependency>\n    <groupId>redis.clients</groupId>\n    <artifactId>jedis</artifactId>\n    <version>2.9.0</version>\n</dependency>\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br")])]),s("p",[e._v("Java编写访问redis集群的代码非常简单，如下所示：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('public class JedisClusterTest {\n    public static void main(String[] args) throws IOException {\n\n        JedisPoolConfig config = new JedisPoolConfig();\n        config.setMaxTotal(20);\n        config.setMaxIdle(10);\n        config.setMinIdle(5);\n\n        Set<HostAndPort> jedisClusterNode = new HashSet<HostAndPort>();\n        jedisClusterNode.add(new HostAndPort("192.168.0.61", 8001));\n        jedisClusterNode.add(new HostAndPort("192.168.0.62", 8002));\n        jedisClusterNode.add(new HostAndPort("192.168.0.63", 8003));\n        jedisClusterNode.add(new HostAndPort("192.168.0.61", 8004));\n        jedisClusterNode.add(new HostAndPort("192.168.0.62", 8005));\n        jedisClusterNode.add(new HostAndPort("192.168.0.63", 8006));\n\n        JedisCluster jedisCluster = null;\n        try {\n            //connectionTimeout：指的是连接一个url的连接等待时间\n            //soTimeout：指的是连接上一个url，获取response的返回等待时间\n            jedisCluster = new JedisCluster(jedisClusterNode, 6000, 5000, 10, "zhuge", config);\n            System.out.println(jedisCluster.set("cluster", "zhuge"));\n            System.out.println(jedisCluster.get("cluster"));\n        } catch (Exception e) {\n            e.printStackTrace();\n        } finally {\n            if (jedisCluster != null)\n                jedisCluster.close();\n        }\n    }\n}\n\n运行效果如下：\nOK\nzhuge\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br"),s("span",{staticClass:"line-number"},[e._v("15")]),s("br"),s("span",{staticClass:"line-number"},[e._v("16")]),s("br"),s("span",{staticClass:"line-number"},[e._v("17")]),s("br"),s("span",{staticClass:"line-number"},[e._v("18")]),s("br"),s("span",{staticClass:"line-number"},[e._v("19")]),s("br"),s("span",{staticClass:"line-number"},[e._v("20")]),s("br"),s("span",{staticClass:"line-number"},[e._v("21")]),s("br"),s("span",{staticClass:"line-number"},[e._v("22")]),s("br"),s("span",{staticClass:"line-number"},[e._v("23")]),s("br"),s("span",{staticClass:"line-number"},[e._v("24")]),s("br"),s("span",{staticClass:"line-number"},[e._v("25")]),s("br"),s("span",{staticClass:"line-number"},[e._v("26")]),s("br"),s("span",{staticClass:"line-number"},[e._v("27")]),s("br"),s("span",{staticClass:"line-number"},[e._v("28")]),s("br"),s("span",{staticClass:"line-number"},[e._v("29")]),s("br"),s("span",{staticClass:"line-number"},[e._v("30")]),s("br"),s("span",{staticClass:"line-number"},[e._v("31")]),s("br"),s("span",{staticClass:"line-number"},[e._v("32")]),s("br"),s("span",{staticClass:"line-number"},[e._v("33")]),s("br"),s("span",{staticClass:"line-number"},[e._v("34")]),s("br"),s("span",{staticClass:"line-number"},[e._v("35")]),s("br")])]),s("p",[e._v("集群的Spring Boot整合Redis连接代码见示例项目：redis-sentinel-cluster")]),e._v(" "),s("p",[e._v("1、引入相关依赖：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("<dependency>\n   <groupId>org.springframework.boot</groupId>\n   <artifactId>spring-boot-starter-data-redis</artifactId>\n</dependency>\n\n<dependency>\n   <groupId>org.apache.commons</groupId>\n   <artifactId>commons-pool2</artifactId>\n</dependency>\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br")])]),s("p",[e._v("springboot项目核心配置：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("server:\n  port: 8080\n\nspring:\n  redis:\n    database: 0\n    timeout: 3000\n    password: zhuge\n    cluster:\n      nodes: 192.168.0.61:8001,192.168.0.62:8002,192.168.0.63:8003,192.168.0.61:8004,192.168.0.62:8005,192.168.0.63:8006\n   lettuce:\n      pool:\n        max-idle: 50\n        min-idle: 10\n        max-active: 100\n        max-wait: 1000\n  \n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br"),s("span",{staticClass:"line-number"},[e._v("15")]),s("br"),s("span",{staticClass:"line-number"},[e._v("16")]),s("br"),s("span",{staticClass:"line-number"},[e._v("17")]),s("br")])]),s("p",[e._v("访问代码：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('@RestController\npublic class IndexController {\n\n    private static final Logger logger = LoggerFactory.getLogger(IndexController.class);\n\n    @Autowired\n    private StringRedisTemplate stringRedisTemplate;\n\n    @RequestMapping("/test_cluster")\n    public void testCluster() throws InterruptedException {\n       stringRedisTemplate.opsForValue().set("zhuge", "666");\n       System.out.println(stringRedisTemplate.opsForValue().get("zhuge"));\n    }\n}\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br")])])])}),[],!1,null,null,null);s.default=n.exports}}]);
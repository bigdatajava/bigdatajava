(window.webpackJsonp=window.webpackJsonp||[]).push([[191],{556:function(s,a,t){"use strict";t.r(a);var n=t(5),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("U2FsdGVkX1/yaWCbUEGjPO03FxK5ek6wumA18taLo/4I70r9rVl59ISMdGA4nC2b\nHASVe+BpC8CAnLwRXNy6L/jktfJRHcQpExPO3N+OfbY7c+DaWiyBSL3+W9g2D7Fg\nVB2YZLM+RD+ffiLRy14Ry8Jc647F+iTGyUiXPKh0Ow==\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("事先启动一个web应用程序，用jps查看其进程id，接着用各种jdk自带命令优化应用")]),s._v(" "),a("h2",{attrs:{id:"jmap"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jmap"}},[s._v("#")]),s._v(" Jmap")]),s._v(" "),a("p",[s._v("此命令可以用来查看内存信息，实例个数以及占用内存大小。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("C:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Users"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Administrator"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("jps\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5024")]),s._v(" Launcher\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11380")]),s._v(" Jps\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13996")]),s._v(" TestServer\n\n\nC:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Users"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Administrator"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("jmap "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-histo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13996")]),s._v(" \nC:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Users"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Administrator"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("jmap "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-histo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13996")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ./log.txt\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("ul",[a("li",[s._v("jmap -histo 13996  #查看历史生成的实例")]),s._v(" "),a("li",[s._v("jmap -histo:live 13996  #查看当前存活的实例，执行过程中可能会触发一次full gc")])]),s._v(" "),a("p",[s._v("打开log.txt，文件内容如下：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v(" num     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#instances         #bytes  class name")]),s._v("\n----------------------------------------------\n   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(":       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3701325")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("148053000")]),s._v("  java.util.HashMap"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$ValueIterator")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(":       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3703332")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("88879968")]),s._v("  java.util.ArrayList\n   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(":         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("89253")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("81489856")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("B\n   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(":       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2717222")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("78180000")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("C\n   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(":       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2715736")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65177664")]),s._v("  java.lang.String\n   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(":         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("59937")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("48908592")]),s._v("  com.quota.api.value.Quotation\n   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(":         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("51549")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("44797184")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("I\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("ul",[a("li",[s._v("num：序号")]),s._v(" "),a("li",[s._v("instances：实例数量")]),s._v(" "),a("li",[s._v("bytes：占用空间大小")]),s._v(" "),a("li",[s._v("class name：类名称，"),a("code",[s._v("[C")]),s._v(" is a "),a("code",[s._v("char[]")]),s._v("，"),a("code",[s._v("[S")]),s._v(" is a "),a("code",[s._v("short[]")]),s._v("，"),a("code",[s._v("[I")]),s._v(" is a "),a("code",[s._v("int[]")]),s._v("，"),a("code",[s._v("[B")]),s._v(" is a "),a("code",[s._v("byte[]")]),s._v("，"),a("code",[s._v("[[I")]),s._v(" is a "),a("code",[s._v("int[] []")])])]),s._v(" "),a("h2",{attrs:{id:"堆信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#堆信息"}},[s._v("#")]),s._v(" 堆信息")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("C:\\Users\\Administrator>jmap -heap 13996\nAttaching to process ID 13996, please wait...\nDebugger attached successfully.\nServer compiler detected.\nJVM version is 25.45-b02\n\nusing thread-local object allocation.\nParallel GC with 10 thread(s)\n\nHeap Configuration:\n   MinHeapFreeRatio         = 0\n   MaxHeapFreeRatio         = 100\n   MaxHeapSize              = 8518631424 (8124.0MB)\n   NewSize                  = 177209344 (169.0MB)\n   MaxNewSize               = 2839543808 (2708.0MB)\n   OldSize                  = 355467264 (339.0MB)\n   NewRatio                 = 2\n   SurvivorRatio            = 8\n   MetaspaceSize            = 21807104 (20.796875MB)\n   CompressedClassSpaceSize = 1073741824 (1024.0MB)\n   MaxMetaspaceSize         = 17592186044415 MB\n   G1HeapRegionSize         = 0 (0.0MB)\n\nHeap Usage:\nPS Young Generation\nEden Space:\n   capacity = 362283008 (345.5MB)\n   used     = 101289160 (96.59687042236328MB)\n   free     = 260993848 (248.90312957763672MB)\n   27.958573204736116% used\nFrom Space:\n   capacity = 524288 (0.5MB)\n   used     = 262144 (0.25MB)\n   free     = 262144 (0.25MB)\n   50.0% used\nTo Space:\n   capacity = 524288 (0.5MB)\n   used     = 0 (0.0MB)\n   free     = 524288 (0.5MB)\n   0.0% used\nPS Old Generation\n   capacity = 753401856 (718.5MB)\n   used     = 466897864 (445.2685012817383MB)\n   free     = 286503992 (273.2314987182617MB)\n   61.97195564116051% used\n\n21432 interned Strings occupying 2184104 bytes.\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br")])]),a("blockquote",[a("p",[s._v("JDK9以后换写法了：jhsdb jmap --heap --pid 20092")])]),s._v(" "),a("h2",{attrs:{id:"堆内存快照"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#堆内存快照"}},[s._v("#")]),s._v(" 堆内存快照")]),s._v(" "),a("h3",{attrs:{id:"保存当前时刻的堆内存快照"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#保存当前时刻的堆内存快照"}},[s._v("#")]),s._v(" 保存当前时刻的堆内存快照")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("jmap -dump:format=b,file=eureka.hprof 14660  \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("C:\\Users\\Administrator>jmap -dump:format=b,file=chao.hprof 13996\nDumping heap to C:\\Users\\Administrator\\chao.hprof ...\nHeap dump file created\n\n此时将会当前时刻的堆内存快照保存到文件里了。可以使用工具打开此文件分析。例如jvisualvm\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h3",{attrs:{id:"设置内存溢出时-自动导出快照文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#设置内存溢出时-自动导出快照文件"}},[s._v("#")]),s._v(" 设置内存溢出时，自动导出快照文件")]),s._v(" "),a("p",[s._v("(内存很大的时候，可能会导不出来)")]),s._v(" "),a("ul",[a("li",[s._v("-XX:+HeapDumpOnOutOfMemoryError")]),s._v(" "),a("li",[s._v("-XX:HeapDumpPath=./  （路径）")])]),s._v(" "),a("p",[s._v("示例代码：")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OOMTest")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" list "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ArrayList")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// JVM设置")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// -Xms10M -Xmx10M -XX:+PrintGCDetails -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=D:\\jvm.dump ")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" list "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ArrayList")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" j "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            list"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("User")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("UUID")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("randomUUID")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("toString")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("User")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("j"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("UUID")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("randomUUID")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("toString")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("h3",{attrs:{id:"jvisualvm工具导入快照dump文件分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jvisualvm工具导入快照dump文件分析"}},[s._v("#")]),s._v(" jvisualvm工具导入快照dump文件分析")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("C:\\Users\\Administrator>jvisualvm\n\n输入此命令 jvisualvm 将会打开`Java VisualVM`图形化工具，导入时选择文件类型，选中快照文件导入即可查看堆内存信息\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("blockquote",[a("p",[s._v("JDK8 后不集成 jvisualvm")]),s._v(" "),a("p",[s._v("下载地址：https://visualvm.github.io/download.html")])]),s._v(" "),a("h2",{attrs:{id:"jvisualvm远程连接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jvisualvm远程连接"}},[s._v("#")]),s._v(" jvisualvm远程连接")]),s._v(" "),a("blockquote",[a("p",[s._v("JDK8 后不集成 jvisualvm")]),s._v(" "),a("p",[s._v("下载地址：https://visualvm.github.io/download.html")])]),s._v(" "),a("p",[s._v("启动普通的jar程序JMX端口配置：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("java -Dcom.sun.management.jmxremote.port=8888 \n-Djava.rmi.server.hostname=192.168.65.60\n-Dcom.sun.management.jmxremote.ssl=false \n-Dcom.sun.management.jmxremote.authenticate=false \n-jar microservice-eureka-server.jar \n-Dcom.sun.management.jmxremote.port 为远程机器的JMX端口\n-Djava.rmi.server.hostname 为远程机器IP \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("tomcat的JMX配置：在catalina.sh文件里的最后一个JAVA_OPTS的赋值语句下一行增加如下配置行")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('JAVA_OPTS="$JAVA_OPTS \n-Dcom.sun.management.jmxremote.port=8888 \n-Djava.rmi.server.hostname=192.168.50.60 \n-Dcom.sun.management.jmxremote.ssl=false \n-Dcom.sun.management.jmxremote.authenticate=false"  \n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("连接时确认下端口是否通畅，可以临时关闭下防火墙")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("#临时关闭防火墙   \nsystemctl stop firewalld  \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"jstack"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jstack"}},[s._v("#")]),s._v(" Jstack")]),s._v(" "),a("p",[s._v("用jstack加进程id查找死锁")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("jstack 线程ID\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("如下示例")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DeadLockTest")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" lock1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" lock2 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("lock1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"thread1 begin"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InterruptedException")]),s._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("lock2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"thread1 end"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("lock2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"thread2 begin"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InterruptedException")]),s._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("lock1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"thread2 end"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"main thread end"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("C:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Users"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Administrator"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("jps\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20496")]),s._v(" DeadLockTest\n\nC:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Users"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Administrator"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("jstack "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20496")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-05-06 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":50:57\nFull thread dump Java HotSpot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("TM"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("-Bit Server VM "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25.45")]),s._v("-b02 mixed mode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":\n\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"DestroyJavaVM"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#14 prio=5 os_prio=0 tid=0x00000000035c3800 nid=0x25ac waiting on condition [0x0000000000000000]")]),s._v("\n   java.lang.Thread.State: RUNNABLE\n\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Thread-1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#13 prio=5 os_prio=0 tid=0x00000000297f5000 nid=0x4ccc waiting for monitor entry [0x000000002a44e000]")]),s._v("\n   java.lang.Thread.State: BLOCKED "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("on object monitor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        at DeadLockTest.lambda"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$main")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("scratch_4.java:28"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        - waiting to lock "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("0x00000007171b36f"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a java.lang.Object"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        - locked "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("0x00000007171b370"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a java.lang.Object"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        at DeadLockTest"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$$")]),s._v("Lambda"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$2")]),s._v("/517380410.run"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Unknown Source"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        at java.lang.Thread.run"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Thread.java:745"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Thread-0"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#12 prio=5 os_prio=0 tid=0x00000000297fe800 nid=0x2aa0 waiting for monitor entry [0x000000002a34f000]")]),s._v("\n   java.lang.Thread.State: BLOCKED "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("on object monitor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        at DeadLockTest.lambda"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$main")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("scratch_4.java:15"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        - waiting to lock "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("0x00000007171b370"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a java.lang.Object"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        - locked "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("0x00000007171b36f"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a java.lang.Object"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        at DeadLockTest"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$$")]),s._v("Lambda"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v("/1161082381.run"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Unknown Source"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        at java.lang.Thread.run"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Thread.java:745"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Service Thread"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#11 daemon prio=9 os_prio=0 tid=0x000000002953d800 nid=0x3084 runnable [0x0000000000000000]")]),s._v("\n。。。\n。。。\n。。。\nFound one Java-level deadlock:\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Thread-1"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("\n  waiting to lock monitor 0x00000000266b0dd8 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("object 0x00000007171b36f0, a java.lang.Object"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("which")]),s._v(" is held by "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Thread-0"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Thread-0"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("\n  waiting to lock monitor 0x00000000266b35b8 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("object 0x00000007171b3700, a java.lang.Object"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("which")]),s._v(" is held by "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Thread-1"')]),s._v("\n\nJava stack information "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" the threads listed above:\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Thread-1"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("\n        at DeadLockTest.lambda"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$main")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("scratch_4.java:28"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        - waiting to lock "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("0x00000007171b36f"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a java.lang.Object"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        - locked "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("0x00000007171b370"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a java.lang.Object"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        at DeadLockTest"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$$")]),s._v("Lambda"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$2")]),s._v("/517380410.run"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Unknown Source"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        at java.lang.Thread.run"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Thread.java:745"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Thread-0"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("\n        at DeadLockTest.lambda"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$main")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("scratch_4.java:15"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        - waiting to lock "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("0x00000007171b370"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a java.lang.Object"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        - locked "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("0x00000007171b36f"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a java.lang.Object"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        at DeadLockTest"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$$")]),s._v("Lambda"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v("/1161082381.run"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Unknown Source"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        at java.lang.Thread.run"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Thread.java:745"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nFound "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" deadlock.\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br")])]),a("ul",[a("li",[s._v('"Thread-1" 线程名')]),s._v(" "),a("li",[s._v("prio=5 优先级=5")]),s._v(" "),a("li",[s._v("tid=0x000000001fa9e000 线程id")]),s._v(" "),a("li",[s._v("nid=0x2d64 线程对应的本地线程标识nid")]),s._v(" "),a("li",[s._v("java.lang.Thread.State: BLOCKED 线程状态")])]),s._v(" "),a("p",[s._v("还可以用jvisualvm自动检测死锁")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/tuling1/3.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"jstack找出占用cpu最高的线程堆栈信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jstack找出占用cpu最高的线程堆栈信息"}},[s._v("#")]),s._v(" jstack找出占用cpu最高的线程堆栈信息")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("package")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tuling"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("jvm")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n * 运行此代码，cpu会飙高\n */")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Math")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" initData "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("666")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("User")]),s._v(" user "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("User")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("compute")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//一个方法对应一块栈帧内存区域")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" a "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" b "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" c "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Math")]),s._v(" math "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Math")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            math"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("compute")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br")])]),a("p",[s._v("1.使用命令top -p  ，显示你的java进程的内存情况，pid是你的java进程号，比如19663")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/tuling1/4.png",alt:""}})]),s._v(" "),a("p",[s._v("2.按H，获取每个线程的内存情况")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/tuling1/5.png",alt:""}})]),s._v(" "),a("p",[s._v("3.找到内存和cpu占用最高的线程tid，比如19664")]),s._v(" "),a("p",[s._v("4.19664转为十六进制得到 0x4cd0")]),s._v(" "),a("p",[s._v("5.执行 jstack 19663|grep -A 10 4cd0，得到线程堆栈信息中 4cd0 这个线程所在行的后面10行，从堆栈中可以发现导致cpu飙高的调用方法")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/tuling1/6.png",alt:""}})]),s._v(" "),a("p",[s._v("6.查看对应的堆栈信息找出可能存在问题的代码")]),s._v(" "),a("h2",{attrs:{id:"jinfo"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jinfo"}},[s._v("#")]),s._v(" Jinfo")]),s._v(" "),a("p",[s._v("jinfo属性：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("    -flag <name>         to print the value of the named VM flag\n    -flag [+|-]<name>    to enable or disable the named VM flag\n    -flag <name>=<value> to set the named VM flag to the given value\n    -flags               to print VM flags\n    -sysprops            to print Java system properties\n    <no option>          to print both of the above\n    -h | -help           to print this help message\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("查看正在运行的Java应用程序的扩展参数")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("C:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Users"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Administrator"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("jinfo "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-flags")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5392")]),s._v("\n\nAttaching to process ID "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5392")]),s._v(", please wait"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nDebugger attached successfully.\nServer compiler detected.\nJVM version is "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25.45")]),s._v("-b02\nNon-default VM flags: "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-XX:CICompilerCount")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-XX:InitialHeapSize")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("532676608")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-XX:MaxHeapSize")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8518631424")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-XX:MaxNewSize")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2839543808")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-XX:MinHeapDeltaBytes")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("524288")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-XX:NewSize")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("177209344")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-XX:OldSize")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("355467264")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-XX:+UseCompressedClassPointers")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-XX:+UseCompressedOops")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-XX:+UseFastUnorderedTimeStamps")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-XX:-UseLargePagesIndividualAllocation")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-XX:+UseParallelGC")]),s._v("\nCommand line:  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-agentlib:jdwp")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("transport"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("dt_socket,address"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:59024,suspend"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("y,server"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("n "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-Dlog4j.configurationFile")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("./configuration/log4j2_client.xml -javaagent:C:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Users"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Administrator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("AppData"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Local"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("JetBrains"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("IntelliJIdea2021.3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("captureAgent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("debugger-agent.jar "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-Dfile.encoding")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("GBK\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("查看java系统参数")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("jinfo -sysprops 5392  \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"jstat"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jstat"}},[s._v("#")]),s._v(" Jstat")]),s._v(" "),a("p",[s._v("jstat命令可以查看堆内存各部分的使用量，以及加载类的数量。命令的格式如下：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("jstat [-命令选项] [vmid] [间隔时间(毫秒)] [查询次数]\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("blockquote",[a("p",[s._v("注意：使用的jdk版本是jdk8")])]),s._v(" "),a("h3",{attrs:{id:"jstat属性帮助"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jstat属性帮助"}},[s._v("#")]),s._v(" jstat属性帮助")]),s._v(" "),a("blockquote",[a("p",[s._v("jstat -help")]),s._v(" "),a("p",[s._v("jstat -options")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("C:\\Users\\Administrator>jstat -options\n-class (类加载器) \n-compiler  (JIT) \n-gc  (GC堆状态) \n-gccapacity  (各区大小) \n-gccause  (最近一次GC统计和原因) \n-gcmetacapacity\n-gcnew  (新区统计)\n-gcnewcapacity  (新区大小)\n-gcold  (老区统计)\n-gcoldcapacity (老区大小)\n-gcutil  (GC统计汇总)\n-printcompilation\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("h3",{attrs:{id:"垃圾回收统计"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#垃圾回收统计"}},[s._v("#")]),s._v(" 垃圾回收统计")]),s._v(" "),a("p",[s._v("jstat -gc pid 最常用，可以评估程序内存使用及GC压力整体情况")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("C:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Users"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Administrator"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("jstat "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-gc")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5392")]),s._v("\n S0C    S1C    S0U    S1U      EC       EU        OC         OU       MC     MU    CCSC   CCSU   YGC     YGCT    FGC    FGCT     GCT\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("512.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("512.0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("518144.0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("363046.6")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("621568.0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("414298.9")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("87768.0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("86556.7")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8960.0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8681.8")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("715")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.627")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.210")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.836")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("ul",[a("li",[s._v("S0C：第一个幸存区的大小，单位KB")]),s._v(" "),a("li",[s._v("S1C：第二个幸存区的大小")]),s._v(" "),a("li",[s._v("S0U：第一个幸存区的使用大小")]),s._v(" "),a("li",[s._v("S1U：第二个幸存区的使用大小")]),s._v(" "),a("li",[s._v("EC：伊甸园区的大小")]),s._v(" "),a("li",[s._v("EU：伊甸园区的使用大小")]),s._v(" "),a("li",[s._v("OC：老年代大小")]),s._v(" "),a("li",[s._v("OU：老年代使用大小")]),s._v(" "),a("li",[s._v("MC：方法区大小(元空间)")]),s._v(" "),a("li",[s._v("MU：方法区使用大小")]),s._v(" "),a("li",[s._v("CCSC:压缩类空间大小")]),s._v(" "),a("li",[s._v("CCSU:压缩类空间使用大小")]),s._v(" "),a("li",[s._v("YGC：年轻代垃圾回收次数")]),s._v(" "),a("li",[s._v("YGCT：年轻代垃圾回收消耗时间，单位s")]),s._v(" "),a("li",[s._v("FGC：老年代垃圾回收次数")]),s._v(" "),a("li",[s._v("FGCT：老年代垃圾回收消耗时间，单位s")]),s._v(" "),a("li",[s._v("GCT：垃圾回收消耗总时间，单位s")])]),s._v(" "),a("h3",{attrs:{id:"堆内存统计"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#堆内存统计"}},[s._v("#")]),s._v(" 堆内存统计")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("C:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Users"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Administrator"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("jstat "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-gccapacity")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5392")]),s._v("\n NGCMN    NGCMX     NGC     S0C   S1C       EC      OGCMN      OGCMX       OGC         OC       MCMN     MCMX      MC     CCSMN    CCSMX     CCSC    YGC    FGC\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("173056.0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2772992.0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2772992.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("512.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("512.0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("472576.0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("347136.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5545984.0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("621568.0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("621568.0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1128448.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("87768.0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1048576.0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8960.0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("948")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("ul",[a("li",[s._v("NGCMN：新生代最小容量")]),s._v(" "),a("li",[s._v("NGCMX：新生代最大容量")]),s._v(" "),a("li",[s._v("NGC：当前新生代容量")]),s._v(" "),a("li",[s._v("S0C：第一个幸存区大小")]),s._v(" "),a("li",[s._v("S1C：第二个幸存区的大小")]),s._v(" "),a("li",[s._v("EC：伊甸园区的大小")]),s._v(" "),a("li",[s._v("OGCMN：老年代最小容量")]),s._v(" "),a("li",[s._v("OGCMX：老年代最大容量")]),s._v(" "),a("li",[s._v("OGC：当前老年代大小")]),s._v(" "),a("li",[s._v("OC:当前老年代大小")]),s._v(" "),a("li",[s._v("MCMN:最小元数据容量")]),s._v(" "),a("li",[s._v("MCMX：最大元数据容量")]),s._v(" "),a("li",[s._v("MC：当前元数据空间大小")]),s._v(" "),a("li",[s._v("CCSMN：最小压缩类空间大小")]),s._v(" "),a("li",[s._v("CCSMX：最大压缩类空间大小")]),s._v(" "),a("li",[s._v("CCSC：当前压缩类空间大小")]),s._v(" "),a("li",[s._v("YGC：年轻代gc次数")]),s._v(" "),a("li",[s._v("FGC：老年代GC次数")])]),s._v(" "),a("h3",{attrs:{id:"新生代垃圾回收统计"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#新生代垃圾回收统计"}},[s._v("#")]),s._v(" 新生代垃圾回收统计")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("C:\\Users\\Administrator>jstat -gcnew 5392\n S0C    S1C    S0U    S1U   TT MTT  DSS      EC       EU     YGC     YGCT\n 512.0  512.0  320.0    0.0 15  15  512.0 392704.0 163744.4   4458    8.519\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("ul",[a("li",[s._v("S0C：第一个幸存区的大小")]),s._v(" "),a("li",[s._v("S1C：第二个幸存区的大小")]),s._v(" "),a("li",[s._v("S0U：第一个幸存区的使用大小")]),s._v(" "),a("li",[s._v("S1U：第二个幸存区的使用大小")]),s._v(" "),a("li",[s._v("TT:对象在新生代存活的次数")]),s._v(" "),a("li",[s._v("MTT:对象在新生代存活的最大次数")]),s._v(" "),a("li",[s._v("DSS:期望的幸存区大小")]),s._v(" "),a("li",[s._v("EC：伊甸园区的大小")]),s._v(" "),a("li",[s._v("EU：伊甸园区的使用大小")]),s._v(" "),a("li",[s._v("YGC：年轻代垃圾回收次数")]),s._v(" "),a("li",[s._v("YGCT：年轻代垃圾回收消耗时间")])]),s._v(" "),a("h3",{attrs:{id:"新生代内存统计"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#新生代内存统计"}},[s._v("#")]),s._v(" 新生代内存统计")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("C:\\Users\\Administrator>jstat -gcnewcapacity 5392\n  NGCMN      NGCMX       NGC      S0CMX     S0C     S1CMX     S1C       ECMX        EC      YGC   FGC\n  173056.0  2772992.0  2772992.0 924160.0    512.0 924160.0    512.0  2771968.0   410624.0 13727     3\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("ul",[a("li",[s._v("NGCMN：新生代最小容量")]),s._v(" "),a("li",[s._v("NGCMX：新生代最大容量")]),s._v(" "),a("li",[s._v("NGC：当前新生代容量")]),s._v(" "),a("li",[s._v("S0CMX：最大幸存1区大小")]),s._v(" "),a("li",[s._v("S0C：当前幸存1区大小")]),s._v(" "),a("li",[s._v("S1CMX：最大幸存2区大小")]),s._v(" "),a("li",[s._v("S1C：当前幸存2区大小")]),s._v(" "),a("li",[s._v("ECMX：最大伊甸园区大小")]),s._v(" "),a("li",[s._v("EC：当前伊甸园区大小")]),s._v(" "),a("li",[s._v("YGC：年轻代垃圾回收次数")]),s._v(" "),a("li",[s._v("FGC：老年代回收次数")])]),s._v(" "),a("h3",{attrs:{id:"老年代垃圾回收统计"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#老年代垃圾回收统计"}},[s._v("#")]),s._v(" 老年代垃圾回收统计")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("C:\\Users\\Administrator>jstat  -gcold 5392\n   MC       MU      CCSC     CCSU       OC          OU       YGC    FGC    FGCT     GCT\n 88024.0  86919.2   8960.0   8682.3    621568.0    458165.8  14238     3    0.210   29.343\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("ul",[a("li",[s._v("MC：方法区大小")]),s._v(" "),a("li",[s._v("MU：方法区使用大小")]),s._v(" "),a("li",[s._v("CCSC:压缩类空间大小")]),s._v(" "),a("li",[s._v("CCSU:压缩类空间使用大小")]),s._v(" "),a("li",[s._v("OC：老年代大小")]),s._v(" "),a("li",[s._v("OU：老年代使用大小")]),s._v(" "),a("li",[s._v("YGC：年轻代垃圾回收次数")]),s._v(" "),a("li",[s._v("FGC：老年代垃圾回收次数")]),s._v(" "),a("li",[s._v("FGCT：老年代垃圾回收消耗时间")]),s._v(" "),a("li",[s._v("GCT：垃圾回收消耗总时间")])]),s._v(" "),a("h3",{attrs:{id:"老年代内存统计"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#老年代内存统计"}},[s._v("#")]),s._v(" 老年代内存统计")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("C:\\Users\\Administrator>jstat -gcoldcapacity 5392\n   OGCMN       OGCMX        OGC         OC       YGC   FGC    FGCT     GCT\n   347136.0   5545984.0    621568.0    621568.0 14794     3    0.210   30.391\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("ul",[a("li",[s._v("OGCMN：老年代最小容量")]),s._v(" "),a("li",[s._v("OGCMX：老年代最大容量")]),s._v(" "),a("li",[s._v("OGC：当前老年代大小")]),s._v(" "),a("li",[s._v("OC：老年代大小")]),s._v(" "),a("li",[s._v("YGC：年轻代垃圾回收次数")]),s._v(" "),a("li",[s._v("FGC：老年代垃圾回收次数")]),s._v(" "),a("li",[s._v("FGCT：老年代垃圾回收消耗时间")]),s._v(" "),a("li",[s._v("GCT：垃圾回收消耗总时间")])]),s._v(" "),a("h3",{attrs:{id:"元数据空间统计"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#元数据空间统计"}},[s._v("#")]),s._v(" 元数据空间统计")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("C:\\Users\\Administrator>jstat -gcmetacapacity 21276\n   MCMN       MCMX        MC       CCSMN      CCSMX       CCSC     YGC   FGC    FGCT     GCT\n   0.0  1128448.0    87040.0        0.0  1048576.0     8960.0    29     3    0.212    0.550 \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("ul",[a("li",[s._v("MCMN:最小元数据容量")]),s._v(" "),a("li",[s._v("MCMX：最大元数据容量")]),s._v(" "),a("li",[s._v("MC：当前元数据空间大小")]),s._v(" "),a("li",[s._v("CCSMN：最小压缩类空间大小")]),s._v(" "),a("li",[s._v("CCSMX：最大压缩类空间大小")]),s._v(" "),a("li",[s._v("CCSC：当前压缩类空间大小")]),s._v(" "),a("li",[s._v("YGC：年轻代垃圾回收次数")]),s._v(" "),a("li",[s._v("FGC：老年代垃圾回收次数")]),s._v(" "),a("li",[s._v("FGCT：老年代垃圾回收消耗时间")]),s._v(" "),a("li",[s._v("GCT：垃圾回收消耗总时间")])]),s._v(" "),a("h3",{attrs:{id:"gc统计汇总"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gc统计汇总"}},[s._v("#")]),s._v(" GC统计汇总")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("C:\\Users\\Administrator>jstat -gcutil 21276\n  S0     S1     E      O      M     CCS    YGC     YGCT    FGC    FGCT     GCT\n 81.25   0.00   2.00  77.28  98.76  96.91     68    0.488     3    0.212    0.700\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("ul",[a("li",[s._v("S0：幸存1区当前使用比例")]),s._v(" "),a("li",[s._v("S1：幸存2区当前使用比例")]),s._v(" "),a("li",[s._v("E：伊甸园区使用比例")]),s._v(" "),a("li",[s._v("O：老年代使用比例")]),s._v(" "),a("li",[s._v("M：元数据区使用比例")]),s._v(" "),a("li",[s._v("CCS：压缩使用比例")]),s._v(" "),a("li",[s._v("YGC：年轻代垃圾回收次数")]),s._v(" "),a("li",[s._v("FGC：老年代垃圾回收次数")]),s._v(" "),a("li",[s._v("FGCT：老年代垃圾回收消耗时间")]),s._v(" "),a("li",[s._v("GCT：垃圾回收消耗总时间")])]),s._v(" "),a("h2",{attrs:{id:"jvm运行情况预估"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jvm运行情况预估"}},[s._v("#")]),s._v(" JVM运行情况预估")]),s._v(" "),a("p",[s._v("用 jstat gc -pid 命令可以计算出如下一些关键数据，有了这些数据就可以采用之前介绍过的优化思路，先给自己的系统设置一些初始性的JVM参数，比如堆内存大小，年轻代大小，Eden和Survivor的比例，老年代的大小，大对象的阈值，大龄对象进入老年代的阈值等。")]),s._v(" "),a("h2",{attrs:{id:"年轻代对象增长的速率"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#年轻代对象增长的速率"}},[s._v("#")]),s._v(" 年轻代对象增长的速率")]),s._v(" "),a("p",[s._v("可以执行命令 jstat -gc pid 1000 10 (每隔1秒执行1次命令，共执行10次)，通过观察EU(eden区的使用)来估算每秒eden大概新增多少对象，如果系统负载不高，可以把频率1秒换成1分钟，甚至10分钟来观察整体情况。注意，一般系统可能有高峰期和日常期，所以需要在不同的时间分别估算不同情况下对象增长速率。")]),s._v(" "),a("h2",{attrs:{id:"young-gc的触发频率和每次耗时"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#young-gc的触发频率和每次耗时"}},[s._v("#")]),s._v(" Young GC的触发频率和每次耗时")]),s._v(" "),a("p",[s._v("知道年轻代对象增长速率我们就能推根据eden区的大小推算出Young GC大概多久触发一次，Young GC的平均耗时可以通过 YGCT/YGC 公式算出，根据结果我们大概就能知道系统大概多久会因为Young GC的执行而卡顿多久。")]),s._v(" "),a("p",[s._v("每次Young GC后有多少对象存活和进入老年代")]),s._v(" "),a("p",[s._v("这个因为之前已经大概知道Young GC的频率，假设是每5分钟一次，那么可以执行命令 jstat -gc pid 300000 10 ，观察每次结果eden，survivor和老年代使用的变化情况，在每次gc后eden区使用一般会大幅减少，survivor和老年代都有可能增长，这些增长的对象就是每次Young GC后存活的对象，同时还可以看出每次Young GC后进去老年代大概多少对象，从而可以推算出老年代对象增长速率。")]),s._v(" "),a("h2",{attrs:{id:"full-gc的触发频率和每次耗时"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#full-gc的触发频率和每次耗时"}},[s._v("#")]),s._v(" Full GC的触发频率和每次耗时")]),s._v(" "),a("p",[s._v("知道了老年代对象的增长速率就可以推算出Full GC的触发频率了，Full GC的每次耗时可以用公式 FGCT/FGC 计算得出。")]),s._v(" "),a("p",[s._v("优化思路其实简单来说就是尽量让每次Young GC后的存活对象小于Survivor区域的50%，都留存在年轻代里。尽量别让对象进入老年代。尽量减少Full GC的频率，避免频繁Full GC对JVM性能的影响。")]),s._v(" "),a("h2",{attrs:{id:"系统频繁full-gc导致系统卡顿是怎么回事"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#系统频繁full-gc导致系统卡顿是怎么回事"}},[s._v("#")]),s._v(" 系统频繁Full GC导致系统卡顿是怎么回事")]),s._v(" "),a("ul",[a("li",[s._v("机器配置：2核4G")]),s._v(" "),a("li",[s._v("JVM内存大小：2G")]),s._v(" "),a("li",[s._v("系统运行时间：7天")]),s._v(" "),a("li",[s._v("期间发生的Full GC次数和耗时：500多次，200多秒")]),s._v(" "),a("li",[s._v("期间发生的Young GC次数和耗时：1万多次，500多秒")])]),s._v(" "),a("p",[s._v("大致算下来每天会发生70多次Full GC，平均每小时3次，每次Full GC在400毫秒左右；")]),s._v(" "),a("p",[s._v("每天会发生1000多次Young GC，每分钟会发生1次，每次Young GC在50毫秒左右。")]),s._v(" "),a("p",[s._v("JVM参数设置如下：")]),s._v(" "),a("blockquote",[a("p",[s._v("-Xms1536M -Xmx1536M -Xmn512M -Xss256K -XX:SurvivorRatio=6  -XX:MetaspaceSize=256M -XX:MaxMetaspaceSize=256M  -XX:+UseParNewGC  -XX:+UseConcMarkSweepGC  -XX:CMSInitiatingOccupancyFraction=75 -XX:+UseCMSInitiatingOccupancyOnly")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/tuling3/7.png",alt:""}})]),s._v(" "),a("p",[s._v("大家可以结合对象挪动到老年代那些规则推理下我们这个程序可能存在的一些问题")]),s._v(" "),a("p",[s._v("经过分析感觉可能会由于对象动态年龄判断机制导致full gc较为频繁")]),s._v(" "),a("p",[s._v("模拟了一个示例程序，打印了jstat的结果如下：")]),s._v(" "),a("blockquote",[a("p",[s._v("jstat -gc 13456 2000 10000")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/tuling3/8.png",alt:""}})]),s._v(" "),a("p",[s._v("对于对象动态年龄判断机制导致的full gc较为频繁可以先试着优化下JVM参数，把年轻代适当调大点：")]),s._v(" "),a("blockquote",[a("p",[s._v("-Xms1536M -Xmx1536M -Xmn1024M -Xss256K -XX:SurvivorRatio=6  -XX:MetaspaceSize=256M -XX:MaxMetaspaceSize=256M  -XX:+UseParNewGC  -XX:+UseConcMarkSweepGC  -XX:CMSInitiatingOccupancyFraction=92 -XX:+UseCMSInitiatingOccupancyOnly")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/tuling3/9.png",alt:""}})]),s._v(" "),a("p",[s._v("优化完发现没什么变化，full gc的次数比minor gc的次数还多了")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/tuling3/10.png",alt:""}})]),s._v(" "),a("p",[s._v("我们可以推测下full gc比minor gc还多的原因有哪些？")]),s._v(" "),a("blockquote",[a("p",[s._v("1、元空间不够导致的多余full gc")]),s._v(" "),a("p",[s._v("2、显示调用System.gc()造成多余的full gc，这种一般线上尽量通过-XX:+DisableExplicitGC参数禁用，如果加上了这个JVM启动参数，那么代码中调用System.gc()没有任何效果")]),s._v(" "),a("p",[s._v("3、老年代空间分配担保机制")])]),s._v(" "),a("p",[s._v("最快速度分析完这些我们推测的原因以及优化后，我们发现young gc和full gc依然很频繁了，而且看到有大量的对象频繁的被挪动到老年代，这种情况我们可以借助jmap命令大概看下是什么对象")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/tuling3/11.png",alt:""}})]),s._v(" "),a("p",[s._v("查到了有大量User对象产生，这个可能是问题所在，但不确定，还必须找到对应的代码确认，如何去找对应的代码了？")]),s._v(" "),a("blockquote",[a("p",[s._v("1、代码里全文搜索生成User对象的地方(适合只有少数几处地方的情况)")]),s._v(" "),a("p",[s._v("2、如果生成User对象的地方太多，无法定位具体代码，我们可以同时分析下占用cpu较高的线程，一般有大量对象不断产生，对应的方法代码肯定会被频繁调用，占用的cpu必然较高")])]),s._v(" "),a("p",[s._v("可以用上面讲过的jstack或jvisualvm来定位cpu使用较高的代码，最终定位到的代码如下：")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token import"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("java"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("util"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ArrayList")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@RestController")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IndexController")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n   "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@RequestMapping")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/user/process"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("processUserData")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InterruptedException")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ArrayList")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("User")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" users "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("queryUsers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n       "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("User")]),s._v(" user "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" users"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n           "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//TODO 业务处理")]),s._v("\n           "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"user:"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("toString")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"end"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n    * 模拟批量查询用户场景\n    *\n    * @return\n    */")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ArrayList")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("User")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("queryUsers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ArrayList")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("User")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" users "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ArrayList")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n           users"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("User")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"zhuge"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" users"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br")])]),a("p",[s._v("同时，java的代码也是需要优化的，一次查询出500M的对象出来，明显不合适，要根据之前说的各种原则尽量优化到合适的值，尽量消除这种朝生夕死的对象导致的full gc")]),s._v(" "),a("h2",{attrs:{id:"内存泄露到底是怎么回事"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#内存泄露到底是怎么回事"}},[s._v("#")]),s._v(" 内存泄露到底是怎么回事")]),s._v(" "),a("p",[s._v("再给大家讲一种情况，一般电商架构可能会使用多级缓存架构，就是redis加上JVM级缓存，大多数同学可能为了图方便对于JVM级缓存就简单使用一个hashmap，于是不断往里面放缓存数据，但是很少考虑这个map的容量问题，结果这个缓存map越来越大，一直占用着老年代的很多空间，时间长了就会导致full gc非常频繁，这就是一种内存泄漏，对于一些老旧数据没有及时清理导致一直占用着宝贵的内存资源，时间长了除了导致full gc，还有可能导致OOM。")]),s._v(" "),a("p",[s._v("这种情况完全可以考虑采用一些成熟的JVM级缓存框架来解决，比如ehcache等自带一些LRU数据淘汰算法的框架来作为JVM级的缓存。")])])}),[],!1,null,null,null);a.default=e.exports}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{358:function(n,s,a){"use strict";a.r(s);var e=a(1),t=Object(e.a)({},(function(){var n=this,s=n._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[s("h2",{attrs:{id:"实现目标"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实现目标"}},[n._v("#")]),n._v(" 实现目标")]),n._v(" "),s("p",[n._v('<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:cov="http://www.test.com/lmc/cov">\n'),s("strong",[n._v("添加自定义头部")]),n._v('：xmlns:cov="http://www.test.com/lmc/cov"')]),n._v(" "),s("h2",{attrs:{id:"_1-feign配置encoder-实现soap支持自定义头部"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-feign配置encoder-实现soap支持自定义头部"}},[n._v("#")]),n._v(" 1.feign配置Encoder，实现SOAP支持自定义头部")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('import feign.codec.Decoder;\nimport feign.codec.EncodeException;\nimport feign.codec.Encoder;\nimport feign.jaxb.JAXBContextFactory;\nimport feign.soap.SOAPDecoder;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.context.annotation.Bean;\nimport org.w3c.dom.Document;\n\nimport javax.xml.bind.JAXBException;\nimport javax.xml.bind.Marshaller;\nimport javax.xml.parsers.DocumentBuilderFactory;\nimport javax.xml.parsers.ParserConfigurationException;\nimport javax.xml.soap.MessageFactory;\nimport javax.xml.soap.SOAPEnvelope;\nimport javax.xml.soap.SOAPException;\nimport javax.xml.soap.SOAPMessage;\nimport javax.xml.transform.TransformerFactoryConfigurationError;\nimport java.io.ByteArrayOutputStream;\nimport java.io.IOException;\nimport java.nio.charset.Charset;\nimport java.nio.charset.StandardCharsets;\n\nimport static javax.xml.soap.SOAPConstants.DEFAULT_SOAP_PROTOCOL;\n\n@Slf4j\npublic class CovFeignClientConfiguration {\n\n    private Charset charsetEncoding = StandardCharsets.UTF_8;\n    private String soapProtocol = DEFAULT_SOAP_PROTOCOL;\n\n    private static final JAXBContextFactory jaxbContextFactory = new JAXBContextFactory.Builder()\n            .withMarshallerJAXBEncoding("UTF-8")\n            .build();\n\n    @Bean\n    public Encoder feignEncoder() {\n        return (object, bodyType, template) -> {\n            if (!(bodyType instanceof Class)) {\n                throw new UnsupportedOperationException(\n                        "SOAP only supports encoding raw types. Found " + bodyType);\n            }\n            try {\n                Document document = DocumentBuilderFactory.newInstance().newDocumentBuilder().newDocument();\n                Marshaller marshaller = jaxbContextFactory.createMarshaller((Class<?>) bodyType);\n                marshaller.marshal(object, document);\n                SOAPMessage soapMessage = MessageFactory.newInstance(soapProtocol).createMessage();\n                SOAPEnvelope soapEnvelope = soapMessage.getSOAPPart().getEnvelope();\n                soapEnvelope.addNamespaceDeclaration("cov", "http://www.test.com/lmc/cov");\n                soapMessage.setProperty(SOAPMessage.CHARACTER_SET_ENCODING, charsetEncoding.displayName());\n                soapMessage.getSOAPBody().addDocument(document);\n                ByteArrayOutputStream bos = new ByteArrayOutputStream();\n                soapMessage.writeTo(bos);\n                template.body(new String(bos.toByteArray()).replaceAll("CovRequest", "cov:CovRequest"));\n            } catch (SOAPException | JAXBException | ParserConfigurationException | IOException | TransformerFactoryConfigurationError e) {\n                throw new EncodeException(e.toString(), e);\n            }\n        };\n    }\n\n    @Bean\n    public Decoder feignDecoder() {\n        return new SOAPDecoder(jaxbContextFactory);\n    }\n}\n\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br"),s("span",{staticClass:"line-number"},[n._v("35")]),s("br"),s("span",{staticClass:"line-number"},[n._v("36")]),s("br"),s("span",{staticClass:"line-number"},[n._v("37")]),s("br"),s("span",{staticClass:"line-number"},[n._v("38")]),s("br"),s("span",{staticClass:"line-number"},[n._v("39")]),s("br"),s("span",{staticClass:"line-number"},[n._v("40")]),s("br"),s("span",{staticClass:"line-number"},[n._v("41")]),s("br"),s("span",{staticClass:"line-number"},[n._v("42")]),s("br"),s("span",{staticClass:"line-number"},[n._v("43")]),s("br"),s("span",{staticClass:"line-number"},[n._v("44")]),s("br"),s("span",{staticClass:"line-number"},[n._v("45")]),s("br"),s("span",{staticClass:"line-number"},[n._v("46")]),s("br"),s("span",{staticClass:"line-number"},[n._v("47")]),s("br"),s("span",{staticClass:"line-number"},[n._v("48")]),s("br"),s("span",{staticClass:"line-number"},[n._v("49")]),s("br"),s("span",{staticClass:"line-number"},[n._v("50")]),s("br"),s("span",{staticClass:"line-number"},[n._v("51")]),s("br"),s("span",{staticClass:"line-number"},[n._v("52")]),s("br"),s("span",{staticClass:"line-number"},[n._v("53")]),s("br"),s("span",{staticClass:"line-number"},[n._v("54")]),s("br"),s("span",{staticClass:"line-number"},[n._v("55")]),s("br"),s("span",{staticClass:"line-number"},[n._v("56")]),s("br"),s("span",{staticClass:"line-number"},[n._v("57")]),s("br"),s("span",{staticClass:"line-number"},[n._v("58")]),s("br"),s("span",{staticClass:"line-number"},[n._v("59")]),s("br"),s("span",{staticClass:"line-number"},[n._v("60")]),s("br"),s("span",{staticClass:"line-number"},[n._v("61")]),s("br"),s("span",{staticClass:"line-number"},[n._v("62")]),s("br"),s("span",{staticClass:"line-number"},[n._v("63")]),s("br"),s("span",{staticClass:"line-number"},[n._v("64")]),s("br"),s("span",{staticClass:"line-number"},[n._v("65")]),s("br"),s("span",{staticClass:"line-number"},[n._v("66")]),s("br")])]),s("h2",{attrs:{id:"_2-使用地方通过-configuration-引入即可"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-使用地方通过-configuration-引入即可"}},[n._v("#")]),n._v(" 2.使用地方通过‘configuration’引入即可")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('import com.lenovo.quotation.config.feign.CovFeignClientConfiguration;\nimport com.lenovo.quotation.service.dto.covrequest.CovFeignResult;\nimport com.lenovo.quotation.service.dto.covrequest.CovResult;\nimport org.springframework.cloud.openfeign.FeignClient;\nimport org.springframework.http.MediaType;\nimport org.springframework.web.bind.annotation.PostMapping;\nimport org.springframework.web.bind.annotation.RequestMapping;\n\n@FeignClient(name = "test", configuration = {CovFeignClientConfiguration.class}, url = "${test.host}")\n@RequestMapping("/v1.0")\npublic interface TestFeignClient {\n    @PostMapping(value = "/test", consumes = { MediaType.TEXT_XML_VALUE }, produces = MediaType.TEXT_XML_VALUE)\n    TestFeignResult sendTestBody(TestResult testResult);\n}\n\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br")])]),s("h2",{attrs:{id:"_3-接口调用示例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-接口调用示例"}},[n._v("#")]),n._v(" 3.接口调用示例")]),n._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/20191123204308725.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2JhaW9mY2hhbw==,size_16,color_FFFFFF,t_70",alt:"在这里插入图片描述"}}),n._v(" "),s("img",{attrs:{src:"https://img-blog.csdnimg.cn/20191123204325383.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2JhaW9mY2hhbw==,size_16,color_FFFFFF,t_70",alt:"在这里插入图片描述"}})]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:cov="http://www.test.com/lmc/cov">\n<soapenv:Header/>\n<soapenv:Body>\n<cov:CovRequest source="test">\n<BuildEntity Build="test">\n    \n</BuildEntity>\n</cov:CovRequest>\n</soapenv:Body>\n</soapenv:Envelope> \n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br")])]),s("h2",{attrs:{id:"_4-对于soap里面的内容"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-对于soap里面的内容"}},[n._v("#")]),n._v(" 4.对于SOAP里面的内容")]),n._v(" "),s("p",[n._v("参考：\njavax.xml.bind.annotation包下用法：\n@XmlRootElement\n@XmlAttribute\n@XmlElement")])])}),[],!1,null,null,null);s.default=t.exports}}]);
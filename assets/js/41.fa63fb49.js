(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{409:function(s,e,n){"use strict";n.r(e);var a=n(5),t=Object(a.a)({},(function(){var s=this,e=s._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("p",[s._v("ğŸ€  â›„ï¸  ğŸ€")]),s._v(" "),e("h2",{attrs:{id:"redisä¸»ä»æ¶æ„"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#redisä¸»ä»æ¶æ„"}},[s._v("#")]),s._v(" Redisä¸»ä»æ¶æ„")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/redis/2.png",alt:""}})]),s._v(" "),e("p",[s._v("ä¸»èŠ‚ç‚¹-å†™æ•°æ®")]),s._v(" "),e("p",[s._v("ä»èŠ‚ç‚¹-åªè¯»")]),s._v(" "),e("h3",{attrs:{id:"redisä¸»ä»æ¶æ„æ­å»º"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#redisä¸»ä»æ¶æ„æ­å»º"}},[s._v("#")]),s._v(" Redisä¸»ä»æ¶æ„æ­å»º")]),s._v(" "),e("p",[e("strong",[s._v("redisä¸»ä»æ¶æ„æ­å»ºï¼Œé…ç½®ä»èŠ‚ç‚¹æ­¥éª¤ï¼š")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('1ã€å¤åˆ¶ä¸€ä»½redis.confæ–‡ä»¶\n\n2ã€å°†ç›¸å…³é…ç½®ä¿®æ”¹ä¸ºå¦‚ä¸‹å€¼ï¼š\nport 6380\npidfile /var/run/redis_6380.pid  # æŠŠpidè¿›ç¨‹å·å†™å…¥pidfileé…ç½®çš„æ–‡ä»¶\nlogfile "6380.log"\ndir /usr/local/redis-5.0.3/data/6380  # æŒ‡å®šæ•°æ®å­˜æ”¾ç›®å½•\n# éœ€è¦æ³¨é‡Šæ‰bind\n# bind 127.0.0.1ï¼ˆbindç»‘å®šçš„æ˜¯è‡ªå·±æœºå™¨ç½‘å¡çš„ipï¼Œå¦‚æœæœ‰å¤šå—ç½‘å¡å¯ä»¥é…å¤šä¸ªipï¼Œä»£è¡¨å…è®¸å®¢æˆ·ç«¯é€šè¿‡æœºå™¨çš„å“ªäº›ç½‘å¡ipå»è®¿é—®ï¼Œå†…ç½‘ä¸€èˆ¬å¯ä»¥ä¸é…ç½®bindï¼Œæ³¨é‡Šæ‰å³å¯ï¼‰\n\n3ã€é…ç½®ä¸»ä»å¤åˆ¶\nreplicaof 192.168.0.60 6379   # ä»æœ¬æœº6379çš„rediså®ä¾‹å¤åˆ¶æ•°æ®ï¼ŒRedis 5.0ä¹‹å‰ä½¿ç”¨slaveof\nreplica-read-only yes  # é…ç½®ä»èŠ‚ç‚¹åªè¯»\n\n4ã€å¯åŠ¨ä»èŠ‚ç‚¹\nredis-server redis.conf\n\n5ã€è¿æ¥ä»èŠ‚ç‚¹\nredis-cli -p 6380\n\n6ã€æµ‹è¯•åœ¨6379å®ä¾‹ä¸Šå†™æ•°æ®ï¼Œ6380å®ä¾‹æ˜¯å¦èƒ½åŠæ—¶åŒæ­¥æ–°ä¿®æ”¹æ•°æ®\n\n7ã€å¯ä»¥è‡ªå·±å†é…ç½®ä¸€ä¸ª6381çš„ä»èŠ‚ç‚¹\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br")])]),e("h3",{attrs:{id:"redisä¸»ä»å·¥ä½œåŸç†"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#redisä¸»ä»å·¥ä½œåŸç†"}},[s._v("#")]),s._v(" "),e("strong",[s._v("Redisä¸»ä»å·¥ä½œåŸç†")])]),s._v(" "),e("p",[s._v("å¦‚æœä½ ä¸ºmasteré…ç½®äº†ä¸€ä¸ªslaveï¼Œä¸ç®¡è¿™ä¸ªslaveæ˜¯å¦æ˜¯ç¬¬ä¸€æ¬¡è¿æ¥ä¸ŠMasterï¼Œå®ƒéƒ½ä¼šå‘é€ä¸€ä¸ª"),e("strong",[s._v("PSYNC")]),s._v("å‘½ä»¤ç»™masterè¯·æ±‚å¤åˆ¶æ•°æ®ã€‚")]),s._v(" "),e("p",[s._v("masteræ”¶åˆ°PSYNCå‘½ä»¤åï¼Œä¼šåœ¨åå°è¿›è¡Œæ•°æ®æŒä¹…åŒ–é€šè¿‡bgsaveç”Ÿæˆæœ€æ–°çš„rdbå¿«ç…§æ–‡ä»¶ï¼ŒæŒä¹…åŒ–æœŸé—´ï¼Œmasterä¼šç»§ç»­æ¥æ”¶å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œå®ƒä¼šæŠŠè¿™äº›å¯èƒ½ä¿®æ”¹æ•°æ®é›†çš„è¯·æ±‚ç¼“å­˜åœ¨å†…å­˜ä¸­ã€‚å½“æŒä¹…åŒ–è¿›è¡Œå®Œæ¯•ä»¥åï¼Œmasterä¼šæŠŠè¿™ä»½rdbæ–‡ä»¶æ•°æ®é›†å‘é€ç»™slaveï¼Œslaveä¼šæŠŠæ¥æ”¶åˆ°çš„æ•°æ®è¿›è¡ŒæŒä¹…åŒ–ç”Ÿæˆrdbï¼Œç„¶åå†åŠ è½½åˆ°å†…å­˜ä¸­ã€‚ç„¶åï¼Œmasterå†å°†ä¹‹å‰ç¼“å­˜åœ¨å†…å­˜ä¸­çš„å‘½ä»¤å‘é€ç»™slaveã€‚")]),s._v(" "),e("p",[s._v("å½“masterä¸slaveä¹‹é—´çš„è¿æ¥ç”±äºæŸäº›åŸå› è€Œæ–­å¼€æ—¶ï¼Œslaveèƒ½å¤Ÿè‡ªåŠ¨é‡è¿Masterï¼Œå¦‚æœmasteræ”¶åˆ°äº†å¤šä¸ªslaveå¹¶å‘è¿æ¥è¯·æ±‚ï¼Œå®ƒåªä¼šè¿›è¡Œä¸€æ¬¡æŒä¹…åŒ–ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªè¿æ¥ä¸€æ¬¡ï¼Œç„¶åå†æŠŠè¿™ä¸€ä»½æŒä¹…åŒ–çš„æ•°æ®å‘é€ç»™å¤šä¸ªå¹¶å‘è¿æ¥çš„slaveã€‚")]),s._v(" "),e("p",[e("strong",[s._v("ä¸»ä»å¤åˆ¶(å…¨é‡å¤åˆ¶)æµç¨‹å›¾ï¼š")])]),s._v(" "),e("p",[e("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/redis/3.png",alt:""}})]),s._v(" "),e("blockquote",[e("p",[s._v("2.1 æ­¥éª¤ä½¿ç”¨åˆ°RDBæ–¹å¼ï¼Œæ˜¯redisåº•å±‚æ–¹å¼ï¼Œä¸é…ç½®æ–‡ä»¶å¼€å¯/ä¸å¼€å¯RDBé…ç½®æ— å…³")]),s._v(" "),e("p",[s._v("7 æ˜¯é€šè¿‡ç½‘ç»œå°†å‘½ä»¤ä¼ è¾“åˆ°ä»æœåŠ¡å™¨ã€‚ä¸AOFä¹Ÿæ²¡æœ‰ä»»ä½•å…³ç³»")])]),s._v(" "),e("p",[e("strong",[s._v("æ•°æ®éƒ¨åˆ†å¤åˆ¶")])]),s._v(" "),e("p",[s._v("å½“masterå’Œslaveæ–­å¼€é‡è¿åï¼Œä¸€èˆ¬éƒ½ä¼šå¯¹æ•´ä»½æ•°æ®è¿›è¡Œå¤åˆ¶ã€‚ä½†ä»redis2.8ç‰ˆæœ¬å¼€å§‹ï¼Œredisæ”¹ç”¨å¯ä»¥æ”¯æŒéƒ¨åˆ†æ•°æ®å¤åˆ¶çš„å‘½ä»¤PSYNCå»masteråŒæ­¥æ•°æ®ï¼Œslaveä¸masterèƒ½å¤Ÿåœ¨ç½‘ç»œè¿æ¥æ–­å¼€é‡è¿ååªè¿›è¡Œéƒ¨åˆ†æ•°æ®å¤åˆ¶("),e("strong",[s._v("æ–­ç‚¹ç»­ä¼ ")]),s._v(")ã€‚")]),s._v(" "),e("p",[s._v("masterä¼šåœ¨å…¶å†…å­˜ä¸­åˆ›å»ºä¸€ä¸ªå¤åˆ¶æ•°æ®ç”¨çš„ç¼“å­˜é˜Ÿåˆ—ï¼Œç¼“å­˜æœ€è¿‘ä¸€æ®µæ—¶é—´çš„æ•°æ®ï¼Œmasterå’Œå®ƒæ‰€æœ‰çš„slaveéƒ½ç»´æŠ¤äº†å¤åˆ¶çš„æ•°æ®ä¸‹æ ‡offsetå’Œmasterçš„è¿›ç¨‹idï¼Œå› æ­¤ï¼Œå½“ç½‘ç»œè¿æ¥æ–­å¼€åï¼Œslaveä¼šè¯·æ±‚masterç»§ç»­è¿›è¡Œæœªå®Œæˆçš„å¤åˆ¶ï¼Œä»æ‰€è®°å½•çš„æ•°æ®ä¸‹æ ‡å¼€å§‹ã€‚å¦‚æœmasterè¿›ç¨‹idå˜åŒ–äº†ï¼Œæˆ–è€…ä»èŠ‚ç‚¹æ•°æ®ä¸‹æ ‡offsetå¤ªæ—§ï¼Œå·²ç»ä¸åœ¨masterçš„ç¼“å­˜é˜Ÿåˆ—é‡Œäº†ï¼Œé‚£ä¹ˆå°†ä¼šè¿›è¡Œä¸€æ¬¡å…¨é‡æ•°æ®çš„å¤åˆ¶ã€‚")]),s._v(" "),e("p",[e("strong",[s._v("ä¸»ä»å¤åˆ¶(éƒ¨åˆ†å¤åˆ¶ï¼Œæ–­ç‚¹ç»­ä¼ )æµç¨‹å›¾ï¼š")])]),s._v(" "),e("p",[e("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/redis/4.png",alt:""}})]),s._v(" "),e("blockquote",[e("p",[s._v("repl backlog bufferï¼šredis.configé»˜è®¤ç¼“å­˜åŒºå¤§å°æ˜¯1Mï¼Œå¦‚æœslaveç»“ç‚¹é•¿æ—¶é—´æŒ‚æ‰ï¼Œè€Œæ•°æ®ä¸åœçš„å‘ç¼“å­˜åŒºå­˜æ”¾ï¼Œä¼šå¯¼è‡´offsetåç§»é‡åœ¨ç¼“å­˜åŒºï¼ˆrepl backlog bufferï¼‰é‡Œæ‰¾ä¸åˆ°ã€‚è¿›è€Œè§¦å‘å…¨é‡åŒæ­¥ã€‚")])]),s._v(" "),e("p",[s._v("å¦‚æœæœ‰å¾ˆå¤šä»èŠ‚ç‚¹ï¼Œä¸ºäº†ç¼“è§£"),e("strong",[s._v("ä¸»ä»å¤åˆ¶é£æš´")]),s._v("(å¤šä¸ªä»èŠ‚ç‚¹åŒæ—¶å¤åˆ¶ä¸»èŠ‚ç‚¹å¯¼è‡´ä¸»èŠ‚ç‚¹å‹åŠ›è¿‡å¤§)ï¼Œå¯ä»¥åšå¦‚ä¸‹æ¶æ„ï¼Œè®©éƒ¨åˆ†ä»èŠ‚ç‚¹ä¸ä»èŠ‚ç‚¹(ä¸ä¸»èŠ‚ç‚¹åŒæ­¥)åŒæ­¥æ•°æ®")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/redis/6.png",alt:""}})]),s._v(" "),e("p",[e("strong",[s._v("Jedisè¿æ¥ä»£ç ç¤ºä¾‹ï¼š")])]),s._v(" "),e("p",[s._v("1ã€å¼•å…¥ç›¸å…³ä¾èµ–ï¼š")]),s._v(" "),e("div",{staticClass:"language-html line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-html"}},[e("code",[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("redis.clients"),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("jedis"),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("version")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("2.9.0"),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("version")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependency")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[s._v("è®¿é—®ä»£ç ï¼š")]),s._v(" "),e("div",{staticClass:"language-java line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-java"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("JedisSingleTest")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IOException")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n        "),e("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("JedisPoolConfig")]),s._v(" jedisPoolConfig "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("JedisPoolConfig")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        jedisPoolConfig"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("setMaxTotal")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        jedisPoolConfig"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("setMaxIdle")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        jedisPoolConfig"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("setMinIdle")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// timeoutï¼Œè¿™é‡Œæ—¢æ˜¯è¿æ¥è¶…æ—¶åˆæ˜¯è¯»å†™è¶…æ—¶ï¼Œä»Jedis 2.8å¼€å§‹æœ‰åŒºåˆ†connectionTimeoutå’ŒsoTimeoutçš„æ„é€ å‡½æ•°")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("JedisPool")]),s._v(" jedisPool "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("JedisPool")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("jedisPoolConfig"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.0.60"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),e("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Jedis")]),s._v(" jedis "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//ä»redisè¿æ¥æ± é‡Œæ‹¿å‡ºä¸€ä¸ªè¿æ¥æ‰§è¡Œå‘½ä»¤")]),s._v("\n            jedis "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" jedisPool"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("getResource")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n            "),e("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("jedis"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("set")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"single"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"zhuge"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),e("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("jedis"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"single"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n            "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//ç®¡é“ç¤ºä¾‹")]),s._v("\n            "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//ç®¡é“çš„å‘½ä»¤æ‰§è¡Œæ–¹å¼ï¼šcat redis.txt | redis-cli -h 127.0.0.1 -a password - p 6379 --pipe")]),s._v("\n            "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v('/*Pipeline pl = jedis.pipelined();\n            for (int i = 0; i < 10; i++) {\n                pl.incr("pipelineKey");\n                pl.set("zhuge" + i, "zhuge");\n            }\n            List<Object> results = pl.syncAndReturnAll();\n            System.out.println(results);*/')]),s._v("\n\n            "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//luaè„šæœ¬æ¨¡æ‹Ÿä¸€ä¸ªå•†å“å‡åº“å­˜çš„åŸå­æ“ä½œ")]),s._v("\n            "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//luaè„šæœ¬å‘½ä»¤æ‰§è¡Œæ–¹å¼ï¼šredis-cli --eval /tmp/test.lua , 10")]),s._v("\n            "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v('/*jedis.set("product_count_10016", "15");  //åˆå§‹åŒ–å•†å“10016çš„åº“å­˜\n            String script = " local count = redis.call(\'get\', KEYS[1]) " +\n                            " local a = tonumber(count) " +\n                            " local b = tonumber(ARGV[1]) " +\n                            " if a >= b then " +\n                            "   redis.call(\'set\', KEYS[1], a-b) " +\n                            "   return 1 " +\n                            " end " +\n                            " return 0 ";\n            Object obj = jedis.eval(script, Arrays.asList("product_count_10016"), Arrays.asList("10"));\n            System.out.println(obj);*/')]),s._v("\n\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" e"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            e"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("printStackTrace")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//æ³¨æ„è¿™é‡Œä¸æ˜¯å…³é—­è¿æ¥ï¼Œåœ¨JedisPoolæ¨¡å¼ä¸‹ï¼ŒJedisä¼šè¢«å½’è¿˜ç»™èµ„æºæ± ã€‚")]),s._v("\n            "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("jedis "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                jedis"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("close")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br"),e("span",{staticClass:"line-number"},[s._v("51")]),e("br"),e("span",{staticClass:"line-number"},[s._v("52")]),e("br")])]),e("h2",{attrs:{id:"rediså“¨å…µæ¶æ„"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#rediså“¨å…µæ¶æ„"}},[s._v("#")]),s._v(" Rediså“¨å…µæ¶æ„")]),s._v(" "),e("p",[s._v("é›†ç¾¤æ­å»ºé…ç½®æ–‡ä»¶ç¤ºä¾‹ï¼š"),e("code",[s._v("https://gitee.com/nylg/picture/tree/master/file/%E5%93%A8%E5%85%B5%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE%E7%A4%BA%E4%BE%8B")])]),s._v(" "),e("hr"),s._v(" "),e("p",[s._v("â€‹    "),e("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/redis/7.png",alt:""}})]),s._v(" "),e("p",[s._v("sentinelå“¨å…µæ˜¯ç‰¹æ®Šçš„redisæœåŠ¡ï¼Œä¸æä¾›è¯»å†™æœåŠ¡ï¼Œä¸»è¦ç”¨æ¥ç›‘æ§rediså®ä¾‹èŠ‚ç‚¹ã€‚")]),s._v(" "),e("p",[s._v("å“¨å…µæ¶æ„ä¸‹clientç«¯ç¬¬ä¸€æ¬¡ä»å“¨å…µæ‰¾å‡ºredisçš„ä¸»èŠ‚ç‚¹ï¼Œåç»­å°±ç›´æ¥è®¿é—®redisçš„ä¸»èŠ‚ç‚¹ï¼Œä¸ä¼šæ¯æ¬¡éƒ½é€šè¿‡sentinelä»£ç†è®¿é—®redisçš„ä¸»èŠ‚ç‚¹ï¼Œå½“redisçš„ä¸»èŠ‚ç‚¹å‘ç”Ÿå˜åŒ–ï¼Œå“¨å…µä¼šç¬¬ä¸€æ—¶é—´æ„ŸçŸ¥åˆ°ï¼Œå¹¶ä¸”å°†æ–°çš„redisä¸»èŠ‚ç‚¹é€šçŸ¥ç»™clientç«¯(è¿™é‡Œé¢redisçš„clientç«¯ä¸€èˆ¬éƒ½å®ç°äº†è®¢é˜…åŠŸèƒ½ï¼Œè®¢é˜…sentinelå‘å¸ƒçš„èŠ‚ç‚¹å˜åŠ¨æ¶ˆæ¯)")]),s._v(" "),e("blockquote",[e("p",[s._v("åœ¨redis3.0ä»¥å‰çš„ç‰ˆæœ¬è¦å®ç°é›†ç¾¤ä¸€èˆ¬æ˜¯å€ŸåŠ©å“¨å…µsentinelå·¥å…·æ¥ç›‘æ§masterèŠ‚ç‚¹çš„çŠ¶æ€ï¼Œå¦‚æœmasterèŠ‚ç‚¹å¼‚å¸¸ï¼Œåˆ™ä¼šåšä¸»ä»åˆ‡æ¢ï¼Œå°†æŸä¸€å°slaveä½œä¸ºmasterï¼Œå“¨å…µçš„é…ç½®ç•¥å¾®å¤æ‚ï¼Œå¹¶ä¸”æ€§èƒ½å’Œé«˜å¯ç”¨æ€§ç­‰å„æ–¹é¢è¡¨ç°ä¸€èˆ¬ï¼Œç‰¹åˆ«æ˜¯åœ¨ä¸»ä»åˆ‡æ¢çš„ç¬é—´å­˜åœ¨è®¿é—®ç¬æ–­çš„æƒ…å†µï¼Œè€Œä¸”å“¨å…µæ¨¡å¼åªæœ‰ä¸€ä¸ªä¸»èŠ‚ç‚¹å¯¹å¤–æä¾›æœåŠ¡ï¼Œæ²¡æ³•æ”¯æŒå¾ˆé«˜çš„å¹¶å‘ï¼Œä¸”å•ä¸ªä¸»èŠ‚ç‚¹å†…å­˜ä¹Ÿä¸å®œè®¾ç½®å¾—è¿‡å¤§ï¼Œå¦åˆ™ä¼šå¯¼è‡´æŒä¹…åŒ–æ–‡ä»¶è¿‡å¤§ï¼Œå½±å“æ•°æ®æ¢å¤æˆ–ä¸»ä»åŒæ­¥çš„æ•ˆç‡ã€‚")])]),s._v(" "),e("p",[e("strong",[s._v("rediså“¨å…µæ¶æ„æ­å»ºæ­¥éª¤ï¼š")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('1ã€å¤åˆ¶ä¸€ä»½sentinel.confæ–‡ä»¶\ncp sentinel.conf sentinel-26379.conf\n\n2ã€å°†ç›¸å…³é…ç½®ä¿®æ”¹ä¸ºå¦‚ä¸‹å€¼ï¼š\nport 26379\ndaemonize yes\npidfile "/var/run/redis-sentinel-26379.pid"\nlogfile "26379.log"\ndir "/usr/local/redis-5.0.3/data"\n# sentinel monitor <master-redis-name> <master-redis-ip> <master-redis-port> <quorum>\n# quorumæ˜¯ä¸€ä¸ªæ•°å­—ï¼ŒæŒ‡æ˜å½“æœ‰å¤šå°‘ä¸ªsentinelè®¤ä¸ºä¸€ä¸ªmasterå¤±æ•ˆæ—¶(å€¼ä¸€èˆ¬ä¸ºï¼šsentinelæ€»æ•°/2 + 1)ï¼Œmasteræ‰ç®—çœŸæ­£å¤±æ•ˆ\nsentinel monitor mymaster 192.168.0.60 6379 2   # mymasterè¿™ä¸ªåå­—éšä¾¿å–ï¼Œå®¢æˆ·ç«¯è®¿é—®æ—¶ä¼šç”¨åˆ°\n\n3ã€å¯åŠ¨sentinelå“¨å…µå®ä¾‹\nsrc/redis-sentinel sentinel-26379.conf\n\n4ã€æŸ¥çœ‹sentinelçš„infoä¿¡æ¯\nsrc/redis-cli -p 26379\n127.0.0.1:26379>info\nå¯ä»¥çœ‹åˆ°Sentinelçš„infoé‡Œå·²ç»è¯†åˆ«å‡ºäº†redisçš„ä¸»ä»\n\n5ã€å¯ä»¥è‡ªå·±å†é…ç½®ä¸¤ä¸ªsentinelï¼Œç«¯å£26380å’Œ26381ï¼Œæ³¨æ„ä¸Šè¿°é…ç½®æ–‡ä»¶é‡Œçš„å¯¹åº”æ•°å­—éƒ½è¦ä¿®æ”¹\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br")])]),e("p",[s._v("sentinelé›†ç¾¤éƒ½å¯åŠ¨å®Œæ¯•åï¼Œä¼šå°†å“¨å…µé›†ç¾¤çš„å…ƒæ•°æ®ä¿¡æ¯å†™å…¥æ‰€æœ‰sentinelçš„é…ç½®æ–‡ä»¶é‡Œå»(è¿½åŠ åœ¨æ–‡ä»¶çš„æœ€ä¸‹é¢)ï¼Œæˆ‘ä»¬æŸ¥çœ‹ä¸‹å¦‚ä¸‹é…ç½®æ–‡ä»¶sentinel-26379.confï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("sentinel known-replica mymaster 192.168.0.60 6380 #ä»£è¡¨redisä¸»èŠ‚ç‚¹çš„ä»èŠ‚ç‚¹ä¿¡æ¯\nsentinel known-replica mymaster 192.168.0.60 6381 #ä»£è¡¨redisä¸»èŠ‚ç‚¹çš„ä»èŠ‚ç‚¹ä¿¡æ¯\nsentinel known-sentinel mymaster 192.168.0.60 26380 52d0a5d70c1f90475b4fc03b6ce7c3c56935760f  #ä»£è¡¨æ„ŸçŸ¥åˆ°çš„å…¶å®ƒå“¨å…µèŠ‚ç‚¹\nsentinel known-sentinel mymaster 192.168.0.60 26381 e9f530d3882f8043f76ebb8e1686438ba8bd5ca6  #ä»£è¡¨æ„ŸçŸ¥åˆ°çš„å…¶å®ƒå“¨å…µèŠ‚ç‚¹\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[s._v("å½“redisä¸»èŠ‚ç‚¹å¦‚æœæŒ‚äº†ï¼Œå“¨å…µé›†ç¾¤ä¼šé‡æ–°é€‰ä¸¾å‡ºæ–°çš„redisä¸»èŠ‚ç‚¹ï¼ŒåŒæ—¶ä¼šä¿®æ”¹æ‰€æœ‰sentinelèŠ‚ç‚¹é…ç½®æ–‡ä»¶çš„é›†ç¾¤å…ƒæ•°æ®ä¿¡æ¯ï¼Œæ¯”å¦‚6379çš„rediså¦‚æœæŒ‚äº†ï¼Œå‡è®¾é€‰ä¸¾å‡ºçš„æ–°ä¸»èŠ‚ç‚¹æ˜¯6380ï¼Œåˆ™sentinelæ–‡ä»¶é‡Œçš„é›†ç¾¤å…ƒæ•°æ®ä¿¡æ¯ä¼šå˜æˆå¦‚ä¸‹æ‰€ç¤ºï¼š")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("sentinel known-replica mymaster 192.168.0.60 6379 #ä»£è¡¨ä¸»èŠ‚ç‚¹çš„ä»èŠ‚ç‚¹ä¿¡æ¯\nsentinel known-replica mymaster 192.168.0.60 6381 #ä»£è¡¨ä¸»èŠ‚ç‚¹çš„ä»èŠ‚ç‚¹ä¿¡æ¯\nsentinel known-sentinel mymaster 192.168.0.60 26380 52d0a5d70c1f90475b4fc03b6ce7c3c56935760f  #ä»£è¡¨æ„ŸçŸ¥åˆ°çš„å…¶å®ƒå“¨å…µèŠ‚ç‚¹\nsentinel known-sentinel mymaster 192.168.0.60 26381 e9f530d3882f8043f76ebb8e1686438ba8bd5ca6  #ä»£è¡¨æ„ŸçŸ¥åˆ°çš„å…¶å®ƒå“¨å…µèŠ‚\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[s._v("åŒæ—¶è¿˜ä¼šä¿®æ”¹sentinelæ–‡ä»¶é‡Œä¹‹å‰é…ç½®çš„mymasterå¯¹åº”çš„6379ç«¯å£ï¼Œæ”¹ä¸º6380")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("sentinel monitor mymaster 192.168.0.60 6380 2              \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("å½“6379çš„rediså®ä¾‹å†æ¬¡å¯åŠ¨æ—¶ï¼Œå“¨å…µé›†ç¾¤æ ¹æ®é›†ç¾¤å…ƒæ•°æ®ä¿¡æ¯å°±å¯ä»¥å°†6379ç«¯å£çš„redisèŠ‚ç‚¹ä½œä¸ºä»èŠ‚ç‚¹åŠ å…¥é›†ç¾¤")]),s._v(" "),e("p",[s._v("å“¨å…µçš„Jedisè¿æ¥ä»£ç ï¼š")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('public class JedisSentinelTest {\n    public static void main(String[] args) throws IOException {\n\n        JedisPoolConfig config = new JedisPoolConfig();\n        config.setMaxTotal(20);\n        config.setMaxIdle(10);\n        config.setMinIdle(5);\n\n        String masterName = "mymaster";\n        Set<String> sentinels = new HashSet<String>();\n        sentinels.add(new HostAndPort("192.168.0.60",26379).toString());\n        sentinels.add(new HostAndPort("192.168.0.60",26380).toString());\n        sentinels.add(new HostAndPort("192.168.0.60",26381).toString());\n        //JedisSentinelPoolå…¶å®æœ¬è´¨è·ŸJedisPoolç±»ä¼¼ï¼Œéƒ½æ˜¯ä¸redisä¸»èŠ‚ç‚¹å»ºç«‹çš„è¿æ¥æ± \n        //JedisSentinelPoolå¹¶ä¸æ˜¯è¯´ä¸sentinelå»ºç«‹çš„è¿æ¥æ± ï¼Œè€Œæ˜¯é€šè¿‡sentinelå‘ç°redisä¸»èŠ‚ç‚¹å¹¶ä¸å…¶å»ºç«‹è¿æ¥\n        JedisSentinelPool jedisSentinelPool = new JedisSentinelPool(masterName, sentinels, config, 3000, null);\n        Jedis jedis = null;\n        try {\n            jedis = jedisSentinelPool.getResource();\n            System.out.println(jedis.set("sentinel", "zhuge"));\n            System.out.println(jedis.get("sentinel"));\n        } catch (Exception e) {\n            e.printStackTrace();\n        } finally {\n            //æ³¨æ„è¿™é‡Œä¸æ˜¯å…³é—­è¿æ¥ï¼Œåœ¨JedisPoolæ¨¡å¼ä¸‹ï¼ŒJedisä¼šè¢«å½’è¿˜ç»™èµ„æºæ± ã€‚\n            if (jedis != null)\n                jedis.close();\n        }\n    }\n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br")])]),e("p",[s._v("â€‹")]),s._v(" "),e("p",[s._v("å“¨å…µçš„Spring Bootæ•´åˆRedisè¿æ¥ä»£ç è§ç¤ºä¾‹é¡¹ç›®ï¼šredis-sentinel-cluster")]),s._v(" "),e("p",[s._v("1ã€å¼•å…¥ç›¸å…³ä¾èµ–ï¼š")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("<dependency>\n   <groupId>org.springframework.boot</groupId>\n   <artifactId>spring-boot-starter-data-redis</artifactId>\n</dependency>\n\n<dependency>\n   <groupId>org.apache.commons</groupId>\n   <artifactId>commons-pool2</artifactId>\n</dependency>\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("p",[s._v("springbooté¡¹ç›®æ ¸å¿ƒé…ç½®ï¼š")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("server:\n  port: 8080\n\nspring:\n  redis:\n    database: 0\n    timeout: 3000\n    sentinel:    #å“¨å…µæ¨¡å¼\n      master: mymaster #ä¸»æœåŠ¡å™¨æ‰€åœ¨é›†ç¾¤åç§°\n     nodes: 192.168.0.60:26379,192.168.0.60:26380,192.168.0.60:26381\n   lettuce:\n      pool:\n        max-idle: 50\n        min-idle: 10\n        max-active: 100\n        max-wait: 1000\n \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br")])]),e("p",[s._v("â€‹")]),s._v(" "),e("p",[s._v("è®¿é—®ä»£ç ï¼š")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('@RestController\npublic class IndexController {\n\n    private static final Logger logger = LoggerFactory.getLogger(IndexController.class);\n\n    @Autowired\n    private StringRedisTemplate stringRedisTemplate;\n\n    /**\n     * æµ‹è¯•èŠ‚ç‚¹æŒ‚äº†å“¨å…µé‡æ–°é€‰ä¸¾æ–°çš„masterèŠ‚ç‚¹ï¼Œå®¢æˆ·ç«¯æ˜¯å¦èƒ½åŠ¨æ€æ„ŸçŸ¥åˆ°\n     * æ–°çš„masteré€‰ä¸¾å‡ºæ¥åï¼Œå“¨å…µä¼šæŠŠæ¶ˆæ¯å‘å¸ƒå‡ºå»ï¼Œå®¢æˆ·ç«¯å®é™…ä¸Šæ˜¯å®ç°äº†ä¸€ä¸ªæ¶ˆæ¯ç›‘å¬æœºåˆ¶ï¼Œ\n     * å½“å“¨å…µæŠŠæ–°masterçš„æ¶ˆæ¯å‘å¸ƒå‡ºå»ï¼Œå®¢æˆ·ç«¯ä¼šç«‹é©¬æ„ŸçŸ¥åˆ°æ–°masterçš„ä¿¡æ¯ï¼Œä»è€ŒåŠ¨æ€åˆ‡æ¢è®¿é—®çš„masterip\n     *\n     * @throws InterruptedException\n     */\n    @RequestMapping("/test_sentinel")\n    public void testSentinel() throws InterruptedException {\n        int i = 1;\n        while (true){\n            try {\n                stringRedisTemplate.opsForValue().set("zhuge"+i, i+"");\n                System.out.println("è®¾ç½®keyï¼š"+ "zhuge" + i);\n                i++;\n                Thread.sleep(1000);\n            }catch (Exception e){\n                logger.error("é”™è¯¯ï¼š", e);\n            }\n        }\n    }\n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br")])]),e("h2",{attrs:{id:"redisé›†ç¾¤æ¶æ„"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#redisé›†ç¾¤æ¶æ„"}},[s._v("#")]),s._v(" Redisé›†ç¾¤æ¶æ„")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/redis/41.png",alt:""}})]),s._v(" "),e("p",[e("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/redis/image-20210829140644530.png",alt:"image-20210829140644530"}})]),s._v(" "),e("p",[s._v("redisé›†ç¾¤æ˜¯ä¸€ä¸ªç”±å¤šä¸ªä¸»ä»èŠ‚ç‚¹ç¾¤ç»„æˆçš„åˆ†å¸ƒå¼æœåŠ¡å™¨ç¾¤ï¼Œå®ƒå…·æœ‰å¤åˆ¶ã€é«˜å¯ç”¨å’Œåˆ†ç‰‡ç‰¹æ€§ã€‚Redisé›†ç¾¤ä¸éœ€è¦sentinelå“¨å…µÂ·ä¹Ÿèƒ½å®ŒæˆèŠ‚ç‚¹ç§»é™¤å’Œæ•…éšœè½¬ç§»çš„åŠŸèƒ½ã€‚éœ€è¦å°†æ¯ä¸ªèŠ‚ç‚¹è®¾ç½®æˆé›†ç¾¤æ¨¡å¼ï¼Œè¿™ç§é›†ç¾¤æ¨¡å¼æ²¡æœ‰ä¸­å¿ƒèŠ‚ç‚¹ï¼Œå¯æ°´å¹³æ‰©å±•ï¼Œæ®å®˜æ–¹æ–‡æ¡£ç§°å¯ä»¥çº¿æ€§æ‰©å±•åˆ°ä¸Šä¸‡ä¸ªèŠ‚ç‚¹("),e("strong",[s._v("å®˜æ–¹æ¨èä¸è¶…è¿‡1000ä¸ªèŠ‚ç‚¹")]),s._v(")ã€‚redisé›†ç¾¤çš„æ€§èƒ½å’Œé«˜å¯ç”¨æ€§å‡ä¼˜äºä¹‹å‰ç‰ˆæœ¬çš„å“¨å…µæ¨¡å¼ï¼Œä¸”é›†ç¾¤é…ç½®éå¸¸ç®€å•")]),s._v(" "),e("h3",{attrs:{id:"redisé›†ç¾¤åŸç†"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#redisé›†ç¾¤åŸç†"}},[s._v("#")]),s._v(" Redisé›†ç¾¤åŸç†")]),s._v(" "),e("blockquote",[e("p",[s._v("è¯»å†™éƒ½æ˜¯ç”¨ä¸»èŠ‚ç‚¹ã€‚ä»èŠ‚ç‚¹ä»…ä»…ç”¨æ¥å€™é€‰ï¼ˆæ›¿ä»£æŒ‚æ‰çš„ä¸»èŠ‚ç‚¹ï¼‰ï¼Œå¤‡ä»½")])]),s._v(" "),e("p",[s._v("Redis Cluster å°†æ‰€æœ‰æ•°æ®åˆ’åˆ†ä¸º 16384 ä¸ª slots(æ§½ä½)ï¼Œæ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£å…¶ä¸­ä¸€éƒ¨åˆ†æ§½ä½ã€‚æ§½ä½çš„ä¿¡æ¯å­˜å‚¨äºæ¯ä¸ªèŠ‚ç‚¹ä¸­ã€‚")]),s._v(" "),e("p",[s._v("å½“ Redis Cluster çš„å®¢æˆ·ç«¯æ¥è¿æ¥é›†ç¾¤æ—¶ï¼Œå®ƒä¹Ÿä¼šå¾—åˆ°ä¸€ä»½é›†ç¾¤çš„æ§½ä½é…ç½®ä¿¡æ¯å¹¶å°†å…¶ç¼“å­˜åœ¨å®¢æˆ·ç«¯æœ¬åœ°ã€‚è¿™æ ·å½“å®¢æˆ·ç«¯è¦æŸ¥æ‰¾æŸä¸ª key æ—¶ï¼Œå¯ä»¥ç›´æ¥å®šä½åˆ°ç›®æ ‡èŠ‚ç‚¹ã€‚åŒæ—¶å› ä¸ºæ§½ä½çš„ä¿¡æ¯å¯èƒ½ä¼šå­˜åœ¨å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¸ä¸€è‡´çš„æƒ…å†µï¼Œè¿˜éœ€è¦çº æ­£æœºåˆ¶æ¥å®ç°æ§½ä½ä¿¡æ¯çš„æ ¡éªŒè°ƒæ•´ã€‚")]),s._v(" "),e("p",[e("strong",[s._v("æ§½ä½å®šä½ç®—æ³•")])]),s._v(" "),e("p",[s._v("Cluster é»˜è®¤ä¼šå¯¹ key å€¼ä½¿ç”¨ crc16 ç®—æ³•è¿›è¡Œ hash å¾—åˆ°ä¸€ä¸ªæ•´æ•°å€¼ï¼Œç„¶åç”¨è¿™ä¸ªæ•´æ•°å€¼å¯¹ 16384 è¿›è¡Œå–æ¨¡æ¥å¾—åˆ°å…·ä½“æ§½ä½ã€‚")]),s._v(" "),e("p",[s._v("HASH_SLOT = CRC16(key) mod 16384")]),s._v(" "),e("p",[e("strong",[s._v("è·³è½¬é‡å®šä½")])]),s._v(" "),e("p",[s._v("å½“å®¢æˆ·ç«¯å‘ä¸€ä¸ªé”™è¯¯çš„èŠ‚ç‚¹å‘å‡ºäº†æŒ‡ä»¤ï¼Œè¯¥èŠ‚ç‚¹ä¼šå‘ç°æŒ‡ä»¤çš„ key æ‰€åœ¨çš„æ§½ä½å¹¶ä¸å½’è‡ªå·±ç®¡ç†ï¼Œè¿™æ—¶å®ƒä¼šå‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªç‰¹æ®Šçš„è·³è½¬æŒ‡ä»¤æºå¸¦ç›®æ ‡æ“ä½œçš„èŠ‚ç‚¹åœ°å€ï¼Œå‘Šè¯‰å®¢æˆ·ç«¯å»è¿è¿™ä¸ªèŠ‚ç‚¹å»è·å–æ•°æ®ã€‚å®¢æˆ·ç«¯æ”¶åˆ°æŒ‡ä»¤åé™¤äº†è·³è½¬åˆ°æ­£ç¡®çš„èŠ‚ç‚¹ä¸Šå»æ“ä½œï¼Œè¿˜ä¼šåŒæ­¥æ›´æ–°çº æ­£æœ¬åœ°çš„æ§½ä½æ˜ å°„è¡¨ç¼“å­˜ï¼Œåç»­æ‰€æœ‰ key å°†ä½¿ç”¨æ–°çš„æ§½ä½æ˜ å°„è¡¨ã€‚")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/redis/42.png",alt:""}})]),s._v(" "),e("p",[e("strong",[s._v("Redisé›†ç¾¤èŠ‚ç‚¹é—´çš„é€šä¿¡æœºåˆ¶")])]),s._v(" "),e("p",[s._v("redis clusterèŠ‚ç‚¹é—´é‡‡å–gossipåè®®è¿›è¡Œé€šä¿¡")]),s._v(" "),e("ul",[e("li",[s._v("ç»´æŠ¤é›†ç¾¤çš„å…ƒæ•°æ®(é›†ç¾¤èŠ‚ç‚¹ä¿¡æ¯ï¼Œä¸»ä»è§’è‰²ï¼ŒèŠ‚ç‚¹æ•°é‡ï¼Œå„èŠ‚ç‚¹å…±äº«çš„æ•°æ®ç­‰)æœ‰ä¸¤ç§æ–¹å¼ï¼šé›†ä¸­å¼å’Œgossip")])]),s._v(" "),e("p",[e("strong",[s._v("é›†ä¸­å¼ï¼š")])]),s._v(" "),e("p",[s._v("ä¼˜ç‚¹åœ¨äºå…ƒæ•°æ®çš„æ›´æ–°å’Œè¯»å–ï¼Œæ—¶æ•ˆæ€§éå¸¸å¥½ï¼Œä¸€æ—¦å…ƒæ•°æ®å‡ºç°å˜æ›´ç«‹å³å°±ä¼šæ›´æ–°åˆ°é›†ä¸­å¼çš„å­˜å‚¨ä¸­ï¼Œå…¶ä»–èŠ‚ç‚¹è¯»å–çš„æ—¶å€™ç«‹å³å°±å¯ä»¥ç«‹å³æ„ŸçŸ¥åˆ°ï¼›ä¸è¶³åœ¨äºæ‰€æœ‰çš„å…ƒæ•°æ®çš„æ›´æ–°å‹åŠ›å…¨éƒ¨é›†ä¸­åœ¨ä¸€ä¸ªåœ°æ–¹ï¼Œå¯èƒ½å¯¼è‡´å…ƒæ•°æ®çš„å­˜å‚¨å‹åŠ›ã€‚ å¾ˆå¤šä¸­é—´ä»¶éƒ½ä¼šå€ŸåŠ©zookeeperé›†ä¸­å¼å­˜å‚¨å…ƒæ•°æ®ã€‚")]),s._v(" "),e("p",[e("strong",[s._v("gossipï¼š")])]),s._v(" "),e("p",[e("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/redis/44.gif",alt:""}})]),s._v(" "),e("p",[s._v("gossipåè®®åŒ…å«å¤šç§æ¶ˆæ¯ï¼ŒåŒ…æ‹¬pingï¼Œpongï¼Œmeetï¼Œfailç­‰ç­‰ã€‚")]),s._v(" "),e("p",[s._v("meetï¼šæŸä¸ªèŠ‚ç‚¹å‘é€meetç»™æ–°åŠ å…¥çš„èŠ‚ç‚¹ï¼Œè®©æ–°èŠ‚ç‚¹åŠ å…¥é›†ç¾¤ä¸­ï¼Œç„¶åæ–°èŠ‚ç‚¹å°±ä¼šå¼€å§‹ä¸å…¶ä»–èŠ‚ç‚¹è¿›è¡Œé€šä¿¡ï¼›")]),s._v(" "),e("p",[s._v("pingï¼šæ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šé¢‘ç¹ç»™å…¶ä»–èŠ‚ç‚¹å‘é€pingï¼Œå…¶ä¸­åŒ…å«è‡ªå·±çš„çŠ¶æ€è¿˜æœ‰è‡ªå·±ç»´æŠ¤çš„é›†ç¾¤å…ƒæ•°æ®ï¼Œäº’ç›¸é€šè¿‡pingäº¤æ¢å…ƒæ•°æ®(ç±»ä¼¼è‡ªå·±æ„ŸçŸ¥åˆ°çš„é›†ç¾¤èŠ‚ç‚¹å¢åŠ å’Œç§»é™¤ï¼Œhash slotä¿¡æ¯ç­‰)ï¼›")]),s._v(" "),e("p",[s._v("pong: å¯¹pingå’Œmeetæ¶ˆæ¯çš„è¿”å›ï¼ŒåŒ…å«è‡ªå·±çš„çŠ¶æ€å’Œå…¶ä»–ä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥ç”¨äºä¿¡æ¯å¹¿æ’­å’Œæ›´æ–°ï¼›")]),s._v(" "),e("p",[s._v("fail: æŸä¸ªèŠ‚ç‚¹åˆ¤æ–­å¦ä¸€ä¸ªèŠ‚ç‚¹failä¹‹åï¼Œå°±å‘é€failç»™å…¶ä»–èŠ‚ç‚¹ï¼Œé€šçŸ¥å…¶ä»–èŠ‚ç‚¹ï¼ŒæŒ‡å®šçš„èŠ‚ç‚¹å®•æœºäº†ã€‚")]),s._v(" "),e("p",[s._v("gossipåè®®çš„ä¼˜ç‚¹åœ¨äºå…ƒæ•°æ®çš„æ›´æ–°æ¯”è¾ƒåˆ†æ•£ï¼Œä¸æ˜¯é›†ä¸­åœ¨ä¸€ä¸ªåœ°æ–¹ï¼Œæ›´æ–°è¯·æ±‚ä¼šé™†é™†ç»­ç»­ï¼Œæ‰“åˆ°æ‰€æœ‰èŠ‚ç‚¹ä¸Šå»æ›´æ–°ï¼Œæœ‰ä¸€å®šçš„å»¶æ—¶ï¼Œé™ä½äº†å‹åŠ›ï¼›ç¼ºç‚¹åœ¨äºå…ƒæ•°æ®æ›´æ–°æœ‰å»¶æ—¶å¯èƒ½å¯¼è‡´é›†ç¾¤çš„ä¸€äº›æ“ä½œä¼šæœ‰ä¸€äº›æ»åã€‚")]),s._v(" "),e("p",[e("strong",[s._v("gossipé€šä¿¡çš„10000ç«¯å£")])]),s._v(" "),e("p",[s._v("æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªä¸“é—¨ç”¨äºèŠ‚ç‚¹é—´gossipé€šä¿¡çš„ç«¯å£ï¼Œå°±æ˜¯è‡ªå·±æä¾›æœåŠ¡çš„ç«¯å£å·+10000ï¼Œæ¯”å¦‚7001ï¼Œé‚£ä¹ˆç”¨äºèŠ‚ç‚¹é—´é€šä¿¡çš„å°±æ˜¯17001ç«¯å£ã€‚ æ¯ä¸ªèŠ‚ç‚¹æ¯éš”ä¸€æ®µæ—¶é—´éƒ½ä¼šå¾€å¦å¤–å‡ ä¸ªèŠ‚ç‚¹å‘é€pingæ¶ˆæ¯ï¼ŒåŒæ—¶å…¶ä»–å‡ ç‚¹æ¥æ”¶åˆ°pingæ¶ˆæ¯ä¹‹åè¿”å›pongæ¶ˆæ¯ã€‚")]),s._v(" "),e("p",[e("strong",[s._v("ç½‘ç»œæŠ–åŠ¨")])]),s._v(" "),e("p",[s._v("çœŸå®ä¸–ç•Œçš„æœºæˆ¿ç½‘ç»œå¾€å¾€å¹¶ä¸æ˜¯é£å¹³æµªé™çš„ï¼Œå®ƒä»¬ç»å¸¸ä¼šå‘ç”Ÿå„ç§å„æ ·çš„å°é—®é¢˜ã€‚æ¯”å¦‚ç½‘ç»œæŠ–åŠ¨å°±æ˜¯éå¸¸å¸¸è§çš„ä¸€ç§ç°è±¡ï¼Œçªç„¶ä¹‹é—´éƒ¨åˆ†è¿æ¥å˜å¾—ä¸å¯è®¿é—®ï¼Œç„¶åå¾ˆå¿«åˆæ¢å¤æ­£å¸¸ã€‚")]),s._v(" "),e("p",[s._v("ä¸ºè§£å†³è¿™ç§é—®é¢˜ï¼ŒRedis Cluster æä¾›äº†ä¸€ç§é€‰é¡¹cluster-node-timeoutï¼Œè¡¨ç¤ºå½“æŸä¸ªèŠ‚ç‚¹æŒç»­ timeout çš„æ—¶é—´å¤±è”æ—¶ï¼Œæ‰å¯ä»¥è®¤å®šè¯¥èŠ‚ç‚¹å‡ºç°æ•…éšœï¼Œéœ€è¦è¿›è¡Œä¸»ä»åˆ‡æ¢ã€‚å¦‚æœæ²¡æœ‰è¿™ä¸ªé€‰é¡¹ï¼Œç½‘ç»œæŠ–åŠ¨ä¼šå¯¼è‡´ä¸»ä»é¢‘ç¹åˆ‡æ¢ (æ•°æ®çš„é‡æ–°å¤åˆ¶)ã€‚")]),s._v(" "),e("p",[e("strong",[s._v("Redisé›†ç¾¤é€‰ä¸¾åŸç†åˆ†æ")])]),s._v(" "),e("p",[s._v("å½“slaveå‘ç°è‡ªå·±çš„masterå˜ä¸ºFAILçŠ¶æ€æ—¶ï¼Œä¾¿å°è¯•è¿›è¡ŒFailoverï¼Œä»¥æœŸæˆä¸ºæ–°çš„masterã€‚ç”±äºæŒ‚æ‰çš„masterå¯èƒ½ä¼šæœ‰å¤šä¸ªslaveï¼Œä»è€Œå­˜åœ¨å¤šä¸ªslaveç«äº‰æˆä¸ºmasterèŠ‚ç‚¹çš„è¿‡ç¨‹ï¼Œ å…¶è¿‡ç¨‹å¦‚ä¸‹ï¼š")]),s._v(" "),e("p",[s._v("1.slaveå‘ç°è‡ªå·±çš„masterå˜ä¸ºFAIL")]),s._v(" "),e("p",[s._v("2.å°†è‡ªå·±è®°å½•çš„é›†ç¾¤currentEpochåŠ 1ï¼Œå¹¶å¹¿æ’­FAILOVER_AUTH_REQUEST ä¿¡æ¯")]),s._v(" "),e("p",[s._v("3.å…¶ä»–èŠ‚ç‚¹æ”¶åˆ°è¯¥ä¿¡æ¯ï¼Œåªæœ‰masterå“åº”ï¼Œåˆ¤æ–­è¯·æ±‚è€…çš„åˆæ³•æ€§ï¼Œå¹¶å‘é€FAILOVER_AUTH_ACKï¼Œå¯¹æ¯ä¸€ä¸ªepochåªå‘é€ä¸€æ¬¡ack")]),s._v(" "),e("p",[s._v("4.å°è¯•failoverçš„slaveæ”¶é›†masterè¿”å›çš„FAILOVER_AUTH_ACK")]),s._v(" "),e("p",[s._v("5.slaveæ”¶åˆ°è¶…è¿‡åŠæ•°masterçš„ackåå˜æˆæ–°Master(è¿™é‡Œè§£é‡Šäº†é›†ç¾¤ä¸ºä»€ä¹ˆè‡³å°‘éœ€è¦ä¸‰ä¸ªä¸»èŠ‚ç‚¹ï¼Œå¦‚æœåªæœ‰ä¸¤ä¸ªï¼Œå½“å…¶ä¸­ä¸€ä¸ªæŒ‚äº†ï¼Œåªå‰©ä¸€ä¸ªä¸»èŠ‚ç‚¹æ˜¯ä¸èƒ½é€‰ä¸¾æˆåŠŸçš„)")]),s._v(" "),e("p",[s._v("6.slaveå¹¿æ’­Pongæ¶ˆæ¯é€šçŸ¥å…¶ä»–é›†ç¾¤èŠ‚ç‚¹ã€‚")]),s._v(" "),e("p",[s._v("ä»èŠ‚ç‚¹å¹¶ä¸æ˜¯åœ¨ä¸»èŠ‚ç‚¹ä¸€è¿›å…¥ FAIL çŠ¶æ€å°±é©¬ä¸Šå°è¯•å‘èµ·é€‰ä¸¾ï¼Œè€Œæ˜¯æœ‰ä¸€å®šå»¶è¿Ÿï¼Œä¸€å®šçš„å»¶è¿Ÿç¡®ä¿æˆ‘ä»¬ç­‰å¾…FAILçŠ¶æ€åœ¨é›†ç¾¤ä¸­ä¼ æ’­ï¼Œslaveå¦‚æœç«‹å³å°è¯•é€‰ä¸¾ï¼Œå…¶å®ƒmastersæˆ–è®¸å°šæœªæ„è¯†åˆ°FAILçŠ¶æ€ï¼Œå¯èƒ½ä¼šæ‹’ç»æŠ•ç¥¨")]),s._v(" "),e("p",[s._v("â€¢å»¶è¿Ÿè®¡ç®—å…¬å¼ï¼š")]),s._v(" "),e("p",[s._v("DELAY = 500ms + random(0 ~ 500ms) + SLAVE_RANK * 1000ms")]),s._v(" "),e("p",[s._v("â€¢SLAVE_RANKè¡¨ç¤ºæ­¤slaveå·²ç»ä»masterå¤åˆ¶æ•°æ®çš„æ€»é‡çš„rankã€‚Rankè¶Šå°ä»£è¡¨å·²å¤åˆ¶çš„æ•°æ®è¶Šæ–°ã€‚è¿™ç§æ–¹å¼ä¸‹ï¼ŒæŒæœ‰æœ€æ–°æ•°æ®çš„slaveå°†ä¼šé¦–å…ˆå‘èµ·é€‰ä¸¾ï¼ˆç†è®ºä¸Šï¼‰ã€‚")]),s._v(" "),e("p",[e("strong",[s._v("é›†ç¾¤è„‘è£‚æ•°æ®ä¸¢å¤±é—®é¢˜")])]),s._v(" "),e("p",[s._v("redisé›†ç¾¤æ²¡æœ‰è¿‡åŠæœºåˆ¶ä¼šæœ‰è„‘è£‚é—®é¢˜ï¼Œç½‘ç»œåˆ†åŒºå¯¼è‡´è„‘è£‚åå¤šä¸ªä¸»èŠ‚ç‚¹å¯¹å¤–æä¾›å†™æœåŠ¡ï¼Œä¸€æ—¦ç½‘ç»œåˆ†åŒºæ¢å¤ï¼Œä¼šå°†å…¶ä¸­ä¸€ä¸ªä¸»èŠ‚ç‚¹å˜ä¸ºä»èŠ‚ç‚¹ï¼Œè¿™æ—¶ä¼šæœ‰å¤§é‡æ•°æ®ä¸¢å¤±ã€‚")]),s._v(" "),e("p",[s._v("è§„é¿æ–¹æ³•å¯ä»¥åœ¨redisé…ç½®é‡ŒåŠ ä¸Šå‚æ•°(è¿™ç§æ–¹æ³•ä¸å¯èƒ½ç™¾åˆ†ç™¾é¿å…æ•°æ®ä¸¢å¤±ï¼Œå‚è€ƒé›†ç¾¤leaderé€‰ä¸¾æœºåˆ¶)ï¼š")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("min-replicas-to-write 1Â  //å†™æ•°æ®æˆåŠŸæœ€å°‘åŒæ­¥çš„slaveæ•°é‡ï¼Œè¿™ä¸ªæ•°é‡å¯ä»¥æ¨¡ä»¿å¤§äºåŠæ•°æœºåˆ¶é…ç½®ï¼Œæ¯”å¦‚é›†ç¾¤æ€»å…±ä¸‰ä¸ªèŠ‚ç‚¹å¯ä»¥é…ç½®1ï¼ŒåŠ ä¸Šleaderå°±æ˜¯2ï¼Œè¶…è¿‡äº†åŠæ•°\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[e("strong",[s._v("æ³¨æ„")]),s._v("ï¼šè¿™ä¸ªé…ç½®åœ¨ä¸€å®šç¨‹åº¦ä¸Šä¼šå½±å“é›†ç¾¤çš„å¯ç”¨æ€§ï¼Œæ¯”å¦‚slaveè¦æ˜¯å°‘äº1ä¸ªï¼Œè¿™ä¸ªé›†ç¾¤å°±ç®—leaderæ­£å¸¸ä¹Ÿä¸èƒ½æä¾›æœåŠ¡äº†ï¼Œéœ€è¦å…·ä½“åœºæ™¯æƒè¡¡é€‰æ‹©ã€‚")]),s._v(" "),e("p",[e("strong",[s._v("é›†ç¾¤æ˜¯å¦å®Œæ•´æ‰èƒ½å¯¹å¤–æä¾›æœåŠ¡")])]),s._v(" "),e("p",[s._v("å½“redis.confçš„é…ç½®cluster-require-full-coverageä¸ºnoæ—¶ï¼Œè¡¨ç¤ºå½“è´Ÿè´£ä¸€ä¸ªæ’æ§½çš„ä¸»åº“ä¸‹çº¿ä¸”æ²¡æœ‰ç›¸åº”çš„ä»åº“è¿›è¡Œæ•…éšœæ¢å¤æ—¶ï¼Œé›†ç¾¤ä»ç„¶å¯ç”¨ï¼Œå¦‚æœä¸ºyesåˆ™é›†ç¾¤ä¸å¯ç”¨ã€‚")]),s._v(" "),e("p",[e("strong",[s._v("Redisé›†ç¾¤ä¸ºä»€ä¹ˆè‡³å°‘éœ€è¦ä¸‰ä¸ªmasterèŠ‚ç‚¹ï¼Œå¹¶ä¸”æ¨èèŠ‚ç‚¹æ•°ä¸ºå¥‡æ•°ï¼Ÿ")])]),s._v(" "),e("p",[s._v("å› ä¸ºæ–°masterçš„é€‰ä¸¾éœ€è¦å¤§äºåŠæ•°çš„é›†ç¾¤masterèŠ‚ç‚¹åŒæ„æ‰èƒ½é€‰ä¸¾æˆåŠŸï¼Œå¦‚æœåªæœ‰ä¸¤ä¸ªmasterèŠ‚ç‚¹ï¼Œå½“å…¶ä¸­ä¸€ä¸ªæŒ‚äº†ï¼Œæ˜¯è¾¾ä¸åˆ°é€‰ä¸¾æ–°masterçš„æ¡ä»¶çš„ã€‚")]),s._v(" "),e("p",[s._v("å¥‡æ•°ä¸ªmasterèŠ‚ç‚¹å¯ä»¥åœ¨æ»¡è¶³é€‰ä¸¾è¯¥æ¡ä»¶çš„åŸºç¡€ä¸ŠèŠ‚çœä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ¯”å¦‚ä¸‰ä¸ªmasterèŠ‚ç‚¹å’Œå››ä¸ªmasterèŠ‚ç‚¹çš„é›†ç¾¤ç›¸æ¯”ï¼Œå¤§å®¶å¦‚æœéƒ½æŒ‚äº†ä¸€ä¸ªmasterèŠ‚ç‚¹éƒ½èƒ½é€‰ä¸¾æ–°masterèŠ‚ç‚¹ï¼Œå¦‚æœéƒ½æŒ‚äº†ä¸¤ä¸ªmasterèŠ‚ç‚¹éƒ½æ²¡æ³•é€‰ä¸¾æ–°masterèŠ‚ç‚¹äº†ï¼Œæ‰€ä»¥å¥‡æ•°çš„masterèŠ‚ç‚¹æ›´å¤šçš„æ˜¯"),e("strong",[s._v("ä»èŠ‚çœæœºå™¨èµ„æºè§’åº¦å‡ºå‘")]),s._v("è¯´çš„ã€‚")]),s._v(" "),e("p",[e("strong",[s._v("Redisé›†ç¾¤å¯¹æ‰¹é‡æ“ä½œå‘½ä»¤çš„æ”¯æŒ")])]),s._v(" "),e("p",[s._v("å¯¹äºç±»ä¼¼msetï¼Œmgetè¿™æ ·çš„å¤šä¸ªkeyçš„åŸç”Ÿæ‰¹é‡æ“ä½œå‘½ä»¤ï¼Œredisé›†ç¾¤åªæ”¯æŒæ‰€æœ‰keyè½åœ¨åŒä¸€slotçš„æƒ…å†µï¼Œå¦‚æœæœ‰å¤šä¸ªkeyä¸€å®šè¦ç”¨msetå‘½ä»¤åœ¨redisé›†ç¾¤ä¸Šæ“ä½œï¼Œåˆ™å¯ä»¥åœ¨keyçš„å‰é¢åŠ ä¸Š{XX}ï¼Œè¿™æ ·å‚æ•°æ•°æ®åˆ†ç‰‡hashè®¡ç®—çš„åªä¼šæ˜¯å¤§æ‹¬å·é‡Œçš„å€¼ï¼Œè¿™æ ·èƒ½ç¡®ä¿ä¸åŒçš„keyèƒ½è½åˆ°åŒä¸€sloté‡Œå»ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("mset {user1}:1:name zhuge {user1}:1:age 18 \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("å‡è®¾nameå’Œageè®¡ç®—çš„hash slotå€¼ä¸ä¸€æ ·ï¼Œä½†æ˜¯è¿™æ¡å‘½ä»¤åœ¨é›†ç¾¤ä¸‹æ‰§è¡Œï¼Œredisåªä¼šç”¨å¤§æ‹¬å·é‡Œçš„ user1 åšhash slotè®¡ç®—ï¼Œæ‰€ä»¥ç®—å‡ºæ¥çš„slotå€¼è‚¯å®šç›¸åŒï¼Œæœ€åéƒ½èƒ½è½åœ¨åŒä¸€slotã€‚")]),s._v(" "),e("p",[e("strong",[s._v("å“¨å…µleaderé€‰ä¸¾æµç¨‹")])]),s._v(" "),e("p",[s._v("å½“ä¸€ä¸ªmasteræœåŠ¡å™¨è¢«æŸsentinelè§†ä¸ºä¸‹çº¿çŠ¶æ€åï¼Œè¯¥sentinelä¼šä¸å…¶ä»–sentinelåå•†é€‰å‡ºsentinelçš„leaderè¿›è¡Œæ•…éšœè½¬ç§»å·¥ä½œã€‚æ¯ä¸ªå‘ç°masteræœåŠ¡å™¨è¿›å…¥ä¸‹çº¿çš„sentineléƒ½å¯ä»¥è¦æ±‚å…¶ä»–sentinelé€‰è‡ªå·±ä¸ºsentinelçš„leaderï¼Œé€‰ä¸¾æ˜¯å…ˆåˆ°å…ˆå¾—ã€‚åŒæ—¶æ¯ä¸ªsentinelæ¯æ¬¡é€‰ä¸¾éƒ½ä¼šè‡ªå¢é…ç½®çºªå…ƒ(é€‰ä¸¾å‘¨æœŸ)ï¼Œæ¯ä¸ªçºªå…ƒä¸­åªä¼šé€‰æ‹©ä¸€ä¸ªsentinelçš„leaderã€‚å¦‚æœæ‰€æœ‰è¶…è¿‡ä¸€åŠçš„sentinelé€‰ä¸¾æŸsentinelä½œä¸ºleaderã€‚ä¹‹åè¯¥sentinelè¿›è¡Œæ•…éšœè½¬ç§»æ“ä½œï¼Œä»å­˜æ´»çš„slaveä¸­é€‰ä¸¾å‡ºæ–°çš„masterï¼Œè¿™ä¸ªé€‰ä¸¾è¿‡ç¨‹è·Ÿé›†ç¾¤çš„masteré€‰ä¸¾å¾ˆç±»ä¼¼ã€‚")]),s._v(" "),e("p",[s._v("å“¨å…µé›†ç¾¤åªæœ‰ä¸€ä¸ªå“¨å…µèŠ‚ç‚¹ï¼Œredisçš„ä¸»ä»ä¹Ÿèƒ½æ­£å¸¸è¿è¡Œä»¥åŠé€‰ä¸¾masterï¼Œå¦‚æœmasteræŒ‚äº†ï¼Œé‚£å”¯ä¸€çš„é‚£ä¸ªå“¨å…µèŠ‚ç‚¹å°±æ˜¯å“¨å…µleaderäº†ï¼Œå¯ä»¥æ­£å¸¸é€‰ä¸¾æ–°masterã€‚")]),s._v(" "),e("p",[s._v("ä¸è¿‡ä¸ºäº†é«˜å¯ç”¨ä¸€èˆ¬éƒ½æ¨èè‡³å°‘éƒ¨ç½²ä¸‰ä¸ªå“¨å…µèŠ‚ç‚¹ã€‚ä¸ºä»€ä¹ˆæ¨èå¥‡æ•°ä¸ªå“¨å…µèŠ‚ç‚¹åŸç†è·Ÿé›†ç¾¤å¥‡æ•°ä¸ªmasterèŠ‚ç‚¹ç±»ä¼¼ã€‚")]),s._v(" "),e("h3",{attrs:{id:"redisé›†ç¾¤æ­å»º"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#redisé›†ç¾¤æ­å»º"}},[s._v("#")]),s._v(" Redisé›†ç¾¤æ­å»º")]),s._v(" "),e("ul",[e("li",[e("strong",[s._v("redisé›†ç¾¤æ­å»º")])])]),s._v(" "),e("p",[s._v("redisé›†ç¾¤éœ€è¦è‡³å°‘ä¸‰ä¸ªmasterèŠ‚ç‚¹ï¼Œæˆ‘ä»¬è¿™é‡Œæ­å»ºä¸‰ä¸ªmasterèŠ‚ç‚¹ï¼Œå¹¶ä¸”ç»™æ¯ä¸ªmasterå†æ­å»ºä¸€ä¸ªslaveèŠ‚ç‚¹ï¼Œæ€»å…±6ä¸ªredisèŠ‚ç‚¹ï¼Œè¿™é‡Œç”¨ä¸€å°æœºå™¨éƒ¨ç½²6ä¸ªrediså®ä¾‹ï¼Œæ¯å°æœºå™¨ä¸€ä¸»ä¸€ä»ï¼Œæ­å»ºé›†ç¾¤çš„æ­¥éª¤å¦‚ä¸‹ï¼š")]),s._v(" "),e("p",[s._v("â‘  åˆ›å»ºæ–‡ä»¶å¤¹redis-clusterï¼Œç„¶ååœ¨å…¶ä¸‹é¢åˆ›å»º6ä¸ªæ–‡ä»¶å¤¾å¦‚ä¸‹")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("mkdir -p /usr/local/redis-cluster\nmkdir 8001 8002 8003 8004 8005 8006\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("â‘¡ æŠŠä¹‹å‰çš„redis.confé…ç½®æ–‡ä»¶copyåˆ°8001ä¸‹ï¼Œä¿®æ”¹å¦‚ä¸‹å†…å®¹ï¼š")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("daemonize yes\nport 8001ï¼ˆåˆ†åˆ«å¯¹æ¯ä¸ªæœºå™¨çš„ç«¯å£å·è¿›è¡Œè®¾ç½®ï¼‰\npidfile /var/run/redis_8001.pid  # æŠŠpidè¿›ç¨‹å·å†™å…¥pidfileé…ç½®çš„æ–‡ä»¶\ndir /usr/local/redis-cluster/8001/ï¼ˆæŒ‡å®šæ•°æ®æ–‡ä»¶å­˜æ”¾ä½ç½®ï¼Œå¿…é¡»è¦æŒ‡å®šä¸åŒçš„ç›®å½•ä½ç½®ï¼Œä¸ç„¶ä¼šä¸¢å¤±æ•°æ®ï¼‰\ncluster-enabled yesï¼ˆå¯åŠ¨é›†ç¾¤æ¨¡å¼ï¼‰\ncluster-config-file nodes-8001.confï¼ˆé›†ç¾¤èŠ‚ç‚¹ä¿¡æ¯æ–‡ä»¶ï¼Œè¿™é‡Œ800xæœ€å¥½å’Œportå¯¹åº”ä¸Šï¼‰\ncluster-node-timeout 10000\n# bind 127.0.0.1ï¼ˆbindç»‘å®šçš„æ˜¯è‡ªå·±æœºå™¨ç½‘å¡çš„ipï¼Œå¦‚æœæœ‰å¤šå—ç½‘å¡å¯ä»¥é…å¤šä¸ªipï¼Œä»£è¡¨å…è®¸å®¢æˆ·ç«¯é€šè¿‡æœºå™¨çš„å“ªäº›ç½‘å¡ipå»è®¿é—®ï¼Œå†…ç½‘ä¸€èˆ¬å¯ä»¥ä¸é…ç½®bindï¼Œæ³¨é‡Šæ‰å³å¯ï¼‰\nprotected-mode  no   ï¼ˆå…³é—­ä¿æŠ¤æ¨¡å¼ï¼‰\nappendonly yes\n# å¦‚æœè¦è®¾ç½®å¯†ç éœ€è¦å¢åŠ å¦‚ä¸‹é…ç½®ï¼š\nrequirepass zhuge     (è®¾ç½®redisè®¿é—®å¯†ç )\nmasterauth zhuge      (è®¾ç½®é›†ç¾¤èŠ‚ç‚¹é—´è®¿é—®å¯†ç ï¼Œè·Ÿä¸Šé¢ä¸€è‡´)\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br")])]),e("p",[s._v("â‘¢ æŠŠä¿®æ”¹åçš„é…ç½®æ–‡ä»¶ï¼Œcopyåˆ°å¦å¤–äº”ä¸ª8002,8003...ç›®å½•ä¸­ï¼Œä¿®æ”¹ä¸Šä¸€æ­¥çš„2ã€3ã€4ã€6é¡¹é‡Œçš„ç«¯å£å·")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("å¯ä»¥ç”¨æ‰¹é‡æ›¿æ¢ï¼š:%s/æºå­—ç¬¦ä¸²/ç›®çš„å­—ç¬¦ä¸²/g \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("â‘£ åˆ†åˆ«å¯åŠ¨6ä¸ªrediså®ä¾‹ï¼Œç„¶åæ£€æŸ¥æ˜¯å¦å¯åŠ¨æˆåŠŸ")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("/usr/local/redis-5.0.3/src/redis-server /usr/local/redis-cluster/8001[2,3,4,5,6]/redis.conf\nps -ef | grep redis æŸ¥çœ‹æ˜¯å¦å¯åŠ¨æˆåŠŸ\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("â‘¤ ç”¨redis-cliåˆ›å»ºæ•´ä¸ªredisé›†ç¾¤")]),s._v(" "),e("blockquote",[e("p",[s._v("(redis5ä»¥å‰çš„ç‰ˆæœ¬é›†ç¾¤æ˜¯ä¾é rubyè„šæœ¬redis-trib.rbå®ç°)")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# ä¸‹é¢å‘½ä»¤é‡Œçš„1ä»£è¡¨ä¸ºæ¯ä¸ªåˆ›å»ºçš„ä¸»æœåŠ¡å™¨èŠ‚ç‚¹åˆ›å»ºä¸€ä¸ªä»æœåŠ¡å™¨èŠ‚ç‚¹\n# æ‰§è¡Œè¿™æ¡å‘½ä»¤éœ€è¦ç¡®è®¤ä¸‰å°æœºå™¨ä¹‹é—´çš„rediså®ä¾‹è¦èƒ½ç›¸äº’è®¿é—®ï¼Œå¯ä»¥å…ˆç®€å•æŠŠæ‰€æœ‰æœºå™¨é˜²ç«å¢™å…³æ‰ï¼Œå¦‚æœä¸å…³é—­é˜²ç«å¢™åˆ™éœ€è¦æ‰“å¼€redisæœåŠ¡ç«¯å£å’Œé›†ç¾¤èŠ‚ç‚¹gossipé€šä¿¡ç«¯å£16379(é»˜è®¤æ˜¯åœ¨redisç«¯å£å·ä¸ŠåŠ 1W)\n# å…³é—­é˜²ç«å¢™\n# systemctl stop firewalld # ä¸´æ—¶å…³é—­é˜²ç«å¢™\n# systemctl disable firewalld # ç¦æ­¢å¼€æœºå¯åŠ¨\n# æ³¨æ„ï¼šä¸‹é¢è¿™æ¡åˆ›å»ºé›†ç¾¤çš„å‘½ä»¤å¤§å®¶ä¸è¦ç›´æ¥å¤åˆ¶ï¼Œé‡Œé¢çš„ç©ºæ ¼ç¼–ç å¯èƒ½æœ‰é—®é¢˜å¯¼è‡´åˆ›å»ºé›†ç¾¤ä¸æˆåŠŸ\nï¼ˆ1ï¼‰/usr/local/redis-5.0.3/src/redis-cli -a zhuge --cluster create --cluster-replicas 1 192.168.0.61:8001 192.168.0.62:8002 192.168.0.63:8003 192.168.0.61:8004 192.168.0.62:8005 192.168.0.63:8006 \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("p",[s._v("â‘¥ éªŒè¯é›†ç¾¤")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("ï¼ˆ1ï¼‰è¿æ¥ä»»æ„ä¸€ä¸ªå®¢æˆ·ç«¯å³å¯ï¼š./redis-cli -c -h -p (-aè®¿é—®æœåŠ¡ç«¯å¯†ç ï¼Œ-cè¡¨ç¤ºé›†ç¾¤æ¨¡å¼ï¼ŒæŒ‡å®šipåœ°å€å’Œç«¯å£å·ï¼‰\n    å¦‚ï¼š/usr/local/redis-5.0.3/src/redis-cli -a zhuge -c -h 192.168.0.61 -p 800*\nï¼ˆ2ï¼‰è¿›è¡ŒéªŒè¯ï¼š cluster infoï¼ˆæŸ¥çœ‹é›†ç¾¤ä¿¡æ¯ï¼‰ã€cluster nodesï¼ˆæŸ¥çœ‹èŠ‚ç‚¹åˆ—è¡¨ï¼‰\nï¼ˆ3ï¼‰è¿›è¡Œæ•°æ®æ“ä½œéªŒè¯\n\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("p",[s._v("â‘¦ å…³é—­é›†ç¾¤éœ€è¦é€ä¸ªè¿›è¡Œå…³é—­")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("/usr/local/redis-5.0.3/src/redis-cli -a zhuge -c -h 192.168.0.60 -p 800* shutdown\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"redisé›†ç¾¤ä¹‹æ°´å¹³æ‰©å±•"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#redisé›†ç¾¤ä¹‹æ°´å¹³æ‰©å±•"}},[s._v("#")]),s._v(" Redisé›†ç¾¤ä¹‹æ°´å¹³æ‰©å±•")]),s._v(" "),e("p",[s._v("Redis3.0ä»¥åçš„ç‰ˆæœ¬è™½ç„¶æœ‰äº†é›†ç¾¤åŠŸèƒ½ï¼Œæä¾›äº†æ¯”ä¹‹å‰ç‰ˆæœ¬çš„å“¨å…µæ¨¡å¼æ›´é«˜çš„æ€§èƒ½ä¸å¯ç”¨æ€§ï¼Œä½†æ˜¯é›†ç¾¤çš„æ°´å¹³æ‰©å±•å´æ¯”è¾ƒéº»çƒ¦ï¼Œä»Šå¤©å°±æ¥å¸¦å¤§å®¶çœ‹çœ‹redisé«˜å¯ç”¨é›†ç¾¤å¦‚ä½•åšæ°´å¹³æ‰©å±•ï¼ŒåŸå§‹é›†ç¾¤(è§ä¸‹å›¾)ç”±6ä¸ªèŠ‚ç‚¹ç»„æˆï¼Œ6ä¸ªèŠ‚ç‚¹åˆ†å¸ƒåœ¨ä¸‰å°æœºå™¨ä¸Šï¼Œé‡‡ç”¨ä¸‰ä¸»ä¸‰ä»çš„æ¨¡å¼")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/redis/20.png",alt:""}})]),s._v(" "),e("p",[e("strong",[s._v("1ã€å¯åŠ¨é›†ç¾¤")])]),s._v(" "),e("p",[s._v("å¯åŠ¨æ•´ä¸ªé›†ç¾¤")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("/usr/local/redis-5.0.3/src/redis-server /usr/local/redis-cluster/8001/redis.conf\n/usr/local/redis-5.0.3/src/redis-server /usr/local/redis-cluster/8002/redis.conf\n/usr/local/redis-5.0.3/src/redis-server /usr/local/redis-cluster/8003/redis.conf\n/usr/local/redis-5.0.3/src/redis-server /usr/local/redis-cluster/8004/redis.conf\n/usr/local/redis-5.0.3/src/redis-server /usr/local/redis-cluster/8005/redis.conf\n/usr/local/redis-5.0.3/src/redis-server /usr/local/redis-cluster/8006/redis.conf\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("p",[s._v("â€‹")]),s._v(" "),e("p",[s._v("å®¢æˆ·ç«¯è¿æ¥8001ç«¯å£çš„rediså®ä¾‹")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("/usr/local/redis-5.0.3/src/redis-cli -a zhuge -c -h 192.168.0.61 -p 8001  \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("æŸ¥çœ‹é›†ç¾¤çŠ¶æ€")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("192.168.0.61:8001> cluster nodes  \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[e("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/redis/21.png",alt:""}})]),s._v(" "),e("p",[s._v("ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œæ•´ä¸ªé›†ç¾¤è¿è¡Œæ­£å¸¸ï¼Œä¸‰ä¸ªmasterèŠ‚ç‚¹å’Œä¸‰ä¸ªslaveèŠ‚ç‚¹ï¼Œ8001ç«¯å£çš„å®ä¾‹èŠ‚ç‚¹å­˜å‚¨0-5460è¿™äº›hashæ§½ï¼Œ8002ç«¯å£çš„å®ä¾‹èŠ‚ç‚¹å­˜å‚¨5461-10922è¿™äº›hashæ§½ï¼Œ8003ç«¯å£çš„å®ä¾‹èŠ‚ç‚¹å­˜å‚¨10923-16383è¿™äº›hashæ§½ï¼Œè¿™ä¸‰ä¸ªmasterèŠ‚ç‚¹å­˜å‚¨çš„æ‰€æœ‰hashæ§½ç»„æˆredisé›†ç¾¤çš„å­˜å‚¨æ§½ä½ï¼Œslaveç‚¹æ˜¯æ¯ä¸ªä¸»èŠ‚ç‚¹çš„å¤‡ä»½ä»èŠ‚ç‚¹ï¼Œä¸æ˜¾ç¤ºå­˜å‚¨æ§½ä½")]),s._v(" "),e("p",[e("strong",[s._v("2ã€é›†ç¾¤æ“ä½œ")])]),s._v(" "),e("p",[s._v("æˆ‘ä»¬åœ¨åŸå§‹é›†ç¾¤åŸºç¡€ä¸Šå†å¢åŠ ä¸€ä¸»(8007)ä¸€ä»(8008)ï¼Œå¢åŠ èŠ‚ç‚¹åçš„é›†ç¾¤å‚è§ä¸‹å›¾ï¼Œæ–°å¢èŠ‚ç‚¹ç”¨è™šçº¿æ¡†è¡¨ç¤º")]),s._v(" "),e("p",[s._v("â€‹    "),e("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/redis/22.png",alt:""}})]),s._v(" "),e("ul",[e("li",[e("strong",[s._v("å¢åŠ rediså®ä¾‹")])])]),s._v(" "),e("p",[s._v("åœ¨/usr/local/redis-clusterä¸‹åˆ›å»º8007å’Œ8008æ–‡ä»¶å¤¹ï¼Œå¹¶æ‹·è´8001æ–‡ä»¶å¤¹ä¸‹çš„redis.confæ–‡ä»¶åˆ°8007å’Œ8008è¿™ä¸¤ä¸ªæ–‡ä»¶å¤¹ä¸‹")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("mkdir 8007 8008\ncd 8001\ncp redis.conf /usr/local/redis-cluster/8007/\ncp redis.conf /usr/local/redis-cluster/8008/\n\n# ä¿®æ”¹8007æ–‡ä»¶å¤¹ä¸‹çš„redis.confé…ç½®æ–‡ä»¶\nvim /usr/local/redis-cluster/8007/redis.conf\n# ä¿®æ”¹å¦‚ä¸‹å†…å®¹ï¼š\nport:8007\ndir /usr/local/redis-cluster/8007/\ncluster-config-file nodes-8007.conf\n\n# ä¿®æ”¹8008æ–‡ä»¶å¤¹ä¸‹çš„redis.confé…ç½®æ–‡ä»¶\nvim /usr/local/redis-cluster/8008/redis.conf\nä¿®æ”¹å†…å®¹å¦‚ä¸‹ï¼š\nport:8008\ndir /usr/local/redis-cluster/8008/\ncluster-config-file nodes-8008.conf\n\n# å¯åŠ¨8007å’Œ8008ä¿©ä¸ªæœåŠ¡å¹¶æŸ¥çœ‹æœåŠ¡çŠ¶æ€\n/usr/local/redis-5.0.3/src/redis-server /usr/local/redis-cluster/8007/redis.conf\n/usr/local/redis-5.0.3/src/redis-server /usr/local/redis-cluster/8008/redis.conf\nps -el | grep redis\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br")])]),e("ul",[e("li",[e("strong",[s._v("æŸ¥çœ‹redisé›†ç¾¤çš„å‘½ä»¤å¸®åŠ©")])])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("cd /usr/local/redis-5.0.3 \nsrc/redis-cli --cluster help              \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("â€‹    "),e("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/redis/23.png",alt:""}})]),s._v(" "),e("ol",[e("li",[s._v("createï¼šåˆ›å»ºä¸€ä¸ªé›†ç¾¤ç¯å¢ƒhost1:port1 ... hostN:portN")]),s._v(" "),e("li",[s._v("callï¼šå¯ä»¥æ‰§è¡Œrediså‘½ä»¤")]),s._v(" "),e("li",[s._v("add-nodeï¼šå°†ä¸€ä¸ªèŠ‚ç‚¹æ·»åŠ åˆ°é›†ç¾¤é‡Œï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ–°èŠ‚ç‚¹çš„ip:portï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºé›†ç¾¤ä¸­ä»»æ„ä¸€ä¸ªå·²ç»å­˜åœ¨çš„èŠ‚ç‚¹çš„ip:port")]),s._v(" "),e("li",[s._v("del-nodeï¼šç§»é™¤ä¸€ä¸ªèŠ‚ç‚¹")]),s._v(" "),e("li",[s._v("reshardï¼šé‡æ–°åˆ†ç‰‡")]),s._v(" "),e("li",[s._v("checkï¼šæ£€æŸ¥é›†ç¾¤çŠ¶æ€")])]),s._v(" "),e("ul",[e("li",[e("strong",[s._v("é…ç½®8007ä¸ºé›†ç¾¤ä¸»èŠ‚ç‚¹")])])]),s._v(" "),e("p",[s._v('ä½¿ç”¨add-nodeå‘½ä»¤æ–°å¢ä¸€ä¸ªä¸»èŠ‚ç‚¹8007(master)ï¼Œå‰é¢çš„ip:portä¸ºæ–°å¢èŠ‚ç‚¹ï¼Œåé¢çš„ip:portä¸ºå·²çŸ¥å­˜åœ¨èŠ‚ç‚¹ï¼Œçœ‹åˆ°æ—¥å¿—æœ€åæœ‰"[OK] New node added correctly"æç¤ºä»£è¡¨æ–°èŠ‚ç‚¹åŠ å…¥æˆåŠŸ')]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("/usr/local/redis-5.0.3/src/redis-cli -a zhuge --cluster add-node 192.168.0.61:8007 192.168.0.61:8001  \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("æŸ¥çœ‹é›†ç¾¤çŠ¶æ€")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("/usr/local/redis-5.0.3/src/redis-cli -a zhuge -c -h 192.168.0.61 -p 8001 192.168.0.61:8001> cluster nodes\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[e("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/redis/24.png",alt:""}})]),s._v(" "),e("p",[s._v("æ³¨æ„ï¼šå½“æ·»åŠ èŠ‚ç‚¹æˆåŠŸä»¥åï¼Œæ–°å¢çš„èŠ‚ç‚¹ä¸ä¼šæœ‰ä»»ä½•æ•°æ®ï¼Œå› ä¸ºå®ƒè¿˜æ²¡æœ‰åˆ†é…ä»»ä½•çš„slot(hashæ§½)ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºæ–°èŠ‚ç‚¹æ‰‹å·¥åˆ†é…hashæ§½")]),s._v(" "),e("p",[s._v("ä½¿ç”¨redis-cliå‘½ä»¤ä¸º8007åˆ†é…hashæ§½ï¼Œæ‰¾åˆ°é›†ç¾¤ä¸­çš„ä»»æ„ä¸€ä¸ªä¸»èŠ‚ç‚¹ï¼Œå¯¹å…¶è¿›è¡Œé‡æ–°åˆ†ç‰‡å·¥ä½œã€‚")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("/usr/local/redis-5.0.3/src/redis-cli -a zhuge --cluster reshard 192.168.0.61:8001             \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("è¾“å‡ºå¦‚ä¸‹ï¼š")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("... ...\nHow many slots do you want to move (from 1 to 16384)? 600\n(ps:éœ€è¦å¤šå°‘ä¸ªæ§½ç§»åŠ¨åˆ°æ–°çš„èŠ‚ç‚¹ä¸Šï¼Œè‡ªå·±è®¾ç½®ï¼Œæ¯”å¦‚600ä¸ªhashæ§½)\nWhat is the receiving node ID? 2728a594a0498e98e4b83a537e19f9a0a3790f38\n(ps:æŠŠè¿™600ä¸ªhashæ§½ç§»åŠ¨åˆ°å“ªä¸ªèŠ‚ç‚¹ä¸Šå»ï¼Œéœ€è¦æŒ‡å®šèŠ‚ç‚¹id)\nPlease enter all the source node IDs.\nÂ  Type 'all' to use all the nodes as source nodes for the hash slots.\nÂ  Type 'done' once you entered all the source nodes IDs.\nSource node 1:all\n(ps:è¾“å…¥allä¸ºä»æ‰€æœ‰ä¸»èŠ‚ç‚¹(8001,8002,8003)ä¸­åˆ†åˆ«æŠ½å–ç›¸åº”çš„æ§½æ•°æŒ‡å®šåˆ°æ–°èŠ‚ç‚¹ä¸­ï¼ŒæŠ½å–çš„æ€»æ§½æ•°ä¸º600ä¸ª)\nÂ ... ...\nDo you want to proceed with the proposed reshard plan (yes/no)? yes\n(ps:è¾“å…¥yesç¡®è®¤å¼€å§‹æ‰§è¡Œåˆ†ç‰‡ä»»åŠ¡)\n... ...\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br")])]),e("p",[s._v("æŸ¥çœ‹ä¸‹æœ€æ–°çš„é›†ç¾¤çŠ¶æ€")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("/usr/local/redis-5.0.3/src/redis-cli -a zhuge -c -h 192.168.0.61 -p 8001 192.168.0.61:8001> cluster nodes\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[e("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/redis/25.png",alt:""}})]),s._v(" "),e("p",[s._v("å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œç°åœ¨æˆ‘ä»¬çš„8007å·²ç»æœ‰hashæ§½äº†ï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥åœ¨8007ä¸Šè¿›è¡Œè¯»å†™æ•°æ®å•¦ï¼åˆ°æ­¤ä¸ºæ­¢æˆ‘ä»¬çš„8007å·²ç»åŠ å…¥åˆ°é›†ç¾¤ä¸­ï¼Œå¹¶ä¸”æ˜¯ä¸»èŠ‚ç‚¹(Master)")]),s._v(" "),e("ul",[e("li",[e("strong",[s._v("é…ç½®8008ä¸º8007çš„ä»èŠ‚ç‚¹")])])]),s._v(" "),e("p",[s._v("æ·»åŠ ä»èŠ‚ç‚¹8008åˆ°é›†ç¾¤ä¸­å»å¹¶æŸ¥çœ‹é›†ç¾¤çŠ¶æ€")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("/usr/local/redis-5.0.3/src/redis-cli -a zhuge --cluster add-node 192.168.0.61:8008 192.168.0.61:8001  \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("â€‹")]),s._v(" "),e("p",[s._v("â€‹    "),e("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/redis/26.png",alt:""}})]),s._v(" "),e("p",[s._v("å¦‚å›¾æ‰€ç¤ºï¼Œè¿˜æ˜¯ä¸€ä¸ªmasterèŠ‚ç‚¹ï¼Œæ²¡æœ‰è¢«åˆ†é…ä»»ä½•çš„hashæ§½ã€‚")]),s._v(" "),e("p",[s._v("æˆ‘ä»¬éœ€è¦æ‰§è¡Œreplicateå‘½ä»¤æ¥æŒ‡å®šå½“å‰èŠ‚ç‚¹(ä»èŠ‚ç‚¹)çš„ä¸»èŠ‚ç‚¹idä¸ºå“ªä¸ª,é¦–å…ˆéœ€è¦è¿æ¥æ–°åŠ çš„8008èŠ‚ç‚¹çš„å®¢æˆ·ç«¯ï¼Œç„¶åä½¿ç”¨é›†ç¾¤å‘½ä»¤è¿›è¡Œæ“ä½œï¼ŒæŠŠå½“å‰çš„8008(slave)èŠ‚ç‚¹æŒ‡å®šåˆ°ä¸€ä¸ªä¸»èŠ‚ç‚¹ä¸‹(è¿™é‡Œä½¿ç”¨ä¹‹å‰åˆ›å»ºçš„8007ä¸»èŠ‚ç‚¹)")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("/usr/local/redis-5.0.3/src/redis-cli -a zhuge -c -h 192.168.0.61 -p 8008 192.168.0.61:8008> cluster replicate 2728a594a0498e98e4b83a537e19f9a0a3790f38  #åé¢è¿™ä¸²idä¸º8007çš„èŠ‚ç‚¹id \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("â€‹")]),s._v(" "),e("p",[s._v("æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ï¼Œ8008èŠ‚ç‚¹å·²æˆåŠŸæ·»åŠ ä¸º8007èŠ‚ç‚¹çš„ä»èŠ‚ç‚¹")]),s._v(" "),e("p",[s._v("â€‹    "),e("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/redis/27.png",alt:""}})]),s._v(" "),e("ul",[e("li",[e("strong",[s._v("åˆ é™¤8008ä»èŠ‚ç‚¹")])])]),s._v(" "),e("p",[s._v("ç”¨del-nodeåˆ é™¤ä»èŠ‚ç‚¹8008ï¼ŒæŒ‡å®šåˆ é™¤èŠ‚ç‚¹ipå’Œç«¯å£ï¼Œä»¥åŠèŠ‚ç‚¹id(çº¢è‰²ä¸º8008èŠ‚ç‚¹id)")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("/usr/local/redis-5.0.3/src/redis-cli -a zhuge --cluster del-node 192.168.0.61:8008 a1cfe35722d151cf70585cee21275565393c0956 \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("â€‹")]),s._v(" "),e("p",[s._v("å†æ¬¡æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œ8008è¿™ä¸ªslaveèŠ‚ç‚¹å·²ç»ç§»é™¤ï¼Œå¹¶ä¸”è¯¥èŠ‚ç‚¹çš„redisæœåŠ¡ä¹Ÿå·²è¢«åœæ­¢")]),s._v(" "),e("p",[s._v("â€‹    "),e("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/redis/28.png",alt:""}})]),s._v(" "),e("ul",[e("li",[e("strong",[s._v("åˆ é™¤8007ä¸»èŠ‚ç‚¹")])])]),s._v(" "),e("p",[s._v("æœ€åï¼Œæˆ‘ä»¬å°è¯•åˆ é™¤ä¹‹å‰åŠ å…¥çš„ä¸»èŠ‚ç‚¹8007ï¼Œè¿™ä¸ªæ­¥éª¤ç›¸å¯¹æ¯”è¾ƒéº»çƒ¦ä¸€äº›ï¼Œå› ä¸ºä¸»èŠ‚ç‚¹çš„é‡Œé¢æ˜¯æœ‰åˆ†é…äº†hashæ§½çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œå¿…é¡»å…ˆæŠŠ8007é‡Œçš„hashæ§½æ”¾å…¥åˆ°å…¶ä»–çš„å¯ç”¨ä¸»èŠ‚ç‚¹ä¸­å»ï¼Œç„¶åå†è¿›è¡Œç§»é™¤èŠ‚ç‚¹æ“ä½œï¼Œä¸ç„¶ä¼šå‡ºç°æ•°æ®ä¸¢å¤±é—®é¢˜(ç›®å‰åªèƒ½æŠŠmasterçš„æ•°æ®è¿ç§»åˆ°ä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œæš‚æ—¶åšä¸äº†å¹³å‡åˆ†é…åŠŸèƒ½)ï¼Œæ‰§è¡Œå‘½ä»¤å¦‚ä¸‹ï¼š")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("/usr/local/redis-5.0.3/src/redis-cli -a zhuge --cluster reshard 192.168.0.61:8007\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("â€‹")]),s._v(" "),e("p",[s._v("è¾“å‡ºå¦‚ä¸‹ï¼š")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("... ...\nHow many slots do you want to move (from 1 to 16384)? 600\nWhat is the receiving node ID? dfca1388f124dec92f394a7cc85cf98cfa02f86f\n(ps:è¿™é‡Œæ˜¯éœ€è¦æŠŠæ•°æ®ç§»åŠ¨åˆ°å“ªï¼Ÿ8001çš„ä¸»èŠ‚ç‚¹id)\nPlease enter all the source node IDs.\nÂ  Type 'all' to use all the nodes as source nodes for the hash slots.\nÂ  Type 'done' once you entered all the source nodes IDs.\nSource node 1:2728a594a0498e98e4b83a537e19f9a0a3790f38\n(ps:è¿™é‡Œæ˜¯éœ€è¦æ•°æ®æºï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„8007èŠ‚ç‚¹id)\nSource node 2:done\n(ps:è¿™é‡Œç›´æ¥è¾“å…¥done å¼€å§‹ç”Ÿæˆè¿ç§»è®¡åˆ’)\nÂ ... ...\nDo you want to proceed with the proposed reshard plan (yes/no)? Yes\n(ps:è¿™é‡Œè¾“å…¥yeså¼€å§‹è¿ç§»)\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br")])]),e("p",[s._v("è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»æˆåŠŸçš„æŠŠ8007ä¸»èŠ‚ç‚¹çš„æ•°æ®è¿ç§»åˆ°8001ä¸Šå»äº†ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹ç°åœ¨çš„é›†ç¾¤çŠ¶æ€å¦‚ä¸‹å›¾ï¼Œä½ ä¼šå‘ç°8007ä¸‹é¢å·²ç»æ²¡æœ‰ä»»ä½•hashæ§½äº†ï¼Œè¯æ˜è¿ç§»æˆåŠŸï¼")]),s._v(" "),e("p",[s._v("â€‹    "),e("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/redis/29.png",alt:""}})]),s._v(" "),e("p",[s._v("æœ€åæˆ‘ä»¬ç›´æ¥ä½¿ç”¨del-nodeå‘½ä»¤åˆ é™¤8007ä¸»èŠ‚ç‚¹å³å¯")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("/usr/local/redis-5.0.3/src/redis-cli -a zhuge --cluster del-node 192.168.0.61:8007 2728a594a0498e98e4b83a537e19f9a0a3790f38 \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("â€‹")]),s._v(" "),e("p",[s._v("æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ï¼Œä¸€åˆ‡è¿˜åŸä¸ºæœ€åˆå§‹çŠ¶æ€å•¦ï¼å¤§åŠŸå‘Šæˆï¼")]),s._v(" "),e("p",[s._v("â€‹    "),e("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/redis/30.png",alt:""}})])])}),[],!1,null,null,null);e.default=t.exports}}]);
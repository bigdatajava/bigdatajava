(window.webpackJsonp=window.webpackJsonp||[]).push([[45],{413:function(s,a,t){"use strict";t.r(a);var e=t(5),n=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("🍀 ⛄️ 🍀")]),s._v(" "),a("p",[s._v("官网所有命令："),a("code",[s._v("https://redis.io/commands")])]),s._v(" "),a("h2",{attrs:{id:"类型概述"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#类型概述"}},[s._v("#")]),s._v(" 类型概述")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/20231219/image-20231227130707055.png",alt:"image-20231227130707055"}})]),s._v(" "),a("h2",{attrs:{id:"string"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#string"}},[s._v("#")]),s._v(" String")]),s._v(" "),a("h3",{attrs:{id:"字符串常用操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#字符串常用操作"}},[s._v("#")]),s._v(" 字符串常用操作")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("help @string\nSET key value  //存入字符串键值对\nMSET key value [key value ...]  //批量存储字符串键值对\nSETNX key value  //存入一个不存在的字符串键值对\nGET key  //获取一个字符串键值\nMGET key [key ...]   //批量获取字符串键值\nDEL key [key ...]  //删除一个键\nEXPIRE key seconds  //设置一个键的过期时间(秒)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("原子加减")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("INCR key  //将key中储存的数字值加1\nDECR key  //将key中储存的数字值减1\nINCRBY key increment  //将key所储存的值加上increment\nDECRBY key decrement  //将key所储存的值减去decrement\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"应该场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#应该场景"}},[s._v("#")]),s._v(" 应该场景")]),s._v(" "),a("h4",{attrs:{id:"单值缓存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#单值缓存"}},[s._v("#")]),s._v(" 单值缓存")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("SET  key  value \t\nGET  key \t\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h4",{attrs:{id:"对象缓存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#对象缓存"}},[s._v("#")]),s._v(" 对象缓存")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("SET  user:1  value(json格式数据)\nMSET  user:1:name zhuge user:1:balance 1888\nMGET  user:1:name   user:1:balance\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h4",{attrs:{id:"分布式锁"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分布式锁"}},[s._v("#")]),s._v(" 分布式锁")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("SETNX  product:10001  true \t\t//返回1代表获取锁成功\nSETNX  product:10001  true \t\t//返回0代表获取锁失败\n（此过程）执行业务操作\nDEL  product:10001\t\t\t//执行完业务释放锁\n\nSET product:10001 true  ex  10  nx\t//防止程序意外终止导致死锁\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h4",{attrs:{id:"计数器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#计数器"}},[s._v("#")]),s._v(" 计数器")]),s._v(" "),a("p",[s._v("例如：点赞数，阅读数")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("INCR article:readcount:{文章id}  \t\nGET article:readcount:{文章id} \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h4",{attrs:{id:"web集群session共享"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#web集群session共享"}},[s._v("#")]),s._v(" Web集群session共享")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("spring session + redis实现session共享\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"分布式系统全局序列号"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分布式系统全局序列号"}},[s._v("#")]),s._v(" 分布式系统全局序列号")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("INCRBY  orderId  1000\t\t//redis批量生成序列号提升性能\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"源码底层"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#源码底层"}},[s._v("#")]),s._v(" 源码底层")]),s._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[s._v("数据结构\n\nredis "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.2")]),s._v(" 以前\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("sdshdr")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" len"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" free"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),s._v(" buf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nredis "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.2")]),s._v(" 后\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("typedef")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("sds"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("__attribute__")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("__packed__"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("sdshdr5")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("unsigned")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),s._v(" flags"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* 3 lsb of type, and 5 msb of string length */")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),s._v(" buf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("__attribute__")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("__packed__"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("sdshdr8")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint8_t")]),s._v(" len"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* used */")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint8_t")]),s._v(" alloc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* excluding the header and null terminator */")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("unsigned")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),s._v(" flags"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* 3 lsb of type, 5 unused bits */")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),s._v(" buf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("__attribute__")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("__packed__"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("sdshdr16")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint16_t")]),s._v(" len"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* used */")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint16_t")]),s._v(" alloc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* excluding the header and null terminator */")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("unsigned")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),s._v(" flags"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* 3 lsb of type, 5 unused bits */")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),s._v(" buf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("__attribute__")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("__packed__"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("sdshdr32")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint32_t")]),s._v(" len"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* used */")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint32_t")]),s._v(" alloc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* excluding the header and null terminator */")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("unsigned")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),s._v(" flags"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* 3 lsb of type, 5 unused bits */")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),s._v(" buf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("__attribute__")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("__packed__"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("sdshdr64")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("#define SDS_TYPE_5  0\n#define SDS_TYPE_8  1\n#define SDS_TYPE_16 2\n#define SDS_TYPE_32 3\n#define SDS_TYPE_64 4\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("static inline char sdsReqType(size_t string_size) {\n    if (string_size < 32)  \n        return SDS_TYPE_5;\n    if (string_size < 0xff) //2^8 -1  \n        return SDS_TYPE_8;\n    if (string_size < 0xffff) // 2^16 -1  \n        return SDS_TYPE_16;\n    if (string_size < 0xffffffff)  // 2^32 -1 \n        return SDS_TYPE_32;\n    return SDS_TYPE_64;\n}\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("h2",{attrs:{id:"hash"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#hash"}},[s._v("#")]),s._v(" Hash")]),s._v(" "),a("h3",{attrs:{id:"hash常用操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#hash常用操作"}},[s._v("#")]),s._v(" Hash常用操作")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("HSET  key  field  value \t\t\t//存储一个哈希表key的键值\nHSETNX  key  field  value \t\t//存储一个不存在的哈希表key的键值\nHMSET  key  field  value [field value ...] \t//在一个哈希表key中存储多个键值对\nHGET  key  field \t\t\t\t//获取哈希表key对应的field键值\nHMGET  key  field  [field ...] \t\t//批量获取哈希表key中多个field键值\nHDEL  key  field  [field ...] \t\t//删除哈希表key中的field键值\nHLEN  key\t\t\t\t//返回哈希表key中field的数量\nHGETALL  key\t\t\t\t//返回哈希表key中所有的键值\n\nHINCRBY  key  field  increment \t\t//为哈希表key中field键的值加上增量increment\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h3",{attrs:{id:"应用场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#应用场景"}},[s._v("#")]),s._v(" 应用场景")]),s._v(" "),a("h4",{attrs:{id:"对象缓存-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#对象缓存-2"}},[s._v("#")]),s._v(" 对象缓存")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("HMSET  user  {userId}:name  zhuge  {userId}:balance  1888\nHMSET  user  1:name  zhuge  1:balance  1888\nHMGET  user  1:name  1:balance  \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h4",{attrs:{id:"电商购物车"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#电商购物车"}},[s._v("#")]),s._v(" 电商购物车")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("- 电商购物车\n1)以用户id为key\n2）商品id为field\n3）商品数量为value\n\n- 购物车操作\n1)添加商品 hset cart:1001 10088 1\n2)增加数量 hincrby cart:1001 10088 1\n3)商品总数 hlen cart:1001\n4)删除商品 hdel cart:1001 10088\n5)获取购物车所有商品 hgetall cart:1001\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[a("img",{attrs:{src:"C:%5CUsers%5CNO%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210829140401313.png",alt:"image-20210829140401313"}})]),s._v(" "),a("h3",{attrs:{id:"hash结构优缺点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#hash结构优缺点"}},[s._v("#")]),s._v(" Hash结构优缺点")]),s._v(" "),a("ul",[a("li",[s._v("优点")])]),s._v(" "),a("ol",[a("li",[a("p",[s._v("同类数据归类整合储存，方便数据管理")])]),s._v(" "),a("li",[a("p",[s._v("相比string操作消耗内存与cpu更小")])]),s._v(" "),a("li",[a("p",[s._v("相比string储存更节省空间")])])]),s._v(" "),a("ul",[a("li",[s._v("缺点")])]),s._v(" "),a("ol",[a("li",[a("p",[s._v("过期功能不能使用在field上，只能用在key上")])]),s._v(" "),a("li",[a("p",[s._v("Redis集群架构下不适合大规模使用")])])]),s._v(" "),a("h3",{attrs:{id:"源码底层-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#源码底层-2"}},[s._v("#")]),s._v(" 源码底层")]),s._v(" "),a("p",[s._v("Hash数据结构底层实现为一个字典（dict），也是RedisBb用来存储K-V的书据结构，当数据量比较小，或者单个元素比较小时，底层用ziplist存储，数据大小和元素数量阈值可以通过一下参数设置")]),s._v(" "),a("p",[a("img",{attrs:{src:"C:%5CUsers%5CNO%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210829184049175.png",alt:"image-20210829184049175"}})]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("hash-max-ziplist-entries  512 //  ziplist 元素个数超过 512 ，将改为hashtable编码 \nhash-max-ziplist-value    64 //  单个元素大小超过 64 byte时，将改为hashtable编码\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h2",{attrs:{id:"list"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#list"}},[s._v("#")]),s._v(" List")]),s._v(" "),a("p",[a("img",{attrs:{src:"C:%5CUsers%5CNO%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210829140859502.png",alt:"image-20210829140859502"}})]),s._v(" "),a("h3",{attrs:{id:"list常用操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#list常用操作"}},[s._v("#")]),s._v(" List常用操作")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("LPUSH  key  value [value ...]  //将一个或多个值value插入到key列表的表头(最左边)\nRPUSH  key  value [value ...]  //将一个或多个值value插入到key列表的表尾(最右边)\nLPOP  key\t//移除并返回key列表的头元素\nRPOP  key\t//移除并返回key列表的尾元素\nLRANGE  key  start  stop //返回列表key中指定区间内的元素，区间以偏移量start和stop指定\n\nBLPOP  key  [key ...]  timeout\t//从key列表表头弹出一个元素，若列表中没有元素，阻塞等待timeout秒,如果timeout=0,一直阻塞等待\nBRPOP  key  [key ...]  timeout \t//从key列表表尾弹出一个元素，若列表中没有元素，阻塞等待timeout秒,如果timeout=0,一直阻塞等待\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h3",{attrs:{id:"应用场景-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#应用场景-2"}},[s._v("#")]),s._v(" 应用场景")]),s._v(" "),a("h4",{attrs:{id:"用于数据结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#用于数据结构"}},[s._v("#")]),s._v(" 用于数据结构")]),s._v(" "),a("p",[a("img",{attrs:{src:"C:%5CUsers%5CNO%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210829141109827.png",alt:"image-20210829141109827"}})]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("Stack栈) = LPUSH + LPOP\nQueue(队列）= LPUSH + RPOP\nBlocking MQ(阻塞队列）= LPUSH + BRPOP\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h4",{attrs:{id:"微博消息和微信公号消息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#微博消息和微信公号消息"}},[s._v("#")]),s._v(" 微博消息和微信公号消息")]),s._v(" "),a("p",[s._v("诸葛老师关注了MacTalk，备胎说车等大V")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("1）MacTalk发微博，消息ID为10018\nLPUSH msg:{诸葛老师-ID} 10018\n\n2）备胎说车发微博，消息ID为10086\nLPUSH msg:{诸葛老师-ID} 10086\n\n3）查看最新微博消息\nLRANGE msg:{诸葛老师-ID} 0 4\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[a("img",{attrs:{src:"C:%5CUsers%5CNO%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210829141356236.png",alt:"image-20210829141356236"}})]),s._v(" "),a("h3",{attrs:{id:"源码底层-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#源码底层-3"}},[s._v("#")]),s._v(" 源码底层")]),s._v(" "),a("p",[s._v("List是一个有序（按加入的时序排序）的数据结构，redis采用quicklist（双端链表）和ziplist作为List的底层实现。")]),s._v(" "),a("p",[s._v("可以通过设置每个ziplist的最大容量，quiclist的数据压缩范围，提升数据存取效率")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("list-max-ziplist-size  -2 //  单个ziplist节点最大能存储  8kb  ,超过则进行分裂,将数据存储在新的ziplist节点中\nlist-compress-depth  1  //  0 代表所有节点，都不进行压缩，1， 代表从头节点往后走一个，尾节点往前走一个不用压缩，其他的全部压缩，2，3，4 ... 以此类推\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[a("img",{attrs:{src:"C:%5CUsers%5CNO%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210829183533536.png",alt:"image-20210829183533536"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"C:%5CUsers%5CNO%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210829183546560.png",alt:"image-20210829183546560"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"C:%5CUsers%5CNO%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210829183654170.png",alt:"image-20210829183654170"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"C:%5CUsers%5CNO%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210829183703080.png",alt:"image-20210829183703080"}})]),s._v(" "),a("h2",{attrs:{id:"set"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#set"}},[s._v("#")]),s._v(" Set")]),s._v(" "),a("h3",{attrs:{id:"常用操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常用操作"}},[s._v("#")]),s._v(" 常用操作")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("SADD  key  member  [member ...] //往集合key中存入元素，元素存在则忽略，若key不存在则新建\nSREM  key  member  [member ...]\t//从集合key中删除元素\nSMEMBERS  key  //获取集合key中所有元素\nSCARD  key\t//获取集合key的元素个数\nSISMEMBER  key  member\t//判断member元素是否存在于集合key中\nSRANDMEMBER  key  [count]//从集合key中选出count个元素，元素不从key中删除\nSPOP  key  [count]//从集合key中选出count个元素，元素从key中删除\n\nSet运算操作\nSINTER  key  [key ...]//交集运算\nSINTERSTORE  destination  key  [key ..]//将交集结果存入新集合destination中\nSUNION  key  [key ..]//并集运算\nSUNIONSTORE  destination  key  [key ...]//将并集结果存入新集合destination中\nSDIFF  key  [key ...]//差集运算\nSDIFFSTORE  destination  key  [key ...]//将差集结果存入新集合destination中\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("h3",{attrs:{id:"应用场景-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#应用场景-3"}},[s._v("#")]),s._v(" 应用场景")]),s._v(" "),a("h4",{attrs:{id:"微信抽奖小程序"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#微信抽奖小程序"}},[s._v("#")]),s._v(" 微信抽奖小程序")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("1）点击参与抽奖加入集合\nSADD key {userlD}\n2）查看参与抽奖所有用户\nSMEMBERS key\t  \n3）抽取count名中奖者\nSRANDMEMBER key [count] / SPOP key [count]\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h4",{attrs:{id:"微信微博点赞-收藏-标签"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#微信微博点赞-收藏-标签"}},[s._v("#")]),s._v(" 微信微博点赞，收藏，标签")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("1) 点赞\nSADD  like:{消息ID}  {用户ID}\n2) 取消点赞\nSREM like:{消息ID}  {用户ID}\n3) 检查用户是否点过赞\nSISMEMBER  like:{消息ID}  {用户ID}\n4) 获取点赞的用户列表\nSMEMBERS like:{消息ID}\n5) 获取点赞用户数 \nSCARD like:{消息ID}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h4",{attrs:{id:"集合操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#集合操作"}},[s._v("#")]),s._v(" 集合操作")]),s._v(" "),a("p",[a("img",{attrs:{src:"C:%5CUsers%5CNO%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210829142007066.png",alt:"image-20210829142007066"}})]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("SINTER set1 set2 set3  { c }\nSUNION set1 set2 set3  { a,b,c,d,e }\nSDIFF set1 set2 set3  { a }\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h4",{attrs:{id:"集合操作实现微博-微信关注模型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#集合操作实现微博-微信关注模型"}},[s._v("#")]),s._v(" 集合操作实现微博/微信关注模型")]),s._v(" "),a("p",[a("img",{attrs:{src:"C:%5CUsers%5CNO%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210829142109665.png",alt:"image-20210829142109665"}})]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("1) 诸葛老师关注的人: \nzhugeSet-> {guojia, xushu}\n2) 杨过老师关注的人:\n yangguoSet--\x3e {zhuge, baiqi, guojia, xushu}\n3) 郭嘉老师关注的人: \nguojiaSet-> {zhuge, yangguo, baiqi, xushu, xunyu)\n4) 我和杨过老师共同关注: \nSINTER zhugeSet yangguoSet--\x3e {guojia, xushu}\n5) 我关注的人也关注他(杨过老师): \nSISMEMBER guojiaSet yangguo \nSISMEMBER xushuSet yangguo\n6) 我可能认识的人: \nSDIFF yangguoSet zhugeSet->(zhuge, baiqi}\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("h4",{attrs:{id:"集合操作实现电商商品筛选"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#集合操作实现电商商品筛选"}},[s._v("#")]),s._v(" 集合操作实现电商商品筛选")]),s._v(" "),a("p",[a("img",{attrs:{src:"C:%5CUsers%5CNO%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210829142216697.png",alt:"image-20210829142216697"}})]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("SADD  brand:huawei  P40\nSADD  brand:xiaomi  mi-10\nSADD  brand:iPhone iphone12\nSADD os:android  P40  mi-10\nSADD cpu:brand:intel  P40  mi-10\nSADD ram:8G  P40  mi-10  iphone12\n\nSINTER  os:android  cpu:brand:intel  ram:8G   {P40，mi-10}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h3",{attrs:{id:"源码底层-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#源码底层-4"}},[s._v("#")]),s._v(" 源码底层")]),s._v(" "),a("p",[s._v("Set 为无序的，自动去重的集合数据类型，Set 数据结构底层实现为一个value 为 null 的 字典( dict ),当数据可以用整形表示时，Set集合将被编码为intset数据结构。两个条件任意满足时Set将用hashtable存储数据。1， 元素个数大于 set-max-intset-entries , 2 ， 元素无法用整形表示")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("set-max-intset-entries 512       // intset 能存储的最大元素个数，超过则用hashtable编码\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"C:%5CUsers%5CNO%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210829184326533.png",alt:"image-20210829184326533"}})]),s._v(" "),a("h2",{attrs:{id:"zset"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#zset"}},[s._v("#")]),s._v(" ZSet")]),s._v(" "),a("p",[a("img",{attrs:{src:"C:%5CUsers%5CNO%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210829142340316.png",alt:"image-20210829142340316"}})]),s._v(" "),a("h3",{attrs:{id:"常用操作-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常用操作-2"}},[s._v("#")]),s._v(" 常用操作")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("ZADD key score member [[score member]…]\t//往有序集合key中加入带分值元素\nZREM key member [member …]\t\t//从有序集合key中删除元素\nZSCORE key member \t\t\t//返回有序集合key中元素member的分值\nZINCRBY key increment member\t\t//为有序集合key中元素member的分值加上increment \nZCARD key\t\t\t\t//返回有序集合key中元素个数\nZRANGE key start stop [WITHSCORES]\t//正序获取有序集合key从start下标到stop下标的元素\nZREVRANGE key start stop [WITHSCORES]\t//倒序获取有序集合key从start下标到stop下标的元素\n\nZset集合操作\nZUNIONSTORE destkey numkeys key [key ...] \t//并集计算\nZINTERSTORE destkey numkeys key [key …]\t//交集计算\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("h3",{attrs:{id:"应用场景-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#应用场景-4"}},[s._v("#")]),s._v(" 应用场景")]),s._v(" "),a("h4",{attrs:{id:"zset集合操作实现排行榜"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#zset集合操作实现排行榜"}},[s._v("#")]),s._v(" ZSet集合操作实现排行榜")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("1）点击新闻\nZINCRBY  hotNews:20190819  1  守护香港\n2）展示当日排行前十\nZREVRANGE  hotNews:20190819  0  9  WITHSCORES \n3）七日搜索榜单计算\nZUNIONSTORE  hotNews:20190813-20190819  7 \nhotNews:20190813  hotNews:20190814... hotNews:20190819\n4）展示七日排行前十\nZREVRANGE hotNews:20190813-20190819  0  9  WITHSCORES\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[a("img",{attrs:{src:"C:%5CUsers%5CNO%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210829142441846.png",alt:"image-20210829142441846"}})]),s._v(" "),a("h3",{attrs:{id:"源码底层-5"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#源码底层-5"}},[s._v("#")]),s._v(" 源码底层")]),s._v(" "),a("p",[s._v("ZSet 为有序的，自动去重的集合数据类型，ZSet 数据结构底层实现为 字典(dict) + 跳表(skiplist) ,当数据比较少时，用ziplist编码结构存储。")]),s._v(" "),a("p",[a("img",{attrs:{src:"C:%5CUsers%5CNO%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210829184425050.png",alt:"image-20210829184425050"}})]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("zset-max-ziplist-entries  128    // 元素个数超过128 ，将用skiplist编码\nzset-max-ziplist-value     64     //  单个元素大小超过 64 byte, 将用 skiplist编码\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("strong",[s._v("Zset数据结构")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("Zset 数据结构\n// 创建zset 数据结构: 字典 + 跳表\nrobj *createZsetObject(void) {\n    zset *zs = zmalloc(sizeof(*zs));\n    robj *o;\n    // dict用来查询数据到分数的对应关系， 如 zscore 就可以直接根据 元素拿到分值 \n    zs->dict = dictCreate(&zsetDictType,NULL);\n    \n    // skiplist用来根据分数查询数据（可能是范围查找）\n    zs->zsl = zslCreate();\n\v    // 设置对象类型 \n    o = createObject(OBJ_ZSET,zs);\n\v     // 设置编码类型 \n    o->encoding = OBJ_ENCODING_SKIPLIST;\n    return o;\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("typedef struct zskiplistNode {\n    sds ele;\n    double score;\n    struct zskiplistNode *backward;\n    struct zskiplistLevel {\n        struct zskiplistNode *forward;\n        unsigned long span;\n    } level[];\n} zskiplistNode;\n\vtypedef struct zskiplist {\n    struct zskiplistNode *header, *tail;\n    unsigned long length;\n    int level;\n} zskiplist;\n\vtypedef struct zset {\n    dict *dict;\n    zskiplist *zsl;\n} zset;\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("h2",{attrs:{id:"skiplist"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#skiplist"}},[s._v("#")]),s._v(" skiplist")]),s._v(" "),a("p",[a("img",{attrs:{src:"C:%5CUsers%5CNO%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210829184700442.png",alt:"image-20210829184700442"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"C:%5CUsers%5CNO%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210829184709936.png",alt:"image-20210829184709936"}})]),s._v(" "),a("p",[a("strong",[s._v("原理")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/redis/skiplist.png",alt:""}})]),s._v(" "),a("p",[s._v("图二：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/redis/skiplist.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"bitmap-todo"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#bitmap-todo"}},[s._v("#")]),s._v(" BitMap TODO")]),s._v(" "),a("h2",{attrs:{id:"其他高级命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#其他高级命令"}},[s._v("#")]),s._v(" 其他高级命令")]),s._v(" "),a("h3",{attrs:{id:"keys"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#keys"}},[s._v("#")]),s._v(" keys")]),s._v(" "),a("p",[a("strong",[s._v("keys：全量遍历键")]),s._v("，用来列出所有满足特定正则字符串规则的key，当redis数据量比较大时，性能比较差，要避免使用")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/redis/9.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"scan"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#scan"}},[s._v("#")]),s._v(" scan")]),s._v(" "),a("p",[a("strong",[s._v("scan：渐进式遍历键")])]),s._v(" "),a("p",[s._v("SCAN cursor [MATCH pattern] [COUNT count]")]),s._v(" "),a("p",[s._v("scan 参数提供了三个参数，第一个是 cursor 整数值(hash桶的索引值)，第二个是 key 的正则模式，第三个是一次遍历的key的数量(参考值，底层遍历的数量不一定)，并不是符合条件的结果数量。第一次遍历时，cursor 值为 0，然后将返回结果中第一个整数值作为下一次遍历的 cursor。一直遍历到返回的 cursor 值为 0 时结束。")]),s._v(" "),a("p",[s._v("注意：但是scan并非完美无瑕， 如果在scan的过程中如果有键的变化（增加、 删除、 修改） ，那么遍历效果可能会碰到如下问题： 新增的键可能没有遍历到， 遍历出了重复的键等情况， 也就是说scan并不能保证完整的遍历出来所有的键， 这些是我们在开发时需要考虑的。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/redis/10.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/redis/11.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"info"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#info"}},[s._v("#")]),s._v(" info")]),s._v(" "),a("p",[a("strong",[s._v("Info：查看redis服务运行信息，分为 9 大块，每个块都有非常多的参数，这 9 个块分别是:")])]),s._v(" "),a("p",[s._v("Server 服务器运行的环境参数")]),s._v(" "),a("p",[s._v("Clients 客户端相关信息")]),s._v(" "),a("p",[s._v("Memory 服务器运行内存统计数据")]),s._v(" "),a("p",[s._v("Persistence 持久化信息")]),s._v(" "),a("p",[s._v("Stats 通用统计数据")]),s._v(" "),a("p",[s._v("Replication 主从复制相关信息")]),s._v(" "),a("p",[s._v("CPU CPU 使用情况")]),s._v(" "),a("p",[s._v("Cluster 集群信息")]),s._v(" "),a("p",[s._v("KeySpace 键值对统计数量信息")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/redis/12.png",alt:""}})]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("connected_clients:2                  # 正在连接的客户端数量\n\ninstantaneous_ops_per_sec:789        # 每秒执行多少次指令\n\nused_memory:929864                   # Redis分配的内存总量(byte)，包含redis进程内部的开销和数据占用的内存\nused_memory_human:908.07K            # Redis分配的内存总量(Kb，human会展示出单位)\nused_memory_rss_human:2.28M          # 向操作系统申请的内存大小(Mb)（这个值一般是大于used_memory的，因为Redis的内存分配策略会产生内存碎片）\nused_memory_peak:929864              # redis的内存消耗峰值(byte)\nused_memory_peak_human:908.07K       # redis的内存消耗峰值(KB)\n\nmaxmemory:0                         # 配置中设置的最大可使用内存值(byte),默认0,不限制\nmaxmemory_human:0B                  # 配置中设置的最大可使用内存值\nmaxmemory_policy:noeviction         # 当达到maxmemory时的淘汰策略\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("h2",{attrs:{id:"管道-pipeline"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#管道-pipeline"}},[s._v("#")]),s._v(" 管道（Pipeline）")]),s._v(" "),a("p",[s._v("客户端可以一次性发送多个请求而不用等待服务器的响应，待所有命令都发送完后再一次性读取服务的响应，这样可以极大的降低多条命令执行的网络传输开销，管道执行多条命令的网络开销实际上只相当于一次命令执行的网络开销。需要注意到是用pipeline方式打包命令发送，redis必须在"),a("strong",[s._v("处理完所有命令前先缓存起所有命令的处理结果")]),s._v("。打包的命令越多，缓存消耗内存也越多。所以并不是打包的命令越多越好。")]),s._v(" "),a("p",[s._v("pipeline中发送的每个command都会被server立即执行，如果执行失败，将会在此后的响应中得到信息；也就是pipeline并不是表达“所有command都一起成功”的语义，管道中前面命令失败，后面命令不会有影响，继续执行。")]),s._v(" "),a("p",[s._v("详细代码示例见上面jedis连接示例：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('Pipeline pl = jedis.pipelined();\nfor (int i = 0; i < 10; i++) {\n    pl.incr("pipelineKey");\n    pl.set("zhuge" + i, "zhuge");\n    //模拟管道报错\n    // pl.setbit("zhuge", -1, true);\n}\nList<Object> results = pl.syncAndReturnAll();\nSystem.out.println(results);\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h2",{attrs:{id:"redis-lua脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#redis-lua脚本"}},[s._v("#")]),s._v(" Redis Lua脚本")]),s._v(" "),a("p",[s._v("Redis在2.6推出了脚本功能，允许开发者使用Lua语言编写脚本传到Redis中执行。使用脚本的好处如下:")]),s._v(" "),a("p",[s._v("1、"),a("strong",[s._v("减少网络开销")]),s._v("：本来5次网络请求的操作，可以用一个请求完成，原先5次请求的逻辑放在redis服务器上完成。使用脚本，减少了网络往返时延。"),a("strong",[s._v("这点跟管道类似")]),s._v("。")]),s._v(" "),a("p",[s._v("2、"),a("strong",[s._v("原子操作")]),s._v("：Redis会将整个脚本作为一个整体执行，中间不会被其他命令插入。"),a("strong",[s._v("管道不是原子的，不过redis的批量操作命令(类似mset)是原子的。")])]),s._v(" "),a("p",[s._v("3、"),a("strong",[s._v("替代redis的事务功能")]),s._v("：redis自带的事务功能很鸡肋，而redis的lua脚本几乎实现了常规的事务功能，官方推荐如果要使用redis的事务功能可以用redis lua替代。")]),s._v(" "),a("p",[a("strong",[s._v("官网文档上有这样一段话：")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("A Redis script is transactional by definition, so everything you can do with a Redis transaction, you can also do with a script, \nand usually the script will be both simpler and faster.\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("从Redis2.6.0版本开始，通过内置的Lua解释器，可以使用EVAL命令对Lua脚本进行求值。EVAL命令的格式如下：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("EVAL script numkeys key [key ...] arg [arg ...]　\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("script参数是一段Lua脚本程序，它会被运行在Redis服务器上下文中，这段脚本"),a("strong",[s._v("不必(也不应该)定义为一个Lua函数")]),s._v("。numkeys参数用于指定键名参数的个数。键名参数 key [key ...] 从EVAL的第三个参数开始算起，表示在脚本中所用到的那些Redis键(key)，这些键名参数可以在 Lua中通过全局变量KEYS数组，用1为基址的形式访问( KEYS[1] ， KEYS[2] ，以此类推)。")]),s._v(" "),a("p",[s._v("在命令的最后，那些不是键名参数的附加参数 arg [arg ...] ，可以在Lua中通过全局变量"),a("strong",[s._v("ARGV")]),s._v("数组访问，访问的形式和KEYS变量类似( ARGV[1] 、 ARGV[2] ，诸如此类)。例如")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('127.0.0.1:6379> eval "return {KEYS[1],KEYS[2],ARGV[1],ARGV[2]}" 2 key1 key2 first second\n1) "key1"\n2) "key2"\n3) "first"\n4) "second"\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v('其中 "return {KEYS[1],KEYS[2],ARGV[1],ARGV[2]}" 是被求值的Lua脚本，数字2指定了键名参数的数量， key1和key2是键名参数，分别使用 KEYS[1] 和 KEYS[2] 访问，而最后的 first 和 second 则是附加参数，可以通过 ARGV[1] 和 ARGV[2] 访问它们。')]),s._v(" "),a("p",[s._v("在 Lua 脚本中，可以使用**redis.call()**函数来执行Redis命令")]),s._v(" "),a("p",[s._v("Jedis调用示例详见上面jedis连接示例：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('jedis.set("product_stock_10016", "15");  //初始化商品10016的库存\nString script = " local count = redis.call(\'get\', KEYS[1]) " +\n                " local a = tonumber(count) " +\n                " local b = tonumber(ARGV[1]) " +\n                " if a >= b then " +\n                "   redis.call(\'set\', KEYS[1], a-b) " +\n                "   return 1 " +\n                " end " +\n                " return 0 ";\nObject obj = jedis.eval(script, Arrays.asList("product_stock_10016"), Arrays.asList("10"));\nSystem.out.println(obj);\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[a("strong",[s._v("注意，不要在Lua脚本中出现死循环和耗时的运算，否则redis会阻塞，将不接受其他的命令， 所以使用时要注意不能出现死循环、耗时的运算。redis是单进程、单线程执行脚本。管道不会阻塞redis。")])]),s._v(" "),a("h2",{attrs:{id:"geohash算法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#geohash算法"}},[s._v("#")]),s._v(" GeoHash算法")]),s._v(" "),a("p",[s._v("GeoHash是一种地理位置编码方法。 由Gustavo Niemeyer 和 G.M. Morton于2008年发明，它将地理位置编码为一串简短的字母和数字。它是一种分层的空间数据结构，将空间细分为网格形状的桶，这是所谓的z顺序曲线的众多应用之一，通常是空间填充曲线。")]),s._v(" "),a("h3",{attrs:{id:"geohash经纬度编码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#geohash经纬度编码"}},[s._v("#")]),s._v(" GeoHash经纬度编码")]),s._v(" "),a("p",[s._v("经度范围是东经180到西经180，纬度范围是南纬90到北纬90，我们设定西经为负，南纬为负，所以地球上的经度范围就是[-180， 180]，纬度范围就是[-90，90]。")]),s._v(" "),a("p",[s._v("如果以本初子午线、赤道为界，地球可以分成4个部分。")]),s._v(" "),a("p",[s._v("如果纬度范围[-90°, 0°)用二进制0代表，（0°, 90°]用二进制1代表，经度范围[-180°, 0°)用二进制0代表，（0°, 180°]用二进制1代表，那么地球可以分成如下(左图 )4个部分")]),s._v(" "),a("p",[a("img",{attrs:{src:"C:%5CUsers%5CNO%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210829184910984.png",alt:"image-20210829184910984"}})]),s._v(" "),a("p",[s._v("通过GeoHash算法，可以将经纬度的二维坐标变成一个可排序、可比较的的字符串编码。 在编码中的每个字符代表一个区域，并且前面的字符是后面字符的父区域。")]),s._v(" "),a("p",[a("strong",[s._v("其算法的过程如下：")])]),s._v(" "),a("p",[s._v("根据GeoHash 来计算纬度的 二进制编码")]),s._v(" "),a("p",[s._v("地球纬度区间是[-90,90]， 如某纬度是39.92324，可以通过下面算法来进行维度编码:")]),s._v(" "),a("p",[s._v("1）区间[-90,90]进行二分为[-90,0),[0,90]，称为左右区间，可以确定39.92324属于右区间[0,90]，给标记为1")]),s._v(" "),a("p",[s._v("2）接着将区间[0,90]进行二分为 [0,45),[45,90]，可以确定39.92324属于左区间 [0,45)，给标记为0")]),s._v(" "),a("p",[s._v("3）递归上述过程39.92324总是属于某个区间[a,b]。随着每次迭代区间[a,b]总在缩小，并越来越逼近39.928167")]),s._v(" "),a("p",[s._v("4）如果给定的纬度（39.92324）属于左区间，则记录0，如果属于右区间则记录1，这样随着算法的进行会产生一个序列1011 1000 1100 0111 1001，序列的长度跟给定的区间划分次数有关。")]),s._v(" "),a("p",[a("img",{attrs:{src:"C:%5CUsers%5CNO%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210829185118746.png",alt:"image-20210829185118746"}})]),s._v(" "),a("p",[s._v("最后使用用0-9、b-z（去掉a, i, l, o）这32个字母进行base32编码，首先将11100 11101 00100 01111 00000 01101 01011 00001转成十进制 28，29，4，15，0，13，11，1，十进制对应的编码就是wx4g0ec1。同理，将编码转换成经纬度的解码算法与之相反")]),s._v(" "),a("p",[a("img",{attrs:{src:"C:%5CUsers%5CNO%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210829185144362.png",alt:"image-20210829185144362"}})]),s._v(" "),a("h3",{attrs:{id:"geohash优缺"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#geohash优缺"}},[s._v("#")]),s._v(" GeoHash优缺")]),s._v(" "),a("ul",[a("li",[s._v("优点：")])]),s._v(" "),a("p",[s._v("GeoHash利用Z阶曲线进行编码，Z阶曲线可以将二维所有点都转换成一阶曲线。地理位置坐标点通过编码转化成一维值，利用 有序数据结构如B树、SkipList等，均可进行范围搜索。因此利用GeoHash算法查找邻近点比较快")]),s._v(" "),a("ul",[a("li",[s._v("缺点：")])]),s._v(" "),a("p",[s._v("Z 阶曲线有一个比较严重的问题，虽然有局部保序性，但是它也有突变性。在每个 Z 字母的拐角，都有可能出现顺序的突变。")])])}),[],!1,null,null,null);a.default=n.exports}}]);
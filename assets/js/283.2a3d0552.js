(window.webpackJsonp=window.webpackJsonp||[]).push([[283],{627:function(e,s,n){"use strict";n.r(s);var r=n(1),a=Object(r.a)({},(function(){var e=this,s=e._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"简介"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[e._v("#")]),e._v(" 简介")]),e._v(" "),s("p",[e._v("本文介绍观察者模式最基础的写法：手动组装Map。")]),e._v(" "),s("p",[s("strong",[e._v("本写法的优缺点")])]),e._v(" "),s("p",[e._v("优点")]),e._v(" "),s("ol",[s("li",[e._v("纯手写，有利于理解观察者模式的原理。")])]),e._v(" "),s("p",[e._v("缺点")]),e._v(" "),s("ol",[s("li",[e._v("需要手动注册观察者，不能自动处理。")])]),e._v(" "),s("h1",{attrs:{id:"实例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实例"}},[e._v("#")]),e._v(" 实例")]),e._v(" "),s("p",[e._v("本处使用一个贴近真实场景的案例：订单取消时，要有一系列操作，比如：账户业务需要给用户退钱、库存业务需要给商品退回数量。")]),e._v(" "),s("p",[e._v("在这个场景中，取消订单就是被观察者，账户业务和库存业务是观察者。")]),e._v(" "),s("p",[e._v("项目结构")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/nylg/picture/raw/master/springboot/image-20230912174346634.png",alt:"image-20230912174346634"}})]),e._v(" "),s("p",[e._v("源码地址")]),e._v(" "),s("p",[e._v("源码地址是："),s("a",{attrs:{href:"https://resource.skyofit.com/learn/resource/project/backend/design-pattern/observer/manual.zip",target:"_blank",rel:"noopener noreferrer"}},[e._v("这里"),s("OutboundLink")],1)]),e._v(" "),s("h2",{attrs:{id:"业务数据类"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#业务数据类"}},[e._v("#")]),e._v(" 业务数据类")]),e._v(" "),s("p",[e._v("取消订单时，主题会将这个数据给到感兴趣的观察者。")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("package com.knife.designPattern.bo;\nimport lombok.Data;\n@Data\npublic class CancelOrderBO {\n    private String orderNo;\n}\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br")])]),s("h2",{attrs:{id:"主题-取消订单"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#主题-取消订单"}},[e._v("#")]),e._v(" 主题（取消订单）")]),e._v(" "),s("p",[e._v("本处只使用到了被观察者的具体类，无需抽象被观察者。")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('package com.knife.designPattern.subject;\nimport com.knife.designPattern.bo.CancelOrderBO;\nimport com.knife.designPattern.observer.CancelOrderObserver;\nimport java.util.ArrayList;\nimport java.util.List;\n/**\n * 具体被观察者（主题）: 订单取消\n */\npublic class CancelOrderSubject {\n    private final List<CancelOrderObserver> list = new ArrayList<>();\n    public void addObserver(CancelOrderObserver cancelOrderObserver) {\n        list.add(cancelOrderObserver);\n    }\n    public void removeObserver(CancelOrderObserver cancelOrderObserver) {\n        list.remove(cancelOrderObserver);\n    }\n    public void process(CancelOrderBO cancelOrderBO) {\n        System.out.println("订单取消的相关数据：" + cancelOrderBO);\n        for (CancelOrderObserver cancelOrderObserver : list) {\n            cancelOrderObserver.process(cancelOrderBO);\n        }\n    }\n}\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br"),s("span",{staticClass:"line-number"},[e._v("15")]),s("br"),s("span",{staticClass:"line-number"},[e._v("16")]),s("br"),s("span",{staticClass:"line-number"},[e._v("17")]),s("br"),s("span",{staticClass:"line-number"},[e._v("18")]),s("br"),s("span",{staticClass:"line-number"},[e._v("19")]),s("br"),s("span",{staticClass:"line-number"},[e._v("20")]),s("br"),s("span",{staticClass:"line-number"},[e._v("21")]),s("br"),s("span",{staticClass:"line-number"},[e._v("22")]),s("br"),s("span",{staticClass:"line-number"},[e._v("23")]),s("br")])]),s("h2",{attrs:{id:"观察者"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#观察者"}},[e._v("#")]),e._v(" 观察者")]),e._v(" "),s("p",[e._v("抽象观察者")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("package com.knife.designPattern.observer;\nimport com.knife.designPattern.bo.CancelOrderBO;\n/**\n * 抽象观察者：业务\n */\n public interface CancelOrderObserver {\n    /**\n     * 业务收到订单取消数据后的操作\n     */\n    void process(CancelOrderBO cancelOrderBO);\n}\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br")])]),s("p",[e._v("具体观察者（账户业务）")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('package com.knife.designPattern.observer.impl;\nimport com.knife.designPattern.bo.CancelOrderBO;\nimport com.knife.designPattern.observer.CancelOrderObserver;\n/**\n * 具体观察者: 账户业务\n */\npublic class AccountCancelOrderObserverImpl implements CancelOrderObserver {\n    @Override\n    public void process(CancelOrderBO cancelOrderBO) {\n        System.out.println("账户业务开始处理订单取消。接收到的消息：" + cancelOrderBO);\n    }\n}\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br")])]),s("p",[e._v("具体观察者（库存业务）")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('package com.knife.designPattern.observer.impl;\nimport com.knife.designPattern.bo.CancelOrderBO;\nimport com.knife.designPattern.observer.CancelOrderObserver;\n/**\n * 具体观察者: 库存业务\n */\npublic class StorageCancelOrderObserverImpl implements CancelOrderObserver {\n    @Override\n    public void process(CancelOrderBO cancelOrderBO) {\n        System.out.println("库存业务开始处理订单取消。接收到的消息：" + cancelOrderBO);\n    }\n}\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br")])]),s("h2",{attrs:{id:"主题持有者"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#主题持有者"}},[e._v("#")]),e._v(" 主题持有者")]),e._v(" "),s("p",[e._v("只有主题还不行，需要有一个地方去调用它，添加一个主题持有者")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("package com.knife.designPattern.subject;\nimport com.knife.designPattern.bo.CancelOrderBO;\nimport com.knife.designPattern.observer.CancelOrderObserver;\nimport com.knife.designPattern.observer.impl.AccountCancelOrderObserverImpl;\nimport com.knife.designPattern.observer.impl.StorageCancelOrderObserverImpl;\npublic class SubjectHolder {\n    private static final CancelOrderSubject instance = init();\n    private SubjectHolder() {\n    }\n    private static CancelOrderSubject init() {\n        // 创建被观察者\n        CancelOrderSubject orderCancelSubject = new CancelOrderSubject();\n        // 创建观察者\n        CancelOrderObserver accountCancelOrderObserver =\n                new AccountCancelOrderObserverImpl();\n        CancelOrderObserver storageCancelOrderObserver =\n                new StorageCancelOrderObserverImpl();\n        // 添加观察者\n        orderCancelSubject.addObserver(accountCancelOrderObserver);\n        orderCancelSubject.addObserver(storageCancelOrderObserver);\n        return orderCancelSubject;\n    }\n    public static void process(CancelOrderBO cancelOrderBO) {\n        instance.process(cancelOrderBO);\n    }\n}\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br"),s("span",{staticClass:"line-number"},[e._v("15")]),s("br"),s("span",{staticClass:"line-number"},[e._v("16")]),s("br"),s("span",{staticClass:"line-number"},[e._v("17")]),s("br"),s("span",{staticClass:"line-number"},[e._v("18")]),s("br"),s("span",{staticClass:"line-number"},[e._v("19")]),s("br"),s("span",{staticClass:"line-number"},[e._v("20")]),s("br"),s("span",{staticClass:"line-number"},[e._v("21")]),s("br"),s("span",{staticClass:"line-number"},[e._v("22")]),s("br"),s("span",{staticClass:"line-number"},[e._v("23")]),s("br"),s("span",{staticClass:"line-number"},[e._v("24")]),s("br"),s("span",{staticClass:"line-number"},[e._v("25")]),s("br"),s("span",{staticClass:"line-number"},[e._v("26")]),s("br")])]),s("h2",{attrs:{id:"测试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#测试"}},[e._v("#")]),e._v(" 测试")]),e._v(" "),s("p",[e._v("测试类")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('package com.knife.designPattern.controller;\nimport com.knife.designPattern.bo.CancelOrderBO;\nimport com.knife.designPattern.subject.SubjectHolder;\nimport io.swagger.annotations.Api;\nimport io.swagger.annotations.ApiOperation;\nimport org.springframework.web.bind.annotation.PostMapping;\nimport org.springframework.web.bind.annotation.RequestBody;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RestController;\n@Api(tags = "订单")\n@RestController\n@RequestMapping("order")\npublic class OrderController {\n    @ApiOperation("取消订单")\n    @PostMapping("cancel")\n    public String cancel(@RequestBody CancelOrderBO cancelOrderBO) {\n        SubjectHolder.process(cancelOrderBO);\n        return "success";\n    }\n}\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br"),s("span",{staticClass:"line-number"},[e._v("15")]),s("br"),s("span",{staticClass:"line-number"},[e._v("16")]),s("br"),s("span",{staticClass:"line-number"},[e._v("17")]),s("br"),s("span",{staticClass:"line-number"},[e._v("18")]),s("br"),s("span",{staticClass:"line-number"},[e._v("19")]),s("br"),s("span",{staticClass:"line-number"},[e._v("20")]),s("br")])]),s("p",[e._v("访问接口")]),e._v(" "),s("p",[e._v("启动项目后，访问Knife4j（接口文档）的地址：http://localhost:8080/doc.html")]),e._v(" "),s("p",[e._v("（当然，你用postman也完全可以）")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/nylg/picture/raw/master/springboot/image-20230912174534780.png",alt:"image-20230912174534780"}})]),e._v(" "),s("p",[e._v("结果")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("订单取消的相关数据：CancelOrderBO(orderNo=1234)\n账户业务开始处理订单取消。接收到的消息：CancelOrderBO(orderNo=1234)\n库存业务开始处理订单取消。接收到的消息：CancelOrderBO(orderNo=1234)\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br")])])])}),[],!1,null,null,null);s.default=a.exports}}]);
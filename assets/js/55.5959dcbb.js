(window.webpackJsonp=window.webpackJsonp||[]).push([[55],{397:function(e,s,r){"use strict";r.r(s);var a=r(1),t=Object(a.a)({},(function(){var e=this,s=e._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("p",[s("strong",[e._v("看源码方法：")])]),e._v(" "),s("p",[e._v("1、**先使用：**先看官方文档快速掌握框架的基本使用")]),e._v(" "),s("p",[e._v("2、**抓主线：**找一个demo入手，顺藤摸瓜快速静态看一遍框架的主线源码，画出源码主流程图，切勿一开始就陷入源码的细枝末节，否则会把自己绕晕，凭经验猜")]),e._v(" "),s("p",[e._v("3、**画图做笔记：**总结框架的一些核心功能点，从这些功能点入手深入到源码的细节，"),s("strong",[e._v("边看源码边画源码走向图")]),e._v("，并对关键源码的理解做笔记，把源码里的闪光点都记录下来，后续借鉴到工作项目中，理解能力强的可以直接看静态源码，也可以边看源码边debug源码执行过程，观察一些关键变量的值")]),e._v(" "),s("p",[e._v("4、**整合总结：**所有功能点的源码都分析完后，回到主流程图再梳理一遍，争取把自己画的所有图都在脑袋里做一个整合")]),e._v(" "),s("ol",[s("li",[s("p",[e._v("启动或leader宕机选举流程")])]),e._v(" "),s("li",[s("p",[e._v("客户端与服务端交互流程（NIO/Netty）")])]),e._v(" "),s("li",[s("p",[e._v("写入数据的ZAB一致性协议（如何保证消息的顺序性）")])]),e._v(" "),s("li",[s("p",[e._v("Watch监听触发机制")])]),e._v(" "),s("li",[s("p",[e._v("zookeeper原名环境搭建")])]),e._v(" "),s("li",[s("p",[e._v("从zookeeper源码如何启动集群")])]),e._v(" "),s("li",[s("p",[e._v("zookeeper集群leader选举流程刨析")])]),e._v(" "),s("li",[s("p",[e._v("zookeeper集群leader宕机如何重新选举leader")])]),e._v(" "),s("li",[s("p",[e._v("zookeeper底层leader选举多层队列架构刨析")])])]),e._v(" "),s("p",[s("strong",[e._v("从源码启动zookeeper")])]),e._v(" "),s("p",[e._v("zookeeper源码下载地址：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("//选择分支3.5.8\nhttps://github.com/apache/zookeeper.git  \n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br")])]),s("p",[s("img",{attrs:{src:"https://gitee.com/nylg/picture/raw/master/zookeeper/70.png",alt:""}})]),e._v(" "),s("p",[e._v("源码导入idea后，org.apache.zookeeper.Version类会报错，需要建一个辅助类")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('package org.apache.zookeeper.version;\n\npublic interface Info {\n    int MAJOR = 1;\n    int MINOR = 0;\n    int MICRO = 0;\n    String QUALIFIER = null;\n    int REVISION = -1;\n    String REVISION_HASH = "1";\n    String BUILD_DATE = "2020-10-15";\n}\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br")])]),s("p",[e._v("然后在根目录编译执行：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("mvn clean install -DskipTests\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("p",[e._v("开源项目找入口类一般都是从启动脚本去找，可以从bin目录下的zkServer.sh或zkServer.cmd里找到启动主类运行即可")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("org.apache.zookeeper.server.quorum.QuorumPeerMain\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("p",[s("strong",[e._v("注意")]),e._v("：")]),e._v(" "),s("p",[e._v("1、将conf文件夹里的zoo_sample.cfg文件复制一份改名为zoo.cfg，将zoo.cfg文件位置配置到启动参数里")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/nylg/picture/raw/master/zookeeper/71.png",alt:""}})]),e._v(" "),s("p",[e._v("2、启动之前需要先将zookeeper-server项目里pom.xml文件里依赖的包(除了jline)的scope为provided这一行全部注释掉")]),e._v(" "),s("p",[e._v("2、将conf文件夹里的log4j.properties文件复制一份到zookeeper-server项目的 \\target\\classes 目录下，这样项目启动时才会打印日志")]),e._v(" "),s("p",[s("strong",[e._v("用客户端命令连接源码启动的server：")])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("bin/zkCli.sh -server 192.168.50.190:2181\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("p",[s("strong",[e._v("从源码里运行客户端("),s("strong",[e._v("org.apache.zookeeper.ZooKeeperMain")]),e._v(")，注意需要加入启动参数，见下图：")])]),e._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/nylg/picture/raw/master/zookeeper/72.png",alt:""}})]),e._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/nylg/picture/raw/master/zookeeper/73.png",alt:""}})]),e._v(" "),s("p",[s("strong",[e._v("从源码启动zookeeper集群(参考视频讲解)")])]),e._v(" "),s("p",[e._v("复制3个zoo.cfg文件，修改对应集群配置，并在data目录里分别建各自的myid文件填入机器id，并创建三个不同配置的启动节点，见下图：")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/nylg/picture/raw/master/zookeeper/74.png",alt:""}})]),e._v(" "),s("p",[e._v("分别运行每个节点，集群启动完毕！")])])}),[],!1,null,null,null);s.default=t.exports}}]);
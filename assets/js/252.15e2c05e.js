(window.webpackJsonp=window.webpackJsonp||[]).push([[252],{618:function(s,n,e){"use strict";e.r(n);var t=e(5),a=Object(t.a)({},(function(){var s=this,n=s._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("U2FsdGVkX1/S7HH5NUrdyVhviiKntn8kGLYFAAQlRC3xVB7AoPgavWInJ/aaQHQb\nd5x6INh2s+yFuIrvMMR1SaU10Bi2lrjjaTBrRtYjK6q6AMbtDwgfoLrTXRKNi8yY\nEg==\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[n("strong",[s._v("1. Spring扩展点")])]),s._v(" "),n("ul",[n("li",[n("p",[n("strong",[s._v("BeanFactoryPostProcessor")])])]),s._v(" "),n("li",[n("ul",[n("li",[n("strong",[s._v("BeanDefinitionRegistryPostProcessor")])])])]),s._v(" "),n("li",[n("p",[n("strong",[s._v("BeanPostProcessor")])])]),s._v(" "),n("li",[n("ul",[n("li",[n("strong",[s._v("InstantiationAwareBeanPostProcessor")])]),s._v(" "),n("li",[n("strong",[s._v("AbstractAutoProxyCreator")])])])]),s._v(" "),n("li",[n("p",[n("strong",[s._v("@Import")])])]),s._v(" "),n("li",[n("ul",[n("li",[n("strong",[s._v("Impor"),n("strong",[n("strong",[s._v("tBeanDefi")])]),s._v("nitionRegistrar")])]),s._v(" "),n("li",[n("strong",[s._v("ImportSelector")])])])]),s._v(" "),n("li",[n("p",[n("strong",[s._v("Aware")])])]),s._v(" "),n("li",[n("p",[n("strong",[s._v("InitializingBean")])])]),s._v(" "),n("li",[n("p",[n("strong",[s._v("FactoryBean")])])]),s._v(" "),n("li",[n("p",[n("strong",[s._v("SmartInitializingSingleton")])])]),s._v(" "),n("li",[n("p",[n("strong",[s._v("ApplicationListener")])])]),s._v(" "),n("li",[n("p",[n("strong",[s._v("Lifecycle")])])]),s._v(" "),n("li",[n("ul",[n("li",[n("strong",[s._v("SmartLifecycle")])]),s._v(" "),n("li",[n("strong",[s._v("LifecycleProcessor")])])])]),s._v(" "),n("li",[n("p",[n("strong",[s._v("HandlerInterceptor")])])]),s._v(" "),n("li",[n("p",[n("strong",[s._v("MethodInterceptor")])])])]),s._v(" "),n("p",[s._v("https://www.processon.com/view/link/5eafa609f346fb177ba8091f")]),s._v(" "),n("p",[n("strong",[s._v("2.")]),s._v(" "),n("strong",[s._v("Spring扩展点应用场景")])]),s._v(" "),n("p",[n("strong",[s._v("2.1 整合Nacos")])]),s._v(" "),n("p",[n("strong",[s._v("思考： 为什么整合Nacos注册中心后，服务启动就会自动注册，Nacos是如何实现自动服务注册的？")])]),s._v(" "),n("p",[n("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/springboot/image-20220623171706002.png",alt:"image-20220623171706002"}})]),s._v(" "),n("p",[n("strong",[s._v("NacosAutoServiceRegistration")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# 对ApplicationListener的扩展\nAbstractAutoServiceRegistration#onApplicationEvent\n# 服务注册\n》NacosServiceRegistry#register\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("​")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/springboot/image-20220623171720271.png",alt:"image-20220623171720271"}})]),s._v(" "),n("p",[s._v("​")]),s._v(" "),n("p",[n("a",{attrs:{href:"https://www.processon.com/view/link/5ea27ca15653bb6efc68eb8c",target:"_blank",rel:"noopener noreferrer"}},[n("strong",[s._v("https://www.processon.com/view/link/5ea27ca15653bb6efc68eb8c")]),n("OutboundLink")],1)]),s._v(" "),n("p",[n("strong",[s._v("NacosWatch：")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("#对SmartLifecycle的扩展\nNacosWatch#start\n#订阅服务接收实例更改的事件\n》NamingService#subscribe \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[n("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/springboot/image-20220623171729813.png",alt:"image-20220623171729813"}})]),s._v(" "),n("p",[n("strong",[s._v("扩展：")]),s._v(" "),n("strong",[s._v("Eureka Server端上下文的初始化是在SmartLifecycle#start中实现的")])]),s._v(" "),n("p",[n("strong",[s._v("EurekaServerInitializerConfiguration")])]),s._v(" "),n("p",[n("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/springboot/image-20220623171739539.png",alt:"image-20220623171739539"}})]),s._v(" "),n("p",[n("strong",[s._v("2.2 整合Feign")])]),s._v(" "),n("p",[n("strong",[s._v("思考：为什么Feign接口可以通过@Autowired直接注入使用？Feign接口是如何交给Spring管理的？")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('@FeignClient(value = "mall-order",path = "/order")\npublic interface OrderFeignService {\n\n    @RequestMapping("/findOrderByUserId/{userId}")\n    R findOrderByUserId(@PathVariable("userId") Integer userId);\n}\n\n@RestController\n@RequestMapping("/user")\npublic class UserController {\n\n    @Autowired\n    OrderFeignService orderFeignService;\n\n    @RequestMapping(value = "/findOrderByUserId/{id}")\n    public R  findOrderByUserId(@PathVariable("id") Integer id) {\n        //feign调用\n        R result = orderFeignService.findOrderByUserId(id);\n        return result;\n    }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br")])]),n("p",[n("strong",[s._v("FeignClientsRegistrar")])]),s._v(" "),n("p",[n("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/springboot/image-20220623171751712.png",alt:"image-20220623171751712"}})]),s._v(" "),n("p",[n("strong",[s._v("FeignClientFactorybean")])]),s._v(" "),n("p",[n("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/springboot/image-20220623171759817.png",alt:"image-20220623171759817"}})]),s._v(" "),n("p",[s._v("https://www.processon.com/view/link/5e80ae79e4b03b99653fe42f")]),s._v(" "),n("p",[n("strong",[s._v("2.3 整合Ribbon")])]),s._v(" "),n("p",[n("strong",[s._v("思考：为什么@Bean修饰的RestTemplate加上@LoadBalanced就能实现负载均衡功能？")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("@Bean\n@LoadBalanced\npublic RestTemplate restTemplate() {\n    return new RestTemplate();\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[n("strong",[s._v("LoadBalancerAutoConfiguration")])]),s._v(" "),n("p",[s._v("对SmartInitializingSingleton的扩展，为所有用@LaodBalanced修饰的restTemplate（利用了@Qualifier）绑定实现了负载均衡逻辑的拦截器LoadBalancerInterceptor")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/springboot/image-20220623171812275.png",alt:"image-20220623171812275"}})]),s._v(" "),n("p",[n("strong",[s._v("LoadBalancerInterceptor")])]),s._v(" "),n("p",[n("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/springboot/image-20220623171831504.png",alt:"image-20220623171831504"}})]),s._v(" "),n("p",[s._v("https://www.processon.com/view/link/5e7466dce4b027d999bdaddb")]),s._v(" "),n("p",[n("strong",[s._v("2.4 整合sentinel")])]),s._v(" "),n("p",[n("strong",[s._v("AbstractSentinelInterceptor")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# Webmvc接口资源保护入口\nAbstractSentinelInterceptor#preHandle\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[n("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/springboot/image-20220623171844168.png",alt:"image-20220623171844168"}})]),s._v(" "),n("p",[n("strong",[s._v("SentinelDataSourceHandler")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("#Sentinel持久化读数据源设计，利用了SmartInitializingSingleton扩展点\nSentinelDataSourceHandler#afterSingletonsInstantiated\n# 注册一个FactoryBean类型的数据源 \n》SentinelDataSourceHandler#registerBean\n》》NacosDataSourceFactoryBean#getObject\n# 利用FactoryBean获取到读数据源\n》》new NacosDataSource(properties, groupId, dataId, converter)\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("​")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/springboot/image-20220623171905906.png",alt:"image-20220623171905906"}})]),s._v(" "),n("p",[n("strong",[s._v("NacosDataSourceFactoryBean")])]),s._v(" "),n("p",[n("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/springboot/image-20220623171913071.png",alt:"image-20220623171913071"}})]),s._v(" "),n("p",[n("strong",[s._v("2.5 整合seata")])]),s._v(" "),n("p",[n("strong",[s._v("GlobalTransactionScanner")])]),s._v(" "),n("p",[n("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/springboot/image-20220623171925294.png",alt:"image-20220623171925294"}})]),s._v(" "),n("p",[n("strong",[s._v("GlobalTransactionalInterceptor")])]),s._v(" "),n("p",[n("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/springboot/image-20220623171936094.png",alt:"image-20220623171936094"}})]),s._v(" "),n("p",[n("a",{attrs:{href:"https://www.processon.com/view/link/5f743063e0b34d0711f001d2",target:"_blank",rel:"noopener noreferrer"}},[n("strong",[s._v("https://www.processon.com/view/link/5f743063e0b34d0711f001d2")]),n("OutboundLink")],1)]),s._v(" "),n("p",[n("strong",[s._v("3. Nacos配置中心源码分析")])]),s._v(" "),n("p",[s._v("https://www.processon.com/view/link/603f3d2fe401fd641adb51f1")])])}),[],!1,null,null,null);n.default=a.exports}}]);
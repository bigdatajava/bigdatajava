(window.webpackJsonp=window.webpackJsonp||[]).push([[258],{624:function(n,s,t){"use strict";t.r(s);var a=t(5),e=Object(a.a)({},(function(){var n=this,s=n._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[s("p",[s("strong",[n._v("属性是spu级别的比如：电脑有内存、cpu、硬盘")])]),n._v(" "),s("p",[n._v("规格是sku级别的比如：多大内存、什么颜色的、什么尺寸的（价格也有不同 比如iphone土豪金的配置就要比其他颜色相同的配置要高 那这个颜色就是属于规格）")]),n._v(" "),s("p",[s("strong",[n._v("缓存：")])]),n._v(" "),s("p",[s("strong",[n._v("后台问题描述")])]),n._v(" "),s("p",[n._v("访问数据库查询商品信息：")]),n._v(" "),s("p",[n._v("读多写少")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("/**\n * 获取商品详情信息\n *\n * @param id 产品ID\n */\npublic PmsProductParam getProductInfo(Long id) {\n    PmsProductParam productInfo = null;\n    productInfo = portalProductDao.getProductInfo(id);\n    if (null == productInfo) {\n        return productInfo;\n    }\n    FlashPromotionParam promotion = flashPromotionProductDao.getFlashPromotion(id);\n    if (!ObjectUtils.isEmpty(promotion)) {\n        productInfo.setFlashPromotionCount(promotion.getRelation().get(0).getFlashPromotionCount());\n        productInfo.setFlashPromotionLimit(promotion.getRelation().get(0).getFlashPromotionLimit());\n        productInfo.setFlashPromotionPrice(promotion.getRelation().get(0).getFlashPromotionPrice());\n        productInfo.setFlashPromotionRelationId(promotion.getRelation().get(0).getId());\n        productInfo.setFlashPromotionEndDate(promotion.getEndDate());\n        productInfo.setFlashPromotionStartDate(promotion.getStartDate());\n        productInfo.setFlashPromotionStatus(promotion.getStatus());\n    }\n    return productInfo;\n}\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br")])]),s("p",[s("strong",[n._v("前端静态化页面：")])]),n._v(" "),s("p",[n._v("我们发现上节课通过我们对数据进行静态化，也是有很多问题的，比如我们商品如果过多，freemark模板一定修改之后，我们所有的商品都需要重新再次生产静态化，这个工作量实在是太大了。")]),n._v(" "),s("p",[s("strong",[n._v("引入****缓存:")])]),n._v(" "),s("p",[s("strong",[n._v("缓存作用:")])]),n._v(" "),s("p",[s("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/huancun2/image-20220414185321710.png",alt:"image-20220414185321710"}})]),n._v(" "),s("p",[s("strong",[n._v("实战：")])]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("/**\n * 获取商品详情信息\n *\n * @param id 产品ID\n */\npublic PmsProductParam getProductInfo(Long id) {\n    PmsProductParam productInfo = null;\n \n    productInfo = redisOpsUtil.get(RedisKeyPrefixConst.PRODUCT_DETAIL_CACHE + id, PmsProductParam.class);\n    if (productInfo != null) {\n        return productInfo;\n    }\n    productInfo = portalProductDao.getProductInfo(id);\n    if (null == productInfo) {\n        return null;\n    }\n    FlashPromotionParam promotion = flashPromotionProductDao.getFlashPromotion(id);\n    if (!ObjectUtils.isEmpty(promotion)) {\n        productInfo.setFlashPromotionCount(promotion.getRelation().get(0).getFlashPromotionCount());\n        productInfo.setFlashPromotionLimit(promotion.getRelation().get(0).getFlashPromotionLimit());\n        productInfo.setFlashPromotionPrice(promotion.getRelation().get(0).getFlashPromotionPrice());\n        productInfo.setFlashPromotionRelationId(promotion.getRelation().get(0).getId());\n        productInfo.setFlashPromotionEndDate(promotion.getEndDate());\n        productInfo.setFlashPromotionStartDate(promotion.getStartDate());\n        productInfo.setFlashPromotionStatus(promotion.getStatus());\n    }\n    redisOpsUtil.set(RedisKeyPrefixConst.PRODUCT_DETAIL_CACHE + id, productInfo, 3600, TimeUnit.SECONDS);\n    return productInfo;\n}\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br")])]),s("p",[n._v("有两种：")]),n._v(" "),s("p",[n._v("1、最终一致性方案：")]),n._v(" "),s("p",[n._v("设置超时时间来解决")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("redisOpsUtil.set(RedisKeyPrefixConst.PRODUCT_DETAIL_CACHE+id,productInfo,360,TimeUnit.SECONDS);\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br")])]),s("p",[n._v("2、实时一致性方案：")]),n._v(" "),s("p",[n._v("​      课程讲到 交易canal binlog")]),n._v(" "),s("p",[n._v("两个问题(高并发)、压缩的问题》减少内存")]),n._v(" "),s("p",[s("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/huancun2/image-20220414185416407.png",alt:"image-20220414185416407"}})]),n._v(" "),s("p",[s("strong",[n._v("现在有什么问题了？")])]),n._v(" "),s("p",[s("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/huancun2/image-20220414185432932.png",alt:"image-20220414185432932"}})]),n._v(" "),s("p",[n._v("跟我们预期只set一次redis 是有出入，为何会这样子了？"),s("strong",[n._v("并发问题")])]),n._v(" "),s("p",[n._v("当我第二次再去访问，此时此刻没有日志输出，说明全部走了缓存：")]),n._v(" "),s("p",[n._v("并发问题：并发编程》并发问题》锁的方式来实现 java并发 加锁方式（不适合》特殊》分布式）")]),n._v(" "),s("p",[n._v("分布式锁：redis、zookeeper")]),n._v(" "),s("p",[s("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/huancun2/image-20220414185442149.png",alt:"image-20220414185442149"}})]),n._v(" "),s("p",[n._v("QPS立马就提高了很多。")]),n._v(" "),s("p",[s("strong",[n._v("加入分布式锁:")])]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("\x3c!--加入redisson--\x3e\n<dependency>\n    <groupId>org.redisson</groupId>\n    <artifactId>redisson</artifactId>\n    <version>3.6.5</version>\n</dependency>\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br")])]),s("p",[n._v("setnx")]),n._v(" "),s("p",[s("strong",[n._v("缓存应用场景：")])]),n._v(" "),s("p",[n._v("1、访问量大、QPS高、更新频率不是很高的业务")]),n._v(" "),s("p",[n._v("2、数据一致性要求不高")]),n._v(" "),s("p",[s("strong",[n._v("缓存不足:")])]),n._v(" "),s("p",[s("strong",[n._v("缓存击穿问题（热点数据单个key）：")])]),n._v(" "),s("p",[n._v("对于一些设置了过期时间的key，如果这些key可能会在某些时间点被超高并发地访问，是一种非常“热点”的数据。这个时候，需要考虑一个问题：缓存被“击穿”的问题，这个和缓存雪崩的区别在于这里针对某一key缓存，前者则是很多key。")]),n._v(" "),s("p",[s("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/huancun2/image-20220414185452258.png",alt:"image-20220414185452258"}})]),n._v(" "),s("p",[s("strong",[n._v("解决方案：")])]),n._v(" "),s("p",[s("strong",[n._v("1.加锁")]),n._v("，在未命中缓存时，通过加锁避免大量请求访问数据库")]),n._v(" "),s("p",[s("strong",[n._v("2.不允许过期")]),n._v("。物理不过期，也就是不设置过期时间。而是逻辑上定时在后台异步的更新数据。")]),n._v(" "),s("p",[s("strong",[n._v("3.采用二级缓存")]),n._v("。L1缓存失效时间短，L2缓存失效时间长。请求优先从L1缓存获取数据，如果未命中，则加锁，保证只有一个线程去数据库中读取数据然后再更新到L1和L2中。然后其他线程依然在L2缓存获取数据。")]),n._v(" "),s("p",[s("strong",[n._v("缓存穿透问题（恶意攻击、访问不存在数据）：")])]),n._v(" "),s("p",[n._v("缓存穿透是指查询一个一定不存在的数据，由于缓存是不命中时被动写的，并且出于容错考虑，如果从存储层查不到数据则不写入缓存，这将导致这个不存在的数据每次请求都要到存储层去查询，失去了缓存的意义。在流量大时，可能DB就挂掉了，要是有人利用不存在的key频繁攻击我们的应用，这就是漏洞。")]),n._v(" "),s("p",[s("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/huancun2/image-20220414185458787.png",alt:"image-20220414185458787"}})]),n._v(" "),s("p",[n._v("**解决方案：**有很多种方法可以有效地解决缓存穿透问题")]),n._v(" "),s("p",[n._v("1、最常见的则是采用布隆过滤器，将所有可能存在的数据哈希到一个足够大的bitmap中，一个一定不存在的数据会被 这个bitmap拦截掉，从而避免了对底层存储系统的查询压力。")]),n._v(" "),s("p",[n._v("2、另外也有一个更为简单粗暴的方法（我们采用的就是这种），如果一个查询返回的数据为空（不管是数 据不存在，还是系统故障），我们仍然把这个空结果进行缓存，但它的过期时间会很短，最长不超过五分钟。")]),n._v(" "),s("p",[s("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/huancun2/image-20220414185505912.png",alt:"image-20220414185505912"}})]),n._v(" "),s("p",[s("strong",[n._v("缓存雪崩（同一时间失效，并发量大）：")])]),n._v(" "),s("p",[n._v("存雪崩是指在我们设置缓存时采用了相同的过期时间，导致缓存在某一时刻同时失效，请求全部转发到DB，DB瞬时压力过重雪崩。")]),n._v(" "),s("p",[s("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/huancun2/image-20220414185512382.png",alt:"image-20220414185512382"}})]),n._v(" "),s("p",[s("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/huancun2/image-20220414185519147.png",alt:"image-20220414185519147"}})]),n._v(" "),s("p",[s("strong",[n._v("解决方案：")])]),n._v(" "),s("p",[n._v("**1、**缓存失效时的雪崩效应对底层系统的冲击非常可怕。大多数系统设计者考虑用加锁或者队列的方式保证缓存的单线 程（进程）写，从而避免失效时大量的并发请求落到底层存储系统上。这里分享一个简单方案就时讲缓存失效时间分散开，比如我们可以在原有的失效时间基础上增加一个随机值，比如1-5分钟随机，这样每一个缓存的过期时间的重复率就会降低，就很难引发集体失效的事件。")]),n._v(" "),s("p",[s("strong",[n._v("2、事前")]),n._v("：这种方案就是在发生雪崩前对缓存集群实现高可用，如果是使用 Redis，可以使用 主从+哨兵 ，Redis Cluster 来避免 Redis 全盘崩溃的情况。")]),n._v(" "),s("p",[s("strong",[n._v("3、事中")]),n._v("：使用 Hystrix进行限流 & 降级 ，比如一秒来了5000个请求，我们可以设置假设只能有一秒 2000个请求能通过这个组件，那么其他剩余的 3000 请求就会走限流逻辑。然后去调用我们自己开发的降级组件（降级），比如设置的一些默认值呀之类的。以此来保护最后的 MySQL 不会被大量的请求给打死。")]),n._v(" "),s("p",[s("strong",[n._v("4、事后")]),n._v("：开启Redis持久化机制，尽快恢复缓存集群")]),n._v(" "),s("p",[s("strong",[n._v("缓存和数据库双写一致性问题：")])]),n._v(" "),s("p",[n._v("一致性问题是分布式常见问题，还可以再分为最终一致性和强一致性。数据库和缓存双写，就必然会存在不一致的问题。")]),n._v(" "),s("p",[n._v("答这个问题，先明白一个前提。就是如果对数据有强一致性要求，不能放缓存。")]),n._v(" "),s("p",[n._v("我们所做的一切，只能保证最终一致性。另外，我们所做的方案其实从根本上来说，只能说降低不一致发生的概率，无法完全避免。因此，有强一致性要求的数据，不能放缓存。")]),n._v(" "),s("p",[n._v("zk>临时顺序节点》原子性 线程创建如果可以创建成功，是否第一个 拿到了锁")]),n._v(" "),s("p",[n._v("12345")]),n._v(" "),s("p",[s("strong",[n._v("引入分布式锁：")])]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('\x3c!--加入redisson--\x3e\n<dependency>\n    <groupId>org.redisson</groupId>\n    <artifactId>redisson</artifactId>\n    <version>3.6.5</version>\n</dependency>\n \n@Bean\npublic RedissonClient redissonClient(){\n    Config config = new Config();\n    config.useSingleServer().setAddress("redis://tlshop.com:6379").setPassword("123456").setDatabase(1);\n    return Redisson.create(config);\n}\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br")])]),s("p",[s("strong",[n._v("单机加锁：")])]),n._v(" "),s("p",[s("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/huancun2/image-20220414185527252.png",alt:"image-20220414185527252"}})]),n._v(" "),s("p",[s("strong",[n._v("分布式加锁：")])]),n._v(" "),s("p",[n._v("同一时间同一个数据请求过来，比如set 100  value：（1 2 3）")]),n._v(" "),s("p",[s("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/huancun2/image-20220414185535598.png",alt:"image-20220414185535598"}})]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('/**\n * 获取商品详情信息\n *\n * @param id 产品ID\n */\npublic PmsProductParam getProductInfo(Long id) {\n    PmsProductParam productInfo = null;\n    productInfo = redisOpsUtil.get(RedisKeyPrefixConst.PRODUCT_DETAIL_CACHE + id, PmsProductParam.class);\n    if (productInfo != null) {\n        log.info("get redis productId:" + productInfo);\n        return productInfo;\n    }\n    try {\n        if (zkLock.lock(lockPath + "_" + id)) {\n            productInfo = portalProductDao.getProductInfo(id);\n            if (null == productInfo) {\n                return null;\n            }\n            checkFlash(id, productInfo);\n            log.info("set db productId:" + productInfo);\n            //缓存失效时间随机\n            redisOpsUtil.set(RedisKeyPrefixConst.PRODUCT_DETAIL_CACHE + id, productInfo, 3600, TimeUnit.SECONDS);\n        } else {\n            //问题：返回为null\n            productInfo = redisOpsUtil.get(RedisKeyPrefixConst.PRODUCT_DETAIL_CACHE + id, PmsProductParam.class);\n        }\n    } finally {\n        log.info("unlock :" + productInfo);\n        zkLock.unlock(lockPath + "_" + id);\n    }\n    return productInfo;\n}\n \nprivate void checkFlash(Long id, PmsProductParam productInfo) {\n    FlashPromotionParam promotion = flashPromotionProductDao.getFlashPromotion(id);\n    if (!ObjectUtils.isEmpty(promotion)) {\n        productInfo.setFlashPromotionCount(promotion.getRelation().get(0).getFlashPromotionCount());\n        productInfo.setFlashPromotionLimit(promotion.getRelation().get(0).getFlashPromotionLimit());\n        productInfo.setFlashPromotionPrice(promotion.getRelation().get(0).getFlashPromotionPrice());\n        productInfo.setFlashPromotionRelationId(promotion.getRelation().get(0).getId());\n        productInfo.setFlashPromotionEndDate(promotion.getEndDate());\n        productInfo.setFlashPromotionStartDate(promotion.getStartDate());\n        productInfo.setFlashPromotionStatus(promotion.getStatus());\n    }\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br"),s("span",{staticClass:"line-number"},[n._v("35")]),s("br"),s("span",{staticClass:"line-number"},[n._v("36")]),s("br"),s("span",{staticClass:"line-number"},[n._v("37")]),s("br"),s("span",{staticClass:"line-number"},[n._v("38")]),s("br"),s("span",{staticClass:"line-number"},[n._v("39")]),s("br"),s("span",{staticClass:"line-number"},[n._v("40")]),s("br"),s("span",{staticClass:"line-number"},[n._v("41")]),s("br"),s("span",{staticClass:"line-number"},[n._v("42")]),s("br"),s("span",{staticClass:"line-number"},[n._v("43")]),s("br"),s("span",{staticClass:"line-number"},[n._v("44")]),s("br")])]),s("p",[n._v("我们发现在高并发下增加了分布式锁可以解决刚才那个问题，但是也降低了qps，所以这儿还是要根据需求而定")]),n._v(" "),s("p",[s("strong",[n._v("分布式锁原理：")])]),n._v(" "),s("p",[n._v("zk图")]),n._v(" "),s("p",[s("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/huancun2/image-20220414185737104.png",alt:"image-20220414185737104"}})]),n._v(" "),s("p",[n._v("附录：PmsProductServiceImpl.java：redis缓存使用")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('package com.tuling.tulingmall.service.impl;\n\n@Slf4j\n@Service\npublic class PmsProductServiceImpl implements PmsProductService {\n\n    @Autowired\n    private PortalProductDao portalProductDao;\n\n    @Autowired\n    private FlashPromotionProductDao flashPromotionProductDao;\n\n    @Autowired\n    private SmsFlashPromotionMapper flashPromotionMapper;\n\n    @Autowired\n    private SmsFlashPromotionSessionMapper promotionSessionMapper;\n\n    @Autowired\n    private RedisOpsUtil redisOpsUtil;\n\n    private Map<String, PmsProductParam> cacheMap = new ConcurrentHashMap<>();\n\n    @Autowired\n    private LocalCache cache;\n\n\n    /*\n     * zk分布式锁\n     */\n    @Autowired\n    private ZKLock zkLock;\n    private String lockPath = "/load_db";\n\n    @Autowired\n    RedissonClient redission;\n\n\n    /**\n     * 获取商品详情信息\n     *\n     * @param id 产品ID\n     */\n    public PmsProductParam getProductInfo(Long id) {\n        PmsProductParam productInfo = redisOpsUtil.get(RedisKeyPrefixConst.PRODUCT_DETAIL_CACHE + id, PmsProductParam.class);\n        if (null != productInfo) {\n            return productInfo;\n        }\n        RLock lock = redission.getLock(lockPath + id);\n        try {\n            if (lock.tryLock()) {\n                productInfo = portalProductDao.getProductInfo(id);\n                System.out.println("走数据库" + id);\n                if (null == productInfo) {\n                    return null;\n                }\n                FlashPromotionParam promotion = flashPromotionProductDao.getFlashPromotion(id);\n                if (!ObjectUtils.isEmpty(promotion)) {\n                    productInfo.setFlashPromotionCount(promotion.getRelation().get(0).getFlashPromotionCount());\n                    productInfo.setFlashPromotionLimit(promotion.getRelation().get(0).getFlashPromotionLimit());\n                    productInfo.setFlashPromotionPrice(promotion.getRelation().get(0).getFlashPromotionPrice());\n                    productInfo.setFlashPromotionRelationId(promotion.getRelation().get(0).getId());\n                    productInfo.setFlashPromotionEndDate(promotion.getEndDate());\n                    productInfo.setFlashPromotionStartDate(promotion.getStartDate());\n                    productInfo.setFlashPromotionStatus(promotion.getStatus());\n                }\n                redisOpsUtil.set(RedisKeyPrefixConst.PRODUCT_DETAIL_CACHE + id, productInfo, 360, TimeUnit.SECONDS);\n            } else {\n                productInfo = redisOpsUtil.get(RedisKeyPrefixConst.PRODUCT_DETAIL_CACHE + id, PmsProductParam.class);\n            }\n        } finally {\n            if (lock.isLocked()){\n                if (lock.isHeldByCurrentThread()){\n                    lock.unlock();\n                }\n            }\n\n        }\n        return productInfo;\n    }\n\n    /***\n     * 直接访问数据库\n     * @param id\n     * @return\n     */\n    public PmsProductParam getProductInfo1(Long id) {\n        PmsProductParam productInfo = portalProductDao.getProductInfo(id);\n        if (null == productInfo) {\n            return null;\n        }\n        FlashPromotionParam promotion = flashPromotionProductDao.getFlashPromotion(id);\n        if (!ObjectUtils.isEmpty(promotion)) {\n            productInfo.setFlashPromotionCount(promotion.getRelation().get(0).getFlashPromotionCount());\n            productInfo.setFlashPromotionLimit(promotion.getRelation().get(0).getFlashPromotionLimit());\n            productInfo.setFlashPromotionPrice(promotion.getRelation().get(0).getFlashPromotionPrice());\n            productInfo.setFlashPromotionRelationId(promotion.getRelation().get(0).getId());\n            productInfo.setFlashPromotionEndDate(promotion.getEndDate());\n            productInfo.setFlashPromotionStartDate(promotion.getStartDate());\n            productInfo.setFlashPromotionStatus(promotion.getStatus());\n        }\n        return productInfo;\n    }\n\n    /**\n     * 获取商品详情信息  加入redis\n     *\n     * @param id 产品ID\n     */\n    public PmsProductParam getProductInfo2(Long id) {\n        PmsProductParam productInfo = null;\n        //从缓存Redis里找\n        productInfo = redisOpsUtil.get(RedisKeyPrefixConst.PRODUCT_DETAIL_CACHE + id, PmsProductParam.class);\n        if (null != productInfo) {\n            return productInfo;\n        }\n        productInfo = portalProductDao.getProductInfo(id);\n        System.out.println("我被执行了");\n        if (null == productInfo) {\n            log.warn("没有查询到商品信息,id:" + id);\n            return null;\n        }\n        checkFlash(id, productInfo);\n        redisOpsUtil.set(RedisKeyPrefixConst.PRODUCT_DETAIL_CACHE + id, productInfo, 3600, TimeUnit.SECONDS);\n        return productInfo;\n    }\n\n\n    /**\n     * 获取商品详情信息  加入redis 加入锁\n     *\n     * @param id 产品ID\n     */\n    /**\n     * 获取商品详情信息  加入redis 加入锁\n     *\n     * @param id 产品ID\n     */\n    public PmsProductParam getProductInfo3(Long id) {\n        PmsProductParam productInfo = null;\n        //从缓存Redis里找\n        productInfo = redisOpsUtil.get(RedisKeyPrefixConst.PRODUCT_DETAIL_CACHE + id, PmsProductParam.class);\n        if (null != productInfo) {\n            return productInfo;\n        }\n        RLock lock = redission.getLock(lockPath + id);\n        try {\n            if (lock.tryLock()) {\n                productInfo = portalProductDao.getProductInfo(id);\n                if (null == productInfo) {\n                    log.warn("没有查询到商品信息,id:" + id);\n                    return null;\n                }\n                checkFlash(id, productInfo);\n                redisOpsUtil.set(RedisKeyPrefixConst.PRODUCT_DETAIL_CACHE + id, productInfo, 3600, TimeUnit.SECONDS);\n            } else {\n                productInfo = redisOpsUtil.get(RedisKeyPrefixConst.PRODUCT_DETAIL_CACHE + id, PmsProductParam.class);\n            }\n        } finally {\n            if (lock.isLocked()) {\n                if (lock.isHeldByCurrentThread())\n                    lock.unlock();\n            }\n        }\n        return productInfo;\n    }\n\n    /**\n     * 获取商品详情信息 分布式锁、 本地缓存、redis缓存\n     *\n     * @param id 产品ID\n     */\n    public PmsProductParam getProductInfo4(Long id) {\n        PmsProductParam productInfo = null;\n        productInfo = cache.get(RedisKeyPrefixConst.PRODUCT_DETAIL_CACHE + id);\n        if (null != productInfo) {\n            return productInfo;\n        }\n        productInfo = redisOpsUtil.get(RedisKeyPrefixConst.PRODUCT_DETAIL_CACHE + id, PmsProductParam.class);\n        if (productInfo != null) {\n            log.info("get redis productId:" + productInfo);\n            cache.setLocalCache(RedisKeyPrefixConst.PRODUCT_DETAIL_CACHE + id, productInfo);\n            return productInfo;\n        }\n        RLock lock = redission.getLock(lockPath + id);\n        try {\n            if (lock.tryLock()) {\n                productInfo = portalProductDao.getProductInfo(id);\n                if (null == productInfo) {\n                    return null;\n                }\n                checkFlash(id, productInfo);\n                log.info("set db productId:" + productInfo);\n                redisOpsUtil.set(RedisKeyPrefixConst.PRODUCT_DETAIL_CACHE + id, productInfo, 3600, TimeUnit.SECONDS);\n                cache.setLocalCache(RedisKeyPrefixConst.PRODUCT_DETAIL_CACHE + id, productInfo);\n            } else {\n                log.info("get redis2 productId:" + productInfo);\n                productInfo = redisOpsUtil.get(RedisKeyPrefixConst.PRODUCT_DETAIL_CACHE + id, PmsProductParam.class);\n                if (productInfo != null) {\n                    cache.setLocalCache(RedisKeyPrefixConst.PRODUCT_DETAIL_CACHE + id, productInfo);\n                }\n            }\n        } finally {\n            if (lock.isLocked()) {\n                if (lock.isHeldByCurrentThread())\n                    lock.unlock();\n            }\n        }\n        return productInfo;\n    }\n\n    private void checkFlash(Long id, PmsProductParam productInfo) {\n        FlashPromotionParam promotion = flashPromotionProductDao.getFlashPromotion(id);\n        if (!ObjectUtils.isEmpty(promotion)) {\n            productInfo.setFlashPromotionCount(promotion.getRelation().get(0).getFlashPromotionCount());\n            productInfo.setFlashPromotionLimit(promotion.getRelation().get(0).getFlashPromotionLimit());\n            productInfo.setFlashPromotionPrice(promotion.getRelation().get(0).getFlashPromotionPrice());\n            productInfo.setFlashPromotionRelationId(promotion.getRelation().get(0).getId());\n            productInfo.setFlashPromotionEndDate(promotion.getEndDate());\n            productInfo.setFlashPromotionStartDate(promotion.getStartDate());\n            productInfo.setFlashPromotionStatus(promotion.getStatus());\n        }\n    }\n\n\n    /**\n     * add by yangguo\n     * 获取秒杀商品列表\n     *\n     * @param flashPromotionId 秒杀活动ID，关联秒杀活动设置\n     * @param sessionId        场次活动ID，for example：13:00-14:00场等\n     */\n    public List<FlashPromotionProduct> getFlashProductList(Integer pageSize, Integer pageNum, Long flashPromotionId, Long sessionId) {\n        PageHelper.startPage(pageNum, pageSize, "sort desc");\n        return flashPromotionProductDao.getFlashProductList(flashPromotionId, sessionId);\n    }\n\n    /**\n     * 获取当前日期秒杀活动所有场次\n     *\n     * @return\n     */\n    public List<FlashPromotionSessionExt> getFlashPromotionSessionList() {\n        Date now = new Date();\n        SmsFlashPromotion promotion = getFlashPromotion(now);\n        if (promotion != null) {\n            SmsFlashPromotionSessionExample sessionExample = new SmsFlashPromotionSessionExample();\n            //获取时间段内的秒杀场次\n            sessionExample.createCriteria().andStatusEqualTo(1);//启用状态\n            sessionExample.setOrderByClause("start_time asc");\n            List<SmsFlashPromotionSession> promotionSessionList = promotionSessionMapper.selectByExample(sessionExample);\n            List<FlashPromotionSessionExt> extList = new ArrayList<>();\n            if (!CollectionUtils.isEmpty(promotionSessionList)) {\n                promotionSessionList.stream().forEach((item) -> {\n                    FlashPromotionSessionExt ext = new FlashPromotionSessionExt();\n                    BeanUtils.copyProperties(item, ext);\n                    ext.setFlashPromotionId(promotion.getId());\n                    if (DateUtil.getTime(now).after(DateUtil.getTime(ext.getStartTime()))\n                            && DateUtil.getTime(now).before(DateUtil.getTime(ext.getEndTime()))) {\n                        //活动进行中\n                        ext.setSessionStatus(0);\n                    } else if (DateUtil.getTime(now).after(DateUtil.getTime(ext.getEndTime()))) {\n                        //活动即将开始\n                        ext.setSessionStatus(1);\n                    } else if (DateUtil.getTime(now).before(DateUtil.getTime(ext.getStartTime()))) {\n                        //活动已结束\n                        ext.setSessionStatus(2);\n                    }\n                    extList.add(ext);\n                });\n                return extList;\n            }\n        }\n        return null;\n    }\n\n    //根据时间获取秒杀活动\n    public SmsFlashPromotion getFlashPromotion(Date date) {\n        Date currDate = DateUtil.getDate(date);\n        SmsFlashPromotionExample example = new SmsFlashPromotionExample();\n        example.createCriteria()\n                .andStatusEqualTo(1)\n                .andStartDateLessThanOrEqualTo(currDate)\n                .andEndDateGreaterThanOrEqualTo(currDate);\n        List<SmsFlashPromotion> flashPromotionList = flashPromotionMapper.selectByExample(example);\n        if (!CollectionUtils.isEmpty(flashPromotionList)) {\n            return flashPromotionList.get(0);\n        }\n        return null;\n    }\n\n    /**\n     * 获取首页的秒杀商品列表\n     *\n     * @return\n     */\n    public List<FlashPromotionProduct> getHomeSecKillProductList() {\n        PageHelper.startPage(1, 8, "sort desc");\n        FlashPromotionParam flashPromotionParam = flashPromotionProductDao.getFlashPromotion(null);\n        if (flashPromotionParam == null || CollectionUtils.isEmpty(flashPromotionParam.getRelation())) {\n            return null;\n        }\n        List<Long> promotionIds = new ArrayList<>();\n        flashPromotionParam.getRelation().stream().forEach(item -> {\n            promotionIds.add(item.getId());\n        });\n        PageHelper.clearPage();\n        return flashPromotionProductDao.getHomePromotionProductList(promotionIds);\n    }\n\n    @Override\n    public CartProduct getCartProduct(Long productId) {\n        return portalProductDao.getCartProduct(productId);\n    }\n\n    @Override\n    public List<PromotionProduct> getPromotionProductList(List<Long> ids) {\n        return portalProductDao.getPromotionProductList(ids);\n    }\n\n    /**\n     * 查找出所有的产品ID\n     *\n     * @return\n     */\n    public List<Long> getAllProductId() {\n        return portalProductDao.getAllProductId();\n    }\n}\n\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br"),s("span",{staticClass:"line-number"},[n._v("35")]),s("br"),s("span",{staticClass:"line-number"},[n._v("36")]),s("br"),s("span",{staticClass:"line-number"},[n._v("37")]),s("br"),s("span",{staticClass:"line-number"},[n._v("38")]),s("br"),s("span",{staticClass:"line-number"},[n._v("39")]),s("br"),s("span",{staticClass:"line-number"},[n._v("40")]),s("br"),s("span",{staticClass:"line-number"},[n._v("41")]),s("br"),s("span",{staticClass:"line-number"},[n._v("42")]),s("br"),s("span",{staticClass:"line-number"},[n._v("43")]),s("br"),s("span",{staticClass:"line-number"},[n._v("44")]),s("br"),s("span",{staticClass:"line-number"},[n._v("45")]),s("br"),s("span",{staticClass:"line-number"},[n._v("46")]),s("br"),s("span",{staticClass:"line-number"},[n._v("47")]),s("br"),s("span",{staticClass:"line-number"},[n._v("48")]),s("br"),s("span",{staticClass:"line-number"},[n._v("49")]),s("br"),s("span",{staticClass:"line-number"},[n._v("50")]),s("br"),s("span",{staticClass:"line-number"},[n._v("51")]),s("br"),s("span",{staticClass:"line-number"},[n._v("52")]),s("br"),s("span",{staticClass:"line-number"},[n._v("53")]),s("br"),s("span",{staticClass:"line-number"},[n._v("54")]),s("br"),s("span",{staticClass:"line-number"},[n._v("55")]),s("br"),s("span",{staticClass:"line-number"},[n._v("56")]),s("br"),s("span",{staticClass:"line-number"},[n._v("57")]),s("br"),s("span",{staticClass:"line-number"},[n._v("58")]),s("br"),s("span",{staticClass:"line-number"},[n._v("59")]),s("br"),s("span",{staticClass:"line-number"},[n._v("60")]),s("br"),s("span",{staticClass:"line-number"},[n._v("61")]),s("br"),s("span",{staticClass:"line-number"},[n._v("62")]),s("br"),s("span",{staticClass:"line-number"},[n._v("63")]),s("br"),s("span",{staticClass:"line-number"},[n._v("64")]),s("br"),s("span",{staticClass:"line-number"},[n._v("65")]),s("br"),s("span",{staticClass:"line-number"},[n._v("66")]),s("br"),s("span",{staticClass:"line-number"},[n._v("67")]),s("br"),s("span",{staticClass:"line-number"},[n._v("68")]),s("br"),s("span",{staticClass:"line-number"},[n._v("69")]),s("br"),s("span",{staticClass:"line-number"},[n._v("70")]),s("br"),s("span",{staticClass:"line-number"},[n._v("71")]),s("br"),s("span",{staticClass:"line-number"},[n._v("72")]),s("br"),s("span",{staticClass:"line-number"},[n._v("73")]),s("br"),s("span",{staticClass:"line-number"},[n._v("74")]),s("br"),s("span",{staticClass:"line-number"},[n._v("75")]),s("br"),s("span",{staticClass:"line-number"},[n._v("76")]),s("br"),s("span",{staticClass:"line-number"},[n._v("77")]),s("br"),s("span",{staticClass:"line-number"},[n._v("78")]),s("br"),s("span",{staticClass:"line-number"},[n._v("79")]),s("br"),s("span",{staticClass:"line-number"},[n._v("80")]),s("br"),s("span",{staticClass:"line-number"},[n._v("81")]),s("br"),s("span",{staticClass:"line-number"},[n._v("82")]),s("br"),s("span",{staticClass:"line-number"},[n._v("83")]),s("br"),s("span",{staticClass:"line-number"},[n._v("84")]),s("br"),s("span",{staticClass:"line-number"},[n._v("85")]),s("br"),s("span",{staticClass:"line-number"},[n._v("86")]),s("br"),s("span",{staticClass:"line-number"},[n._v("87")]),s("br"),s("span",{staticClass:"line-number"},[n._v("88")]),s("br"),s("span",{staticClass:"line-number"},[n._v("89")]),s("br"),s("span",{staticClass:"line-number"},[n._v("90")]),s("br"),s("span",{staticClass:"line-number"},[n._v("91")]),s("br"),s("span",{staticClass:"line-number"},[n._v("92")]),s("br"),s("span",{staticClass:"line-number"},[n._v("93")]),s("br"),s("span",{staticClass:"line-number"},[n._v("94")]),s("br"),s("span",{staticClass:"line-number"},[n._v("95")]),s("br"),s("span",{staticClass:"line-number"},[n._v("96")]),s("br"),s("span",{staticClass:"line-number"},[n._v("97")]),s("br"),s("span",{staticClass:"line-number"},[n._v("98")]),s("br"),s("span",{staticClass:"line-number"},[n._v("99")]),s("br"),s("span",{staticClass:"line-number"},[n._v("100")]),s("br"),s("span",{staticClass:"line-number"},[n._v("101")]),s("br"),s("span",{staticClass:"line-number"},[n._v("102")]),s("br"),s("span",{staticClass:"line-number"},[n._v("103")]),s("br"),s("span",{staticClass:"line-number"},[n._v("104")]),s("br"),s("span",{staticClass:"line-number"},[n._v("105")]),s("br"),s("span",{staticClass:"line-number"},[n._v("106")]),s("br"),s("span",{staticClass:"line-number"},[n._v("107")]),s("br"),s("span",{staticClass:"line-number"},[n._v("108")]),s("br"),s("span",{staticClass:"line-number"},[n._v("109")]),s("br"),s("span",{staticClass:"line-number"},[n._v("110")]),s("br"),s("span",{staticClass:"line-number"},[n._v("111")]),s("br"),s("span",{staticClass:"line-number"},[n._v("112")]),s("br"),s("span",{staticClass:"line-number"},[n._v("113")]),s("br"),s("span",{staticClass:"line-number"},[n._v("114")]),s("br"),s("span",{staticClass:"line-number"},[n._v("115")]),s("br"),s("span",{staticClass:"line-number"},[n._v("116")]),s("br"),s("span",{staticClass:"line-number"},[n._v("117")]),s("br"),s("span",{staticClass:"line-number"},[n._v("118")]),s("br"),s("span",{staticClass:"line-number"},[n._v("119")]),s("br"),s("span",{staticClass:"line-number"},[n._v("120")]),s("br"),s("span",{staticClass:"line-number"},[n._v("121")]),s("br"),s("span",{staticClass:"line-number"},[n._v("122")]),s("br"),s("span",{staticClass:"line-number"},[n._v("123")]),s("br"),s("span",{staticClass:"line-number"},[n._v("124")]),s("br"),s("span",{staticClass:"line-number"},[n._v("125")]),s("br"),s("span",{staticClass:"line-number"},[n._v("126")]),s("br"),s("span",{staticClass:"line-number"},[n._v("127")]),s("br"),s("span",{staticClass:"line-number"},[n._v("128")]),s("br"),s("span",{staticClass:"line-number"},[n._v("129")]),s("br"),s("span",{staticClass:"line-number"},[n._v("130")]),s("br"),s("span",{staticClass:"line-number"},[n._v("131")]),s("br"),s("span",{staticClass:"line-number"},[n._v("132")]),s("br"),s("span",{staticClass:"line-number"},[n._v("133")]),s("br"),s("span",{staticClass:"line-number"},[n._v("134")]),s("br"),s("span",{staticClass:"line-number"},[n._v("135")]),s("br"),s("span",{staticClass:"line-number"},[n._v("136")]),s("br"),s("span",{staticClass:"line-number"},[n._v("137")]),s("br"),s("span",{staticClass:"line-number"},[n._v("138")]),s("br"),s("span",{staticClass:"line-number"},[n._v("139")]),s("br"),s("span",{staticClass:"line-number"},[n._v("140")]),s("br"),s("span",{staticClass:"line-number"},[n._v("141")]),s("br"),s("span",{staticClass:"line-number"},[n._v("142")]),s("br"),s("span",{staticClass:"line-number"},[n._v("143")]),s("br"),s("span",{staticClass:"line-number"},[n._v("144")]),s("br"),s("span",{staticClass:"line-number"},[n._v("145")]),s("br"),s("span",{staticClass:"line-number"},[n._v("146")]),s("br"),s("span",{staticClass:"line-number"},[n._v("147")]),s("br"),s("span",{staticClass:"line-number"},[n._v("148")]),s("br"),s("span",{staticClass:"line-number"},[n._v("149")]),s("br"),s("span",{staticClass:"line-number"},[n._v("150")]),s("br"),s("span",{staticClass:"line-number"},[n._v("151")]),s("br"),s("span",{staticClass:"line-number"},[n._v("152")]),s("br"),s("span",{staticClass:"line-number"},[n._v("153")]),s("br"),s("span",{staticClass:"line-number"},[n._v("154")]),s("br"),s("span",{staticClass:"line-number"},[n._v("155")]),s("br"),s("span",{staticClass:"line-number"},[n._v("156")]),s("br"),s("span",{staticClass:"line-number"},[n._v("157")]),s("br"),s("span",{staticClass:"line-number"},[n._v("158")]),s("br"),s("span",{staticClass:"line-number"},[n._v("159")]),s("br"),s("span",{staticClass:"line-number"},[n._v("160")]),s("br"),s("span",{staticClass:"line-number"},[n._v("161")]),s("br"),s("span",{staticClass:"line-number"},[n._v("162")]),s("br"),s("span",{staticClass:"line-number"},[n._v("163")]),s("br"),s("span",{staticClass:"line-number"},[n._v("164")]),s("br"),s("span",{staticClass:"line-number"},[n._v("165")]),s("br"),s("span",{staticClass:"line-number"},[n._v("166")]),s("br"),s("span",{staticClass:"line-number"},[n._v("167")]),s("br"),s("span",{staticClass:"line-number"},[n._v("168")]),s("br"),s("span",{staticClass:"line-number"},[n._v("169")]),s("br"),s("span",{staticClass:"line-number"},[n._v("170")]),s("br"),s("span",{staticClass:"line-number"},[n._v("171")]),s("br"),s("span",{staticClass:"line-number"},[n._v("172")]),s("br"),s("span",{staticClass:"line-number"},[n._v("173")]),s("br"),s("span",{staticClass:"line-number"},[n._v("174")]),s("br"),s("span",{staticClass:"line-number"},[n._v("175")]),s("br"),s("span",{staticClass:"line-number"},[n._v("176")]),s("br"),s("span",{staticClass:"line-number"},[n._v("177")]),s("br"),s("span",{staticClass:"line-number"},[n._v("178")]),s("br"),s("span",{staticClass:"line-number"},[n._v("179")]),s("br"),s("span",{staticClass:"line-number"},[n._v("180")]),s("br"),s("span",{staticClass:"line-number"},[n._v("181")]),s("br"),s("span",{staticClass:"line-number"},[n._v("182")]),s("br"),s("span",{staticClass:"line-number"},[n._v("183")]),s("br"),s("span",{staticClass:"line-number"},[n._v("184")]),s("br"),s("span",{staticClass:"line-number"},[n._v("185")]),s("br"),s("span",{staticClass:"line-number"},[n._v("186")]),s("br"),s("span",{staticClass:"line-number"},[n._v("187")]),s("br"),s("span",{staticClass:"line-number"},[n._v("188")]),s("br"),s("span",{staticClass:"line-number"},[n._v("189")]),s("br"),s("span",{staticClass:"line-number"},[n._v("190")]),s("br"),s("span",{staticClass:"line-number"},[n._v("191")]),s("br"),s("span",{staticClass:"line-number"},[n._v("192")]),s("br"),s("span",{staticClass:"line-number"},[n._v("193")]),s("br"),s("span",{staticClass:"line-number"},[n._v("194")]),s("br"),s("span",{staticClass:"line-number"},[n._v("195")]),s("br"),s("span",{staticClass:"line-number"},[n._v("196")]),s("br"),s("span",{staticClass:"line-number"},[n._v("197")]),s("br"),s("span",{staticClass:"line-number"},[n._v("198")]),s("br"),s("span",{staticClass:"line-number"},[n._v("199")]),s("br"),s("span",{staticClass:"line-number"},[n._v("200")]),s("br"),s("span",{staticClass:"line-number"},[n._v("201")]),s("br"),s("span",{staticClass:"line-number"},[n._v("202")]),s("br"),s("span",{staticClass:"line-number"},[n._v("203")]),s("br"),s("span",{staticClass:"line-number"},[n._v("204")]),s("br"),s("span",{staticClass:"line-number"},[n._v("205")]),s("br"),s("span",{staticClass:"line-number"},[n._v("206")]),s("br"),s("span",{staticClass:"line-number"},[n._v("207")]),s("br"),s("span",{staticClass:"line-number"},[n._v("208")]),s("br"),s("span",{staticClass:"line-number"},[n._v("209")]),s("br"),s("span",{staticClass:"line-number"},[n._v("210")]),s("br"),s("span",{staticClass:"line-number"},[n._v("211")]),s("br"),s("span",{staticClass:"line-number"},[n._v("212")]),s("br"),s("span",{staticClass:"line-number"},[n._v("213")]),s("br"),s("span",{staticClass:"line-number"},[n._v("214")]),s("br"),s("span",{staticClass:"line-number"},[n._v("215")]),s("br"),s("span",{staticClass:"line-number"},[n._v("216")]),s("br"),s("span",{staticClass:"line-number"},[n._v("217")]),s("br"),s("span",{staticClass:"line-number"},[n._v("218")]),s("br"),s("span",{staticClass:"line-number"},[n._v("219")]),s("br"),s("span",{staticClass:"line-number"},[n._v("220")]),s("br"),s("span",{staticClass:"line-number"},[n._v("221")]),s("br"),s("span",{staticClass:"line-number"},[n._v("222")]),s("br"),s("span",{staticClass:"line-number"},[n._v("223")]),s("br"),s("span",{staticClass:"line-number"},[n._v("224")]),s("br"),s("span",{staticClass:"line-number"},[n._v("225")]),s("br"),s("span",{staticClass:"line-number"},[n._v("226")]),s("br"),s("span",{staticClass:"line-number"},[n._v("227")]),s("br"),s("span",{staticClass:"line-number"},[n._v("228")]),s("br"),s("span",{staticClass:"line-number"},[n._v("229")]),s("br"),s("span",{staticClass:"line-number"},[n._v("230")]),s("br"),s("span",{staticClass:"line-number"},[n._v("231")]),s("br"),s("span",{staticClass:"line-number"},[n._v("232")]),s("br"),s("span",{staticClass:"line-number"},[n._v("233")]),s("br"),s("span",{staticClass:"line-number"},[n._v("234")]),s("br"),s("span",{staticClass:"line-number"},[n._v("235")]),s("br"),s("span",{staticClass:"line-number"},[n._v("236")]),s("br"),s("span",{staticClass:"line-number"},[n._v("237")]),s("br"),s("span",{staticClass:"line-number"},[n._v("238")]),s("br"),s("span",{staticClass:"line-number"},[n._v("239")]),s("br"),s("span",{staticClass:"line-number"},[n._v("240")]),s("br"),s("span",{staticClass:"line-number"},[n._v("241")]),s("br"),s("span",{staticClass:"line-number"},[n._v("242")]),s("br"),s("span",{staticClass:"line-number"},[n._v("243")]),s("br"),s("span",{staticClass:"line-number"},[n._v("244")]),s("br"),s("span",{staticClass:"line-number"},[n._v("245")]),s("br"),s("span",{staticClass:"line-number"},[n._v("246")]),s("br"),s("span",{staticClass:"line-number"},[n._v("247")]),s("br"),s("span",{staticClass:"line-number"},[n._v("248")]),s("br"),s("span",{staticClass:"line-number"},[n._v("249")]),s("br"),s("span",{staticClass:"line-number"},[n._v("250")]),s("br"),s("span",{staticClass:"line-number"},[n._v("251")]),s("br"),s("span",{staticClass:"line-number"},[n._v("252")]),s("br"),s("span",{staticClass:"line-number"},[n._v("253")]),s("br"),s("span",{staticClass:"line-number"},[n._v("254")]),s("br"),s("span",{staticClass:"line-number"},[n._v("255")]),s("br"),s("span",{staticClass:"line-number"},[n._v("256")]),s("br"),s("span",{staticClass:"line-number"},[n._v("257")]),s("br"),s("span",{staticClass:"line-number"},[n._v("258")]),s("br"),s("span",{staticClass:"line-number"},[n._v("259")]),s("br"),s("span",{staticClass:"line-number"},[n._v("260")]),s("br"),s("span",{staticClass:"line-number"},[n._v("261")]),s("br"),s("span",{staticClass:"line-number"},[n._v("262")]),s("br"),s("span",{staticClass:"line-number"},[n._v("263")]),s("br"),s("span",{staticClass:"line-number"},[n._v("264")]),s("br"),s("span",{staticClass:"line-number"},[n._v("265")]),s("br"),s("span",{staticClass:"line-number"},[n._v("266")]),s("br"),s("span",{staticClass:"line-number"},[n._v("267")]),s("br"),s("span",{staticClass:"line-number"},[n._v("268")]),s("br"),s("span",{staticClass:"line-number"},[n._v("269")]),s("br"),s("span",{staticClass:"line-number"},[n._v("270")]),s("br"),s("span",{staticClass:"line-number"},[n._v("271")]),s("br"),s("span",{staticClass:"line-number"},[n._v("272")]),s("br"),s("span",{staticClass:"line-number"},[n._v("273")]),s("br"),s("span",{staticClass:"line-number"},[n._v("274")]),s("br"),s("span",{staticClass:"line-number"},[n._v("275")]),s("br"),s("span",{staticClass:"line-number"},[n._v("276")]),s("br"),s("span",{staticClass:"line-number"},[n._v("277")]),s("br"),s("span",{staticClass:"line-number"},[n._v("278")]),s("br"),s("span",{staticClass:"line-number"},[n._v("279")]),s("br"),s("span",{staticClass:"line-number"},[n._v("280")]),s("br"),s("span",{staticClass:"line-number"},[n._v("281")]),s("br"),s("span",{staticClass:"line-number"},[n._v("282")]),s("br"),s("span",{staticClass:"line-number"},[n._v("283")]),s("br"),s("span",{staticClass:"line-number"},[n._v("284")]),s("br"),s("span",{staticClass:"line-number"},[n._v("285")]),s("br"),s("span",{staticClass:"line-number"},[n._v("286")]),s("br"),s("span",{staticClass:"line-number"},[n._v("287")]),s("br"),s("span",{staticClass:"line-number"},[n._v("288")]),s("br"),s("span",{staticClass:"line-number"},[n._v("289")]),s("br"),s("span",{staticClass:"line-number"},[n._v("290")]),s("br"),s("span",{staticClass:"line-number"},[n._v("291")]),s("br"),s("span",{staticClass:"line-number"},[n._v("292")]),s("br"),s("span",{staticClass:"line-number"},[n._v("293")]),s("br"),s("span",{staticClass:"line-number"},[n._v("294")]),s("br"),s("span",{staticClass:"line-number"},[n._v("295")]),s("br"),s("span",{staticClass:"line-number"},[n._v("296")]),s("br"),s("span",{staticClass:"line-number"},[n._v("297")]),s("br"),s("span",{staticClass:"line-number"},[n._v("298")]),s("br"),s("span",{staticClass:"line-number"},[n._v("299")]),s("br"),s("span",{staticClass:"line-number"},[n._v("300")]),s("br"),s("span",{staticClass:"line-number"},[n._v("301")]),s("br"),s("span",{staticClass:"line-number"},[n._v("302")]),s("br"),s("span",{staticClass:"line-number"},[n._v("303")]),s("br"),s("span",{staticClass:"line-number"},[n._v("304")]),s("br"),s("span",{staticClass:"line-number"},[n._v("305")]),s("br"),s("span",{staticClass:"line-number"},[n._v("306")]),s("br"),s("span",{staticClass:"line-number"},[n._v("307")]),s("br"),s("span",{staticClass:"line-number"},[n._v("308")]),s("br"),s("span",{staticClass:"line-number"},[n._v("309")]),s("br"),s("span",{staticClass:"line-number"},[n._v("310")]),s("br"),s("span",{staticClass:"line-number"},[n._v("311")]),s("br"),s("span",{staticClass:"line-number"},[n._v("312")]),s("br"),s("span",{staticClass:"line-number"},[n._v("313")]),s("br"),s("span",{staticClass:"line-number"},[n._v("314")]),s("br"),s("span",{staticClass:"line-number"},[n._v("315")]),s("br"),s("span",{staticClass:"line-number"},[n._v("316")]),s("br"),s("span",{staticClass:"line-number"},[n._v("317")]),s("br"),s("span",{staticClass:"line-number"},[n._v("318")]),s("br"),s("span",{staticClass:"line-number"},[n._v("319")]),s("br"),s("span",{staticClass:"line-number"},[n._v("320")]),s("br"),s("span",{staticClass:"line-number"},[n._v("321")]),s("br"),s("span",{staticClass:"line-number"},[n._v("322")]),s("br"),s("span",{staticClass:"line-number"},[n._v("323")]),s("br"),s("span",{staticClass:"line-number"},[n._v("324")]),s("br"),s("span",{staticClass:"line-number"},[n._v("325")]),s("br"),s("span",{staticClass:"line-number"},[n._v("326")]),s("br"),s("span",{staticClass:"line-number"},[n._v("327")]),s("br"),s("span",{staticClass:"line-number"},[n._v("328")]),s("br"),s("span",{staticClass:"line-number"},[n._v("329")]),s("br"),s("span",{staticClass:"line-number"},[n._v("330")]),s("br")])])])}),[],!1,null,null,null);s.default=e.exports}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[79],{445:function(s,n,a){"use strict";a.r(n);var e=a(5),t=Object(e.a)({},(function(){var s=this,n=s._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("p",[n("strong",[s._v("一、ElasticSearch文档分值_score计算底层原理")])]),s._v(" "),n("p",[n("strong",[s._v("1）boolean model")])]),s._v(" "),n("p",[s._v("根据用户的query条件，先过滤出包含指定term的doc")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('query "hello world" --\x3e  hello / world / hello & world\n\nbool --\x3e must/must not/should --\x3e 过滤 --\x3e 包含 / 不包含 / 可能包含\n\ndoc --\x3e 不打分数 --\x3e 正或反 true or false --\x3e 为了减少后续要计算的doc的数量，提升性能\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[n("strong",[s._v("2)relevance score算法，简单来说，就是计算出，一个索引中的文本，与搜索文本，他们之间的关联匹配程度")])]),s._v(" "),n("p",[s._v("Elasticsearch使用的是 term frequency/inverse document frequency算法，简称为TF/IDF算法")]),s._v(" "),n("p",[n("strong",[s._v("Term frequency")]),s._v("：搜索文本中的各个词条在field文本中出现了多少次，出现次数越多，就越相关")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("搜索请求：hello world\n\n\n\ndoc1：hello you, and world is very good\n\ndoc2：hello, how are you\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[n("strong",[s._v("Inverse document frequency")]),s._v("：搜索文本中的各个词条在整个索引的所有文档中出现了多少次，出现的次数越多，就越不相关")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("搜索请求：hello world\n\n\n\ndoc1：hello, tuling is very good\n\ndoc2：hi world, how are you\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("比如说，在index中有1万条document，hello这个单词在所有的document中，一共出现了1000次；world这个单词在所有的document中，一共出现了100次")]),s._v(" "),n("p",[n("strong",[s._v("Field-length norm：field长度，field越长，相关度越弱")])]),s._v(" "),n("p",[s._v("搜索请求：hello world")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('doc1：{ "title": "hello article", "content": "...... N个单词" }\n\ndoc2：{ "title": "my article", "content": "...... N个单词，hi world" }\n\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("​")]),s._v(" "),n("p",[s._v("hello world在整个index中出现的次数是一样多的")]),s._v(" "),n("p",[s._v("doc1更相关，title field更短")]),s._v(" "),n("p",[s._v("2、分析一个document上的_score是如何被计算出来的")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('GET /es_db/_doc/1/_explain\n{\n  "query": {\n    "match": {\n      "remark": "java developer"\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[n("strong",[s._v("3、vector space model")])]),s._v(" "),n("p",[s._v("多个term对一个doc的总分数")]),s._v(" "),n("p",[s._v("hello world --\x3e es会根据hello world在所有doc中的评分情况，计算出一个query vector，query向量")]),s._v(" "),n("p",[s._v("hello这个term，给的基于所有doc的一个评分就是3")]),s._v(" "),n("p",[s._v("world这个term，给的基于所有doc的一个评分就是6")]),s._v(" "),n("p",[s._v("[3, 6]")]),s._v(" "),n("p",[s._v("query vector")]),s._v(" "),n("p",[s._v("doc vector，3个doc，一个包含hello，一个包含world，一个包含hello 以及 world")]),s._v(" "),n("p",[s._v("3个doc")]),s._v(" "),n("p",[s._v("doc1：包含hello --\x3e [3, 0]")]),s._v(" "),n("p",[s._v("doc2：包含world --\x3e [0, 6]")]),s._v(" "),n("p",[s._v("doc3：包含hello, world --\x3e [3, 6]")]),s._v(" "),n("p",[s._v("会给每一个doc，拿每个term计算出一个分数来，hello有一个分数，world有一个分数，再拿所有term的分数组成一个doc vector")]),s._v(" "),n("p",[s._v("画在一个图中，取每个doc vector对query vector的弧度，给出每个doc对多个term的总分数")]),s._v(" "),n("p",[s._v("每个doc vector计算出对query vector的弧度，最后基于这个弧度给出一个doc相对于query中多个term的总分数")]),s._v(" "),n("p",[s._v("弧度越大，分数月底; 弧度越小，分数越高")]),s._v(" "),n("p",[s._v("如果是多个term，那么就是线性代数来计算，无法用图表示")]),s._v(" "),n("p",[s._v("​    "),n("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/es/50.png",alt:""}})]),s._v(" "),n("p",[n("strong",[s._v("二、es生产集群部署之针对生产集群的脑裂问题专门定制的重要参数")])]),s._v(" "),n("p",[n("strong",[s._v("集群脑裂是什么？")])]),s._v(" "),n("p",[s._v("所谓脑裂问题，就是同一个集群中的不同节点，对于集群的状态有了不一样的理解，比如集群中存在两个master")]),s._v(" "),n("p",[s._v("如果因为网络的故障，导致一个集群被划分成了两片，每片都有多个node，以及一个master，那么集群中就出现了两个master了。")]),s._v(" "),n("p",[s._v("但是因为master是集群中非常重要的一个角色，主宰了集群状态的维护，以及shard的分配，因此如果有两个master，可能会导致数据异常。")]),s._v(" "),n("p",[n("strong",[s._v("如：")])]),s._v(" "),n("p",[s._v("​    "),n("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/es/51.png",alt:""}})]),s._v(" "),n("p",[s._v("节点1在启动时被选举为主节点并保存主分片标记为0P，而节点2保存复制分片标记为0R")]),s._v(" "),n("p",[s._v("现在，如果在两个节点之间的通讯中断了，会发生什么？由于网络问题或只是因为其中一个节点无响应,这是有可能发生的。")]),s._v(" "),n("p",[s._v("​    "),n("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/es/52.png",alt:""}})]),s._v(" "),n("p",[s._v("两个节点都相信对方已经挂了。节点1不需要做什么，因为它本来就被选举为主节点。但是节点2会自动选举它自己为主节点，因为它相信集群的一部分没有主节点了。")]),s._v(" "),n("p",[s._v("在elasticsearch集群，是有主节点来决定将分片平均的分布到节点上的。节点2保存的是复制分片，但它相信主节点不可用了。所以它会自动提升Node2节点为主节点。")]),s._v(" "),n("p",[s._v("​    "),n("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/es/53.png",alt:""}})]),s._v(" "),n("p",[s._v("现在我们的集群在一个不一致的状态了。打在节点1上的索引请求会将索引数据分配在主节点，同时打在节点2的请求会将索引数据放在分片上。在这种情况下，分片的两份数据分开了，如果不做一个全量的重索引很难对它们进行重排序。在更坏的情况下，一个对集群无感知的索引客户端（例如，使用REST接口的）,这个问题非常透明难以发现，无论哪个节点被命中索引请求仍然在每次都会成功完成。问题只有在搜索数据时才会被隐约发现：取决于搜索请求命中了哪个节点，结果都会不同。")]),s._v(" "),n("p",[s._v("那么那个参数的作用，就是告诉es直到有足够的master候选节点时，才可以选举出一个master，否则就不要选举出一个master。这个参数必须被设置为集群中master候选节点的quorum数量，也就是大多数。至于quorum的算法，就是：master候选节点数量 / 2 + 1。")]),s._v(" "),n("p",[s._v("比如我们有10个节点，都能维护数据，也可以是master候选节点，那么quorum就是10 / 2 + 1 = 6。")]),s._v(" "),n("p",[s._v("如果我们有三个master候选节点，还有100个数据节点，那么quorum就是3 / 2 + 1 = 2")]),s._v(" "),n("p",[s._v("如果我们有2个节点，都可以是master候选节点，那么quorum是2 / 2 + 1 = 2。此时就有问题了，因为如果一个node挂掉了，那么剩下一个master候选节点，是无法满足quorum数量的，也就无法选举出新的master，集群就彻底挂掉了。此时就只能将这个参数设置为1，但是这就无法阻止脑裂的发生了。")]),s._v(" "),n("p",[s._v("2个节点，discovery.zen.minimum_master_nodes分别设置成2和1会怎么样")]),s._v(" "),n("p",[s._v("综上所述，一个生产环境的es集群，至少要有3个节点，同时将这个参数设置为quorum，也就是2。discovery.zen.minimum_master_nodes设置为2，如何避免脑裂呢？")]),s._v(" "),n("p",[s._v("那么这个是参数是如何避免脑裂问题的产生的呢？比如我们有3个节点，quorum是2.现在网络故障，1个节点在一个网络区域，另外2个节点在另外一个网络区域，不同的网络区域内无法通信。这个时候有两种情况情况：")]),s._v(" "),n("p",[s._v("（1）如果master是单独的那个节点，另外2个节点是master候选节点，那么此时那个单独的master节点因为没有指定数量的候选master node在自己当前所在的集群内，因此就会取消当前master的角色，尝试重新选举，但是无法选举成功。然后另外一个网络区域内的node因为无法连接到master，就会发起重新选举，因为有两个master候选节点，满足了quorum，因此可以成功选举出一个master。此时集群中就会还是只有一个master。")]),s._v(" "),n("p",[s._v("（2）如果master和另外一个node在一个网络区域内，然后一个node单独在一个网络区域内。那么此时那个单独的node因为连接不上master，会尝试发起选举，但是因为master候选节点数量不到quorum，因此无法选举出master。而另外一个网络区域内，原先的那个master还会继续工作。这也可以保证集群内只有一个master节点。")]),s._v(" "),n("p",[s._v("综上所述，集群中master节点的数量至少3台，三台主节点通过在elasticsearch.yml中配置discovery.zen.minimum_master_nodes: 2，就可以避免脑裂问题的产生。")]),s._v(" "),n("p",[n("strong",[s._v("二、数据建模")])]),s._v(" "),n("p",[s._v("1、案例:设计一个用户document数据类型，其中包含一个地址数据的数组，这种设计方式相对复杂，但是在管理数据时，更加的灵活。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('PUT /user_index\n{\n"mappings": {\n"properties": {\n"login_name" : {\n"type" : "keyword"\n},\n"age " : {\n"type" : "short"\n},\n"address" : {\n"properties": {\n"province" : {\n"type" : "keyword"\n},\n"city" : {\n"type" : "keyword"\n},\n"street" : {\n"type" : "keyword"\n}\n}\n}\n}\n}\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br")])]),n("p",[s._v("​")]),s._v(" "),n("p",[s._v("但是上述的数据建模有其明显的缺陷，就是针对地址数据做数据搜索的时候，经常会搜索出不必要的数据，如：在下述数据环境中，搜索一个province为北京，city为天津的用户。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('PUT /user_index/_doc/1\n{\n"login_name" : "jack",\n"age" : 25,\n"address" : [\n{\n"province" : "北京",\n"city" : "北京",\n"street" : "枫林三路"\n},\n{\n"province" : "天津",\n"city" : "天津",\n"street" : "华夏路"\n}\n]\n}\nPUT /user_index/_doc/2\n{\n"login_name" : "rose",\n"age" : 21,\n"address" : [\n{\n"province" : "河北",\n"city" : "廊坊",\n"street" : "燕郊经济开发区"\n},\n{\n"province" : "天津",\n"city" : "天津",\n"street" : "华夏路"\n}\n]\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br")])]),n("p",[s._v("​")]),s._v(" "),n("p",[s._v("执行的搜索应该如下：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('GET /user_index/_search\n{\n"query": {\n"bool": {\n"must": [\n{\n"match": {\n"address.province": "北京"\n}\n},\n{\n"match": {\n"address.city": "天津"\n}\n}\n]\n}\n}\n} \n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])]),n("p",[s._v("但是得到的结果并不准确，这个时候就需要使用nested object来定义数据建模。")]),s._v(" "),n("p",[n("strong",[s._v("2、nested object")])]),s._v(" "),n("p",[s._v("使用nested object作为地址数组的集体类型，可以解决上述问题，document模型如下：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('PUT /user_index\n{\n"mappings": {\n"properties": {\n"login_name" : {\n"type" : "keyword"\n},\n"age" : {\n"type" : "short"\n},\n"address" : {\n"type": "nested", \n"properties": {\n"province" : {\n"type" : "keyword"\n},\n"city" : {\n"type" : "keyword"\n},\n"street" : {\n"type" : "keyword"\n}\n}\n}\n}\n}\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br")])]),n("p",[s._v("这个时候就需要使用nested对应的搜索语法来执行搜索了，语法如下：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('GET /user_index/_search\n{\n"query": {\n"bool": {\n"must": [\n{\n"nested": {\n"path": "address",\n"query": {\n"bool": {\n"must": [\n{\n"match": {\n"address.province": "北京"\n}\n},\n{\n"match": {\n"address.city": "天津"\n}\n}\n]\n}\n}\n}\n}\n]\n}\n}\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br")])]),n("p",[s._v("虽然语法变的复杂了，但是在数据的读写操作上都不会有错误发生，是推荐的设计方式。")]),s._v(" "),n("p",[s._v("其原因是：")]),s._v(" "),n("p",[s._v("普通的数组数据在ES中会被扁平化处理，处理方式如下：（如果字段需要分词，会将分词数据保存在对应的字段位置，当然应该是一个倒排索引，这里只是一个直观的案例）")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('{\n  "login_name" : "jack",\n  "address.province" : [ "北京", "天津" ],\n  "address.city" : [ "北京", "天津" ]\n  "address.street" : [ "枫林三路", "华夏路" ]\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[s._v("那么nested object数据类型ES在保存的时候不会有扁平化处理，保存方式如下：所以在搜索的时候一定会有需要的搜索结果。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('{\n  "login_name" : "jack"\n}\n{\n  "address.province" : "北京",\n  "address.city" : "北京"，\n  "address.street" : "枫林三路"\n}\n{\n  "address.province" : "天津",\n  "address.city" : "天津",\n  "address.street" : "华夏路",\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("p",[n("strong",[s._v("三、父子关系数据建模")])]),s._v(" "),n("p",[s._v("nested object的建模，有个不好的地方，就是采取的是类似冗余数据的方式，将多个数据都放在一起了，维护成本就比较高")]),s._v(" "),n("p",[s._v("每次更新，需要重新索引整个对象（包括跟对象和嵌套对象）")]),s._v(" "),n("p",[s._v("ES 提供了类似关系型数据库中 Join 的实现。使用 Join 数据类型实现，可以通过 Parent / Child 的关系，从而分离两个对象")]),s._v(" "),n("p",[s._v("父文档和子文档是两个独立的文档")]),s._v(" "),n("p",[s._v("更新父文档无需重新索引整个子文档。子文档被新增，更改和删除也不会影响到父文档和其他子文档。")]),s._v(" "),n("p",[s._v("要点：父子关系元数据映射，用于确保查询时候的高性能，但是有一个限制，就是父子数据必须存在于一个shard中")]),s._v(" "),n("p",[s._v("父子关系数据存在一个shard中，而且还有映射其关联关系的元数据，那么搜索父子关系数据的时候，不用跨分片，一个分片本地自己就搞定了，性能当然高")]),s._v(" "),n("p",[n("strong",[s._v("父子关系")])]),s._v(" "),n("ul",[n("li",[n("p",[s._v("定义父子关系的几个步骤")])]),s._v(" "),n("li",[n("ul",[n("li",[s._v("设置索引的 Mapping")]),s._v(" "),n("li",[s._v("索引父文档")]),s._v(" "),n("li",[s._v("索引子文档")]),s._v(" "),n("li",[s._v("按需查询文档")])])])]),s._v(" "),n("p",[n("strong",[s._v("设置 Mapping")])]),s._v(" "),n("p",[s._v("​    "),n("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/es/54.png",alt:""}})]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('DELETE my_blogs\n# 设定 Parent/Child Mapping\nPUT my_blogs\n{\n\n"mappings": {\n"properties": {\n"blog_comments_relation": {\n"type": "join",\n"relations": {\n"blog": "comment"\n}\n},\n"content": {\n"type": "text"\n},\n"title": {\n"type": "keyword"\n}\n}\n}\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br")])]),n("p",[n("strong",[s._v("索引父文档")])]),s._v(" "),n("p",[s._v("​    "),n("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/es/55.png",alt:""}})]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('PUT my_blogs/_doc/blog1\n{\n"title":"Learning Elasticsearch",\n"content":"learning ELK is happy",\n"blog_comments_relation":{\n"name":"blog"\n}\n}\n\nPUT my_blogs/_doc/blog2\n{\n"title":"Learning Hadoop",\n"content":"learning Hadoop",\n"blog_comments_relation":{\n"name":"blog"\n}\n}\n\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("p",[n("strong",[s._v("索引子文档")])]),s._v(" "),n("ul",[n("li",[n("p",[s._v("父文档和子文档必须存在相同的分片上")])]),s._v(" "),n("li",[n("ul",[n("li",[s._v("确保查询 join 的性能")])])]),s._v(" "),n("li",[n("p",[s._v("当指定文档时候，必须指定它的父文档 ID")])]),s._v(" "),n("li",[n("ul",[n("li",[s._v("使用 route 参数来保证，分配到相同的分片")])])])]),s._v(" "),n("p",[s._v("​    "),n("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/es/56.png",alt:""}})]),s._v(" "),n("p",[s._v("#索引子文档")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('PUT my_blogs/_doc/comment1?routing=blog1\n{\n"comment":"I am learning ELK",\n"username":"Jack",\n"blog_comments_relation":{\n"name":"comment",\n"parent":"blog1"\n}\n}\n\nPUT my_blogs/_doc/comment2?routing=blog2\n{\n"comment":"I like Hadoop!!!!!",\n"username":"Jack",\n"blog_comments_relation":{\n"name":"comment",\n"parent":"blog2"\n}\n}\n\nPUT my_blogs/_doc/comment3?routing=blog2\n{\n"comment":"Hello Hadoop",\n"username":"Bob",\n"blog_comments_relation":{\n"name":"comment",\n"parent":"blog2"\n}\n}\n\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br")])]),n("p",[n("strong",[s._v("Parent / Child 所支持的查询")])]),s._v(" "),n("ul",[n("li",[s._v("查询所有文档")]),s._v(" "),n("li",[s._v("Parent Id 查询")]),s._v(" "),n("li",[s._v("Has Child 查询")]),s._v(" "),n("li",[s._v("Has Parent 查询")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('# 查询所有文档\nPOST my_blogs/_search\n{}\n\n#根据父文档ID查看\nGET my_blogs/_doc/blog2\n\n# Parent Id 查询\nPOST my_blogs/_search\n{\n"query": {\n"parent_id": {\n"type": "comment",\n"id": "blog2"\n}\n}\n}\n\n# Has Child 查询,返回父文档\nPOST my_blogs/_search\n{\n"query": {\n"has_child": {\n"type": "comment",\n"query" : {\n"match": {\n"username" : "Jack"\n}\n}\n}\n}\n}\n\n# Has Parent 查询，返回相关的子文档\nPOST my_blogs/_search\n{\n"query": {\n"has_parent": {\n"parent_type": "blog",\n"query" : {\n"match": {\n"title" : "Learning Hadoop"\n}\n}\n}\n}\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br")])]),n("p",[n("strong",[s._v("使用 has_child 查询")])]),s._v(" "),n("ul",[n("li",[n("p",[s._v("返回父文档")])]),s._v(" "),n("li",[n("p",[s._v("通过对子文档进行查询")])]),s._v(" "),n("li",[n("ul",[n("li",[s._v("返回具体相关子文档的父文档")]),s._v(" "),n("li",[s._v("父子文档在相同的分片上，因此 Join 效率高")])])])]),s._v(" "),n("p",[s._v("​    "),n("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/es/57.png",alt:""}})]),s._v(" "),n("p",[n("strong",[s._v("使用 has_parent 查询")])]),s._v(" "),n("ul",[n("li",[n("p",[s._v("返回相关性的子文档")])]),s._v(" "),n("li",[n("p",[s._v("通过对父文档进行查询")])]),s._v(" "),n("li",[n("ul",[n("li",[s._v("返回相关的子文档")])])])]),s._v(" "),n("p",[s._v("​    "),n("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/es/58.png",alt:""}})]),s._v(" "),n("p",[n("strong",[s._v("使用 parent_id 查询")])]),s._v(" "),n("ul",[n("li",[n("p",[s._v("返回所有相关子文档")])]),s._v(" "),n("li",[n("p",[s._v("通过对付文档 Id 进行查询")])]),s._v(" "),n("li",[n("ul",[n("li",[s._v("返回所有相关的子文档")])])])]),s._v(" "),n("p",[s._v("​    "),n("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/es/59.png",alt:""}})]),s._v(" "),n("p",[n("strong",[s._v("访问子文档")])]),s._v(" "),n("ul",[n("li",[s._v("需指定父文档 routing 参数")])]),s._v(" "),n("p",[s._v("​    "),n("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/es/60.png",alt:""}})]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("#通过ID ，访问子文档\nGET my_blogs/_doc/comment2\n\n#通过ID和routing ，访问子文档\nGET my_blogs/_doc/comment3?routing=blog2\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[n("strong",[s._v("更新子文档")])]),s._v(" "),n("ul",[n("li",[s._v("更新子文档不会影响到父文档")])]),s._v(" "),n("p",[s._v("​    !["),n("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/es/61.png",alt:""}})]),s._v(" "),n("p",[s._v("#更新子文档")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('PUT my_blogs/_doc/comment3?routing=blog2\n{\n"comment": "Hello Hadoop??",\n"blog_comments_relation": {\n"name": "comment",\n"parent": "blog2"\n}\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[n("strong",[s._v("嵌套对象 v.s 父子文档")])]),s._v(" "),n("p",[s._v("Nested Object\tParent / Child")]),s._v(" "),n("p",[s._v("优点：文档存储在一起，读取性能高、父子文档可以独立更新")]),s._v(" "),n("p",[s._v("缺点：更新嵌套的子文档时，需要更新整个文档、需要额外的内存去维护关系。读取性能相对差")]),s._v(" "),n("p",[s._v("适用场景子文档偶尔更新，以查询为主、子文档更新频繁")]),s._v(" "),n("p",[n("strong",[s._v("四、文件系统数据建模")])]),s._v(" "),n("p",[s._v("思考一下，github中可以使用代码片段来实现数据搜索。这是如何实现的？")]),s._v(" "),n("p",[s._v("在github中也使用了ES来实现数据的全文搜索。其ES中有一个记录代码内容的索引，大致数据内容如下：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('{\n  "fileName" : "HelloWorld.java",\n  "authName" : "baiqi",\n  "authID" : 110,\n  "productName" : "first-java",\n  "path" : "/com/baiqi/first",\n  "content" : "package com.baiqi.first; public class HelloWorld { //code... }"\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("我们可以在github中通过代码的片段来实现数据的搜索。也可以使用其他条件实现数据搜索。但是，如果需要使用文件路径搜索内容应该如何实现？这个时候需要为其中的字段path定义一个特殊的分词器。具体如下：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('PUT /codes\n{\n"settings": {\n"analysis": {\n"analyzer": {\n"path_analyzer" : {\n"tokenizer" : "path_hierarchy"\n}\n}\n}\n}, \n"mappings": {\n"properties": {\n"fileName" : {\n"type" : "keyword"\n},\n"authName" : {\n"type" : "text",\n"analyzer": "standard",\n"fields": {\n"keyword" : {\n"type" : "keyword"\n}\n}\n},\n"authID" : {\n"type" : "long"\n},\n"productName" : {\n"type" : "text",\n"analyzer": "standard",\n"fields": {\n"keyword" : {\n"type" : "keyword"\n}\n}\n},\n"path" : {\n"type" : "text",\n"analyzer": "path_analyzer", \n"fields": {\n"keyword" : {\n"type" : "keyword"\n}\n}\n},\n"content" : {\n"type" : "text",\n"analyzer": "standard"\n}\n}\n}\n}\n\nPUT /codes/_doc/1\n{\n"fileName" : "HelloWorld.java",\n"authName" : "baiqi",\n"authID" : 110,\n"productName" : "first-java",\n"path" : "/com/baiqi/first",\n"content" : "package com.baiqi.first; public class HelloWorld { // some code... }"\n}\n\nGET /codes/_search\n{\n"query": {\n"match": {\n"path": "/com"\n}\n}\n}\n\nGET /codes/_analyze\n{\n"text": "/a/b/c/d",\n"field": "path"\n}\n\n############################################################################################################\nPUT /codes\n{\n"settings": {\n"analysis": {\n"analyzer": {\n"path_analyzer" : {\n"tokenizer" : "path_hierarchy"\n}\n}\n}\n}, \n"mappings": {\n"properties": {\n"fileName" : {\n"type" : "keyword"\n},\n"authName" : {\n"type" : "text",\n"analyzer": "standard",\n"fields": {\n"keyword" : {\n"type" : "keyword"\n}\n}\n},\n"authID" : {\n"type" : "long"\n},\n"productName" : {\n"type" : "text",\n"analyzer": "standard",\n"fields": {\n"keyword" : {\n"type" : "keyword"\n}\n}\n},\n"path" : {\n"type" : "text",\n"analyzer": "path_analyzer", \n"fields": {\n"keyword" : {\n"type" : "text",\n"analyzer": "standard"\n}\n}\n},\n"content" : {\n"type" : "text",\n"analyzer": "standard"\n}\n}\n}\n}\n\nGET /codes/_search\n{\n"query": {\n"match": {\n"path.keyword": "/com"\n}\n}\n}\n\nGET /codes/_search\n{\n"query": {\n"bool": {\n"should": [\n{\n"match": {\n"path": "/com"\n}\n},\n{\n"match": {\n"path.keyword": "/com/baiqi"\n}\n}\n]\n}\n}\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br"),n("span",{staticClass:"line-number"},[s._v("94")]),n("br"),n("span",{staticClass:"line-number"},[s._v("95")]),n("br"),n("span",{staticClass:"line-number"},[s._v("96")]),n("br"),n("span",{staticClass:"line-number"},[s._v("97")]),n("br"),n("span",{staticClass:"line-number"},[s._v("98")]),n("br"),n("span",{staticClass:"line-number"},[s._v("99")]),n("br"),n("span",{staticClass:"line-number"},[s._v("100")]),n("br"),n("span",{staticClass:"line-number"},[s._v("101")]),n("br"),n("span",{staticClass:"line-number"},[s._v("102")]),n("br"),n("span",{staticClass:"line-number"},[s._v("103")]),n("br"),n("span",{staticClass:"line-number"},[s._v("104")]),n("br"),n("span",{staticClass:"line-number"},[s._v("105")]),n("br"),n("span",{staticClass:"line-number"},[s._v("106")]),n("br"),n("span",{staticClass:"line-number"},[s._v("107")]),n("br"),n("span",{staticClass:"line-number"},[s._v("108")]),n("br"),n("span",{staticClass:"line-number"},[s._v("109")]),n("br"),n("span",{staticClass:"line-number"},[s._v("110")]),n("br"),n("span",{staticClass:"line-number"},[s._v("111")]),n("br"),n("span",{staticClass:"line-number"},[s._v("112")]),n("br"),n("span",{staticClass:"line-number"},[s._v("113")]),n("br"),n("span",{staticClass:"line-number"},[s._v("114")]),n("br"),n("span",{staticClass:"line-number"},[s._v("115")]),n("br"),n("span",{staticClass:"line-number"},[s._v("116")]),n("br"),n("span",{staticClass:"line-number"},[s._v("117")]),n("br"),n("span",{staticClass:"line-number"},[s._v("118")]),n("br"),n("span",{staticClass:"line-number"},[s._v("119")]),n("br"),n("span",{staticClass:"line-number"},[s._v("120")]),n("br"),n("span",{staticClass:"line-number"},[s._v("121")]),n("br"),n("span",{staticClass:"line-number"},[s._v("122")]),n("br"),n("span",{staticClass:"line-number"},[s._v("123")]),n("br"),n("span",{staticClass:"line-number"},[s._v("124")]),n("br"),n("span",{staticClass:"line-number"},[s._v("125")]),n("br"),n("span",{staticClass:"line-number"},[s._v("126")]),n("br"),n("span",{staticClass:"line-number"},[s._v("127")]),n("br"),n("span",{staticClass:"line-number"},[s._v("128")]),n("br"),n("span",{staticClass:"line-number"},[s._v("129")]),n("br"),n("span",{staticClass:"line-number"},[s._v("130")]),n("br"),n("span",{staticClass:"line-number"},[s._v("131")]),n("br"),n("span",{staticClass:"line-number"},[s._v("132")]),n("br"),n("span",{staticClass:"line-number"},[s._v("133")]),n("br"),n("span",{staticClass:"line-number"},[s._v("134")]),n("br"),n("span",{staticClass:"line-number"},[s._v("135")]),n("br"),n("span",{staticClass:"line-number"},[s._v("136")]),n("br"),n("span",{staticClass:"line-number"},[s._v("137")]),n("br"),n("span",{staticClass:"line-number"},[s._v("138")]),n("br"),n("span",{staticClass:"line-number"},[s._v("139")]),n("br"),n("span",{staticClass:"line-number"},[s._v("140")]),n("br"),n("span",{staticClass:"line-number"},[s._v("141")]),n("br"),n("span",{staticClass:"line-number"},[s._v("142")]),n("br"),n("span",{staticClass:"line-number"},[s._v("143")]),n("br"),n("span",{staticClass:"line-number"},[s._v("144")]),n("br"),n("span",{staticClass:"line-number"},[s._v("145")]),n("br"),n("span",{staticClass:"line-number"},[s._v("146")]),n("br"),n("span",{staticClass:"line-number"},[s._v("147")]),n("br"),n("span",{staticClass:"line-number"},[s._v("148")]),n("br"),n("span",{staticClass:"line-number"},[s._v("149")]),n("br"),n("span",{staticClass:"line-number"},[s._v("150")]),n("br"),n("span",{staticClass:"line-number"},[s._v("151")]),n("br"),n("span",{staticClass:"line-number"},[s._v("152")]),n("br"),n("span",{staticClass:"line-number"},[s._v("153")]),n("br"),n("span",{staticClass:"line-number"},[s._v("154")]),n("br"),n("span",{staticClass:"line-number"},[s._v("155")]),n("br"),n("span",{staticClass:"line-number"},[s._v("156")]),n("br"),n("span",{staticClass:"line-number"},[s._v("157")]),n("br"),n("span",{staticClass:"line-number"},[s._v("158")]),n("br"),n("span",{staticClass:"line-number"},[s._v("159")]),n("br"),n("span",{staticClass:"line-number"},[s._v("160")]),n("br"),n("span",{staticClass:"line-number"},[s._v("161")]),n("br"),n("span",{staticClass:"line-number"},[s._v("162")]),n("br"),n("span",{staticClass:"line-number"},[s._v("163")]),n("br")])]),n("p",[s._v("​")]),s._v(" "),n("p",[n("strong",[s._v("参考文档：https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-pathhierarchy-tokenizer.html")])]),s._v(" "),n("p",[n("strong",[s._v("五、根据关键字分页搜索")])]),s._v(" "),n("p",[s._v("在存在大量数据时，一般我们进行查询都需要进行分页查询。例如：我们指定页码、并指定每页显示多少条数据，然后Elasticsearch返回对应页码的数据。")]),s._v(" "),n("p",[n("strong",[s._v("1、使用from和size来进行分页")])]),s._v(" "),n("p",[s._v("在执行查询时，可以指定from（从第几条数据开始查起）和size（每页返回多少条）数据，就可以轻松完成分页。")]),s._v(" "),n("p",[s._v("l from = (page – 1) * size")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('POST /es_db/_doc/_search\n{\n"from": 0,\n"size": 2,\n"query": {\n"match": {\n"address": "广州天河"\n}\n}\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("p",[s._v("​")]),s._v(" "),n("p",[n("strong",[s._v("2、使用scroll方式进行分页")])]),s._v(" "),n("p",[s._v("前面使用from和size方式，查询在1W条数据以内都是OK的，但如果数据比较多的时候，会出现性能问题。Elasticsearch做了一个限制，不允许查询的是10000条以后的数据。如果要查询1W条以后的数据，需要使用Elasticsearch中提供的scroll游标来查询。")]),s._v(" "),n("p",[s._v("在进行大量分页时，每次分页都需要将要查询的数据进行重新排序，这样非常浪费性能。使用scroll是将要用的数据一次性排序好，然后分批取出。性能要比from + size好得多。使用scroll查询后，排序后的数据会保持一定的时间，后续的分页查询都从该快照取数据即可。")]),s._v(" "),n("p",[n("strong",[s._v("2.1、第一次使用scroll分页查询")])]),s._v(" "),n("p",[s._v("此处，我们让排序的数据保持1分钟，所以设置scroll为1m")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('GET /es_db/_search?scroll=1m\n{\n"query": {\n"multi_match":{\n"query":"广州长沙张三",\n"fields":["address","name"]\n}\n},\n"size":100\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("p",[s._v("​")]),s._v(" "),n("p",[s._v("执行后，我们注意到，在响应结果中有一项：")]),s._v(" "),n("p",[s._v('"_scroll_id": "DXF1ZXJ5QW5kRmV0Y2gBAAAAAAAAAZEWY2VQZXBia1JTVkdhTWkwSl9GaUYtQQ=="')]),s._v(" "),n("p",[s._v("后续，我们需要根据这个_scroll_id来进行查询")]),s._v(" "),n("p",[n("strong",[s._v("2.2、第二次直接使用scroll id进行查询")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('GET _search/scroll?scroll=1m\n{\n"scroll_id":"DXF1ZXJ5QW5kRmV0Y2gBAAAAAAAAAZoWY2VQZXBia1JTVkdhTWkwSl9GaUYtQQ=="\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[n("strong",[s._v("六、Elasticsearch SQL")])]),s._v(" "),n("p",[s._v("​    "),n("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/es/63.jpg",alt:""}})]),s._v(" "),n("p",[s._v("Elasticsearch SQL允许执行类SQL的查询，可以使用REST接口、命令行或者是JDBC，都可以使用SQL来进行数据的检索和数据的聚合。")]),s._v(" "),n("p",[s._v("Elasticsearch SQL特点：")]),s._v(" "),n("ul",[n("li",[s._v("本地集成")])]),s._v(" "),n("p",[s._v("​    Elasticsearch SQL是专门为Elasticsearch构建的。每个SQL查询都根据底层存储对相关节点有效执行。")]),s._v(" "),n("ul",[n("li",[s._v("没有额外的要求")])]),s._v(" "),n("p",[s._v("​    不依赖其他的硬件、进程、运行时库，Elasticsearch SQL可以直接运行在Elasticsearch集群上")]),s._v(" "),n("ul",[n("li",[s._v("轻量且高效")])]),s._v(" "),n("p",[s._v("​    像SQL那样简洁、高效地完成查询")]),s._v(" "),n("p",[n("strong",[s._v("1、SQL与Elasticsearch对应关系")])]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[n("strong",[s._v("SQL")])]),s._v(" "),n("th",[n("strong",[s._v("Elasticsearch")])])])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("column（列）")]),s._v(" "),n("td",[s._v("field（字段）")])]),s._v(" "),n("tr",[n("td",[s._v("row（行）")]),s._v(" "),n("td",[s._v("document（文档）")])]),s._v(" "),n("tr",[n("td",[s._v("table（表）")]),s._v(" "),n("td",[s._v("index（索引）")])]),s._v(" "),n("tr",[n("td",[s._v("schema（模式）")]),s._v(" "),n("td",[s._v("mapping（映射）")])]),s._v(" "),n("tr",[n("td",[s._v("database server（数据库服务器）")]),s._v(" "),n("td",[s._v("Elasticsearch集群实例")])])])]),s._v(" "),n("p",[n("strong",[s._v("2、Elasticsearch SQL语法")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("SELECT select_expr [, ...]\n[ FROM table_name ]\n[ WHERE condition ]\n[ GROUP BY grouping_element [, ...] ]\n[ HAVING condition]\n[ ORDER BY expression [ ASC | DESC ] [, ...] ]\n[ LIMIT [ count ] ]\n[ PIVOT ( aggregation_expr FOR column IN ( value [ [ AS ] alias ] [, ...] ) ) ]\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("目前FROM只支持单表")]),s._v(" "),n("p",[n("strong",[s._v("3、职位查询案例")])]),s._v(" "),n("p",[n("strong",[s._v("3.1、查询职位索引库中的一条数据")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('format：表示指定返回的数据类型\n//1.查询职位信息\n\nGET /_sql?format=txt\n{\n"query":"SELECT * FROM es_db limit 1"\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("​")]),s._v(" "),n("p",[s._v("除了txt类型，Elasticsearch SQL还支持以下类型，")]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[s._v("格式")]),s._v(" "),n("th",[s._v("描述")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("csv")]),s._v(" "),n("td",[s._v("逗号分隔符")])]),s._v(" "),n("tr",[n("td",[s._v("json")]),s._v(" "),n("td",[s._v("JSON格式")])]),s._v(" "),n("tr",[n("td",[s._v("tsv")]),s._v(" "),n("td",[s._v("制表符分隔符")])]),s._v(" "),n("tr",[n("td",[s._v("txt")]),s._v(" "),n("td",[s._v("类cli表示")])]),s._v(" "),n("tr",[n("td",[s._v("yaml")]),s._v(" "),n("td",[s._v("YAML人类可读的格式")])])])]),s._v(" "),n("p",[n("strong",[s._v("3.2、将SQL转换为DSL")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('GET /_sql/translate\n{\n"query":"SELECT * FROM es_db limit 1"\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("结果如下：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('{\n  "size" : 1,\n  "_source" : {\n    "includes" : [\n      "age",\n      "remark",\n      "sex"\n    ],\n    "excludes" : [ ]\n  },\n  "docvalue_fields" : [\n    {\n      "field" : "address"\n    },\n    {\n      "field" : "book"\n    },\n    {\n      "field" : "name"\n    }\n  ],\n  "sort" : [\n    {\n      "_doc" : {\n        "order" : "asc"\n      }\n    }\n  ]\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br")])]),n("p",[n("strong",[s._v("3.4、职位全文检索")])]),s._v(" "),n("p",[n("strong",[s._v("3.4.1、需求")])]),s._v(" "),n("p",[s._v("检索address包含广州和name中包含张三的用户。")]),s._v(" "),n("p",[n("strong",[s._v("3.4.2、MATCH函数")])]),s._v(" "),n("p",[s._v("在执行全文检索时，需要使用到MATCH函数。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("MATCH(\n    field_exp,   \n    constant_exp \n    [, options]) \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("field_exp：匹配字段")]),s._v(" "),n("p",[s._v("constant_exp：匹配常量表达式")]),s._v(" "),n("p",[n("strong",[s._v("3.4.3、实现")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("GET /_sql?format=txt\n{\n\"query\":\"select * from es_db where MATCH(address, '广州') or MATCH(name, '张三') limit 10\"\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[n("strong",[s._v("4.4、通过****Elasticsearch SQL方式实现分组统计")])]),s._v(" "),n("p",[n("strong",[s._v("4.4.2、基于Elasticsearch SQL方式实现")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('GET /_sql?format=txt\n{\n"query":"select age, count(*) as age_cnt from es_db group by age"\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("这种方式要更加直观、简洁。")]),s._v(" "),n("p",[n("strong",[s._v("Elasticsearch SQL目前的一些限制")])]),s._v(" "),n("p",[s._v("目前Elasticsearch SQL还存在一些限制。例如：不支持JOIN、不支持较复杂的子查询。所以，有一些相对复杂一些的功能，还得借助于DSL方式来实现。")]),s._v(" "),n("p",[n("strong",[s._v("七、Java API操作ES（上）")])]),s._v(" "),n("p",[s._v("相关依赖：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("<dependencies>\n    \x3c!-- ES的高阶的客户端API --\x3e\n    <dependency>\n        <groupId>org.elasticsearch.client</groupId>\n        <artifactId>elasticsearch-rest-high-level-client</artifactId>\n        <version>7.6.1</version>\n    </dependency>\n    <dependency>\n        <groupId>org.apache.logging.log4j</groupId>\n        <artifactId>log4j-core</artifactId>\n        <version>2.11.1</version>\n    </dependency>\n    \x3c!-- 阿里巴巴出品的一款将Java对象转换为JSON、将JSON转换为Java对象的库 --\x3e\n    <dependency>\n        <groupId>com.alibaba</groupId>\n        <artifactId>fastjson</artifactId>\n        <version>1.2.62</version>\n    </dependency>\n    <dependency>\n    <groupId>junit</groupId>\n    <artifactId>junit</artifactId>\n    <version>4.12</version>\n    <scope>test</scope>\n</dependency>\n    <dependency>\n        <groupId>org.testng</groupId>\n        <artifactId>testng</artifactId>\n        <version>6.14.3</version>\n        <scope>test</scope>\n    </dependency>\n  \n</dependencies>\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br")])]),n("p",[n("strong",[s._v("使用JavaAPI来操作ES集群")])]),s._v(" "),n("p",[n("strong",[s._v("初始化连接")])]),s._v(" "),n("p",[n("strong",[s._v("使用的是RestHighLevelClient去连接ES集群，后续操作ES中的数据")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('    private RestHighLevelClient restHighLevelClient;\n\n    public JobFullTextServiceImpl() {\n        // 建立与ES的连接\n        // 1. 使用RestHighLevelClient构建客户端连接。\n        // 2. 基于RestClient.builder方法来构建RestClientBuilder\n        // 3. 用HttpHost来添加ES的节点\n        RestClientBuilder restClientBuilder = RestClient.builder(\n              new HttpHost("192.168.21.130", 9200, "http")\n            , new HttpHost("192.168.21.131", 9200, "http")\n            , new HttpHost("192.168.21.132", 9200, "http"));\n        restHighLevelClient = new RestHighLevelClient(restClientBuilder);\n    }\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("p",[s._v("​")]),s._v(" "),n("p",[s._v("添加职位数据到ES中")]),s._v(" "),n("p",[s._v("* 使用IndexRequest对象来描述请求")]),s._v(" "),n("p",[s._v("​\t* 可以设置请求的参数：设置ID、并设置传输ES的数据——注意因为ES都是使用JSON（DSL）来去操作数据的，所以需要使用一个FastJSON的库来将对象转换为JSON字符串进行操作")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('@Override\npublic void add(JobDetail jobDetail) throws IOException {\n    //1.\t构建IndexRequest对象，用来描述ES发起请求的数据。\n    IndexRequest indexRequest = new IndexRequest(JOB_IDX);\n\n    //2.\t设置文档ID。\n    indexRequest.id(jobDetail.getId() + "");\n\n    //3.\t使用FastJSON将实体类对象转换为JSON。\n    String json = JSONObject.toJSONString(jobDetail);\n\n    //4.\t使用IndexRequest.source方法设置文档数据，并设置请求的数据为JSON格式。\n    indexRequest.source(json, XContentType.JSON);\n\n    //5.\t使用ES High level client调用index方法发起请求，将一个文档添加到索引中。\n    restHighLevelClient.index(indexRequest, RequestOptions.DEFAULT);\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("p",[s._v("​")]),s._v(" "),n("p",[n("strong",[s._v("查询/删除/搜索/分页")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("\n* 新增：IndexRequest\n* 更新：UpdateRequest\n* 删除：DeleteRequest\n* 根据ID获取：GetRequest\n* 关键字检索：SearchRequest\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('@Override\npublic JobDetail findById(long id) throws IOException {\n    // 1.\t构建GetRequest请求。\n    GetRequest getRequest = new GetRequest(JOB_IDX, id + "");\n\n    // 2.\t使用RestHighLevelClient.get发送GetRequest请求，并获取到ES服务器的响应。\n    GetResponse getResponse = restHighLevelClient.get(getRequest, RequestOptions.DEFAULT);\n\n    // 3.\t将ES响应的数据转换为JSON字符串\n    String json = getResponse.getSourceAsString();\n\n    // 4.\t并使用FastJSON将JSON字符串转换为JobDetail类对象\n    JobDetail jobDetail = JSONObject.parseObject(json, JobDetail.class);\n\n    // 5.\t记得：单独设置ID\n    jobDetail.setId(id);\n\n    return jobDetail;\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('@Override\npublic void update(JobDetail jobDetail) throws IOException {\n    // 1.\t判断对应ID的文档是否存在\n    // a)\t构建GetRequest\n    GetRequest getRequest = new GetRequest(JOB_IDX, jobDetail.getId() + "");\n\n    // b)\t执行client的exists方法，发起请求，判断是否存在\n    boolean exists = restHighLevelClient.exists(getRequest, RequestOptions.DEFAULT);\n\n    if(exists) {\n        // 2.\t构建UpdateRequest请求\n        UpdateRequest updateRequest = new UpdateRequest(JOB_IDX, jobDetail.getId() + "");\n\n        // 3.\t设置UpdateRequest的文档，并配置为JSON格式\n        updateRequest.doc(JSONObject.toJSONString(jobDetail), XContentType.JSON);\n\n        // 4.\t执行client发起update请求\n        restHighLevelClient.update(updateRequest, RequestOptions.DEFAULT);\n    }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('@Override\npublic void deleteById(long id) throws IOException {\n    // 1.\t构建delete请求\n    DeleteRequest deleteRequest = new DeleteRequest(JOB_IDX, id + "");\n\n    // 2.\t使用RestHighLevelClient执行delete请求\n    restHighLevelClient.delete(deleteRequest, RequestOptions.DEFAULT);\n\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('@Override\npublic List<JobDetail> searchByKeywords(String keywords) throws IOException {\n    // 1.构建SearchRequest检索请求\n    // 专门用来进行全文检索、关键字检索的API\n    SearchRequest searchRequest = new SearchRequest(JOB_IDX);\n\n    // 2.创建一个SearchSourceBuilder专门用于构建查询条件\n    SearchSourceBuilder searchSourceBuilder = new SearchSourceBuilder();\n\n    // 3.使用QueryBuilders.multiMatchQuery构建一个查询条件（搜索title、jd），并配置到SearchSourceBuilder\n    MultiMatchQueryBuilder multiMatchQueryBuilder = QueryBuilders.multiMatchQuery(keywords, "title", "jd");\n\n    // 将查询条件设置到查询请求构建器中\n    searchSourceBuilder.query(multiMatchQueryBuilder);\n\n    // 4.调用SearchRequest.source将查询条件设置到检索请求\n    searchRequest.source(searchSourceBuilder);\n\n    // 5.执行RestHighLevelClient.search发起请求\n    SearchResponse searchResponse = restHighLevelClient.search(searchRequest, RequestOptions.DEFAULT);\n    SearchHit[] hitArray = searchResponse.getHits().getHits();\n\n    // 6.遍历结果\n    ArrayList<JobDetail> jobDetailArrayList = new ArrayList<>();\n\n    for (SearchHit documentFields : hitArray) {\n        // 1)获取命中的结果\n        String json = documentFields.getSourceAsString();\n\n        // 2)将JSON字符串转换为对象\n        JobDetail jobDetail = JSONObject.parseObject(json, JobDetail.class);\n\n        // 3)使用SearchHit.getId设置文档ID\n        jobDetail.setId(Long.parseLong(documentFields.getId()));\n\n        jobDetailArrayList.add(jobDetail);\n    }\n\n    return jobDetailArrayList;\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br")])]),n("p",[s._v("​")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('@Override\npublic Map<String, Object> searchByPage(String keywords, int pageNum, int pageSize) throws IOException {\n    // 1.构建SearchRequest检索请求\n    // 专门用来进行全文检索、关键字检索的API\n    SearchRequest searchRequest = new SearchRequest(JOB_IDX);\n\n    // 2.创建一个SearchSourceBuilder专门用于构建查询条件\n    SearchSourceBuilder searchSourceBuilder = new SearchSourceBuilder();\n\n    // 3.使用QueryBuilders.multiMatchQuery构建一个查询条件（搜索title、jd），并配置到SearchSourceBuilder\n    MultiMatchQueryBuilder multiMatchQueryBuilder = QueryBuilders.multiMatchQuery(keywords, "title", "jd");\n\n    // 将查询条件设置到查询请求构建器中\n    searchSourceBuilder.query(multiMatchQueryBuilder);\n\n    // 每页显示多少条\n    searchSourceBuilder.size(pageSize);\n    // 设置从第几条开始查询\n    searchSourceBuilder.from((pageNum - 1) * pageSize);\n\n    // 4.调用SearchRequest.source将查询条件设置到检索请求\n    searchRequest.source(searchSourceBuilder);\n\n    // 5.执行RestHighLevelClient.search发起请求\n    SearchResponse searchResponse = restHighLevelClient.search(searchRequest, RequestOptions.DEFAULT);\n    SearchHit[] hitArray = searchResponse.getHits().getHits();\n\n    // 6.遍历结果\n    ArrayList<JobDetail> jobDetailArrayList = new ArrayList<>();\n\n    for (SearchHit documentFields : hitArray) {\n        // 1)获取命中的结果\n        String json = documentFields.getSourceAsString();\n\n        // 2)将JSON字符串转换为对象\n        JobDetail jobDetail = JSONObject.parseObject(json, JobDetail.class);\n\n        // 3)使用SearchHit.getId设置文档ID\n        jobDetail.setId(Long.parseLong(documentFields.getId()));\n\n        jobDetailArrayList.add(jobDetail);\n    }\n\n    // 8.\t将结果封装到Map结构中（带有分页信息）\n    // a)\ttotal -> 使用SearchHits.getTotalHits().value获取到所有的记录数\n    // b)\tcontent -> 当前分页中的数据\n    long totalNum = searchResponse.getHits().getTotalHits().value;\n    HashMap hashMap = new HashMap();\n    hashMap.put("total", totalNum);\n    hashMap.put("content", jobDetailArrayList);\n\n\n    return hashMap;\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br")])]),n("p",[s._v("​")]),s._v(" "),n("p",[n("strong",[s._v("使用scroll分页方式查询")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("> * 第一次查询，不带scroll_id，所以要设置scroll超时时间\n> * 超时时间不要设置太短，否则会出现异常\n> * 第二次查询，SearchSrollRequest\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('@Override\npublic Map<String, Object> searchByScrollPage(String keywords, String scrollId, int pageSize) throws IOException {\n    SearchResponse searchResponse = null;\n\n    if(scrollId == null) {\n        // 1.构建SearchRequest检索请求\n        // 专门用来进行全文检索、关键字检索的API\n        SearchRequest searchRequest = new SearchRequest(JOB_IDX);\n\n        // 2.创建一个SearchSourceBuilder专门用于构建查询条件\n        SearchSourceBuilder searchSourceBuilder = new SearchSourceBuilder();\n\n        // 3.使用QueryBuilders.multiMatchQuery构建一个查询条件（搜索title、jd），并配置到SearchSourceBuilder\n        MultiMatchQueryBuilder multiMatchQueryBuilder = QueryBuilders.multiMatchQuery(keywords, "title", "jd");\n\n        // 将查询条件设置到查询请求构建器中\n        searchSourceBuilder.query(multiMatchQueryBuilder);\n\n        // 每页显示多少条\n        searchSourceBuilder.size(pageSize);\n\n        // 4.调用SearchRequest.source将查询条件设置到检索请求\n        searchRequest.source(searchSourceBuilder);\n\n        //--------------------------\n        // 设置scroll查询\n        //--------------------------\n        searchRequest.scroll(TimeValue.timeValueMinutes(5));\n\n        // 5.执行RestHighLevelClient.search发起请求\n        searchResponse = restHighLevelClient.search(searchRequest, RequestOptions.DEFAULT);\n\n    }\n    // 第二次查询的时候，直接通过scroll id查询数据\n    else {\n        SearchScrollRequest searchScrollRequest = new SearchScrollRequest(scrollId);\n        searchScrollRequest.scroll(TimeValue.timeValueMinutes(5));\n\n        // 使用RestHighLevelClient发送scroll请求\n        searchResponse = restHighLevelClient.scroll(searchScrollRequest, RequestOptions.DEFAULT);\n    }\n\n    //--------------------------\n    // 迭代ES响应的数据\n    //--------------------------\n\n    SearchHit[] hitArray = searchResponse.getHits().getHits();\n\n    // 6.遍历结果\n    ArrayList<JobDetail> jobDetailArrayList = new ArrayList<>();\n\n    for (SearchHit documentFields : hitArray) {\n        // 1)获取命中的结果\n        String json = documentFields.getSourceAsString();\n\n        // 2)将JSON字符串转换为对象\n        JobDetail jobDetail = JSONObject.parseObject(json, JobDetail.class);\n\n        // 3)使用SearchHit.getId设置文档ID\n        jobDetail.setId(Long.parseLong(documentFields.getId()));\n\n        jobDetailArrayList.add(jobDetail);\n    }\n\n    // 8.\t将结果封装到Map结构中（带有分页信息）\n    // a)\ttotal -> 使用SearchHits.getTotalHits().value获取到所有的记录数\n    // b)\tcontent -> 当前分页中的数据\n    long totalNum = searchResponse.getHits().getTotalHits().value;\n    HashMap hashMap = new HashMap();\n    hashMap.put("scroll_id", searchResponse.getScrollId());\n    hashMap.put("content", jobDetailArrayList);\n\n    return hashMap;\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br")])]),n("p",[n("strong",[s._v("高亮查询")])]),s._v(" "),n("p",[s._v("\\1. 配置高亮选项")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('// 设置高亮\nHighlightBuilder highlightBuilder = new HighlightBuilder();\nhighlightBuilder.field("title");\nhighlightBuilder.field("jd");\nhighlightBuilder.preTags("<font color=\'red\'>");\nhighlightBuilder.postTags("</font>");\n\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("\\2. 需要将高亮的字段拼接在一起，设置到实体类中")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('// 设置高亮的一些文本到实体类中\n// 封装了高亮\nMap<String, HighlightField> highlightFieldMap = documentFields.getHighlightFields();\nHighlightField titleHL = highlightFieldMap.get("title");\nHighlightField jdHL = highlightFieldMap.get("jd");\n\nif(titleHL != null) {\n // 获取指定字段的高亮片段\n Text[] fragments = titleHL.getFragments();\n // 将这些高亮片段拼接成一个完整的高亮字段\n StringBuilder builder = new StringBuilder();\n for(Text text : fragments) {\n     builder.append(text);\n }\n // 设置到实体类中\n jobDetail.setTitle(builder.toString());\n}\n\nif(jdHL != null) {\n // 获取指定字段的高亮片段\n Text[] fragments = jdHL.getFragments();\n // 将这些高亮片段拼接成一个完整的高亮字段\n StringBuilder builder = new StringBuilder();\n for(Text text : fragments) {\n     builder.append(text);\n }\n // 设置到实体类中\n jobDetail.setJd(builder.toString());\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br")])])])}),[],!1,null,null,null);n.default=t.exports}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[329],{697:function(t,n,e){"use strict";e.r(n);var a=e(5),s=Object(a.a)({},(function(){var t=this,n=t._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("p",[t._v("项目中使用到的是Graphics2D画图工具对图片处理，用ImageIO.write输出图片流的，但是发现如果是人像的话，图片质量前后相差太大，最后用ImageWriter方式会好很多。\n"),n("strong",[t._v("修改前代码")])]),t._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('\n\t/**\n\t * 给图片添加文字水印\n\t * \n\t * @param pressText 水印文字\n\t * @param srcImageFile 源图像地址\n\t * @param destImageFile 目标图像地址\n\t * @param fontName 字体名称\n\t * @param fontStyle 字体样式\n\t * @param color 字体颜色\n\t * @param fontSize 字体大小\n\t * @param x 修正值\n\t * @param y 修正值\n\t * @param alpha 透明度：alpha 必须是范围 [0.0, 1.0] 之内（包含边界值）的一个浮点数字\n\t */\n\tpublic final static void pressText2(String pressText, String srcImageFile, String destImageFile, String fontName, int fontStyle, Color color, int fontSize, int x, int y, float alpha, int wz) {\n\t\ttry {\n\t\t\tImage src = toBufferedImage(srcImageFile);\n\t\t\tint width = src.getWidth(null);\n\t\t\tint height = src.getHeight(null);\n\t\t\tBufferedImage image = new BufferedImage(width, height, BufferedImage.TYPE_INT_RGB);\n\t\t\tGraphics2D g = image.createGraphics();\n\t\t\tg.drawImage(src, 0, 0, width, height, null);\n\t\t\tg.setColor(color);\n\t\t\tg.setFont(new Font(fontName, fontStyle, fontSize));\n\t\t\tg.setComposite(AlphaComposite.getInstance(AlphaComposite.SRC_ATOP, alpha));\n\t\t\tMap<String, Integer> map = getPoint(width, (getLength(pressText) * fontSize), height, fontSize, wz, x, y);\n\t\t\t// 在指定坐标绘制水印文字\n\t\t\tg.drawString(pressText, map.get("_x"), map.get("_y") + fontSize);\n\t\t\tg.dispose();\n\t\t\tImageIO.write((BufferedImage) image, "JPG", new File(destImageFile));\n\t\t} catch (Exception e) {\n\t\t\te.printStackTrace();\n\t\t}\n\t}\n')])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br"),n("span",{staticClass:"line-number"},[t._v("20")]),n("br"),n("span",{staticClass:"line-number"},[t._v("21")]),n("br"),n("span",{staticClass:"line-number"},[t._v("22")]),n("br"),n("span",{staticClass:"line-number"},[t._v("23")]),n("br"),n("span",{staticClass:"line-number"},[t._v("24")]),n("br"),n("span",{staticClass:"line-number"},[t._v("25")]),n("br"),n("span",{staticClass:"line-number"},[t._v("26")]),n("br"),n("span",{staticClass:"line-number"},[t._v("27")]),n("br"),n("span",{staticClass:"line-number"},[t._v("28")]),n("br"),n("span",{staticClass:"line-number"},[t._v("29")]),n("br"),n("span",{staticClass:"line-number"},[t._v("30")]),n("br"),n("span",{staticClass:"line-number"},[t._v("31")]),n("br"),n("span",{staticClass:"line-number"},[t._v("32")]),n("br"),n("span",{staticClass:"line-number"},[t._v("33")]),n("br"),n("span",{staticClass:"line-number"},[t._v("34")]),n("br"),n("span",{staticClass:"line-number"},[t._v("35")]),n("br")])]),n("p",[t._v("Graphics2D 这里已经是优化后的写法，图片不会失真，经过ImageIO.write后保存下来的图片还是有点模糊\n"),n("strong",[t._v("优化后的代码")])]),t._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('/**\n\t * 给图片添加文字水印\n\t * \n\t * @param pressText 水印文字\n\t * @param srcImageFile 源图像地址\n\t * @param destImageFile 目标图像地址\n\t * @param fontName 字体名称\n\t * @param fontStyle 字体样式\n\t * @param color 字体颜色\n\t * @param fontSize 字体大小\n\t * @param x 修正值\n\t * @param y 修正值\n\t * @param alpha 透明度：alpha 必须是范围 [0.0, 1.0] 之内（包含边界值）的一个浮点数字\n\t */\n\tpublic final static void pressText2(String pressText, String srcImageFile, String destImageFile, String fontName, int fontStyle, Color color, int fontSize, int x, int y, float alpha, int wz) {\n\t\ttry {\n\t\t\tImage src = toBufferedImage(srcImageFile);\n\t\t\tint width = src.getWidth(null);\n\t\t\tint height = src.getHeight(null);\n\t\t\tBufferedImage image = new BufferedImage(width, height, BufferedImage.TYPE_INT_RGB);\n\t\t\tGraphics2D g = image.createGraphics();\n\t\t\tg.drawImage(src, 0, 0, width, height, null);\n\t\t\tg.setColor(color);\n\t\t\tg.setFont(new Font(fontName, fontStyle, fontSize));\n\t\t\tg.setComposite(AlphaComposite.getInstance(AlphaComposite.SRC_ATOP, alpha));\n\t\t\tMap<String, Integer> map = getPoint(width, (getLength(pressText) * fontSize), height, fontSize, wz, x, y);\n\t\t\t// 在指定坐标绘制水印文字\n\t\t\tg.drawString(pressText, map.get("_x"), map.get("_y") + fontSize);\n\t\t\tg.dispose();\n\t\t\tIterator<ImageWriter> iter = ImageIO.getImageWritersByFormatName("jpg");\n\t        if (iter.hasNext()) {\t\t\n\t           \tImageWriter writer = iter.next();\t\t\n\t           \tImageWriteParam param = writer.getDefaultWriteParam(); \t\t\t\n\t            param.setCompressionMode(ImageWriteParam.MODE_EXPLICIT);\t\t\n\t           \tparam.setCompressionQuality(1.0f);\t//最高质量\t\n\t            File file=new File(destImageFile);\n\t           \tFileImageOutputStream out = new FileImageOutputStream(file);\t\t\t\n\t           \twriter.setOutput(out);\t\t\n\t           \t// writer.write(bi);\t\t\t\t\n\t           \twriter.write(null, new IIOImage((BufferedImage) image, null, null), param);\t\t\t\t\n\t           \tout.close();\t\t\t\n\t           \twriter.dispose();\t\t\n\t      \t}\n\t\t\t//ImageIO.write((BufferedImage) image, "JPG", new File(destImageFile));\n\t\t} catch (Exception e) {\n\t\t\te.printStackTrace();\n\t\t}\n\t}\n')])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br"),n("span",{staticClass:"line-number"},[t._v("20")]),n("br"),n("span",{staticClass:"line-number"},[t._v("21")]),n("br"),n("span",{staticClass:"line-number"},[t._v("22")]),n("br"),n("span",{staticClass:"line-number"},[t._v("23")]),n("br"),n("span",{staticClass:"line-number"},[t._v("24")]),n("br"),n("span",{staticClass:"line-number"},[t._v("25")]),n("br"),n("span",{staticClass:"line-number"},[t._v("26")]),n("br"),n("span",{staticClass:"line-number"},[t._v("27")]),n("br"),n("span",{staticClass:"line-number"},[t._v("28")]),n("br"),n("span",{staticClass:"line-number"},[t._v("29")]),n("br"),n("span",{staticClass:"line-number"},[t._v("30")]),n("br"),n("span",{staticClass:"line-number"},[t._v("31")]),n("br"),n("span",{staticClass:"line-number"},[t._v("32")]),n("br"),n("span",{staticClass:"line-number"},[t._v("33")]),n("br"),n("span",{staticClass:"line-number"},[t._v("34")]),n("br"),n("span",{staticClass:"line-number"},[t._v("35")]),n("br"),n("span",{staticClass:"line-number"},[t._v("36")]),n("br"),n("span",{staticClass:"line-number"},[t._v("37")]),n("br"),n("span",{staticClass:"line-number"},[t._v("38")]),n("br"),n("span",{staticClass:"line-number"},[t._v("39")]),n("br"),n("span",{staticClass:"line-number"},[t._v("40")]),n("br"),n("span",{staticClass:"line-number"},[t._v("41")]),n("br"),n("span",{staticClass:"line-number"},[t._v("42")]),n("br"),n("span",{staticClass:"line-number"},[t._v("43")]),n("br"),n("span",{staticClass:"line-number"},[t._v("44")]),n("br"),n("span",{staticClass:"line-number"},[t._v("45")]),n("br"),n("span",{staticClass:"line-number"},[t._v("46")]),n("br"),n("span",{staticClass:"line-number"},[t._v("47")]),n("br"),n("span",{staticClass:"line-number"},[t._v("48")]),n("br")])]),n("p",[t._v("替换掉ImageIO.write方式，这下保存下来的图片肉眼上不仔细看，根本看不出来模糊了，哈哈。")])])}),[],!1,null,null,null);n.default=s.exports}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[285],{653:function(n,e,s){"use strict";s.r(e);var t=s(5),r=Object(t.a)({},(function(){var n=this,e=n._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[e("h1",{attrs:{id:"简介"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[n._v("#")]),n._v(" 简介")]),n._v(" "),e("p",[e("strong",[n._v("说明")])]),n._v(" "),e("p",[n._v("本文用示例介绍观察者模式的最好的写法：Spring事件。此方法是项目中"),e("strong",[n._v("最推荐的写法")]),n._v("！")]),n._v(" "),e("p",[e("strong",[n._v("Spring事件和传统观察者模式的概念的区别")])]),n._v(" "),e("table",[e("thead",[e("tr",[e("th",[e("strong",[n._v("传统观察者模式")])]),n._v(" "),e("th",[e("strong",[n._v("Spring事件")])])])]),n._v(" "),e("tbody",[e("tr",[e("td",[n._v("主题")]),n._v(" "),e("td",[n._v("事件")])]),n._v(" "),e("tr",[e("td",[n._v("观察者")]),n._v(" "),e("td",[n._v("监听器")])])])]),n._v(" "),e("p",[e("strong",[n._v("优缺点")])]),n._v(" "),e("p",[n._v("优点")]),n._v(" "),e("ol",[e("li",[n._v("策略类会自动注册，无需手动注册策略类。")]),n._v(" "),e("li",[n._v("可以方便地指定观察者的执行顺序。（观察者模式一般不需要指定顺序，但可以指定当然更好啦！）")])]),n._v(" "),e("p",[n._v("缺点")]),n._v(" "),e("p",[n._v("无")]),n._v(" "),e("h1",{attrs:{id:"实战"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#实战"}},[n._v("#")]),n._v(" 实战")]),n._v(" "),e("p",[n._v("本处使用一个贴近真实场景的案例：订单取消时，要有一系列操作，比如：账户业务需要给用户退钱、库存业务需要给商品退回数量。")]),n._v(" "),e("p",[n._v("在这个场景中，取消订单就是事件，账户业务和库存业务是监听器。")]),n._v(" "),e("p",[n._v("项目结构：")]),n._v(" "),e("p",[e("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/springboot/image-20230912175005837.png",alt:"image-20230912175005837"}})]),n._v(" "),e("h2",{attrs:{id:"代码"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#代码"}},[n._v("#")]),n._v(" 代码")]),n._v(" "),e("p",[e("strong",[n._v("源码下载")])]),n._v(" "),e("p",[e("a",{attrs:{href:"https://resource.skyofit.com/learn/resource/project/backend/design-pattern/observer/spring-event.zip",target:"_blank",rel:"noopener noreferrer"}},[n._v("这里"),e("OutboundLink")],1)]),n._v(" "),e("h2",{attrs:{id:"业务数据类"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#业务数据类"}},[n._v("#")]),n._v(" 业务数据类")]),n._v(" "),e("p",[n._v("取消订单时，会将这个数据包装为事件，给到感兴趣的监听器。")]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("package com.knife.designPattern.bo;\nimport lombok.Data;\n@Data\npublic class CancelOrderBO {\n    private String orderNo;\n}\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br")])]),e("h2",{attrs:{id:"事件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#事件"}},[n._v("#")]),n._v(" 事件")]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("package com.knife.designPattern.event;\nimport org.springframework.context.ApplicationEvent;\npublic class CancelOrderEvent extends ApplicationEvent {\n    public CancelOrderEvent(Object source) {\n        super(source);\n    }\n}\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br")])]),e("p",[n._v("这里还需要一个事件发布器：")]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("package com.knife.designPattern.springEvent.publisher;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.context.ApplicationContext;\nimport org.springframework.context.ApplicationEvent;\nimport org.springframework.stereotype.Component;\n@Component\npublic class EventPublisher {\n    @Autowired\n    private ApplicationContext applicationContext;\n    public void publish(ApplicationEvent event) {\n        applicationContext.publishEvent(event);\n    }\n}\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br")])]),e("h2",{attrs:{id:"监听器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#监听器"}},[n._v("#")]),n._v(" 监听器")]),n._v(" "),e("p",[n._v("账户业务监听器")]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v('package com.knife.designPattern.listener;\nimport com.knife.designPattern.event.CancelOrderEvent;\nimport org.springframework.context.ApplicationListener;\nimport org.springframework.core.Ordered;\nimport org.springframework.stereotype.Component;\n@Component\npublic class AccountCancelOrderListener implements ApplicationListener<CancelOrderEvent>,  Ordered {\n    @Override\n    public void onApplicationEvent(CancelOrderEvent event) {\n        System.out.println("账户业务开始处理订单取消。接收到的消息：" + event.getSource());\n    }\n    @Override\n    public int getOrder() {\n        return 2;\n    }\n}\n')])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br"),e("span",{staticClass:"line-number"},[n._v("16")]),e("br")])]),e("p",[n._v("库存业务监听器")]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v('package com.knife.designPattern.listener;\nimport com.knife.designPattern.event.CancelOrderEvent;\nimport org.springframework.context.ApplicationListener;\nimport org.springframework.core.Ordered;\nimport org.springframework.stereotype.Component;\n@Component\npublic class StorageCancelOrderListener implements ApplicationListener<CancelOrderEvent>, Ordered {\n    public void onApplicationEvent(CancelOrderEvent event) {\n        System.out.println("库存业务开始处理订单取消。接收到的消息：" + event.getSource());\n    }\n    @Override\n    public int getOrder() {\n        return 1;\n    }\n}\n')])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br")])]),e("p",[n._v("细心的同学可以观察到，这里实现了Ordered接口。是的，这种方式支持监听器执行的顺序，getOrder()返回的值越小越先执行。如果不需要控制顺序，可以不实现Ordered接口。")]),n._v(" "),e("h1",{attrs:{id:"测试"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#测试"}},[n._v("#")]),n._v(" 测试")]),n._v(" "),e("p",[n._v("测试类")]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v('package com.knife.designPattern.controller;\nimport com.knife.designPattern.publisher.EventPublisher;\nimport com.knife.designPattern.bo.CancelOrderBO;\nimport com.knife.designPattern.event.CancelOrderEvent;\nimport io.swagger.annotations.Api;\nimport io.swagger.annotations.ApiOperation;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.web.bind.annotation.PostMapping;\nimport org.springframework.web.bind.annotation.RequestBody;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RestController;\n@Api(tags = "订单")\n@RestController\n@RequestMapping("order")\npublic class OrderController {\n    @Autowired\n    private EventPublisher eventPublisher;\n    @ApiOperation("取消订单")\n    @PostMapping("cancel")\n    public String cancel(@RequestBody CancelOrderBO cancelOrderBO) {\n        eventPublisher.publish(new CancelOrderEvent(cancelOrderBO));\n        return "success";\n    }\n}\n')])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br"),e("span",{staticClass:"line-number"},[n._v("16")]),e("br"),e("span",{staticClass:"line-number"},[n._v("17")]),e("br"),e("span",{staticClass:"line-number"},[n._v("18")]),e("br"),e("span",{staticClass:"line-number"},[n._v("19")]),e("br"),e("span",{staticClass:"line-number"},[n._v("20")]),e("br"),e("span",{staticClass:"line-number"},[n._v("21")]),e("br"),e("span",{staticClass:"line-number"},[n._v("22")]),e("br"),e("span",{staticClass:"line-number"},[n._v("23")]),e("br"),e("span",{staticClass:"line-number"},[n._v("24")]),e("br")])]),e("p",[n._v("访问接口")]),n._v(" "),e("p",[n._v("启动项目后，访问Knife4j（接口文档）的地址：http://localhost:8080/doc.html")]),n._v(" "),e("p",[n._v("（当然，你用postman也完全可以）")]),n._v(" "),e("p",[e("img",{attrs:{src:"https://404500.oss-cn-beijing.aliyuncs.com/picture/springboot/image-20230912175058655.png",alt:"image-20230912175058655"}})]),n._v(" "),e("p",[n._v("结果")]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("库存业务开始处理订单取消。接收到的消息：CancelOrderBO(orderNo=2255)\n账户业务开始处理订单取消。接收到的消息：CancelOrderBO(orderNo=2255)\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br")])]),e("p",[n._v("​\t\t\t\t\t\t\t\t\t[ 1](javascript:😉")])])}),[],!1,null,null,null);e.default=r.exports}}]);